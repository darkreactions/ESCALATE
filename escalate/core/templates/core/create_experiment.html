{% extends 'core/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load index %}

{% block content %}
<div class="container" >


    {% if new_exp_name %}
        <p> Created Experiment! </p>
            <p>Experiment name: {{ new_exp_name }}</p>
            <p> <a href={{ experiment_link }}> View experiment details</a></p>
            <form action="{{ reagent_prep_link }}">
              <button class="btn btn-outline-primary" type="submit">Prepare Reagent</button>
            </form>
            <form action="{{ outcome_link }}">
              <button class="btn btn-outline-primary" type="submit">Submit Outcomes</button>
            </form>
            {% if lsr_download_link is not None %}
              <p> <a href={{ lsr_download_link }}> Download LibraryStudio file </a></p>
            {% else %}
               {% if messages %}
                <ul class="messages">
                    {% for message in messages %}
                    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            {% endif %}
    {% else %}

    {% if not selected_exp_template %}
    <p> Experiment Template </p>
    <div class="row">
      <div class="col-md-12 text-secondary">
        <form method="post">{% csrf_token %}
        {{ experiment_template_select_form|crispy }}
        <div>
          <button class="btn btn-outline-primary" type="submit">Select Template</button>
      </div>
      </form>
      </div>
    </div>
    {% endif %}

    {% if selected_exp_template %}
    <p>Selected experiment {{ selected_exp_template.description }}</p>
    <div class="row">
        <div class="col-md-12">

          {% if messages %}
          <ul class="messages">
              {% for message in messages %}
              <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
              {% endfor %}
          </ul>
          {% endif %}

            <form method="post" enctype="multipart/form-data">{% csrf_token %}
              
              {% if manual > 0 %}          

                <button class="btn btn-outline-primary" type="submit" name="robot_download"
                  value="Submit">Download Robot file</button>
                {% endif %}
                </div>
                
            </form>
            
            <form method="post" enctype="multipart/form-data">{% csrf_token %}
              {{ experiment_name_form|crispy }}
                {% if automated > 0 %}
                {{ reagent_formset.management_form }}
                  {% for reagent_form in reagent_formset %}
                  <div class="card text-white" style="background-color: {{ colors|index:forloop.counter0 }}" >
                    <div class="card-header ">{{ reagent_template_names|index:forloop.counter0 }}</div>
                    <div class="card-body ">
                      <!--h5 class="card-title"></h5-->
                      {% crispy reagent_form reagent_formset_helper %}
                    </div>
                  </div>
                    <br>             
                  {% endfor %}
                 <div class="treeview-animated border mx-3 my-4">
                      <h6 class="pt-3 pl-3">Vessel Selection for {{ selected_exp_template.description }}</h6>
                      <hr>
                      <ul class="treeview-animated-list">
                          <li class="treeview-animated-items">
                            <a class="closed">
                              <i class="fas fa-angle-right"></i>
                              <span><i class="fas fa-table ic-w mx-1"></i>Vessel</span>
                            </a>
                            <ul class="nested">
                                  {{ vessel_form|crispy }}
                            </ul>
                          </li>
                      </ul>
                  </div>
                  <div class="treeview-animated border mx-3 my-4">
                    <h6 class="pt-3 pl-3">Dead Volume for {{ selected_exp_template.description }}</h6>
                    <hr>
                    <ul class="treeview-animated-list">
                        <li class="treeview-animated-items">
                          <a class="closed">
                            <i class="fas fa-angle-right"></i>
                            <span><i class="fas fa-table ic-w mx-1"></i>Dead Volume</span>
                          </a>
                          <ul class="nested">
                                {{ dead_volume_form|crispy }}
                          </ul>
                        </li>
                    </ul>
                </div>
                {{ reaction_parameter_formset.management_form }}
                <div class="treeview-animated border mx-3 my-4">
                    <h6 class="pt-3 pl-3">Reaction Parameters for {{ selected_exp_template.description }}</h6>
                    <hr>
                    <ul class="treeview-animated-list">
                    	{% for reaction_parameter_label, reaction_parameter_form in reaction_parameter_labels %}
                        <li class="treeview-animated-items">
                          <a class="closed">
                            <i class="fas fa-angle-right"></i>
                            <span><i class="fas fa-table ic-w mx-1"></i>{{ reaction_parameter_label }}</span>
                          </a>
                          <ul class="nested">
                                {{ reaction_parameter_form }}
                          </ul>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                  <input type="hidden" id="automated" name="automated" value="{{ automated }}">
                  <div class="text-right">
                    <button class="btn btn-outline-primary" type="submit" name="create_exp" value="create_exp">Create Experiment</button>
                  {% endif %}


                {% if manual > 0 %}
                {{ reagent_formset.management_form }}
                  {% for reagent_form in reagent_formset %}
                    <div class="card text-white" style="background-color: {{ colors|index:forloop.counter0 }}" >
                      <div class="card-header ">{{ reagent_template_names|index:forloop.counter0 }}</div>
                      <div class="card-body ">
                        <!--h5 class="card-title"></h5-->
                        {% crispy reagent_form reagent_formset_helper %}
                      </div>
                    </div>
                      <br>             
                    {% endfor %}

                {{ robot_file_upload_form|crispy }}
                <button class="btn btn-outline-primary" type="submit" name="robot_upload" value="create_exp">Create Experiment</button> 
                

                <div class="treeview-animated border mx-3 my-4">
                  <h6 class="pt-3 pl-3">Vessel Selection for {{ selected_exp_template.description }}</h6>
                  <hr>
                  <ul class="treeview-animated-list">
                      <li class="treeview-animated-items">
                        <a class="closed">
                          <i class="fas fa-angle-right"></i>
                          <span><i class="fas fa-table ic-w mx-1"></i>Vessel</span>
                        </a>
                        <ul class="nested">
                              {{ vessel_form|crispy }}
                        </ul>
                      </li>
                  </ul>
              </div>
              <div class="treeview-animated border mx-3 my-4">
                <h6 class="pt-3 pl-3">Dead Volume for {{ selected_exp_template.description }}</h6>
                <hr>
                <ul class="treeview-animated-list">
                    <li class="treeview-animated-items">
                      <a class="closed">
                        <i class="fas fa-angle-right"></i>
                        <span><i class="fas fa-table ic-w mx-1"></i>Dead Volume</span>
                      </a>
                      <ul class="nested">
                            {{ dead_volume_form|crispy }}
                      </ul>
                    </li>
                </ul>
            </div>
              {{ reaction_parameter_formset.management_form }}
              <div class="treeview-animated border mx-3 my-4">
                  <h6 class="pt-3 pl-3">Reaction Parameters for {{ selected_exp_template.description }}</h6>
                  <hr>
                  <ul class="treeview-animated-list">
                    {% for reaction_parameter_label, reaction_parameter_form in reaction_parameter_labels %}
                      <li class="treeview-animated-items">
                        <a class="closed">
                          <i class="fas fa-angle-right"></i>
                          <span><i class="fas fa-table ic-w mx-1"></i>{{ reaction_parameter_label }}</span>
                        </a>
                        <ul class="nested">
                              {{ reaction_parameter_form }}
                        </ul>
                      </li>
                      {% endfor %}
                </ul>
            </div>
              <input type="hidden" id="automated" name="automated" value="{{ automated }}">
              <div class="text-right">
                <button class="btn btn-outline-primary" type="submit" name="create_exp" value="create_exp">Create Experiment</button>
              {% endif %}
                
                </div>

        </div>

    </div>

      {% endif %}
    {% endif %}
    
</div>

{% endblock %}


{% block tailcontent %}
<script>
    // Treeview Initialization
    $(document).ready(function() {
      $('.treeview-animated').mdbTreeview();
    });
</script>

{% endblock %}
