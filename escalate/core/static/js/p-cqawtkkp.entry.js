import{r as registerInstance,c as createEvent,h,g as getElement,H as Host}from"./p-5341f061.js";var ActivityDisplayMode;!function(t){t.Design="Design",t.Edit="Edit"}(ActivityDisplayMode||(ActivityDisplayMode={}));class ActivityEditor{constructor(t){registerInstance(this,t),this.activityDefinitions=[],this.submit=createEvent(this,"update-activity",7)}async onSubmit(t){t.preventDefault();const i=new FormData(t.target),n=await this.renderer.updateEditor(i);this.submit.emit(n),this.show=!1}componentDidRender(){$(this.el.querySelector(".modal")).modal(this.show?"show":"hide")}render(){const t=this.activity;if(!t)return null;const i=this.activityDefinitions.find(i=>i.type==t.type);if(i)return h("div",null,h("div",{class:"modal",tabindex:"-1",role:"dialog"},h("div",{class:"modal-dialog modal-xl",role:"document"},h("div",{class:"modal-content"},h("form",{onSubmit:t=>this.onSubmit(t)},h("div",{class:"modal-header"},h("h5",{class:"modal-title"},"Edit ",i.displayName),h("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},h("span",{"aria-hidden":"true"},"×"))),h("div",{class:"modal-body"},h("wf-activity-renderer",{activity:t,activityDefinition:i,displayMode:ActivityDisplayMode.Edit,ref:t=>this.renderer=t})),h("div",{class:"modal-footer"},h("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancel"),h("button",{type:"submit",class:"btn btn-primary"},"Save")))))));console.error(`No activity of type ${this.activity.type} exists in the library.`)}get el(){return getElement(this)}static get style(){return""}}class ActivityPicker{constructor(t){registerInstance(this,t),this.activityDefinitions=[],this.filterText="",this.selectedCategory=null,this.onFilterTextChanged=t=>{this.filterText=t.target.value},this.selectCategory=t=>{this.selectedCategory=t},this.renderActivity=t=>h("div",{class:"card activity"},h("div",{class:"card-body"},h("h4",{class:"card-title"},h("i",{class:`${t.icon||"fas fa-cog"} mr-1`}),t.displayName),h("p",null,t.description),h("a",{href:"#",onClick:i=>{i.preventDefault(),this.selectCategory(t.category)}},h("span",{class:"badge badge-light"},t.category))),h("div",{class:"card-footer text-muted text-xs-right"},h("a",{class:"btn btn-primary btn-sm",href:"#",onClick:async i=>{i.preventDefault(),await this.onActivitySelected(t)}},"Select"))),this.activitySelected=createEvent(this,"activity-picked",7)}async show(){this.isVisible=!0,$(this.modal).modal("show")}async hide(){$(this.modal).modal("hide"),this.isVisible=!1}async onActivitySelected(t){this.activitySelected.emit(t),await this.hide()}render(){const t=this.activityDefinitions,i=[null,...new Set(t.map(t=>t.category))],n=this.filterText,e=this.selectedCategory;let s=t;return e&&(s=s.filter(t=>t.category.toLowerCase()===e.toLowerCase())),n&&(s=s.filter(t=>t.displayName.toLowerCase().includes(n.toLowerCase()))),h("div",null,h("div",{class:"modal",tabindex:"-1",role:"dialog",ref:t=>this.modal=t},h("div",{class:"modal-dialog modal-xl",role:"document"},h("div",{class:"modal-content"},h("div",{class:"modal-header"},h("h5",{class:"modal-title"},"Available Activities"),h("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},h("span",{"aria-hidden":"true"},"×"))),h("div",{class:"modal-body"},h("div",{class:"row"},h("div",{class:"col-sm-3 col-md-3 col-lg-2"},h("div",{class:"form-group"},h("input",{class:"form-control",type:"search",placeholder:"Filter","aria-label":"Filter",autofocus:!0,onKeyUp:this.onFilterTextChanged})),h("ul",{class:"nav nav-pills flex-column activity-picker-categories"},i.map(t=>h("li",{class:"nav-item"},h("a",{class:{"nav-link":!0,active:t===this.selectedCategory},href:"#","data-toggle":"pill",onClick:i=>{i.preventDefault(),this.selectCategory(t)}},t||"All"))))),h("div",{class:"col-sm-9 col-md-9 col-lg-10"},h("div",{class:"card-columns tab-content"},s.map(this.renderActivity))))),h("div",{class:"modal-footer"},h("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancel"))))))}get el(){return getElement(this)}static get style(){return""}}class FormUpdater{static updateEditor(t,i){const n=Object.assign({},t.state);return i.forEach((t,i)=>{n[i]=t}),Object.assign({},t,{state:n})}}class DefaultActivityHandler{constructor(){this.renderDesigner=(activity,definition)=>{let description=null;description=activity.state.description?activity.state.description:definition.runtimeDescription?definition.runtimeDescription:definition.description;try{const fun=eval(description);description=fun({activity,definition,state:activity.state})}catch(t){}return{title:activity.state.title||definition.displayName,description,icon:definition.icon||"fas fa-cog"}},this.updateEditor=(t,i)=>FormUpdater.updateEditor(t,i),this.getOutcomes=(activity,definition)=>{let outcomes=[];if(definition){const lambda=definition.outcomes;if(lambda instanceof Array)outcomes=lambda;else{const value=eval(lambda);if(value instanceof Array)outcomes=value;else if(value instanceof Function)try{outcomes=value({activity,definition,state:activity.state})}catch(t){console.warn(t),outcomes=[]}}}return outcomes||[]}}}class ActivityManager{constructor(){this.addHandler=(t,i)=>{this.handlers[t]=Object.assign({},i)},this.renderDesigner=(t,i)=>{const n=this.getHandler(t.type);return n.renderDesigner?n.renderDesigner(t,i):{title:t.state.title||i.displayName,description:t.state.description||i.description,icon:i.icon||"fas fa-cog"}},this.updateEditor=(t,i)=>(this.getHandler(t.type).updateEditor||FormUpdater.updateEditor)(t,i),this.getOutcomes=(t,i)=>{const n=this.getHandler(t.type);return n.getOutcomes?n.getOutcomes(t,i):[]},this.getHandler=t=>this.handlers[t]||new DefaultActivityHandler,this.handlers={}}}const ActivityManager$1=new ActivityManager;class DisplayManager{constructor(){this.addDriver=(t,i)=>{this.drivers[t]=Object.assign({},i)},this.displayEditor=(t,i)=>{const n=this.drivers[i.type];return n?n.displayEditor(t,i):null},this.updateEditor=(t,i,n)=>{const e=this.drivers[i.type];e&&e.updateEditor(t,i,n)},this.drivers={}}}const DisplayManager$1=new DisplayManager;class ActivityRenderer{constructor(t){registerInstance(this,t),this.displayMode=ActivityDisplayMode.Design}render(){if(!this.activity||!this.activityDefinition)return null;switch(this.displayMode){case ActivityDisplayMode.Design:return this.renderDesigner();case ActivityDisplayMode.Edit:return this.renderEditor()}}renderDesigner(){const t=ActivityManager$1.renderDesigner(this.activity,this.activityDefinition);return h("div",null,h("h5",null,h("i",{class:`${t.icon} mr-1`}),t.title),h("p",{innerHTML:t.description}))}renderEditor(){const t=this.activity;return h(Host,null,this.activityDefinition.properties.map(i=>{const n=DisplayManager$1.displayEditor(t,i);return h("div",{class:"form-group",innerHTML:n})}))}async updateEditor(t){const i=Object.assign({},this.activity),n=this.activityDefinition.properties;for(const e of n)DisplayManager$1.updateEditor(i,e,t);return i}static get style(){return""}}class ContextMenu{constructor(t){registerInstance(this,t),this.isHidden=!0,this.position={left:0,top:0},this.onContextMenu=t=>{t.defaultPrevented||(t.preventDefault(),this.contextMenuEvent.emit(),this.position={left:t.pageX,top:t.pageY},this.isHidden=!1)},this.onContextMenuClick=()=>{this.isHidden=!0},this.contextMenuEvent=createEvent(this,"context-menu",7)}targetChangeHandler(t,i){i&&i.removeEventListener("contextmenu",this.onContextMenu),this.setupTarget(t)}targetSelectorChangeHandler(t){this.target=document.querySelector(t)}handleBodyClick(){this.isHidden=!0}handleContextMenu(){this.isHidden=!0}async handleContextMenuEvent(t){this.onContextMenu(t)}componentDidLoad(){this.setupTarget(this.target)}render(){return h(Host,{class:"dropdown-menu context-menu canvas-context-menu position-fixed",style:{left:`${this.position.left}px`,top:`${this.position.top}px`,display:this.isHidden?"none":"block"},onClick:this.onContextMenuClick},h("slot",null))}setupTarget(t){t&&t.addEventListener("contextmenu",this.onContextMenu,{capture:!1})}get el(){return getElement(this)}static get watchers(){return{target:["targetChangeHandler"],targetSelector:["targetSelectorChangeHandler"]}}static get style(){return""}}class ContextMenuItem{constructor(t){registerInstance(this,t)}render(){return h("a",{class:"dropdown-item",href:"#",onClick:t=>t.preventDefault()},this.text)}get el(){return getElement(this)}static get style(){return""}}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(t,i){return t(i={exports:{}},i.exports),i.exports}var jsplumb=createCommonjsModule(function(t,i){(function(){void 0===Math.sgn&&(Math.sgn=function(t){return 0==t?0:t>0?1:-1});var t=function(t,i){return{x:t.x-i.x,y:t.y-i.y}},n=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},e=Math.pow(2,-65),s=function(i,e){for(var s=[],h=r(i,e),u=e.length-1,a=o(h,2*u-1,s,0),l=t(i,e[0]),f=n(l),v=0,d=0;d<a;d++){l=t(i,c(e,u,s[d],null,null));var p=n(l);p<f&&(f=p,v=s[d])}return l=t(i,e[u]),(p=n(l))<f&&(f=p,v=1),{location:v,distance:f}},r=function(i,n){for(var e=n.length-1,s=2*e-1,r=[],o=[],h=[],u=[],a=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],c=0;c<=e;c++)r[c]=t(n[c],i);for(c=0;c<=e-1;c++)o[c]=t(n[c+1],n[c]),o[c]={x:(l=o[c]).x*(f=3),y:l.y*f};for(var l,f,v,d,p=0;p<=e-1;p++)for(var m=0;m<=e;m++)h[p]||(h[p]=[]),h[p][m]=(v=o[p]).x*(d=r[m]).x+v.y*d.y;for(c=0;c<=s;c++)u[c]||(u[c]=[]),u[c].y=0,u[c].x=parseFloat(c)/s;for(var g=e,y=e-1,x=0;x<=g+y;x++){var b=Math.max(0,x-y),w=Math.min(x,g);for(c=b;c<=w;c++){var M=x-c;u[c+M].y+=h[M][c]*a[M][c]}}return u},o=function(t,i,n,e){var s,r,l=[],f=[],v=[],d=[];switch(h(t,i)){case 0:return 0;case 1:if(e>=64)return n[0]=(t[0].x+t[i].x)/2,1;if(u(t,i))return n[0]=a(t,i),1}c(t,i,.5,l,f),s=o(l,i,v,e+1),r=o(f,i,d,e+1);for(var p=0;p<s;p++)n[p]=v[p];for(p=0;p<r;p++)n[p+s]=d[p];return s+r},h=function(t,i){var n,e,s=0;n=e=Math.sgn(t[0].y);for(var r=1;r<=i;r++)(n=Math.sgn(t[r].y))!=e&&s++,e=n;return s},u=function(t,i){var n,s,r,o,h,u,a,c,l;o=t[0].y-t[i].y,h=t[i].x-t[0].x,u=t[0].x*t[i].y-t[i].x*t[0].y,c=l=0;for(var f=1;f<i;f++){var v=o*t[f].x+h*t[f].y+u;v>c?c=v:v<l&&(l=v)}return n=(1*(u-c)-0*(a=h))*(1/(0*a-1*o)),s=(1*(u-l)-0*(a=h))*(1/(0*a-1*o)),r=Math.min(n,s),Math.max(n,s)-r<e?1:0},a=function(t,i){var n=t[i].x-t[0].x,e=t[i].y-t[0].y;return 0+1/(0*n-1*e)*(n*(t[0].y-0)-e*(t[0].x-0))*1},c=function(t,i,n,e,s){for(var r=[[]],o=0;o<=i;o++)r[0][o]=t[o];for(var h=1;h<=i;h++)for(o=0;o<=i-h;o++)r[h]||(r[h]=[]),r[h][o]||(r[h][o]={}),r[h][o].x=(1-n)*r[h-1][o].x+n*r[h-1][o+1].x,r[h][o].y=(1-n)*r[h-1][o].y+n*r[h-1][o+1].y;if(null!=e)for(o=0;o<=i;o++)e[o]=r[o][0];if(null!=s)for(o=0;o<=i;o++)s[o]=r[i-o][o];return r[i][0]},l={},f=function(t,i){for(var n=function(t){var i=l[t];if(!i){var n=function(t){return function(){return t}},e=function(){return function(t){return t}},s=function(){return function(t){return 1-t}},r=function(t){return function(i){for(var n=1,e=0;e<t.length;e++)n*=t[e](i);return n}};(i=[]).push(new function(){return function(i){return Math.pow(i,t)}});for(var o=1;o<t;o++){for(var h=[new n(t)],u=0;u<t-o;u++)h.push(new e);for(u=0;u<o;u++)h.push(new s);i.push(new r(h))}i.push(new function(){return function(i){return Math.pow(1-i,t)}}),l[t]=i}return i}(t.length-1),e=0,s=0,r=0;r<t.length;r++)e+=t[r].x*n[r](i),s+=t[r].y*n[r](i);return{x:e,y:s}},v=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))},d=function(t){return t[0].x===t[1].x&&t[0].y===t[1].y},p=function(t,i,n){if(d(t))return{point:t[0],location:i};for(var e=f(t,i),s=0,r=i,o=n>0?1:-1,h=null;s<Math.abs(n);)h=f(t,r+=.005*o),s+=v(h,e),e=h;return{point:h,location:r}},m=function(t,i){var n=f(t,i),e=f(t.slice(0,t.length-1),i),s=e.y-n.y;return 0===s?1/0:Math.atan(s/(e.x-n.x))},g=function(t,i,n,e,s){var r=e-i,o=t-n,h=t*(i-e)+i*(n-t),u=function(t){return[y(t,"x"),y(t,"y")]}(s),a=function(t,i,n,e){var s,r,o=i/t,h=n/t,u=e/t,a=(3*h-Math.pow(o,2))/9,c=(9*o*h-27*u-2*Math.pow(o,3))/54,l=Math.pow(a,3)+Math.pow(c,2),f=[];if(l>=0)s=x(c+Math.sqrt(l))*Math.pow(Math.abs(c+Math.sqrt(l)),1/3),r=x(c-Math.sqrt(l))*Math.pow(Math.abs(c-Math.sqrt(l)),1/3),f[0]=-o/3+(s+r),f[1]=-o/3-(s+r)/2,f[2]=-o/3-(s+r)/2,0!==Math.abs(Math.sqrt(3)*(s-r)/2)&&(f[1]=-1,f[2]=-1);else{var v=Math.acos(c/Math.sqrt(-Math.pow(a,3)));f[0]=2*Math.sqrt(-a)*Math.cos(v/3)-o/3,f[1]=2*Math.sqrt(-a)*Math.cos((v+2*Math.PI)/3)-o/3,f[2]=2*Math.sqrt(-a)*Math.cos((v+4*Math.PI)/3)-o/3}for(var d=0;d<3;d++)(f[d]<0||f[d]>1)&&(f[d]=-1);return f}.apply(null,[r*u[0][0]+o*u[1][0],r*u[0][1]+o*u[1][1],r*u[0][2]+o*u[1][2],r*u[0][3]+o*u[1][3]+h]),c=[];if(null!=a)for(var l=0;l<3;l++){var f,v=a[l],d=Math.pow(v,2),p=Math.pow(v,3),m=[u[0][0]*p+u[0][1]*d+u[0][2]*v+u[0][3],u[1][0]*p+u[1][1]*d+u[1][2]*v+u[1][3]];f=n-t!=0?(m[0]-t)/(n-t):(m[1]-i)/(e-i),v>=0&&v<=1&&f>=0&&f<=1&&c.push(m)}return c};function y(t,i){return[3*t[1][i]-t[0][i]+-3*t[2][i]+t[3][i],3*t[0][i]-6*t[1][i]+3*t[2][i],-3*t[0][i]+3*t[1][i],t[0][i]]}function x(t){return t<0?-1:t>0?1:0}var b=this.jsBezier={distanceFromCurve:s,gradientAtPoint:m,gradientAtPointAlongCurveFrom:function(t,i,n){var e=p(t,i,n);return e.location>1&&(e.location=1),e.location<0&&(e.location=0),m(t,e.location)},nearestPointOnCurve:function(t,i){var n=s(t,i);return{point:c(i,i.length-1,n.location,null,null),location:n.location}},pointOnCurve:f,pointAlongCurveFrom:function(t,i,n){return p(t,i,n).point},perpendicularToCurveAt:function(t,i,n,e){var s=p(t,i,e=null==e?0:e),r=m(t,s.location),o=Math.atan(-1/r),h=n/2*Math.sin(o),u=n/2*Math.cos(o);return[{x:s.point.x+u,y:s.point.y+h},{x:s.point.x-u,y:s.point.y-h}]},locationAlongCurveFrom:function(t,i,n){return p(t,i,n).location},getLength:function(t){if(d(t))return 0;for(var i=f(t,0),n=0,e=0,s=null;e<1;)s=f(t,e+=.005),n+=v(s,i),i=s;return n},lineIntersection:g,boxIntersection:function(t,i,n,e,s){var r=[];return r.push.apply(r,g(t,i,t+n,i,s)),r.push.apply(r,g(t+n,i,t+n,i+e,s)),r.push.apply(r,g(t+n,i+e,t,i+e,s)),r.push.apply(r,g(t,i+e,t,i,s)),r},boundingBoxIntersection:function(t,i){var n=[];return n.push.apply(n,g(t.x,t.y,t.x+t.w,t.y,i)),n.push.apply(n,g(t.x+t.w,t.y,t.x+t.w,t.y+t.h,i)),n.push.apply(n,g(t.x+t.w,t.y+t.h,t.x,t.y+t.h,i)),n.push.apply(n,g(t.x,t.y+t.h,t.x,t.y,i)),n},version:"0.9.0"};i.jsBezier=b}).call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.Biltong={version:"0.4.0"};i.Biltong=t;var n=function(t){return"[object Array]"===Object.prototype.toString.call(t)},e=function(t,i,e){return e(t=n(t)?t:[t.x,t.y],i=n(i)?i:[i.x,i.y])},s=t.gradient=function(t,i){return e(t,i,function(t,i){return i[0]==t[0]?i[1]>t[1]?1/0:-1/0:i[1]==t[1]?i[0]>t[0]?0:-0:(i[1]-t[1])/(i[0]-t[0])})},r=(t.normal=function(t,i){return-1/s(t,i)},t.lineLength=function(t,i){return e(t,i,function(t,i){return Math.sqrt(Math.pow(i[1]-t[1],2)+Math.pow(i[0]-t[0],2))})},t.quadrant=function(t,i){return e(t,i,function(t,i){return i[0]>t[0]?i[1]>t[1]?2:1:i[0]==t[0]?i[1]>t[1]?2:1:i[1]>t[1]?3:4})}),o=(t.theta=function(t,i){return e(t,i,function(t,i){var n=s(t,i),e=Math.atan(n),o=r(t,i);return 4!=o&&3!=o||(e+=Math.PI),e<0&&(e+=2*Math.PI),e})},t.intersects=function(t,i){var n=t.x,e=t.x+t.w,s=t.y,r=t.y+t.h,o=i.x,h=i.x+i.w,u=i.y,a=i.y+i.h;return n<=o&&o<=e&&s<=u&&u<=r||n<=h&&h<=e&&s<=u&&u<=r||n<=o&&o<=e&&s<=a&&a<=r||n<=h&&o<=e&&s<=a&&a<=r||o<=n&&n<=h&&u<=s&&s<=a||o<=e&&e<=h&&u<=s&&s<=a||o<=n&&n<=h&&u<=r&&r<=a||o<=e&&n<=h&&u<=r&&r<=a},t.encloses=function(t,i,n){var e=t.y,s=t.y+t.h,r=i.y,o=i.y+i.h,h=function(t,i,e,s){return n?t<=i&&e>=s:t<i&&e>s};return h(t.x,i.x,t.x+t.w,i.x+i.w)&&h(e,r,s,o)},[null,[1,-1],[1,1],[-1,1],[-1,-1]]),h=[null,[-1,-1],[-1,1],[1,1],[1,-1]];t.pointOnLine=function(t,i,n){var e=s(t,i),u=r(t,i),a=n>0?o[u]:h[u],c=Math.atan(e),l=Math.abs(n*Math.sin(c))*a[1],f=Math.abs(n*Math.cos(c))*a[0];return{x:t.x+f,y:t.y+l}},t.perpendicularLineTo=function(t,i,n){var e=s(t,i),r=Math.atan(-1/e),o=n/2*Math.sin(r),h=n/2*Math.cos(r);return[{x:i.x+h,y:i.y+o},{x:i.x-h,y:i.y-o}]}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=function(t,i,n){for(var e=(n=n||t.parentNode).querySelectorAll(i),s=0;s<e.length;s++)if(e[s]===t)return!0;return!1},n=function(t){return"string"==typeof t||t.constructor===String?document.getElementById(t):t},e=function(t){return t.srcElement||t.target},s=function(t,i,n,e){if(e){if(void 0!==t.path&&t.path.indexOf)return{path:t.path,end:t.path.indexOf(n)};var s={path:[],end:-1},r=function(t){s.path.push(t),t===n?s.end=s.path.length-1:null!=t.parentNode&&r(t.parentNode)};return r(i),s}return{path:[i],end:1}},r=function(t,i){for(var n=0,e=t.length;n<e&&t[n]!=i;n++);n<t.length&&t.splice(n,1)},o=1,h=function(t,i,n){var e=o++;return t.__ta=t.__ta||{},t.__ta[i]=t.__ta[i]||{},t.__ta[i][e]=n,n.__tauid=e,e},u=function(i,n,r,o){if(null==i)return r;var h=i.split(","),u=function(o){u.__tauid=r.__tauid;var a=e(o),c=a,l=s(o,a,n,null!=i);if(-1!=l.end)for(var f=0;f<l.end;f++){c=l.path[f];for(var v=0;v<h.length;v++)t(c,h[v],n)&&r.apply(c,arguments)}};return a(r,o,u),u},a=function(t,i,n){t.__taExtra=t.__taExtra||[],t.__taExtra.push([i,n])},c=function(t,i,n,e){if(p&&g[i]){var s=u(e,t,n,g[i]);S(t,g[i],s,n)}"focus"===i&&null==t.getAttribute("tabindex")&&t.setAttribute("tabindex","1"),S(t,i,u(e,t,n,i),n)},l={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}},f=function(i,n){return function(o,h,u,a){if("contextmenu"==h&&m)c(o,h,u,a);else{if(null==o.__taTapHandler){var f=o.__taTapHandler={tap:[],dbltap:[],contextmenu:[],down:!1,taps:0,downSelectors:[]},v=function(){f.down=!1},d=function(){f.taps=0};c(o,"mousedown",function(r){for(var h=e(r),u=s(r,h,o,null!=a),c=!1,l=0;l<u.end;l++){if(c)return;h=u.path[l];for(var p=0;p<f.downSelectors.length;p++)if(null==f.downSelectors[p]||t(h,f.downSelectors[p],o)){f.down=!0,setTimeout(v,i),setTimeout(d,n),c=!0;break}}}),c(o,"mouseup",function(i){if(f.down){var n,r,h=e(i);f.taps++;var u=C(i);for(var a in l)if(l.hasOwnProperty(a)){var c=l[a];if(c.touches===u&&(1===c.taps||c.taps===f.taps))for(var v=0;v<f[a].length;v++){r=s(i,h,o,null!=f[a][v][1]);for(var d=0;d<r.end;d++)if(n=r.path[d],null==f[a][v][1]||t(n,f[a][v][1],o)){f[a][v][0].apply(n,[i]);break}}}}})}o.__taTapHandler.downSelectors.push(a),o.__taTapHandler[h].push([u,a]),u.__taUnstore=function(){r(o.__taTapHandler[h],u)}}}},v=function(t,i,n,e){for(var s in n.__tamee[t])n.__tamee[t].hasOwnProperty(s)&&n.__tamee[t][s].apply(e,[i])},d=function(){var i=[];return function(n,s,r,o){if(!n.__tamee){n.__tamee={over:!1,mouseenter:[],mouseexit:[]};var a=function(s){var r=e(s);(null==o&&r==n&&!n.__tamee.over||t(r,o,n)&&(null==r.__tamee||!r.__tamee.over))&&(v("mouseenter",s,n,r),r.__tamee=r.__tamee||{},r.__tamee.over=!0,i.push(r))},c=function(s){for(var r=e(s),o=0;o<i.length;o++)r!=i[o]||t(s.relatedTarget||s.toElement,"*",r)||(r.__tamee.over=!1,i.splice(o,1),v("mouseexit",s,n,r))};S(n,"mouseover",u(o,n,a,"mouseover"),a),S(n,"mouseout",u(o,n,c,"mouseout"),c)}r.__taUnstore=function(){delete n.__tamee[s][r.__tauid]},h(n,s,r),n.__tamee[s][r.__tauid]=r}},p="ontouchstart"in document.documentElement,m="onmousedown"in document.documentElement,g={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},y=function(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var i=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(i)&&(t=parseFloat(RegExp.$1))}return t}(),x=y>-1&&y<9,b=function(t,i){if(null==t)return[0,0];var n=T(t),e=M(n,0);return[e[i+"X"],e[i+"Y"]]},w=function(t){return null==t?[0,0]:x?[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop]:b(t,"page")},M=function(t,i){return t.item?t.item(i):t[i]},T=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},C=function(t){return T(t).length},S=function(t,i,n,e){if(h(t,i,n),e.__tauid=n.__tauid,t.addEventListener)t.addEventListener(i,n,!1);else if(t.attachEvent){var s=i+n.__tauid;t["e"+s]=n,t[s]=function(){t["e"+s]&&t["e"+s](window.event)},t.attachEvent("on"+i,t[s])}},E=function(t,i,e){null!=e&&j(t,function(){var s=n(this);if(function(t,n,e){if(t.__ta&&t.__ta[i]&&delete t.__ta[i][e.__tauid],e.__taExtra){for(var s=0;s<e.__taExtra.length;s++)E(t,e.__taExtra[s][0],e.__taExtra[s][1]);e.__taExtra.length=0}e.__taUnstore&&e.__taUnstore()}(s,0,e),null!=e.__tauid)if(s.removeEventListener)s.removeEventListener(i,e,!1),p&&g[i]&&s.removeEventListener(g[i],e,!1);else if(this.detachEvent){var r=i+e.__tauid;s[r]&&s.detachEvent("on"+i,s[r]),s[r]=null,s["e"+r]=null}e.__taTouchProxy&&E(t,e.__taTouchProxy[1],e.__taTouchProxy[0])})},j=function(t,i){if(null!=t){t="undefined"!=typeof Window&&"unknown"!=typeof t.top&&t==t.top?[t]:"string"!=typeof t&&null==t.tagName&&null!=t.length?t:"string"==typeof t?document.querySelectorAll(t):[t];for(var n=0;n<t.length;n++)i.apply(t[n])}},k=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=16*Math.random()|0;return("x"==t?i:3&i|8).toString(16)})};this.Mottle=function(t){var i=(t=t||{}).clickThreshold||250,s=t.dblClickThreshold||450,o=new d,h=new f(i,s),u=t.smartClicks,a=function(t,i,s,a){null!=s&&j(t,function(){var t=n(this);u&&"click"===i?function(t,i,n,s){null==t.__taSmartClicks&&(c(t,"mousedown",function(i){t.__tad=w(i)},s),c(t,"mouseup",function(i){t.__tau=w(i)},s),c(t,"click",function(i){if(t.__tad&&t.__tau&&t.__tad[0]===t.__tau[0]&&t.__tad[1]===t.__tau[1])for(var n=0;n<t.__taSmartClicks.length;n++)t.__taSmartClicks[n].apply(e(i),[i])},s),t.__taSmartClicks=[]),t.__taSmartClicks.push(n),n.__taUnstore=function(){r(t.__taSmartClicks,n)}}(t,0,s,a):"tap"===i||"dbltap"===i||"contextmenu"===i?h(t,i,s,a):"mouseenter"===i||"mouseexit"==i?o(t,i,s,a):c(t,i,s,a)})};this.remove=function(t){return j(t,function(){var t=n(this);if(t.__ta)for(var i in t.__ta)if(t.__ta.hasOwnProperty(i))for(var e in t.__ta[i])t.__ta[i].hasOwnProperty(e)&&E(t,i,t.__ta[i][e]);t.parentNode&&t.parentNode.removeChild(t)}),this},this.on=function(t,i,n,e){var s=arguments[0],r=4==arguments.length?arguments[2]:null,o=arguments[1],h=arguments[arguments.length-1];return a(s,o,h,r),this},this.off=function(t,i,n){return E(t,i,n),this},this.trigger=function(t,i,e,s){var r=m&&("undefined"==typeof MouseEvent||null==e||e.constructor===MouseEvent),o=p&&!m&&g[i]?g[i]:i,h=!(p&&!m&&g[i]),u=w(e),a=b(e,"screen"),c=b(e,"client");return j(t,function(){var t,l=n(this);e=e||{screenX:a[0],screenY:a[1],clientX:c[0],clientY:c[1]};var f=function(t){s&&(t.payload=s)},v={TouchEvent:function(t){var i=function(t,i,n,e,s,r,o,h){return function(){var t=[];return Array.prototype.push.apply(t,arguments),t.item=function(t){return this[t]},t}(function(t,i,n,e,s,r,o,h){return new Touch({target:i,identifier:k(),pageX:n,pageY:e,screenX:s,screenY:r,clientX:o||s,clientY:h||r})}.apply(null,arguments))}(window,l,0,u[0],u[1],a[0],a[1],c[0],c[1]);(t.initTouchEvent||t.initEvent)(o,!0,!0,window,null,a[0],a[1],c[0],c[1],!1,!1,!1,!1,i,i,i,1,0)},MouseEvents:function(t){t.initMouseEvent(o,!0,!0,window,0,a[0],a[1],c[0],c[1],!1,!1,!1,!1,1,l)}};if(document.createEvent){var d=!h&&!r&&p&&g[i]?"TouchEvent":"MouseEvents";t=document.createEvent(d),v[d](t),f(t),l.dispatchEvent(t)}else document.createEventObject&&((t=document.createEventObject()).eventType=t.eventName=o,t.screenX=a[0],t.screenY=a[1],t.clientX=c[0],t.clientY=c[1],f(t),l.fireEvent("on"+o,t))}),this}},this.Mottle.consume=function(t,i){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!i&&t.preventDefault&&t.preventDefault()},this.Mottle.pageLocation=w,this.Mottle.setForceTouchEvents=function(t){p=t},this.Mottle.setForceMouseEvents=function(t){m=t},this.Mottle.version="0.8.0",i.Mottle=this.Mottle}.call("undefined"==typeof window?commonjsGlobal:window),function(){var t=function(t,i,n){return-1===t.indexOf(i)&&(n?t.unshift(i):t.push(i),!0)},n=function(t,i){var n=t.indexOf(i);-1!==n&&t.splice(n,1)},e=function(t,i){for(var n=[],e=0;e<t.length;e++)-1===i.indexOf(t[e])&&n.push(t[e]);return n},s=function(t){return null!=t&&("string"==typeof t||t.constructor===String)},r=function(t){var i=t.getBoundingClientRect(),n=document.body,e=document.documentElement,s=window.pageYOffset||e.scrollTop||n.scrollTop,r=window.pageXOffset||e.scrollLeft||n.scrollLeft,o=i.left+r-(e.clientLeft||n.clientLeft||0);return{top:Math.round(i.top+s-(e.clientTop||n.clientTop||0)),left:Math.round(o)}},o=function(t,i,n){for(var e=(n=n||t.parentNode).querySelectorAll(i),s=0;s<e.length;s++)if(e[s]===t)return!0;return!1},h=function(t,i,n){if(o(i,n,t))return i;for(var e=i.parentNode;null!=e&&e!==t;){if(o(e,n,t))return e;e=e.parentNode}},u=function(t,i,n){for(var e=null,s=i.getAttribute("katavorio-draggable"),r=null!=s?"[katavorio-draggable='"+s+"'] ":"",u=0;u<t.length;u++)if(null!=(e=h(i,n,r+t[u].selector))){if(t[u].filter){var a=o(n,t[u].filter,e);if(!0===t[u].filterExclude&&!a||a)return null}return[t[u],e]}return null},a=function(){var t=-1;if("Microsoft Internet Explorer"===navigator.appName){var i=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(i)&&(t=parseFloat(RegExp.$1))}return t}(),c=a>-1&&a<9,l=9===a,f=function(t){if(c)return[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop];var i=d(t),n=v(i,0);return l?[n.pageX||n.clientX,n.pageY||n.clientY]:[n.pageX,n.pageY]},v=function(t,i){return t.item?t.item(i):t[i]},d=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},p={delegatedDraggable:"katavorio-delegated-draggable",draggable:"katavorio-draggable",droppable:"katavorio-droppable",drag:"katavorio-drag",selected:"katavorio-drag-selected",active:"katavorio-drag-active",hover:"katavorio-drag-hover",noSelect:"katavorio-drag-no-select",ghostProxy:"katavorio-ghost-proxy",clonedDrag:"katavorio-clone-drag"},m=["stop","start","drag","drop","over","out","beforeStart"],g=function(){},y=function(){return!0},x=function(t,i,n){for(var e=0;e<t.length;e++)t[e]!=n&&i(t[e])},b=function(t,i,n,e){x(t,function(t){t.setActive(i),i&&t.updatePosition(),n&&t.setHover(e,i)})},w=function(t,i){if(null!=t){t=s(t)||null!=t.tagName||null==t.length?[t]:t;for(var n=0;n<t.length;n++)i.apply(t[n],[t[n]])}},M=function(t){t.stopPropagation?(t.stopPropagation(),t.preventDefault()):t.returnValue=!1},T=function(t,i,n){return!o(t.srcElement||t.target,n.getInputFilterSelector(),i)},C=function(t,i,n,e){this.params=i||{},this.el=t,this.params.addClass(this.el,this._class),this.uuid=D();var s=!0;return this.setEnabled=function(t){s=t},this.isEnabled=function(){return s},this.toggleEnabled=function(){s=!s},this.setScope=function(t){this.scopes=t?t.split(/\s+/):[e]},this.addScope=function(t){var i={};for(var n in w(this.scopes,function(t){i[t]=!0}),w(t?t.split(/\s+/):[],function(t){i[t]=!0}),this.scopes=[],i)this.scopes.push(n)},this.removeScope=function(t){var i={};for(var n in w(this.scopes,function(t){i[t]=!0}),w(t?t.split(/\s+/):[],function(t){delete i[t]}),this.scopes=[],i)this.scopes.push(n)},this.toggleScope=function(t){var i={};for(var n in w(this.scopes,function(t){i[t]=!0}),w(t?t.split(/\s+/):[],function(t){i[t]?delete i[t]:i[t]=!0}),this.scopes=[],i)this.scopes.push(n)},this.setScope(i.scope),this.k=i.katavorio,i.katavorio},S=function(){return!0},E=function(){return!1},j=function(t,i,n){this._class=n.draggable;var e=C.apply(this,arguments);this.rightButtonCanDrag=this.params.rightButtonCanDrag;var h,a,c,l,v=[0,0],d=null,m=null,g=[0,0],x=!1,w=[0,0],j=!1!==this.params.consumeStartEvent,k=this.el,P=this.params.clone,O=!1!==i.multipleDrop,I=!1,L=!0===i.ghostProxy?S:i.ghostProxy&&"function"==typeof i.ghostProxy?i.ghostProxy:E,H=function(t){return t.cloneNode(!0)},_=null,$=[],F=null,N=i.ghostProxyParent;if(i.selector){var R=t.getAttribute("katavorio-draggable");null==R&&(R=""+(new Date).getTime(),t.setAttribute("katavorio-draggable",R)),$.push(i)}var G,Y=i.snapThreshold,X=function(t,i,n,e,s){var r=i*Math.floor(t[0]/i),o=r+i,h=Math.abs(t[0]-r)<=e?r:Math.abs(o-t[0])<=e?o:t[0],u=n*Math.floor(t[1]/n),a=u+n;return[h,Math.abs(t[1]-u)<=s?u:Math.abs(a-t[1])<=s?a:t[1]]};this.posses=[],this.posseRoles={},this.toGrid=function(t){return null==this.params.grid?t:X(t,this.params.grid[0],this.params.grid[1],this.params.grid?this.params.grid[0]/2:Y||5,this.params.grid?this.params.grid[1]/2:Y||5)},this.snap=function(t,i){if(null!=k){t=t||(this.params.grid?this.params.grid[0]:10),i=i||(this.params.grid?this.params.grid[1]:10);var n=this.params.getPosition(k);this.params.setPosition(k,X(n,t,i,this.params.grid?this.params.grid[0]/2:Y,this.params.grid?this.params.grid[1]/2:Y))}},this.setUseGhostProxy=function(t){L=t?S:E};var B,U=function(t){return!1===i.allowNegative?[Math.max(0,t[0]),Math.max(0,t[1])]:t},W=function(t){G="function"==typeof t?t:t?function(t,i,n,e){return U([Math.max(0,Math.min(n.w-e[0],t[0])),Math.max(0,Math.min(n.h-e[1],t[1]))])}.bind(this):function(t){return U(t)}}.bind(this);W("function"==typeof this.params.constrain?this.params.constrain:this.params.constrain||this.params.containment),this.setConstrain=function(t){W(t)},this.setRevert=function(t){B=t},this.params.revert&&(B=this.params.revert);var J=function(t){return"function"==typeof t?(t._katavorioId=D(),t._katavorioId):t},q={},V=function(t){for(var i in q){var n=q[i],e=n[0](t);if(n[1]&&(e=!e),!e)return!1}return!0},z=this.setFilter=function(i,n){if(i){var e=J(i);q[e]=[function(n){var e,r=n.srcElement||n.target;return s(i)?e=o(r,i,t):"function"==typeof i&&(e=i(n,t)),e},!1!==n]}};this.addFilter=z,this.removeFilter=function(t){delete q["function"==typeof t?t._katavorioId:t]},this.clearAllFilters=function(){q={}},this.canDrag=this.params.canDrag||y;var K,Q=[],Z=[];this.addSelector=function(t){t.selector&&$.push(t)},this.downListener=function(t){if(!t.defaultPrevented&&(this.rightButtonCanDrag||3!==t.which&&2!==t.button)&&this.isEnabled()&&this.canDrag())if(V(t)&&T(t,this.el,this.k)){if(F=null,_=null,$.length>0){var i=u($,this.el,t.target||t.srcElement);if(null!=i&&(F=i[0],_=i[1]),null==_)return}else _=this.el;if(P)if(k=_.cloneNode(!0),this.params.addClass(k,p.clonedDrag),k.setAttribute("id",null),k.style.position="absolute",null!=this.params.parent){var s=this.params.getPosition(this.el);k.style.left=s[0]+"px",k.style.top=s[1]+"px",this.params.parent.appendChild(k)}else{var o=r(_);k.style.left=o.left+"px",k.style.top=o.top+"px",document.body.appendChild(k)}else k=_;j&&M(t),v=f(t),k&&k.parentNode&&(w=[k.parentNode.scrollLeft,k.parentNode.scrollTop]),this.params.bind(document,"mousemove",this.moveListener),this.params.bind(document,"mouseup",this.upListener),e.markSelection(this),e.markPosses(this),this.params.addClass(document.body,n.noSelect),nt("beforeStart",{el:this.el,pos:d,e:t,drag:this})}else this.params.consumeFilteredEvents&&M(t)}.bind(this),this.moveListener=function(t){if(v){if(!x)if(!1!==nt("start",{el:this.el,pos:d,e:t,drag:this})){if(!v)return;this.mark(!0),x=!0}else this.abort();if(v){Z.length=0;var i=f(t),n=i[0]-v[0],s=i[1]-v[1],r=this.params.ignoreZoom?1:e.getZoom();k&&k.parentNode&&(n+=k.parentNode.scrollLeft-w[0],s+=k.parentNode.scrollTop-w[1]),this.moveBy(n/=r,s/=r,t),e.updateSelection(n,s,this),e.updatePosses(n,s,this)}}}.bind(this),this.upListener=function(t){v&&(v=null,this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.params.removeClass(document.body,n.noSelect),this.unmark(t),e.unmarkSelection(this,t),e.unmarkPosses(this,t),this.stop(t),e.notifyPosseDragStop(this,t),x=!1,Z.length=0,P?(k&&k.parentNode&&k.parentNode.removeChild(k),k=null):B&&!0===B(k,this.params.getPosition(k))&&(this.params.setPosition(k,d),nt("revert",k)))}.bind(this),this.getFilters=function(){return q},this.abort=function(){null!=v&&this.upListener()},this.getDragElement=function(t){return t?_||this.el:k||this.el};var tt={start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]};i.events.start&&tt.start.push(i.events.start),i.events.beforeStart&&tt.beforeStart.push(i.events.beforeStart),i.events.stop&&tt.stop.push(i.events.stop),i.events.drag&&tt.drag.push(i.events.drag),i.events.revert&&tt.revert.push(i.events.revert),this.on=function(t,i){tt[t]&&tt[t].push(i)},this.off=function(t,i){if(tt[t]){for(var n=[],e=0;e<tt[t].length;e++)tt[t][e]!==i&&n.push(tt[t][e]);tt[t]=n}};var it,nt=function(t,i){var n=null;if(F&&F[t])n=F[t](i);else if(tt[t])for(var e=0;e<tt[t].length;e++)try{var s=tt[t][e](i);null!=s&&(n=s)}catch(t){}return n};this.notifyStart=function(t){nt("start",{el:this.el,pos:this.params.getPosition(k),e:t,drag:this})},this.stop=function(t,i){if(i||x){var n=[],s=e.getSelection(),r=this.params.getPosition(k);if(s.length>0)for(var o=0;o<s.length;o++){var h=this.params.getPosition(s[o].el);n.push([s[o].el,{left:h[0],top:h[1]},s[o]])}else n.push([k,{left:r[0],top:r[1]},this]);nt("stop",{el:k,pos:it||r,finalPos:r,e:t,drag:this,selection:n})}},this.mark=function(t){var i;d=this.params.getPosition(k),m=this.params.getPosition(k,!0),g=[m[0]-d[0],m[1]-d[1]],this.size=this.params.getSize(k),Q=e.getMatchingDroppables(this),b(Q,!0,!1,this),this.params.addClass(k,this.params.dragClass||n.drag),i=this.params.getConstrainingRectangle?this.params.getConstrainingRectangle(k):this.params.getSize(k.parentNode),K={w:i[0],h:i[1]},c=0,l=0,t&&e.notifySelectionDragStart(this)},this.unmark=function(t,e){if(b(Q,!1,!0,this),I&&L(_,k)?(it=[k.offsetLeft-c,k.offsetTop-l],k.parentNode.removeChild(k),k=_):it=null,this.params.removeClass(k,this.params.dragClass||n.drag),Q.length=0,I=!1,!e){Z.length>0&&it&&i.setPosition(_,it),Z.sort(A);for(var s=0;s<Z.length&&!0!==Z[s].drop(this,t);s++);}},this.moveBy=function(t,n,e){Z.length=0;var s=this.toGrid([d[0]+t,d[1]+n]),r=G(s,k,K,this.size);if(L(this.el,k))if(s[0]!==r[0]||s[1]!==r[1]){if(!I){var o=H(_);i.addClass(o,p.ghostProxy),N?(N.appendChild(o),h=i.getPosition(_.parentNode,!0),a=i.getPosition(i.ghostProxyParent,!0),c=h[0]-a[0],l=h[1]-a[1]):_.parentNode.appendChild(o),k=o,I=!0}r=s}else I&&(k.parentNode.removeChild(k),k=_,I=!1,h=null,a=null,c=0,l=0);var u={x:r[0],y:r[1],w:this.size[0],h:this.size[1]},f={x:u.x+g[0],y:u.y+g[1],w:u.w,h:u.h},v=null;this.params.setPosition(k,[r[0]+c,r[1]+l]);for(var m=0;m<Q.length;m++)this.params.intersects(f,{x:Q[m].pagePosition[0],y:Q[m].pagePosition[1],w:Q[m].size[0],h:Q[m].size[1]})&&(O||null==v||v===Q[m].el)&&Q[m].canDrop(this)?(v||(v=Q[m].el),Z.push(Q[m]),Q[m].setHover(this,!0,e)):Q[m].isHover()&&Q[m].setHover(this,!1,e);nt("drag",{el:this.el,pos:r,e,drag:this})},this.destroy=function(){this.params.unbind(this.el,"mousedown",this.downListener),this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null},this.params.bind(this.el,"mousedown",this.downListener),this.params.handle?z(this.params.handle,!1):z(this.params.filter,this.params.filterExclude)},k=function(t,i,n){this._class=n.droppable,this.params=i||{},this.rank=i.rank||0,this._activeClass=this.params.activeClass||n.active,this._hoverClass=this.params.hoverClass||n.hover,C.apply(this,arguments);var e=!1;this.allowLoopback=!1!==this.params.allowLoopback,this.setActive=function(t){this.params[t?"addClass":"removeClass"](this.el,this._activeClass)},this.updatePosition=function(){this.position=this.params.getPosition(this.el),this.pagePosition=this.params.getPosition(this.el,!0),this.size=this.params.getSize(this.el)},this.canDrop=this.params.canDrop||function(){return!0},this.isHover=function(){return e},this.setHover=function(t,i,n){(i||null==this.el._katavorioDragHover||this.el._katavorioDragHover===t.el._katavorio)&&(this.params[i?"addClass":"removeClass"](this.el,this._hoverClass),this.el._katavorioDragHover=i?t.el._katavorio:null,e!==i&&this.params.events[i?"over":"out"]({el:this.el,e:n,drag:t,drop:this}),e=i)},this.drop=function(t,i){return this.params.events.drop({drag:t,e:i,drop:this})},this.destroy=function(){this._class=null,this._activeClass=null,this._hoverClass=null,e=null}},D=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=16*Math.random()|0;return("x"===t?i:3&i|8).toString(16)})},A=function(t,i){return t.rank<i.rank?1:t.rank>i.rank?-1:0},P=function(t){return null==t?null:null==(t="string"==typeof t||t.constructor===String?document.getElementById(t):t)?null:(t._katavorio=t._katavorio||D(),t)};this.Katavorio=function(i){var r=[],o={};this._dragsByScope={},this._dropsByScope={};var h=1,u=function(t,i){w(t,function(t){for(var n=0;n<t.scopes.length;n++)i[t.scopes[n]]=i[t.scopes[n]]||[],i[t.scopes[n]].push(t)})},a=function(t,n){var e=0;return w(t,function(t){for(var s=0;s<t.scopes.length;s++)if(n[t.scopes[s]]){var r=i.indexOf(n[t.scopes[s]],t);-1!==r&&(n[t.scopes[s]].splice(r,1),e++)}}),e>0},c=(this.getMatchingDroppables=function(t){for(var i=[],n={},e=0;e<t.scopes.length;e++){var s=this._dropsByScope[t.scopes[e]];if(s)for(var r=0;r<s.length;r++)!s[r].canDrop(t)||n[s[r].uuid]||!s[r].allowLoopback&&s[r].el===t.el||(n[s[r].uuid]=!0,i.push(s[r]))}return i.sort(A),i},function(t){t=t||{};var n,e={events:{}};for(n in i)e[n]=i[n];for(n in t)e[n]=t[n];for(n=0;n<m.length;n++)e.events[m[n]]=t[m[n]]||g;return e.katavorio=this,e}.bind(this)),l=function(t,i){for(var n=0;n<m.length;n++)i[m[n]]&&t.on(m[n],i[m[n]])}.bind(this),f={},v=i.css||{},d=i.scope||"katavorio-drag-scope";for(var y in p)f[y]=p[y];for(var y in v)f[y]=v[y];var b=i.inputFilterSelector||"input,textarea,select,button,option";this.getInputFilterSelector=function(){return b},this.setInputFilterSelector=function(t){return b=t,this},this.draggable=function(t,n){var e=[];return w(t,function(t){if(null!=(t=P(t)))if(null==t._katavorioDrag){var s=c(n);t._katavorioDrag=new j(t,s,f,d),u(t._katavorioDrag,this._dragsByScope),e.push(t._katavorioDrag),i.addClass(t,s.selector?f.delegatedDraggable:f.draggable)}else l(t._katavorioDrag,n)}.bind(this)),e},this.droppable=function(t,n){var e=[];return w(t,function(t){if(null!=(t=P(t))){var s=new k(t,c(n),f,d);t._katavorioDrop=t._katavorioDrop||[],t._katavorioDrop.push(s),u(s,this._dropsByScope),e.push(s),i.addClass(t,f.droppable)}}.bind(this)),e},this.select=function(t){return w(t,function(){var t=P(this);t&&t._katavorioDrag&&(o[t._katavorio]||(r.push(t._katavorioDrag),o[t._katavorio]=[t,r.length-1],i.addClass(t,f.selected)))}),this},this.deselect=function(t){return w(t,function(){var t=P(this);if(t&&t._katavorio&&o[t._katavorio]){for(var n=[],e=0;e<r.length;e++)r[e].el!==t&&n.push(r[e]);r=n,delete o[t._katavorio],i.removeClass(t,f.selected)}}),this},this.deselectAll=function(){for(var t in o)i.removeClass(o[t][0],f.selected);r.length=0,o={}},this.markSelection=function(t){x(r,function(t){t.mark()},t)},this.markPosses=function(t){t.posses&&w(t.posses,function(i){t.posseRoles[i]&&E[i]&&x(E[i].members,function(t){t.mark()},t)})},this.unmarkSelection=function(t,i){x(r,function(t){t.unmark(i)},t)},this.unmarkPosses=function(t,i){t.posses&&w(t.posses,function(n){t.posseRoles[n]&&E[n]&&x(E[n].members,function(t){t.unmark(i,!0)},t)})},this.getSelection=function(){return r.slice(0)},this.updateSelection=function(t,i,n){x(r,function(n){n.moveBy(t,i)},n)};var M=function(t,i){i.posses&&w(i.posses,function(n){i.posseRoles[n]&&E[n]&&x(E[n].members,function(i){t(i)},i)})};this.updatePosses=function(t,i,n){M(function(n){n.moveBy(t,i)},n)},this.notifyPosseDragStop=function(t,i){M(function(t){t.stop(i,!0)},t)},this.notifySelectionDragStop=function(t,i){x(r,function(t){t.stop(i,!0)},t)},this.notifySelectionDragStart=function(t,i){x(r,function(t){t.notifyStart(i)},t)},this.setZoom=function(t){h=t},this.getZoom=function(){return h};var T=function(t,i,n,e){w(t,function(t){a(t,n),t[e](i),u(t,n)})};w(["set","add","remove","toggle"],function(t){this[t+"Scope"]=function(i,n){T(i._katavorioDrag,n,this._dragsByScope,t+"Scope"),T(i._katavorioDrop,n,this._dropsByScope,t+"Scope")}.bind(this),this[t+"DragScope"]=function(i,n){T(i.constructor===j?i:i._katavorioDrag,n,this._dragsByScope,t+"Scope")}.bind(this),this[t+"DropScope"]=function(i,n){T(i.constructor===k?i:i._katavorioDrop,n,this._dropsByScope,t+"Scope")}.bind(this)}.bind(this)),this.snapToGrid=function(t,i){for(var n in this._dragsByScope)x(this._dragsByScope[n],function(n){n.snap(t,i)})},this.getDragsForScope=function(t){return this._dragsByScope[t]},this.getDropsForScope=function(t){return this._dropsByScope[t]};var C=function(t,i,n){if((t=P(t))[i]){var e=r.indexOf(t[i]);e>=0&&r.splice(e,1),a(t[i],n)&&w(t[i],function(t){t.destroy()}),delete t[i]}},S=function(t,i,n,e){(t=P(t))[i]&&t[i].off(n,e)};this.elementRemoved=function(t){this.destroyDraggable(t),this.destroyDroppable(t)},this.destroyDraggable=function(t,i,n){1===arguments.length?C(t,"_katavorioDrag",this._dragsByScope):S(t,"_katavorioDrag",i,n)},this.destroyDroppable=function(t,i,n){1===arguments.length?C(t,"_katavorioDrop",this._dropsByScope):S(t,"_katavorioDrop",i,n)},this.reset=function(){this._dragsByScope={},this._dropsByScope={},r=[],o={},E={}};var E={},D=function(i,n,e){var r,o=s(n)?n:n.id,h=!!s(n)||!1!==n.active,u=E[o]||(E[o]=r={name:o,members:[]},r);return w(i,function(i){if(i._katavorioDrag){if(e&&null!=i._katavorioDrag.posseRoles[u.name])return;t(u.members,i._katavorioDrag),t(i._katavorioDrag.posses,u.name),i._katavorioDrag.posseRoles[u.name]=h}}),u};this.addToPosse=function(t,i){for(var n=[],e=1;e<arguments.length;e++)n.push(D(t,arguments[e]));return 1===n.length?n[0]:n},this.setPosse=function(t,i){for(var n=[],s=1;s<arguments.length;s++)n.push(D(t,arguments[s],!0).name);return w(t,function(t){if(t._katavorioDrag){var i=e(t._katavorioDrag.posses,n);Array.prototype.push.apply([],t._katavorioDrag.posses);for(var s=0;s<i.length;s++)this.removeFromPosse(t,i[s])}}.bind(this)),1===n.length?n[0]:n},this.removeFromPosse=function(t,i){if(arguments.length<2)throw new TypeError("No posse id provided for remove operation");for(var e=1;e<arguments.length;e++)i=arguments[e],w(t,function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var e=t._katavorioDrag;w(i,function(t){n(E[t].members,e),n(e.posses,t),delete e.posseRoles[t]})}})},this.removeFromAllPosses=function(t){w(t,function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var i=t._katavorioDrag;w(i.posses,function(t){n(E[t].members,i)}),i.posses.length=0,i.posseRoles={}}})},this.setPosseState=function(t,i,n){var e=E[i];e&&w(t,function(t){t._katavorioDrag&&t._katavorioDrag.posses&&(t._katavorioDrag.posseRoles[e.name]=n)})}},this.Katavorio.version="1.0.0",i.Katavorio=this.Katavorio}.call("undefined"!=typeof window?window:commonjsGlobal),function(){this.jsPlumbUtil=this.jsPlumbUtil||{};var t=this.jsPlumbUtil;function n(t){return"[object Array]"===Object.prototype.toString.call(t)}function e(t){return"string"==typeof t}function s(t){return"boolean"==typeof t}function r(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)}function o(t){return"[object Date]"===Object.prototype.toString.call(t)}function h(t){return"[object Function]"===Object.prototype.toString.call(t)}function u(t){if(e(t))return""+t;if(s(t))return!!t;if(o(t))return new Date(t.getTime());if(h(t))return t;if(n(t)){for(var i=[],a=0;a<t.length;a++)i.push(u(t[a]));return i}if(r(t)){var c={};for(var l in t)c[l]=u(t[l]);return c}return t}function a(t,i,o,h){var a,c,l={},f={};for(o=o||[],h=h||[],c=0;c<o.length;c++)l[o[c]]=!0;for(c=0;c<h.length;c++)f[h[c]]=!0;var v=u(t);for(c in i)if(null==v[c]||f[c])v[c]=i[c];else if(e(i[c])||s(i[c]))l[c]?((a=[]).push.apply(a,n(v[c])?v[c]:[v[c]]),a.push.apply(a,s(i[c])?i[c]:[i[c]]),v[c]=a):v[c]=i[c];else if(n(i[c]))a=[],n(v[c])&&a.push.apply(a,v[c]),a.push.apply(a,i[c]),v[c]=a;else if(r(i[c]))for(var d in r(v[c])||(v[c]={}),i[c])v[c][d]=i[c][d];return v}function c(t,i){if(t)for(var n=0;n<t.length;n++)if(i(t[n]))return n;return-1}function l(t,i){var n=t.indexOf(i);return n>-1&&t.splice(n,1),-1!==n}function f(t,i,n,e){var s=t[i];return null==s&&(t[i]=s=[]),s[e?"unshift":"push"](n),s}function v(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=16*Math.random()|0;return("x"===t?i:3&i|8).toString(16)})}function d(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i]}i.jsPlumbUtil=t,t.isArray=n,t.isNumber=function(t){return"[object Number]"===Object.prototype.toString.call(t)},t.isString=e,t.isBoolean=s,t.isNull=function(t){return null==t},t.isObject=r,t.isDate=o,t.isFunction=h,t.isNamedFunction=function(t){return h(t)&&null!=t.name&&t.name.length>0},t.isEmpty=function(t){for(var i in t)if(t.hasOwnProperty(i))return!1;return!0},t.clone=u,t.merge=a,t.replace=function(t,i,n){if(null!=t){var e=t;return i.replace(/([^\.])+/g,function(t,i,s,r){var o=t.match(/([^\[0-9]+){1}(\[)([0-9+])/),h=function(){return e[o[1]]||(e[o[1]]=[],e[o[1]])};if(s+t.length>=r.length)o?h()[o[3]]=n:e[t]=n;else if(o){var u=h();e=u[o[3]]||(u[o[3]]={},u[o[3]])}else e=e[t]||(e[t]={},e[t]);return""}),t}},t.functionChain=function(t,i,n){for(var e=0;e<n.length;e++){var s=n[e][0][n[e][1]].apply(n[e][0],n[e][2]);if(s===i)return s}return t},t.populate=function(t,i,s,o){var u=function(t){if(null!=t){if(e(t))return function(t){var n=t.match(/(\${.*?})/g);if(null!=n)for(var e=0;e<n.length;e++){var s=i[n[e].substring(2,n[e].length-1)]||"";null!=s&&(t=t.replace(n[e],s))}return t}(t);if(!h(t)||o||null!=s&&0!==(t.name||"").indexOf(s)){if(n(t)){for(var a=[],c=0;c<t.length;c++)a.push(u(t[c]));return a}if(r(t)){var l={};for(var f in t)l[f]=u(t[f]);return l}return t}return t(i)}};return u(t)},t.findWithFunction=c,t.removeWithFunction=function(t,i){var n=c(t,i);return n>-1&&t.splice(n,1),-1!==n},t.remove=l,t.addWithFunction=function(t,i,n){-1===c(t,n)&&t.push(i)},t.addToList=f,t.suggest=function(t,i,n){return-1===t.indexOf(i)&&(n?t.unshift(i):t.push(i),!0)},t.extend=function(t,i,e){var s;i=n(i)?i:[i];var r=function(i){for(var n=i.__proto__;null!=n;)if(null!=n.prototype){for(var e in n.prototype)n.prototype.hasOwnProperty(e)&&!t.prototype.hasOwnProperty(e)&&(t.prototype[e]=n.prototype[e]);n=n.prototype.__proto__}else n=null};for(s=0;s<i.length;s++){for(var o in i[s].prototype)i[s].prototype.hasOwnProperty(o)&&!t.prototype.hasOwnProperty(o)&&(t.prototype[o]=i[s].prototype[o]);r(i[s])}var h=function(t,n){return function(){for(s=0;s<i.length;s++)i[s].prototype[t]&&i[s].prototype[t].apply(this,arguments);return n.apply(this,arguments)}},u=function(i){for(var n in i)t.prototype[n]=h(n,i[n])};if(arguments.length>2)for(s=2;s<arguments.length;s++)u(arguments[s]);return t},t.uuid=v,t.fastTrim=function(t){if(null==t)return null;for(var i=t.replace(/^\s\s*/,""),n=/\s/,e=i.length;n.test(i.charAt(--e)););return i.slice(0,e+1)},t.each=function(t,i){t=null==t.length||"string"==typeof t?[t]:t;for(var n=0;n<t.length;n++)i(t[n])},t.map=function(t,i){for(var n=[],e=0;e<t.length;e++)n.push(i(t[e]));return n},t.mergeWithParents=function(t,i,n){n=n||"parent";var e=function(t){return t?i[t]:null},s=function(t){return t?e(t[n]):null},r=function(t,i){if(null==t)return i;var n=["anchor","anchors","cssClass","connector","paintStyle","hoverPaintStyle","endpoint","endpoints"];"override"===i.mergeStrategy&&Array.prototype.push.apply(n,["events","overlays"]);var e=a(t,i,[],n);return r(s(t),e)},o=function(t){if(null==t)return{};if("string"==typeof t)return e(t);if(t.length){for(var i=!1,n=0,s=void 0;!i&&n<t.length;)(s=o(t[n]))?i=!0:n++;return s}},h=o(t);return h?r(s(h),h):{}},t.logEnabled=!0,t.log=d,t.wrap=function(t,i,n){return function(){var e=null;try{null!=i&&(e=i.apply(this,arguments))}catch(t){d("jsPlumb function failed : "+t)}if(null!=t&&(null==n||e!==n))try{e=t.apply(this,arguments)}catch(t){d("wrapped function failed : "+t)}return e}},t.EventGenerator=function(){var t=this;this._listeners={},this.eventsSuspended=!1,this.tick=!1,this.eventsToDieOn={ready:!0},this.queue=[],this.bind=function(i,n,e){var s=function(i){f(t._listeners,i,n,e),n.__jsPlumb=n.__jsPlumb||{},n.__jsPlumb[v()]=i};if("string"==typeof i)s(i);else if(null!=i.length)for(var r=0;r<i.length;r++)s(i[r]);return t},this.fire=function(t,i,n){if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[t]){var e=this._listeners[t].length,s=0,r=!1,o=null;if(!this.shouldFireEvent||this.shouldFireEvent(t,i,n))for(;!r&&s<e&&!1!==o;){if(this.eventsToDieOn[t])this._listeners[t][s].apply(this,[i,n]);else try{o=this._listeners[t][s].apply(this,[i,n])}catch(i){d("jsPlumb: fire failed for event "+t+" : "+i)}s++,null!=this._listeners&&null!=this._listeners[t]||(r=!0)}}this.tick=!1,this._drain()}return this},this._drain=function(){var i=t.queue.pop();i&&t.fire.apply(t,i)},this.unbind=function(t,i){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof t)delete this._listeners[t];else if(t.__jsPlumb)for(var n in t.__jsPlumb)l(this._listeners[t.__jsPlumb[n]]||[],t)}else 2===arguments.length&&l(this._listeners[t]||[],i);return this},this.getListener=function(i){return t._listeners[i]},this.setSuspendEvents=function(i){t.eventsSuspended=i},this.isSuspendEvents=function(){return t.eventsSuspended},this.silently=function(i){t.setSuspendEvents(!0);try{i()}catch(t){d("Cannot execute silent function "+t)}t.setSuspendEvents(!1)},this.cleanupListeners=function(){for(var i in t._listeners)t._listeners[i]=null}}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){this.jsPlumbUtil.matchesSelector=function(t,i,n){for(var e=(n=n||t.parentNode).querySelectorAll(i),s=0;s<e.length;s++)if(e[s]===t)return!0;return!1},this.jsPlumbUtil.consume=function(t,i){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!i&&t.preventDefault&&t.preventDefault()},this.jsPlumbUtil.sizeElement=function(t,i,n,e,s){t&&(t.style.height=s+"px",t.height=s,t.style.width=e+"px",t.width=e,t.style.left=i+"px",t.style.top=n+"px")}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t={deriveAnchor:function(t,i){return{top:["TopRight","TopLeft"],bottom:["BottomRight","BottomLeft"]}[t][i]}},i=function(t){this.count=0,this.instance=t,this.lists={},this.instance.addList=function(t,i){return this.listManager.addList(t,i)},this.instance.removeList=function(t){this.listManager.removeList(t)},this.instance.bind("manageElement",function(t){for(var i=this.instance.getSelector(t.el,"[jtk-scrollable-list]"),n=0;n<i.length;n++)this.addList(i[n])}.bind(this)),this.instance.bind("unmanageElement",function(t){this.removeList(t.el)}),this.instance.bind("connection",function(t,i){null==i&&(this._maybeUpdateParentList(t.source),this._maybeUpdateParentList(t.target))}.bind(this))};this.jsPlumbListManager=i,i.prototype={addList:function(i,e){var s=this.instance.extend({},t);e=this.instance.extend(s,e||{});var r=[this.instance.getInstanceIndex(),this.count++].join("_");this.lists[r]=new n(this.instance,i,e,r)},removeList:function(t){var i=this.lists[t._jsPlumbList];i&&(i.destroy(),delete this.lists[t._jsPlumbList])},_maybeUpdateParentList:function(t){for(var i=t.parentNode,n=this.instance.getContainer();null!=i&&i!==n;){if(null!=i._jsPlumbList&&null!=this.lists[i._jsPlumbList])return void i._jsPlumbScrollHandler();i=i.parentNode}}};var n=function(t,i,n,e){function s(t,i,e,s){return n.anchor?n.anchor:n.deriveAnchor(t,i,e,s)}function r(t,i,e,s){return n.deriveEndpoint?n.deriveEndpoint(t,i,e,s):n.endpoint?n.endpoint:e.type}i._jsPlumbList=e;var o=function(){for(var n=t.getSelector(i,".jtk-managed"),e=t.getId(i),o=0;o<n.length;o++){if(n[o].offsetTop<i.scrollTop)n[o]._jsPlumbProxies||(n[o]._jsPlumbProxies=n[o]._jsPlumbProxies||[],t.select({source:n[o]}).each(function(h){t.proxyConnection(h,0,i,e,function(){return r("top",0,h.endpoints[0],h)},function(){return s("top",0,h.endpoints[0],h)}),n[o]._jsPlumbProxies.push([h,0])}),t.select({target:n[o]}).each(function(h){t.proxyConnection(h,1,i,e,function(){return r("top",1,h.endpoints[1],h)},function(){return s("top",1,h.endpoints[1],h)}),n[o]._jsPlumbProxies.push([h,1])}));else if(n[o].offsetTop>i.scrollTop+i.offsetHeight)n[o]._jsPlumbProxies||(n[o]._jsPlumbProxies=n[o]._jsPlumbProxies||[],t.select({source:n[o]}).each(function(h){t.proxyConnection(h,0,i,e,function(){return r("bottom",0,h.endpoints[0],h)},function(){return s("bottom",0,h.endpoints[0],h)}),n[o]._jsPlumbProxies.push([h,0])}),t.select({target:n[o]}).each(function(h){t.proxyConnection(h,1,i,e,function(){return r("bottom",1,h.endpoints[1],h)},function(){return s("bottom",1,h.endpoints[1],h)}),n[o]._jsPlumbProxies.push([h,1])}));else if(n[o]._jsPlumbProxies){for(var h=0;h<n[o]._jsPlumbProxies.length;h++)t.unproxyConnection(n[o]._jsPlumbProxies[h][0],n[o]._jsPlumbProxies[h][1],e);delete n[o]._jsPlumbProxies}t.revalidate(n[o])}!function(i){for(var n=i.parentNode,e=t.getContainer();null!=n&&n!==e;){if(t.hasClass(n,"jtk-managed"))return void t.recalculateOffsets(n);n=n.parentNode}}(i)};t.setAttribute(i,"jtk-scrollable-list","true"),i._jsPlumbScrollHandler=o,t.on(i,"scroll",o),o(),this.destroy=function(){t.off(i,"scroll",o),delete i._jsPlumbScrollHandler;for(var n=t.getSelector(i,".jtk-managed"),e=t.getId(i),s=0;s<n.length;s++)if(n[s]._jsPlumbProxies){for(var r=0;r<n[s]._jsPlumbProxies.length;r++)t.unproxyConnection(n[s]._jsPlumbProxies[r][0],n[s]._jsPlumbProxies[r][1],e);delete n[s]._jsPlumbProxies}}}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,n=t.jsPlumbUtil,e=function(){return""+(new Date).getTime()},s=function(t){if(t._jsPlumb.paintStyle&&t._jsPlumb.hoverPaintStyle){var i={};v.extend(i,t._jsPlumb.paintStyle),v.extend(i,t._jsPlumb.hoverPaintStyle),delete t._jsPlumb.hoverPaintStyle,i.gradient&&t._jsPlumb.paintStyle.fill&&delete i.gradient,t._jsPlumb.hoverPaintStyle=i}},r=["tap","dbltap","click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu"],o=function(t){return null==t?null:t.split(" ")},h=function(t,i,n){for(var e in i)t[e]=n},u=function(t,i,e){if(t.getDefaultType){var s=t.getTypeDescriptor(),r={},o=t.getDefaultType(),u=n.merge({},o);h(r,o,"__default");for(var a=0,c=t._jsPlumb.types.length;a<c;a++){var l=t._jsPlumb.types[a];if("__default"!==l){var f=t._jsPlumb.instance.getType(l,s);if(null!=f){var v=["anchor","anchors","connector","paintStyle","hoverPaintStyle","endpoint","endpoints","connectorOverlays","connectorStyle","connectorHoverStyle","endpointStyle","endpointHoverStyle"],d=[];"override"===f.mergeStrategy?Array.prototype.push.apply(v,["events","overlays","cssClass"]):d.push("cssClass"),u=n.merge(u,f,d,v),h(r,f,l)}}}i&&(u=n.populate(u,i,"_")),t.applyType(u,e,r),e||t.repaint()}},a=t.jsPlumbUIComponent=function(t){n.EventGenerator.apply(this,arguments);var i=this,e=arguments,s=i.idPrefix,r=s+(new Date).getTime();this._jsPlumb={instance:t._jsPlumb,parameters:t.parameters||{},paintStyle:null,hoverPaintStyle:null,paintStyleInUse:null,hover:!1,beforeDetach:t.beforeDetach,beforeDrop:t.beforeDrop,overlayPlacements:[],hoverClass:t.hoverClass||t._jsPlumb.Defaults.HoverClass,types:[],typeCache:{}},this.cacheTypeItem=function(t,i,n){this._jsPlumb.typeCache[n]=this._jsPlumb.typeCache[n]||{},this._jsPlumb.typeCache[n][t]=i},this.getCachedTypeItem=function(t,i){return this._jsPlumb.typeCache[i]?this._jsPlumb.typeCache[i][t]:null},this.getId=function(){return r};var o=t.overlays||[],h={};if(this.defaultOverlayKeys){for(var u=0;u<this.defaultOverlayKeys.length;u++)Array.prototype.push.apply(o,this._jsPlumb.instance.Defaults[this.defaultOverlayKeys[u]]||[]);for(u=0;u<o.length;u++){var a=v.convertToFullOverlaySpec(o[u]);h[a[1].id]=a}}var c={overlays:h,parameters:t.parameters||{},scope:t.scope||this._jsPlumb.instance.getDefaultScope()};if(this.getDefaultType=function(){return c},this.appendToDefaultType=function(t){for(var i in t)c[i]=t[i]},t.events)for(var l in t.events)i.bind(l,t.events[l]);this.clone=function(){var t=Object.create(this.constructor.prototype);return this.constructor.apply(t,e),t}.bind(this),this.isDetachAllowed=function(t){var i=!0;if(this._jsPlumb.beforeDetach)try{i=this._jsPlumb.beforeDetach(t)}catch(t){n.log("jsPlumb: beforeDetach callback failed",t)}return i},this.isDropAllowed=function(t,i,e,s,r,o,h){var u=this._jsPlumb.instance.checkCondition("beforeDrop",{sourceId:t,targetId:i,scope:e,connection:s,dropEndpoint:r,source:o,target:h});if(this._jsPlumb.beforeDrop)try{u=this._jsPlumb.beforeDrop({sourceId:t,targetId:i,scope:e,connection:s,dropEndpoint:r,source:o,target:h})}catch(t){n.log("jsPlumb: beforeDrop callback failed",t)}return u};var f=[];this.setListenerComponent=function(t){for(var i=0;i<f.length;i++)f[i][3]=t}},c=function(t,i){var n=t._jsPlumb.instance.getType(t._jsPlumb.types[i],t.getTypeDescriptor());null!=n&&n.cssClass&&t.canvas&&t._jsPlumb.instance.removeClass(t.canvas,n.cssClass)};n.extend(t.jsPlumbUIComponent,n.EventGenerator,{getParameter:function(t){return this._jsPlumb.parameters[t]},setParameter:function(t,i){this._jsPlumb.parameters[t]=i},getParameters:function(){return this._jsPlumb.parameters},setParameters:function(t){this._jsPlumb.parameters=t},getClass:function(){return v.getClass(this.canvas)},hasClass:function(t){return v.hasClass(this.canvas,t)},addClass:function(t){v.addClass(this.canvas,t)},removeClass:function(t){v.removeClass(this.canvas,t)},updateClasses:function(t,i){v.updateClasses(this.canvas,t,i)},setType:function(t,i,n){this.clearTypes(),this._jsPlumb.types=o(t)||[],u(this,i,n)},getType:function(){return this._jsPlumb.types},reapplyTypes:function(t,i){u(this,t,i)},hasType:function(t){return-1!==this._jsPlumb.types.indexOf(t)},addType:function(t,i,n){var e=o(t),s=!1;if(null!=e){for(var r=0,h=e.length;r<h;r++)this.hasType(e[r])||(this._jsPlumb.types.push(e[r]),s=!0);s&&u(this,i,n)}},removeType:function(t,i,n){var e=o(t),s=!1,r=function(t){var i=this._jsPlumb.types.indexOf(t);return-1!==i&&(c(this,i),this._jsPlumb.types.splice(i,1),!0)}.bind(this);if(null!=e){for(var h=0,a=e.length;h<a;h++)s=r(e[h])||s;s&&u(this,i,n)}},clearTypes:function(t,i){for(var n=this._jsPlumb.types.length,e=0;e<n;e++)c(this,0),this._jsPlumb.types.splice(0,1);u(this,t,i)},toggleType:function(t,i,n){var e=o(t);if(null!=e){for(var s=0,r=e.length;s<r;s++){var h=this._jsPlumb.types.indexOf(e[s]);-1!==h?(c(this,h),this._jsPlumb.types.splice(h,1)):this._jsPlumb.types.push(e[s])}u(this,i,n)}},applyType:function(t,i){if(this.setPaintStyle(t.paintStyle,i),this.setHoverPaintStyle(t.hoverPaintStyle,i),t.parameters)for(var n in t.parameters)this.setParameter(n,t.parameters[n]);this._jsPlumb.paintStyleInUse=this.getPaintStyle()},setPaintStyle:function(t,i){this._jsPlumb.paintStyle=t,this._jsPlumb.paintStyleInUse=this._jsPlumb.paintStyle,s(this),i||this.repaint()},getPaintStyle:function(){return this._jsPlumb.paintStyle},setHoverPaintStyle:function(t,i){this._jsPlumb.hoverPaintStyle=t,s(this),i||this.repaint()},getHoverPaintStyle:function(){return this._jsPlumb.hoverPaintStyle},destroy:function(t){(t||null==this.typeId)&&(this.cleanupListeners(),this.clone=null,this._jsPlumb=null)},isHover:function(){return this._jsPlumb.hover},setHover:function(t,i,n){if(this._jsPlumb&&!this._jsPlumb.instance.currentlyDragging&&!this._jsPlumb.instance.isHoverSuspended()){this._jsPlumb.hover=t;var s=t?"addClass":"removeClass";null!=this.canvas&&(null!=this._jsPlumb.instance.hoverClass&&this._jsPlumb.instance[s](this.canvas,this._jsPlumb.instance.hoverClass),null!=this._jsPlumb.hoverClass&&this._jsPlumb.instance[s](this.canvas,this._jsPlumb.hoverClass)),null!=this._jsPlumb.hoverPaintStyle&&(this._jsPlumb.paintStyleInUse=t?this._jsPlumb.hoverPaintStyle:this._jsPlumb.paintStyle,this._jsPlumb.instance.isSuspendDrawing()||(n=n||e(),this.repaint({timestamp:n,recalc:!1}))),this.getAttachedElements&&!i&&function(t,i,n,e){var s=t.getAttachedElements();if(s)for(var r=0,o=s.length;r<o;r++)e&&e===s[r]||s[r].setHover(i,!0,n)}(this,t,e(),this)}}});var l=0,f=t.jsPlumbInstance=function(i){this.version="2.11.1",this.Defaults={Anchor:"Bottom",Anchors:[null,null],ConnectionsDetachable:!0,ConnectionOverlays:[],Connector:"Bezier",Container:null,DoNotThrowErrors:!1,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fill:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},LogEnabled:!1,Overlays:[],MaxConnections:1,PaintStyle:{"stroke-width":4,stroke:"#456"},ReattachConnections:!1,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"},i&&v.extend(this.Defaults,i),this.logEnabled=this.Defaults.LogEnabled,this._connectionTypes={},this._endpointTypes={},n.EventGenerator.apply(this);var s=this,o=function(){var t=l+1;return l++,t}(),h=s.bind,u={},c=1,f=function(t){if(null==t)return null;if(3===t.nodeType||8===t.nodeType)return{el:t,text:!0};var i=s.getElement(t);return{el:i,id:n.isString(t)&&null==i?t:G(i)}};for(var d in this.getInstanceIndex=function(){return o},this.setZoom=function(t,i){return s.fire("zoom",c=t),i&&s.repaintEverything(),!0},this.getZoom=function(){return c},this.Defaults)u[d]=this.Defaults[d];var p,m=[];this.unbindContainer=function(){if(null!=p&&m.length>0)for(var t=0;t<m.length;t++)s.off(p,m[t][0],m[t][1])},this.setContainer=function(t){this.unbindContainer(),t=this.getElement(t),this.select().each(function(i){i.moveParent(t)}),this.selectEndpoints().each(function(i){i.moveParent(t)});var i=p;p=t,m.length=0;for(var n={endpointclick:"endpointClick",endpointdblclick:"endpointDblClick"},e=function(t,i,e){var r=i.srcElement||i.target,o=(r&&r.parentNode?r.parentNode._jsPlumb:null)||(r?r._jsPlumb:null)||(r&&r.parentNode&&r.parentNode.parentNode?r.parentNode.parentNode._jsPlumb:null);o&&(o.fire(t,o,i),s.fire(e&&n[e+t]||t,o.component||o,i))},o=function(t,i,n){m.push([t,n]),s.on(p,t,i,n)},h=function(t){o(t,".jtk-connector",function(i){e(t,i)}),o(t,".jtk-endpoint",function(i){e(t,i,"endpoint")}),o(t,".jtk-overlay",function(i){e(t,i)})},u=0;u<r.length;u++)h(r[u]);for(var a in M){var c=M[a].el;c.parentNode===i&&(i.removeChild(c),p.appendChild(c))}},this.getContainer=function(){return p},this.bind=function(t,i){"ready"===t&&y?i():h.apply(s,[t,i])},s.importDefaults=function(t){for(var i in t)s.Defaults[i]=t[i];return t.Container&&s.setContainer(t.Container),s},s.restoreDefaults=function(){return s.Defaults=v.extend({},u),s};var g=null,y=!1,x=[],b={},w={},M={},T={},C={},S=!1,E=[],j=!1,k=null,D=this.Defaults.Scope,A=1,P=function(){return""+A++},O=function(t,i){p?p.appendChild(t):i?this.getElement(i).appendChild(t):this.appendToRoot(t)}.bind(this),I=function(t,i,n,r){if(!j){var o,h=G(t),u=s.getDragManager();u&&(o=u.getElementsForDraggable(h)),null==n&&(n=e());var a=ot({elId:h,offset:i,recalc:!1,timestamp:n});if(o&&a&&a.o)for(var c in o)ot({elId:o[c].id,offset:{left:a.o.left+o[c].offset.left,top:a.o.top+o[c].offset.top},recalc:!1,timestamp:n});if(s.anchorManager.redraw(h,i,n,null,r),o)for(var l in o)s.anchorManager.redraw(o[l].id,i,n,o[l].offset,r,!0)}},L=function(t){return w[t]},H=function(t,i){var e=v.extend({},t);if(i&&v.extend(e,i),e.source&&(e.source.endpoint?e.sourceEndpoint=e.source:e.source=s.getElement(e.source)),e.target&&(e.target.endpoint?e.targetEndpoint=e.target:e.target=s.getElement(e.target)),t.uuids&&(e.sourceEndpoint=L(t.uuids[0]),e.targetEndpoint=L(t.uuids[1])),e.sourceEndpoint&&e.sourceEndpoint.isFull())n.log(s,"could not add connection; source endpoint is full");else if(e.targetEndpoint&&e.targetEndpoint.isFull())n.log(s,"could not add connection; target endpoint is full");else{if(!e.type&&e.sourceEndpoint&&(e.type=e.sourceEndpoint.connectionType),e.sourceEndpoint&&e.sourceEndpoint.connectorOverlays){e.overlays=e.overlays||[];for(var r=0,o=e.sourceEndpoint.connectorOverlays.length;r<o;r++)e.overlays.push(e.sourceEndpoint.connectorOverlays[r])}e.sourceEndpoint&&e.sourceEndpoint.scope&&(e.scope=e.sourceEndpoint.scope),!e["pointer-events"]&&e.sourceEndpoint&&e.sourceEndpoint.connectorPointerEvents&&(e["pointer-events"]=e.sourceEndpoint.connectorPointerEvents);var h=function(t,i,n,r){if(e[t]&&!e[t].endpoint&&!e[t+"Endpoint"]&&!e.newConnection){var o=n[G(e[t])];if(o=o?o[r]:null){if(!o.enabled)return!1;var h=null!=o.endpoint&&o.endpoint._jsPlumb?o.endpoint:function(t,i,n){return s.addEndpoint(t,function(t,i){var n=v.extend({},t);for(var e in i)i[e]&&(n[e]=i[e]);return n}(i,{anchor:e.anchors?e.anchors[n]:e.anchor,endpoint:e.endpoints?e.endpoints[n]:e.endpoint,paintStyle:e.endpointStyles?e.endpointStyles[n]:e.endpointStyle,hoverPaintStyle:e.endpointHoverStyles?e.endpointHoverStyles[n]:e.endpointHoverStyle}))}(e[t],o.def,i);if(h.isFull())return!1;e[t+"Endpoint"]=h,!e.scope&&o.def.scope&&(e.scope=o.def.scope),o.uniqueEndpoint?o.endpoint?h.finalEndpoint=o.endpoint:(o.endpoint=h,h.setDeleteOnEmpty(!1)):h.setDeleteOnEmpty(!0),0===i&&o.def.connectorOverlays&&(e.overlays=e.overlays||[],Array.prototype.push.apply(e.overlays,o.def.connectorOverlays))}}};if(!1!==h("source",0,this.sourceEndpointDefinitions,e.type||"default")&&!1!==h("target",1,this.targetEndpointDefinitions,e.type||"default"))return e.sourceEndpoint&&e.targetEndpoint&&(function(t,i){for(var n=e.sourceEndpoint.scope.split(/\s/),s=i.scope.split(/\s/),r=0;r<n.length;r++)for(var o=0;o<s.length;o++)if(s[o]===n[r])return!0;return!1}(0,e.targetEndpoint)||(e=null)),e}}.bind(s),_=function(t){var i=s.Defaults.ConnectionType||s.getDefaultConnectionType();t._jsPlumb=s,t.newConnection=_,t.newEndpoint=F,t.endpointsByUUID=w,t.endpointsByElement=b,t.finaliseConnection=$,t.id="con_"+P();var n=new i(t);return n.isDetachable()&&(n.endpoints[0].initDraggable("_jsPlumbSource"),n.endpoints[1].initDraggable("_jsPlumbTarget")),n},$=s.finaliseConnection=function(t,i,n,e){i=i||{},t.suspendedEndpoint||x.push(t),t.pending=null,t.endpoints[0].isTemporarySource=!1,!1!==e&&s.anchorManager.newConnection(t),I(t.source),i.doNotFireConnectionEvent||!1===i.fireEvent||s.fire("connection",{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]},n)},F=function(t,i){var n=s.Defaults.EndpointType||v.Endpoint,e=v.extend({},t);e._jsPlumb=s,e.newConnection=_,e.newEndpoint=F,e.endpointsByUUID=w,e.endpointsByElement=b,e.fireDetachEvent=B,e.elementId=i||G(e.source);var r=new n(e);return r.id="ep_"+P(),rt(e.elementId,e.source),v.headless||s.getDragManager().endpointAdded(e.source,i),r},N=function(t,i,n){var e=b[t];if(e&&e.length)for(var s=0,r=e.length;s<r;s++){for(var o=0,h=e[s].connections.length;o<h;o++)if(i(e[s].connections[o]))return;n&&n(e[s])}},R=function(t,i,n){i="block"===i;var e=null;n&&(e=function(t){t.setVisible(i,!0,!0)});var s=f(t);N(s.id,function(t){i&&n?t.endpoints[t.sourceId===s.id?1:0].isVisible()&&t.setVisible(!0):t.setVisible(i)},e)},G=function(t,i,e){if(n.isString(t))return t;if(null==t)return null;var r=s.getAttribute(t,"id");return r&&"undefined"!==r||(2===arguments.length&&void 0!==arguments[1]?r=i:(1===arguments.length||3===arguments.length&&!arguments[2])&&(r="jsPlumb_"+o+"_"+P()),e||s.setAttribute(t,"id",r)),r};this.setConnectionBeingDragged=function(t){S=t},this.isConnectionBeingDragged=function(){return S},this.getManagedElements=function(){return M},this.connectorClass="jtk-connector",this.connectorOutlineClass="jtk-connector-outline",this.connectedClass="jtk-connected",this.hoverClass="jtk-hover",this.endpointClass="jtk-endpoint",this.endpointConnectedClass="jtk-endpoint-connected",this.endpointFullClass="jtk-endpoint-full",this.endpointDropAllowedClass="jtk-endpoint-drop-allowed",this.endpointDropForbiddenClass="jtk-endpoint-drop-forbidden",this.overlayClass="jtk-overlay",this.draggingClass="jtk-dragging",this.elementDraggingClass="jtk-element-dragging",this.sourceElementDraggingClass="jtk-source-element-dragging",this.targetElementDraggingClass="jtk-target-element-dragging",this.endpointAnchorClassPrefix="jtk-endpoint-anchor",this.hoverSourceClass="jtk-source-hover",this.hoverTargetClass="jtk-target-hover",this.dragSelectClass="jtk-drag-select",this.Anchors={},this.Connectors={svg:{}},this.Endpoints={svg:{}},this.Overlays={svg:{}},this.ConnectorRenderers={},this.SVG="svg",this.addEndpoint=function(t,i,e){var r=v.extend({},e=e||{});v.extend(r,i),r.endpoint=r.endpoint||s.Defaults.Endpoint,r.paintStyle=r.paintStyle||s.Defaults.EndpointStyle;for(var o=[],h=n.isArray(t)||null!=t.length&&!n.isString(t)?t:[t],u=0,a=h.length;u<a;u++){r.source=s.getElement(h[u]),st(r.source);var c=G(r.source),l=F(r,c),f=rt(c,r.source).info.o;n.addToList(b,c,l),j||l.paint({anchorLoc:l.anchor.compute({xy:[f.left,f.top],wh:E[c],element:l,timestamp:k}),timestamp:k}),o.push(l)}return 1===o.length?o[0]:o},this.addEndpoints=function(t,i,e){for(var r=[],o=0,h=i.length;o<h;o++){var u=s.addEndpoint(t,i[o],e);n.isArray(u)?Array.prototype.push.apply(r,u):r.push(u)}return r},this.animate=function(t,i,e){if(!this.animationSupported)return!1;e=e||{};var r=s.getElement(t),o=G(r),h=v.animEvents.step,u=v.animEvents.complete;e[h]=n.wrap(e[h],function(){s.revalidate(o)}),e[u]=n.wrap(e[u],function(){s.revalidate(o)}),s.doAnimate(r,i,e)},this.checkCondition=function(t,i){var e=s.getListener(t),r=!0;if(e&&e.length>0){var o=Array.prototype.slice.call(arguments,1);try{for(var h=0,u=e.length;h<u;h++)r=r&&e[h].apply(e[h],o)}catch(i){n.log(s,"cannot check condition ["+t+"]"+i)}}return r},this.connect=function(t,i){var e,s=H(t,i);if(s){if(null==s.source&&null==s.sourceEndpoint)return void n.log("Cannot establish connection - source does not exist");if(null==s.target&&null==s.targetEndpoint)return void n.log("Cannot establish connection - target does not exist");st(s.source),e=_(s),$(e,s)}return e};var Y=[{el:"source",elId:"sourceId",epDefs:"sourceEndpointDefinitions"},{el:"target",elId:"targetId",epDefs:"targetEndpointDefinitions"}],X=function(t,i,n,e){var s,r,o,h=Y[n],u=t[h.elId],a=t.endpoints[n],c={index:n,originalSourceId:0===n?u:t.sourceId,newSourceId:t.sourceId,originalTargetId:1===n?u:t.targetId,newTargetId:t.targetId,connection:t};if(i.constructor===v.Endpoint)(s=i).addConnection(t),i=s.element;else if(r=G(i),o=this[h.epDefs][r],r===t[h.elId])s=null;else if(o)for(var l in o){if(!o[l].enabled)return;s=null!=o[l].endpoint&&o[l].endpoint._jsPlumb?o[l].endpoint:this.addEndpoint(i,o[l].def),o[l].uniqueEndpoint&&(o[l].endpoint=s),s.addConnection(t)}else s=t.makeEndpoint(0===n,i,r);return null!=s&&(a.detachFromConnection(t),t.endpoints[n]=s,t[h.el]=s.element,t[h.elId]=s.elementId,c[0===n?"newSourceId":"newTargetId"]=s.elementId,U(c),e||t.repaint()),c.element=i,c}.bind(this);this.setSource=function(t,i,n){var e=X(t,i,0,n);this.anchorManager.sourceChanged(e.originalSourceId,e.newSourceId,t,e.el)},this.setTarget=function(t,i,n){var e=X(t,i,1,n);this.anchorManager.updateOtherEndpoint(e.originalSourceId,e.originalTargetId,e.newTargetId,t)},this.deleteEndpoint=function(t,i,n){var e="string"==typeof t?w[t]:t;return e&&s.deleteObject({endpoint:e,dontUpdateHover:i,deleteAttachedObjects:n}),s},this.deleteEveryEndpoint=function(){var t=s.setSuspendDrawing(!0);for(var i in b){var n=b[i];if(n&&n.length)for(var e=0,r=n.length;e<r;e++)s.deleteEndpoint(n[e],!0)}b={},M={},w={},T={},C={},s.anchorManager.reset();var o=s.getDragManager();return o&&o.reset(),t||s.setSuspendDrawing(!1),s};var B=function(t,i,n){var e=s.Defaults.ConnectionType||s.getDefaultConnectionType(),r=t.constructor===e?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;i&&s.fire("connectionDetached",r,n),s.fire("internal.connectionDetached",r,n),s.anchorManager.connectionDetached(r)},U=s.fireMoveEvent=function(t,i){s.fire("connectionMoved",t,i)};this.unregisterEndpoint=function(t){for(var i in t._jsPlumb.uuid&&(w[t._jsPlumb.uuid]=null),s.anchorManager.deleteEndpoint(t),b){var n=b[i];if(n){for(var e=[],r=0,o=n.length;r<o;r++)n[r]!==t&&e.push(n[r]);b[i]=e}b[i].length<1&&delete b[i]}},this.deleteConnection=function(t,i){return!(null==t||!(i=i||{}).force&&!n.functionChain(!0,!1,[[t.endpoints[0],"isDetachAllowed",[t]],[t.endpoints[1],"isDetachAllowed",[t]],[t,"isDetachAllowed",[t]],[s,"checkCondition",["beforeDetach",t]]])||(t.setHover(!1),B(t,!t.pending&&!1!==i.fireEvent,i.originalEvent),t.endpoints[0].detachFromConnection(t),t.endpoints[1].detachFromConnection(t),n.removeWithFunction(x,function(i){return t.id===i.id}),t.cleanup(),t.destroy(),0))},this.deleteEveryConnection=function(t){t=t||{};var i=x.length,n=0;return s.batch(function(){for(var e=0;e<i;e++)n+=s.deleteConnection(x[0],t)?1:0}),n},this.deleteConnectionsForElement=function(t,i){i=i||{},t=s.getElement(t);var n=G(t),e=b[n];if(e&&e.length)for(var r=0,o=e.length;r<o;r++)e[r].deleteEveryConnection(i);return s},this.deleteObject=function(t){var i={endpoints:{},connections:{},endpointCount:0,connectionCount:0},e=!1!==t.deleteAttachedObjects,r=function(n){null!=n&&null==i.connections[n.id]&&(t.dontUpdateHover||null==n._jsPlumb||n.setHover(!1),i.connections[n.id]=n,i.connectionCount++)};for(var o in t.connection?r(t.connection):function(n){if(null!=n&&null==i.endpoints[n.id]&&(t.dontUpdateHover||null==n._jsPlumb||n.setHover(!1),i.endpoints[n.id]=n,i.endpointCount++,e))for(var s=0;s<n.connections.length;s++)r(n.connections[s])}(t.endpoint),i.connections){var h=i.connections[o];if(h._jsPlumb){n.removeWithFunction(x,function(t){return h.id===t.id}),B(h,!1!==t.fireEvent&&!h.pending,t.originalEvent);var u=null==t.deleteAttachedObjects?null:!t.deleteAttachedObjects;h.endpoints[0].detachFromConnection(h,null,u),h.endpoints[1].detachFromConnection(h,null,u),h.cleanup(!0),h.destroy(!0)}}for(var a in i.endpoints){var c=i.endpoints[a];c._jsPlumb&&(s.unregisterEndpoint(c),c.cleanup(!0),c.destroy(!0))}return i};var W=function(t,i,n,e){for(var s=0,r=t.length;s<r;s++)t[s][i].apply(t[s],n);return e(t)},J=function(t,i,n){for(var e=[],s=0,r=t.length;s<r;s++)e.push([t[s][i].apply(t[s],n),t[s]]);return e},q=function(t,i,n){return function(){return W(t,i,arguments,n)}},V=function(t,i){return function(){return J(t,i,arguments)}},z=function(t,i){var n=[];if(t)if("string"==typeof t){if("*"===t)return t;n.push(t)}else if(i)n=t;else if(t.length)for(var e=0,s=t.length;e<s;e++)n.push(f(t[e]).id);else n.push(f(t).id);return n},K=function(t,i,n){return"*"===t||(t.length>0?-1!==t.indexOf(i):!n)};this.getConnections=function(t,i){t?t.constructor===String&&(t={scope:t}):t={};for(var n=t.scope||s.getDefaultScope(),e=z(n,!0),r=z(t.source),o=z(t.target),h=!i&&e.length>1?{}:[],u=function(t,n){if(!i&&e.length>1){var s=h[t];null==s&&(s=h[t]=[]),s.push(n)}else h.push(n)},a=0,c=x.length;a<c;a++){var l=x[a],f=l.proxies&&l.proxies[0]?l.proxies[0].originalEp.elementId:l.sourceId,v=l.proxies&&l.proxies[1]?l.proxies[1].originalEp.elementId:l.targetId;K(e,l.scope)&&K(r,f)&&K(o,v)&&u(l.scope,l)}return h};var Q=function(t,i){return function(n){for(var e=0,s=t.length;e<s;e++)n(t[e]);return i(t)}},Z=function(t){return function(i){return t[i]}},tt=function(t,i){var n,e,s={length:t.length,each:Q(t,i),get:Z(t)},r=["setHover","removeAllOverlays","setLabel","addClass","addOverlay","removeOverlay","removeOverlays","showOverlay","hideOverlay","showOverlays","hideOverlays","setPaintStyle","setHoverPaintStyle","setSuspendEvents","setParameter","setParameters","setVisible","repaint","addType","toggleType","removeType","removeClass","setType","bind","unbind"],o=["getLabel","getOverlay","isHover","getParameter","getParameters","getPaintStyle","getHoverPaintStyle","isVisible","hasType","getType","isSuspendEvents"];for(n=0,e=r.length;n<e;n++)s[r[n]]=q(t,r[n],i);for(n=0,e=o.length;n<e;n++)s[o[n]]=V(t,o[n]);return s},it=function(t){var i=tt(t,it);return v.extend(i,{setDetachable:q(t,"setDetachable",it),setReattach:q(t,"setReattach",it),setConnector:q(t,"setConnector",it),delete:function(){for(var i=0,n=t.length;i<n;i++)s.deleteConnection(t[i])},isDetachable:V(t,"isDetachable"),isReattach:V(t,"isReattach")})},nt=function(t){var i=tt(t,nt);return v.extend(i,{setEnabled:q(t,"setEnabled",nt),setAnchor:q(t,"setAnchor",nt),isEnabled:V(t,"isEnabled"),deleteEveryConnection:function(){for(var i=0,n=t.length;i<n;i++)t[i].deleteEveryConnection()},delete:function(){for(var i=0,n=t.length;i<n;i++)s.deleteEndpoint(t[i])}})};this.select=function(t){return(t=t||{}).scope=t.scope||"*",it(t.connections||s.getConnections(t,!0))},this.selectEndpoints=function(t){(t=t||{}).scope=t.scope||"*";var i=!t.element&&!t.source&&!t.target,n=i?"*":z(t.element),e=i?"*":z(t.source),s=i?"*":z(t.target),r=z(t.scope,!0),o=[];for(var h in b){var u=K(n,h,!0),a=K(e,h,!0),c="*"!==e,l=K(s,h,!0),f="*"!==s;if(u||a||l)t:for(var v=0,d=b[h].length;v<d;v++){var p=b[h][v];if(K(r,p.scope,!0)){if(c&&e.length>0&&!p.isSource||f&&s.length>0&&!p.isTarget)continue t;o.push(p)}}}return nt(o)},this.getAllConnections=function(){return x},this.getDefaultScope=function(){return D},this.getEndpoint=L,this.getEndpoints=function(t){return b[f(t).id]||[]},this.getDefaultEndpointType=function(){return v.Endpoint},this.getDefaultConnectionType=function(){return v.Connection},this.getId=G,this.draw=I,this.info=f,this.appendElement=O;var et=!1;this.isHoverSuspended=function(){return et},this.setHoverSuspended=function(t){et=t},this.hide=function(t,i){return R(t,"none",i),s},this.idstamp=P;var st=function(t){if(!p&&t){var i=s.getElement(t);i.offsetParent&&s.setContainer(i.offsetParent)}},rt=s.manage=function(t,i,n){return M[t]||(M[t]={el:i,endpoints:[],connections:[]},M[t].info=ot({elId:t,timestamp:k}),s.addClass(i,"jtk-managed"),n||s.fire("manageElement",{id:t,info:M[t].info,el:i})),M[t]},ot=(s.unmanage=function(t){if(M[t]){var i=M[t].el;s.removeClass(i,"jtk-managed"),delete M[t],s.fire("unmanageElement",{id:t,el:i})}},function(t){var i,n=t.timestamp,e=t.recalc,r=t.offset,o=t.elId;return j&&!n&&(n=k),!e&&n&&n===C[o]?{o:t.offset||T[o],s:E[o]}:(e||!r&&null==T[o]?null!=(i=M[o]?M[o].el:null)&&(E[o]=s.getSize(i),T[o]=s.getOffset(i),C[o]=n):(T[o]=r||T[o],null==E[o]&&null!=(i=M[o].el)&&(E[o]=s.getSize(i)),C[o]=n),T[o]&&!T[o].right&&(T[o].right=T[o].left+E[o][0],T[o].bottom=T[o].top+E[o][1],T[o].width=E[o][0],T[o].height=E[o][1],T[o].centerx=T[o].left+T[o].width/2,T[o].centery=T[o].top+T[o].height/2),{o:T[o],s:E[o]})});this.updateOffset=ot,this.init=function(){y||(s.Defaults.Container&&s.setContainer(s.Defaults.Container),s.anchorManager=new t.jsPlumb.AnchorManager({jsPlumbInstance:s}),y=!0,s.fire("ready",s))}.bind(this),this.log=g,this.jsPlumbUIComponent=a,this.makeAnchor=function(){var i,e=function(i,n){if(t.jsPlumb.Anchors[i])return new t.jsPlumb.Anchors[i](n);if(!s.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown anchor type '"+i+"'"}};if(0===arguments.length)return null;var r=arguments[0],o=arguments[1],h=null;if(r.compute&&r.getOrientation)return r;if("string"==typeof r)h=e(arguments[0],{elementId:o,jsPlumbInstance:s});else if(n.isArray(r))if(n.isArray(r[0])||n.isString(r[0]))2===r.length&&n.isObject(r[1])?n.isString(r[0])?(i=t.jsPlumb.extend({elementId:o,jsPlumbInstance:s},r[1]),h=e(r[0],i)):(i=t.jsPlumb.extend({elementId:o,jsPlumbInstance:s,anchors:r[0]},r[1]),h=new t.jsPlumb.DynamicAnchor(i)):h=new v.DynamicAnchor({anchors:r,selector:null,elementId:o,jsPlumbInstance:s});else{var u={x:r[0],y:r[1],orientation:r.length>=4?[r[2],r[3]]:[0,0],offsets:r.length>=6?[r[4],r[5]]:[0,0],elementId:o,jsPlumbInstance:s,cssClass:7===r.length?r[6]:null};(h=new t.jsPlumb.Anchor(u)).clone=function(){return new t.jsPlumb.Anchor(u)}}return h.id||(h.id="anchor_"+P()),h},this.makeAnchors=function(i,e,r){for(var o=[],h=0,u=i.length;h<u;h++)"string"==typeof i[h]?o.push(t.jsPlumb.Anchors[i[h]]({elementId:e,jsPlumbInstance:r})):n.isArray(i[h])&&o.push(s.makeAnchor(i[h],e,r));return o},this.makeDynamicAnchor=function(i,n){return new t.jsPlumb.DynamicAnchor({anchors:i,selector:n,elementId:null,jsPlumbInstance:s})},this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={};var ht=function(i,e,r,o,h){var u=new a(e),c=e._jsPlumb.EndpointDropHandler({jsPlumb:s,enabled:function(){return i.def.enabled},isFull:function(){var t=s.select({target:i.id}).length;return i.def.maxConnections>0&&t>=i.def.maxConnections},element:i.el,elementId:i.id,isSource:o,isTarget:h,addClass:function(t){s.addClass(i.el,t)},removeClass:function(t){s.removeClass(i.el,t)},onDrop:function(t){t.endpoints[0].anchor.unlock()},isDropAllowed:function(){return u.isDropAllowed.apply(u,arguments)},isRedrop:function(t){return null!=t.suspendedElement&&null!=t.suspendedEndpoint&&t.suspendedEndpoint.element===i.el},getEndpoint:function(n){var r=i.def.endpoint;if(null==r||null==r._jsPlumb){var o=s.deriveEndpointAndAnchorSpec(n.getType().join(" "),!0),h=o.endpoints?t.jsPlumb.extend(e,{endpoint:i.def.def.endpoint||o.endpoints[1]}):e;o.anchors&&(h=t.jsPlumb.extend(h,{anchor:i.def.def.anchor||o.anchors[1]})),(r=s.addEndpoint(i.el,h))._mtNew=!0}if(e.uniqueEndpoint&&(i.def.endpoint=r),r.setDeleteOnEmpty(!0),n.isDetachable()&&r.initDraggable(),null!=r.anchor.positionFinder){var u=s.getUIPosition(arguments,s.getZoom()),a=s.getOffset(i.el),c=s.getSize(i.el),l=null==u?[0,0]:r.anchor.positionFinder(u,a,c,r.anchor.constructorParams);r.anchor.x=l[0],r.anchor.y=l[1]}return r},maybeCleanup:function(t){t._mtNew&&0===t.connections.length?s.deleteObject({endpoint:t}):delete t._mtNew}}),l=t.jsPlumb.dragEvents.drop;return r.scope=r.scope||e.scope||s.Defaults.Scope,r[l]=n.wrap(r[l],c,!0),r.rank=e.rank||0,h&&(r[t.jsPlumb.dragEvents.over]=function(){return!0}),!1===e.allowLoopback&&(r.canDrop=function(t){return t.getDragElement()._jsPlumbRelatedElement!==i.el}),s.initDroppable(i.el,r,"internal"),c};this.makeTarget=function(i,n,e){var r=t.jsPlumb.extend({_jsPlumb:this},e);t.jsPlumb.extend(r,n);for(var o=r.maxConnections||-1,h=function(i){var n=f(i),e=n.id,h=t.jsPlumb.extend({},r.dropOptions||{}),u=r.connectionType||"default";this.targetEndpointDefinitions[e]=this.targetEndpointDefinitions[e]||{},st(e),n.el._isJsPlumbGroup&&null==h.rank&&(h.rank=-1);var a={def:t.jsPlumb.extend({},r),uniqueEndpoint:r.uniqueEndpoint,maxConnections:o,enabled:!0};r.createEndpoint&&(a.uniqueEndpoint=!0,a.endpoint=s.addEndpoint(i,a.def),a.endpoint.setDeleteOnEmpty(!1)),n.def=a,this.targetEndpointDefinitions[e][u]=a,ht(n,r,h,!0===r.isSource,!0),n.el._katavorioDrop[n.el._katavorioDrop.length-1].targetDef=a}.bind(this),u=i.length&&i.constructor!==String?i:[i],a=0,c=u.length;a<c;a++)h(u[a]);return this},this.unmakeTarget=function(t,i){var n=f(t);return s.destroyDroppable(n.el,"internal"),i||delete this.targetEndpointDefinitions[n.id],this},this.makeSource=function(i,e,r){var o=t.jsPlumb.extend({_jsPlumb:this},r);t.jsPlumb.extend(o,e);var h=o.connectionType||"default",u=s.deriveEndpointAndAnchorSpec(h);o.endpoint=o.endpoint||u.endpoints[0],o.anchor=o.anchor||u.anchors[0];for(var a=o.maxConnections||-1,l=o.onMaxConnections,v=function(e){var r=e.id,u=this.getElement(e.el);this.sourceEndpointDefinitions[r]=this.sourceEndpointDefinitions[r]||{},st(r);var f={def:t.jsPlumb.extend({},o),uniqueEndpoint:o.uniqueEndpoint,maxConnections:a,enabled:!0};o.createEndpoint&&(f.uniqueEndpoint=!0,f.endpoint=s.addEndpoint(i,f.def),f.endpoint.setDeleteOnEmpty(!1)),this.sourceEndpointDefinitions[r][h]=f,e.def=f;var v=t.jsPlumb.dragEvents.stop,d=t.jsPlumb.dragEvents.drag,p=t.jsPlumb.extend({},o.dragOptions||{}),m=p.drag,g=p.stop,y=null,x=!1;p.scope=p.scope||o.scope,p[d]=n.wrap(p[d],function(){m&&m.apply(this,arguments),x=!1}),p[v]=n.wrap(p[v],function(){if(g&&g.apply(this,arguments),this.currentlyDragging=!1,null!=y._jsPlumb){var t=o.anchor||this.Defaults.Anchor,i=y.anchor,n=y.connections[0],e=this.makeAnchor(t,r,this),h=y.element;if(null!=e.positionFinder){var u=s.getOffset(h),a=this.getSize(h),c={left:u.left+i.x*a[0],top:u.top+i.y*a[1]},l=e.positionFinder(c,u,a,e.constructorParams);e.x=l[0],e.y=l[1]}y.setAnchor(e,!0),y.repaint(),this.repaint(y.elementId),null!=n&&this.repaint(n.targetId)}}.bind(this));var b=function(i){if(3!==i.which&&2!==i.button){var f=this.sourceEndpointDefinitions[r][h];if(f.enabled){if(r=this.getId(this.getElement(e.el)),o.filter&&!1===(n.isString(o.filter)?function(t,n,s,r,h){for(var u=i.target||i.srcElement,a=!1,c=r.getSelector(e.el,o.filter),l=0;l<c.length;l++)if(c[l]===u){a=!0;break}return h?!a:a}(0,0,0,this,o.filterExclude):o.filter(i,e.el)))return;var v=this.select({source:r}).length;if(f.maxConnections>=0&&v>=f.maxConnections)return l&&l({element:e.el,maxConnections:a},i),!1;var d=t.jsPlumb.getPositionOnElement(i,u,c),m={};t.jsPlumb.extend(m,f.def),m.isTemporarySource=!0,m.anchor=[d[0],d[1],0,0],m.dragOptions=p,f.def.scope&&(m.scope=f.def.scope),y=this.addEndpoint(r,m),x=!0,y.setDeleteOnEmpty(!0),f.uniqueEndpoint&&(f.endpoint?y.finalEndpoint=f.endpoint:(f.endpoint=y,y.setDeleteOnEmpty(!1)));var g=function(){s.off(y.canvas,"mouseup",g),s.off(e.el,"mouseup",g),x&&(x=!1,s.deleteEndpoint(y))};s.on(y.canvas,"mouseup",g),s.on(e.el,"mouseup",g);var b={};if(f.def.extract)for(var w in f.def.extract){var M=(i.srcElement||i.target).getAttribute(w);M&&(b[f.def.extract[w]]=M)}s.trigger(y.canvas,"mousedown",i,b),n.consume(i)}}}.bind(this);this.on(e.el,"mousedown",b),f.trigger=b,o.filter&&(n.isString(o.filter)||n.isFunction(o.filter))&&s.setDragFilter(e.el,o.filter);var w=t.jsPlumb.extend({},o.dropOptions||{});ht(e,o,w,!0,!0===o.isTarget)}.bind(this),d=i.length&&i.constructor!==String?i:[i],p=0,m=d.length;p<m;p++)v(f(d[p]));return this},this.unmakeSource=function(t,i,n){var e=f(t);s.destroyDroppable(e.el,"internal");var r=this.sourceEndpointDefinitions[e.id];if(r)for(var o in r)if(null==i||i===o){var h=r[o].trigger;h&&s.off(e.el,"mousedown",h),n||delete this.sourceEndpointDefinitions[e.id][o]}return this},this.unmakeEverySource=function(){for(var t in this.sourceEndpointDefinitions)s.unmakeSource(t,null,!0);return this.sourceEndpointDefinitions={},this};var ut=function(t,i,e){i=n.isArray(i)?i:[i];var s=G(t);e=e||"default";for(var r=0;r<i.length;r++){var o=this[i[r]][s];if(o&&o[e])return o[e].def.scope||this.Defaults.Scope}}.bind(this),at=function(t,i,e,s){e=n.isArray(e)?e:[e];var r=G(t);s=s||"default";for(var o=0;o<e.length;o++){var h=this[e[o]][r];h&&h[s]&&(h[s].def.scope=i)}}.bind(this);this.getScope=function(t){return ut(t,["sourceEndpointDefinitions","targetEndpointDefinitions"])},this.getSourceScope=function(t){return ut(t,"sourceEndpointDefinitions")},this.getTargetScope=function(t){return ut(t,"targetEndpointDefinitions")},this.setScope=function(t,i,n){this.setSourceScope(t,i,n),this.setTargetScope(t,i,n)},this.setSourceScope=function(t,i,n){at(t,i,"sourceEndpointDefinitions",n),this.setDragScope(t,i)},this.setTargetScope=function(t,i,n){at(t,i,"targetEndpointDefinitions",n),this.setDropScope(t,i)},this.unmakeEveryTarget=function(){for(var t in this.targetEndpointDefinitions)s.unmakeTarget(t,!0);return this.targetEndpointDefinitions={},this};var ct=function(t,i,e,r,o){var h,u,a,c="source"===t?this.sourceEndpointDefinitions:this.targetEndpointDefinitions;if(o=o||"default",i.length&&!n.isString(i)){h=[];for(var l=0,v=i.length;l<v;l++)c[(u=f(i[l])).id]&&c[u.id][o]&&(h[l]=c[u.id][o].enabled,c[u.id][o].enabled=a=r?!h[l]:e,s[a?"removeClass":"addClass"](u.el,"jtk-"+t+"-disabled"))}else{var d=(u=f(i)).id;c[d]&&c[d][o]&&(h=c[d][o].enabled,c[d][o].enabled=a=r?!h:e,s[a?"removeClass":"addClass"](u.el,"jtk-"+t+"-disabled"))}return h}.bind(this),lt=function(t,i){return n.isString(t)||!t.length?i.apply(this,[t]):t.length?i.apply(this,[t[0]]):void 0}.bind(this);this.toggleSourceEnabled=function(t,i){return ct("source",t,null,!0,i),this.isSourceEnabled(t,i)},this.setSourceEnabled=function(t,i,n){return ct("source",t,i,null,n)},this.isSource=function(t,i){return i=i||"default",lt(t,function(t){var n=this.sourceEndpointDefinitions[f(t).id];return null!=n&&null!=n[i]}.bind(this))},this.isSourceEnabled=function(t,i){return i=i||"default",lt(t,function(t){var n=this.sourceEndpointDefinitions[f(t).id];return n&&n[i]&&!0===n[i].enabled}.bind(this))},this.toggleTargetEnabled=function(t,i){return ct("target",t,null,!0,i),this.isTargetEnabled(t,i)},this.isTarget=function(t,i){return i=i||"default",lt(t,function(t){var n=this.targetEndpointDefinitions[f(t).id];return null!=n&&null!=n[i]}.bind(this))},this.isTargetEnabled=function(t,i){return i=i||"default",lt(t,function(t){var n=this.targetEndpointDefinitions[f(t).id];return n&&n[i]&&!0===n[i].enabled}.bind(this))},this.setTargetEnabled=function(t,i,n){return ct("target",t,i,null,n)},this.ready=function(t){s.bind("ready",t)};var ft=function(t,i){if("object"==typeof t&&t.length)for(var n=0,e=t.length;n<e;n++)i(t[n]);else i(t);return s};this.repaint=function(t,i,n){return ft(t,function(t){I(t,i,n)})},this.revalidate=function(t,i,n){return ft(t,function(t){var e=n?t:s.getId(t);s.updateOffset({elId:e,recalc:!0,timestamp:i});var r=s.getDragManager();r&&r.updateOffsets(e),s.repaint(t)})},this.repaintEverything=function(){var t,i=e();for(t in b)s.updateOffset({elId:t,recalc:!0,timestamp:i});for(t in b)I(t,null,i);return this},this.removeAllEndpoints=function(t,i,n){n=n||[];var e=function(t){var r,o,h=f(t),u=b[h.id];if(u)for(n.push(h),r=0,o=u.length;r<o;r++)s.deleteEndpoint(u[r],!1);if(delete b[h.id],i&&h.el&&3!==h.el.nodeType&&8!==h.el.nodeType)for(r=0,o=h.el.childNodes.length;r<o;r++)e(h.el.childNodes[r])};return e(t),this};var vt=function(t,i){s.removeAllEndpoints(t.id,!0,i);for(var n=s.getDragManager(),e=function(t){n&&n.elementRemoved(t.id),s.anchorManager.clearFor(t.id),s.anchorManager.removeFloatingConnection(t.id),s.isSource(t.el)&&s.unmakeSource(t.el),s.isTarget(t.el)&&s.unmakeTarget(t.el),s.destroyDraggable(t.el),s.destroyDroppable(t.el),delete s.floatingConnections[t.id],delete M[t.id],delete T[t.id],t.el&&(s.removeElement(t.el),t.el._jsPlumb=null)},r=1;r<i.length;r++)e(i[r]);e(t)};this.remove=function(t,i){var n=f(t),e=[];return n.text?n.el.parentNode.removeChild(n.el):n.id&&s.batch(function(){vt(n,e)},!0===i),s},this.empty=function(t,i){var n=[],e=function(t,i){var s=f(t);if(s.text)s.el.parentNode.removeChild(s.el);else if(s.el){for(;s.el.childNodes.length>0;)e(s.el.childNodes[0]);i||vt(s,n)}};return s.batch(function(){e(t,!0)},!1===i),s},this.reset=function(t){s.silently(function(){et=!1,s.removeAllGroups(),s.removeGroupManager(),s.deleteEveryEndpoint(),t||s.unbind(),this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={},x.length=0,this.doReset&&this.doReset()}.bind(this))};var dt=function(t){t.canvas&&t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),t.cleanup(),t.destroy()};this.clear=function(){s.select().each(dt),s.selectEndpoints().each(dt),b={},w={}},this.setDefaultScope=function(t){return D=t,s},this.deriveEndpointAndAnchorSpec=function(t,i){for(var n=((i?"":"default ")+t).split(/[\s]/),e=null,r=null,o=null,h=null,u=0;u<n.length;u++){var a=s.getType(n[u],"connection");a&&(a.endpoints&&(e=a.endpoints),a.endpoint&&(r=a.endpoint),a.anchors&&(h=a.anchors),a.anchor&&(o=a.anchor))}return{endpoints:e||[r,r],anchors:h||[o,o]}},this.setId=function(t,i,e){var s;n.isString(t)?s=t:(t=this.getElement(t),s=this.getId(t));var r=this.getConnections({source:s,scope:"*"},!0),o=this.getConnections({target:s,scope:"*"},!0);i=""+i,e?t=this.getElement(i):(t=this.getElement(s),this.setAttribute(t,"id",i)),b[i]=b[s]||[];for(var h=0,u=b[i].length;h<u;h++)b[i][h].setElementId(i),b[i][h].setReferenceElement(t);delete b[s],this.sourceEndpointDefinitions[i]=this.sourceEndpointDefinitions[s],delete this.sourceEndpointDefinitions[s],this.targetEndpointDefinitions[i]=this.targetEndpointDefinitions[s],delete this.targetEndpointDefinitions[s],this.anchorManager.changeId(s,i);var a=this.getDragManager();a&&a.changeId(s,i),M[i]=M[s],delete M[s];var c=function(n,e,s){for(var r=0,o=n.length;r<o;r++)n[r].endpoints[e].setElementId(i),n[r].endpoints[e].setReferenceElement(t),n[r][s+"Id"]=i,n[r][s]=t};c(r,0,"source"),c(o,1,"target"),this.repaint(i)},this.setDebugLog=function(t){g=t},this.setSuspendDrawing=function(t,i){var n=j;return j=t,k=t?(new Date).getTime():null,i&&this.repaintEverything(),n},this.isSuspendDrawing=function(){return j},this.getSuspendedAt=function(){return k},this.batch=function(t,i){var e=this.isSuspendDrawing();e||this.setSuspendDrawing(!0);try{t()}catch(t){n.log("Function run while suspended failed",t)}e||this.setSuspendDrawing(!1,!i)},this.doWhileSuspended=this.batch,this.getCachedData=function(t){var i=T[t];return i?{o:i,s:E[t]}:ot({elId:t})},this.timestamp=e,this.show=function(t,i){return R(t,"block",i),s},this.toggleVisible=function(t,i){var n=null;i&&(n=function(t){var i=t.isVisible();t.setVisible(!i)}),N(t,function(t){var i=t.isVisible();t.setVisible(!i)},n)},this.addListener=this.bind;var pt=[];this.registerFloatingConnection=function(t,i,e){pt[t.id]=i,n.addToList(b,t.id,e)},this.getFloatingConnectionFor=function(t){return pt[t]},this.listManager=new t.jsPlumbListManager(this)};n.extend(t.jsPlumbInstance,n.EventGenerator,{setAttribute:function(t,i,n){this.setAttribute(t,i,n)},getAttribute:function(i,n){return this.getAttribute(t.jsPlumb.getElement(i),n)},convertToFullOverlaySpec:function(t){return n.isString(t)&&(t=[t,{}]),t[1].id=t[1].id||n.uuid(),t},registerConnectionType:function(i,n){if(this._connectionTypes[i]=t.jsPlumb.extend({},n),n.overlays){for(var e={},s=0;s<n.overlays.length;s++){var r=this.convertToFullOverlaySpec(n.overlays[s]);e[r[1].id]=r}this._connectionTypes[i].overlays=e}},registerConnectionTypes:function(t){for(var i in t)this.registerConnectionType(i,t[i])},registerEndpointType:function(i,n){if(this._endpointTypes[i]=t.jsPlumb.extend({},n),n.overlays){for(var e={},s=0;s<n.overlays.length;s++){var r=this.convertToFullOverlaySpec(n.overlays[s]);e[r[1].id]=r}this._endpointTypes[i].overlays=e}},registerEndpointTypes:function(t){for(var i in t)this.registerEndpointType(i,t[i])},getType:function(t,i){return"connection"===i?this._connectionTypes[t]:this._endpointTypes[t]},setIdChanged:function(t,i){this.setId(t,i,!0)},setParent:function(t,i){var n=this.getElement(t),e=this.getId(n),s=this.getElement(i),r=this.getId(s),o=this.getDragManager();n.parentNode.removeChild(n),s.appendChild(n),o&&o.setParent(n,e,s,r)},extend:function(t,i,n){var e;if(n)for(e=0;e<n.length;e++)t[n[e]]=i[n[e]];else for(e in i)t[e]=i[e];return t},floatingConnections:{},getFloatingAnchorIndex:function(t){return t.endpoints[0].isFloating()?0:t.endpoints[1].isFloating()?1:-1},proxyConnection:function(t,i,n,e,s,r){var o,h=t.endpoints[i].elementId,u=t.endpoints[i];t.proxies=t.proxies||[],(o=t.proxies[i]?t.proxies[i].ep:this.addEndpoint(n,{endpoint:s(t,i),anchor:r(t,i),parameters:{isProxyEndpoint:!0}})).setDeleteOnEmpty(!0),t.proxies[i]={ep:o,originalEp:u},0===i?this.anchorManager.sourceChanged(h,e,t,n):(this.anchorManager.updateOtherEndpoint(t.endpoints[0].elementId,h,e,t),t.target=n,t.targetId=e),u.detachFromConnection(t,null,!0),o.connections=[t],t.endpoints[i]=o,u.setVisible(!1),t.setVisible(!0),this.revalidate(n)},unproxyConnection:function(t,i,n){if(null!=t._jsPlumb&&null!=t.proxies&&null!=t.proxies[i]){var e=t.proxies[i].originalEp.element,s=t.proxies[i].originalEp.elementId;t.endpoints[i]=t.proxies[i].originalEp,0===i?this.anchorManager.sourceChanged(n,s,t,e):(this.anchorManager.updateOtherEndpoint(t.endpoints[0].elementId,n,s,t),t.target=e,t.targetId=s),t.proxies[i].ep.detachFromConnection(t,null),t.proxies[i].originalEp.addConnection(t),t.isVisible()&&t.proxies[i].originalEp.setVisible(!0),delete t.proxies[i]}}});var v=new f;t.jsPlumb=v,v.getInstance=function(t,i){var n=new f(t);if(i)for(var e in i)n[e]=i[e];return n.init(),n},v.each=function(t,i){if(null!=t)if("string"==typeof t)i(v.getElement(t));else if(null!=t.length)for(var n=0;n<t.length;n++)i(v.getElement(t[n]));else i(t)},i.jsPlumb=v}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,i=t.jsPlumb,n=t.jsPlumbUtil;i.OverlayCapableJsPlumbUIComponent=function(i){t.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.overlays={},this._jsPlumb.overlayPositions={},i.label&&(this.getDefaultType().overlays.__label=["Label",{label:i.label,location:i.labelLocation||this.defaultLabelLocation||.5,labelStyle:i.labelStyle||this._jsPlumb.instance.Defaults.LabelStyle,id:"__label"}]),this.setListenerComponent=function(t){if(this._jsPlumb)for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i].setListenerComponent(t)}},i.OverlayCapableJsPlumbUIComponent.applyType=function(t,i){if(i.overlays){var n,e={};for(n in i.overlays){var s=t._jsPlumb.overlays[i.overlays[n][1].id];if(s)s.updateFrom(i.overlays[n][1]),e[i.overlays[n][1].id]=!0;else{var r=t.getCachedTypeItem("overlay",i.overlays[n][1].id);null!=r?(r.reattach(t._jsPlumb.instance,t),r.setVisible(!0),r.updateFrom(i.overlays[n][1]),t._jsPlumb.overlays[r.id]=r):r=t.addOverlay(i.overlays[n],!0),e[r.id]=!0}}for(n in t._jsPlumb.overlays)null==e[t._jsPlumb.overlays[n].id]&&t.removeOverlay(t._jsPlumb.overlays[n].id,!0)}},n.extend(i.OverlayCapableJsPlumbUIComponent,t.jsPlumbUIComponent,{setHover:function(t){if(this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged())for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i][t?"addClass":"removeClass"](this._jsPlumb.instance.hoverClass)},addOverlay:function(t,e){var s=function(t,e){var s=null;if(n.isArray(e)){var r=e[0],o=i.extend({component:t,_jsPlumb:t._jsPlumb.instance},e[1]);3===e.length&&i.extend(o,e[2]),s=new(i.Overlays[t._jsPlumb.instance.getRenderMode()][r])(o)}else s=e.constructor===String?new(i.Overlays[t._jsPlumb.instance.getRenderMode()][e])({component:t,_jsPlumb:t._jsPlumb.instance}):e;return s.id=s.id||n.uuid(),t.cacheTypeItem("overlay",s,s.id),t._jsPlumb.overlays[s.id]=s,s}(this,t);return e||this.repaint(),s},getOverlay:function(t){return this._jsPlumb.overlays[t]},getOverlays:function(){return this._jsPlumb.overlays},hideOverlay:function(t){var i=this.getOverlay(t);i&&i.hide()},hideOverlays:function(){for(var t in this._jsPlumb.overlays)this._jsPlumb.overlays[t].hide()},showOverlay:function(t){var i=this.getOverlay(t);i&&i.show()},showOverlays:function(){for(var t in this._jsPlumb.overlays)this._jsPlumb.overlays[t].show()},removeAllOverlays:function(t){for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i].cleanup&&this._jsPlumb.overlays[i].cleanup();this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null,this._jsPlumb.overlayPlacements={},t||this.repaint()},removeOverlay:function(t,i){var n=this._jsPlumb.overlays[t];n&&(n.setVisible(!1),!i&&n.cleanup&&n.cleanup(),delete this._jsPlumb.overlays[t],this._jsPlumb.overlayPositions&&delete this._jsPlumb.overlayPositions[t],this._jsPlumb.overlayPlacements&&delete this._jsPlumb.overlayPlacements[t])},removeOverlays:function(){for(var t=0,i=arguments.length;t<i;t++)this.removeOverlay(arguments[t])},moveParent:function(t){if(this.bgCanvas&&(this.bgCanvas.parentNode.removeChild(this.bgCanvas),t.appendChild(this.bgCanvas)),this.canvas&&this.canvas.parentNode)for(var i in this.canvas.parentNode.removeChild(this.canvas),t.appendChild(this.canvas),this._jsPlumb.overlays)if(this._jsPlumb.overlays[i].isAppendedAtTopLevel){var n=this._jsPlumb.overlays[i].getElement();n.parentNode.removeChild(n),t.appendChild(n)}},getLabel:function(){var t=this.getOverlay("__label");return null!=t?t.getLabel():null},getLabelOverlay:function(){return this.getOverlay("__label")},setLabel:function(t){var n=this.getOverlay("__label");n?t.constructor===String||t.constructor===Function?n.setLabel(t):(t.label&&n.setLabel(t.label),t.location&&n.setLocation(t.location)):(n=function(t,n){var e=i.extend({cssClass:n.cssClass,labelStyle:t.labelStyle,id:"__label",component:t,_jsPlumb:t._jsPlumb.instance},n);return new(i.Overlays[t._jsPlumb.instance.getRenderMode()].Label)(e)}(this,t.constructor===String||t.constructor===Function?{label:t}:t),this._jsPlumb.overlays.__label=n),this._jsPlumb.instance.isSuspendDrawing()||this.repaint()},cleanup:function(t){for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i].cleanup(t),this._jsPlumb.overlays[i].destroy(t);t&&(this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null)},setVisible:function(t){this[t?"showOverlays":"hideOverlays"]()},setAbsoluteOverlayPosition:function(t,i){this._jsPlumb.overlayPositions[t.id]=i},getAbsoluteOverlayPosition:function(t){return this._jsPlumb.overlayPositions?this._jsPlumb.overlayPositions[t.id]:null},_clazzManip:function(t,i,n){if(!n)for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e][t+"Class"](i)},addClass:function(t,i){this._clazzManip("add",t,i)},removeClass:function(t,i){this._clazzManip("remove",t,i)}})}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,i=this.jsPlumbUtil,n=function(t,i,n){var e=!1;return{drag:function(){if(e)return e=!1,!0;if(i.element){var s=n.getUIPosition(arguments,n.getZoom());null!=s&&n.setPosition(i.element,s),n.repaint(i.element,s),t.paint({anchorPoint:t.anchor.getCurrentLocation({element:t})})}},stopDrag:function(){e=!0}}},e=function(t,i,n,e){var s=i.createElement("div",{position:"absolute"});i.appendElement(s);var r=i.getId(s);i.setPosition(s,n),s.style.width=e[0]+"px",s.style.height=e[1]+"px",i.manage(r,s,!0),t.id=r,t.element=s},s=function(i,n,e,s,r,o,h,u){return h({paintStyle:i,endpoint:e,anchor:new t.FloatingAnchor({reference:n,referenceCanvas:s,jsPlumbInstance:o}),source:r,scope:u})},r=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],o=function(t,i){var n=0;if(null!=i)for(var e=0;e<t.connections.length;e++)if(t.connections[e].sourceId===i||t.connections[e].targetId===i){n=e;break}return t.connections[n]};t.Endpoint=function(h){var u=h._jsPlumb,a=h.newConnection,c=h.newEndpoint;this.idPrefix="_jsplumb_e_",this.defaultLabelLocation=[.5,.5],this.defaultOverlayKeys=["Overlays","EndpointOverlays"],t.OverlayCapableJsPlumbUIComponent.apply(this,arguments),this.appendToDefaultType({connectionType:h.connectionType,maxConnections:null==h.maxConnections?this._jsPlumb.instance.Defaults.MaxConnections:h.maxConnections,paintStyle:h.endpointStyle||h.paintStyle||h.style||this._jsPlumb.instance.Defaults.EndpointStyle||t.Defaults.EndpointStyle,hoverPaintStyle:h.endpointHoverStyle||h.hoverPaintStyle||this._jsPlumb.instance.Defaults.EndpointHoverStyle||t.Defaults.EndpointHoverStyle,connectorStyle:h.connectorStyle,connectorHoverStyle:h.connectorHoverStyle,connectorClass:h.connectorClass,connectorHoverClass:h.connectorHoverClass,connectorOverlays:h.connectorOverlays,connector:h.connector,connectorTooltip:h.connectorTooltip}),this._jsPlumb.enabled=!(!1===h.enabled),this._jsPlumb.visible=!0,this.element=t.getElement(h.source),this._jsPlumb.uuid=h.uuid,this._jsPlumb.floatingEndpoint=null,this._jsPlumb.uuid&&(h.endpointsByUUID[this._jsPlumb.uuid]=this),this.elementId=h.elementId,this.dragProxy=h.dragProxy,this._jsPlumb.connectionCost=h.connectionCost,this._jsPlumb.connectionsDirected=h.connectionsDirected,this._jsPlumb.currentAnchorClass="",this._jsPlumb.events={};var l=!0===h.deleteOnEmpty;this.setDeleteOnEmpty=function(t){l=t};var f=function(){var i=u.endpointAnchorClassPrefix+"-"+this._jsPlumb.currentAnchorClass;this._jsPlumb.currentAnchorClass=this.anchor.getCssClass();var n=u.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"");this.removeClass(i),this.addClass(n),t.updateClasses(this.element,n,i)}.bind(this);this.prepareAnchor=function(t){var i=this._jsPlumb.instance.makeAnchor(t,this.elementId,u);return i.bind("anchorChanged",function(t){this.fire("anchorChanged",{endpoint:this,anchor:t}),f()}.bind(this)),i},this.setPreparedAnchor=function(t,i){return this._jsPlumb.instance.continuousAnchorFactory.clear(this.elementId),this.anchor=t,f(),i||this._jsPlumb.instance.repaint(this.elementId),this},this.setAnchor=function(t,i){var n=this.prepareAnchor(t);return this.setPreparedAnchor(n,i),this};var v=function(t){if(this.connections.length>0)for(var i=0;i<this.connections.length;i++)this.connections[i].setHover(t,!1);else this.setHover(t)}.bind(this);this.bind("mouseover",function(){v(!0)}),this.bind("mouseout",function(){v(!1)}),h._transient||this._jsPlumb.instance.anchorManager.add(this,this.elementId),this.prepareEndpoint=function(n,e){var s,r=function(i,n){var e=u.getRenderMode();if(t.Endpoints[e][i])return new t.Endpoints[e][i](n);if(!u.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown endpoint type '"+i+"'"}},o={_jsPlumb:this._jsPlumb.instance,cssClass:h.cssClass,container:h.container,tooltip:h.tooltip,connectorTooltip:h.connectorTooltip,endpoint:this};return i.isString(n)?s=r(n,o):i.isArray(n)?(o=i.merge(n[1],o),s=r(n[0],o)):s=n.clone(),s.clone=function(){return i.isString(n)?r(n,o):i.isArray(n)?(o=i.merge(n[1],o),r(n[0],o)):void 0}.bind(this),s.typeId=e,s},this.setEndpoint=function(t){var i=this.prepareEndpoint(t);this.setPreparedEndpoint(i,!0)},this.setPreparedEndpoint=function(t){null!=this.endpoint&&(this.endpoint.cleanup(),this.endpoint.destroy()),this.endpoint=t,this.type=this.endpoint.type,this.canvas=this.endpoint.canvas},t.extend(this,h,r),this.isSource=h.isSource||!1,this.isTemporarySource=h.isTemporarySource||!1,this.isTarget=h.isTarget||!1,this.connections=h.connections||[],this.connectorPointerEvents=h["connector-pointer-events"],this.scope=h.scope||u.getDefaultScope(),this.timestamp=null,this.reattachConnections=h.reattach||u.Defaults.ReattachConnections,this.connectionsDetachable=u.Defaults.ConnectionsDetachable,!1!==h.connectionsDetachable&&!1!==h.detachable||(this.connectionsDetachable=!1),this.dragAllowedWhenFull=!1!==h.dragAllowedWhenFull,h.onMaxConnections&&this.bind("maxConnections",h.onMaxConnections),this.addConnection=function(t){this.connections.push(t),this[(this.connections.length>0?"add":"remove")+"Class"](u.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](u.endpointFullClass)},this.detachFromConnection=function(t,i,n){(i=null==i?this.connections.indexOf(t):i)>=0&&(this.connections.splice(i,1),this[(this.connections.length>0?"add":"remove")+"Class"](u.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](u.endpointFullClass)),!n&&l&&0===this.connections.length&&u.deleteObject({endpoint:this,fireEvent:!1,deleteAttachedObjects:!0!==n})},this.deleteEveryConnection=function(t){for(var i=this.connections.length,n=0;n<i;n++)u.deleteConnection(this.connections[0],t)},this.detachFrom=function(t){for(var i=[],n=0;n<this.connections.length;n++)this.connections[n].endpoints[1]!==t&&this.connections[n].endpoints[0]!==t||i.push(this.connections[n]);for(var e=0,s=i.length;e<s;e++)u.deleteConnection(i[0]);return this},this.getElement=function(){return this.element},this.setElement=function(n){var e=this._jsPlumb.instance.getId(n),s=this.elementId;return i.removeWithFunction(h.endpointsByElement[this.elementId],function(t){return t.id===this.id}.bind(this)),this.element=t.getElement(n),this.elementId=u.getId(this.element),u.anchorManager.rehomeEndpoint(this,s,this.element),u.dragManager.endpointAdded(this.element),i.addToList(h.endpointsByElement,e,this),this},this.makeInPlaceCopy=function(){var t=this.anchor.getCurrentLocation({element:this}),i=this.anchor.getOrientation(this),n=this.anchor.getCssClass();return c({dropOptions:h.dropOptions,anchor:{bind:function(){},compute:function(){return[t[0],t[1]]},getCurrentLocation:function(){return[t[0],t[1]]},getOrientation:function(){return i},getCssClass:function(){return n}},source:this.element,paintStyle:this.getPaintStyle(),endpoint:h.hideOnDrag?"Blank":this.endpoint,_transient:!0,scope:this.scope,reference:this})},this.connectorSelector=function(){return this.connections[0]},this.setStyle=this.setPaintStyle,this.paint=function(t){var i=(t=t||{}).timestamp,n=!(!1===t.recalc);if(!i||this.timestamp!==i){var e=u.updateOffset({elId:this.elementId,timestamp:i}),s=t.offset?t.offset.o:e.o;if(null!=s){var r=t.anchorPoint,h=t.connectorPaintStyle;if(null==r){var a={xy:[s.left,s.top],wh:t.dimensions||e.s,element:this,timestamp:i};if(n&&this.anchor.isDynamic&&this.connections.length>0){var c=o(this,t.elementWithPrecedence),l=c.endpoints[0]===this?1:0,f=u.getCachedData(0===l?c.sourceId:c.targetId),v=f.o,d=f.s;a.index=0===l?1:0,a.connection=c,a.txy=[v.left,v.top],a.twh=d,a.tElement=c.endpoints[l]}else this.connections.length>0&&(a.connection=this.connections[0]);r=this.anchor.compute(a)}for(var p in this.endpoint.compute(r,this.anchor.getOrientation(this),this._jsPlumb.paintStyleInUse,h||this.paintStyleInUse),this.endpoint.paint(this._jsPlumb.paintStyleInUse,this.anchor),this.timestamp=i,this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(p)){var m=this._jsPlumb.overlays[p];m.isVisible()&&(this._jsPlumb.overlayPlacements[p]=m.draw(this.endpoint,this._jsPlumb.paintStyleInUse),m.paint(this._jsPlumb.overlayPlacements[p]))}}}},this.getTypeDescriptor=function(){return"endpoint"},this.isVisible=function(){return this._jsPlumb.visible},this.repaint=this.paint;var d=!1;this.initDraggable=function(){if(!d&&t.isDragSupported(this.element)){var r,o={id:null,element:null},l=null,f=!1,v=null,p=n(this,o,u),m=h.dragOptions||{},g=t.dragEvents.start,y=t.dragEvents.stop,x=t.dragEvents.drag,b=t.dragEvents.beforeStart,w=function(){l=this.connectorSelector();var i=!0;this.isEnabled()||(i=!1),null!=l||this.isSource||this.isTemporarySource||(i=!1),!this.isSource||!this.isFull()||null!=l&&this.dragAllowedWhenFull||(i=!1),null==l||l.isDetachable(this)||(this.isFull()?i=!1:l=null);var n=u.checkCondition(null==l?"beforeDrag":"beforeStartDetach",{endpoint:this,source:this.element,sourceId:this.elementId,connection:l});if(!1===n?i=!1:"object"==typeof n?t.extend(n,r||{}):n=r||{},!1===i)return u.stopDrag&&u.stopDrag(this.canvas),p.stopDrag(),!1;for(var d=0;d<this.connections.length;d++)this.connections[d].setHover(!1);this.addClass("endpointDrag"),u.setConnectionBeingDragged(!0),l&&!this.isFull()&&this.isSource&&(l=null),u.updateOffset({elId:this.elementId});var m=this._jsPlumb.instance.getOffset(this.canvas),g=this.canvas,y=this._jsPlumb.instance.getSize(this.canvas);e(o,u,m,y),u.setAttributes(this.canvas,{dragId:o.id,elId:this.elementId});var x=this.dragProxy||this.endpoint;if(null==this.dragProxy&&null!=this.connectionType){var b=this._jsPlumb.instance.deriveEndpointAndAnchorSpec(this.connectionType);b.endpoints[1]&&(x=b.endpoints[1])}var w=this._jsPlumb.instance.makeAnchor("Center");w.isFloating=!0,this._jsPlumb.floatingEndpoint=s(this.getPaintStyle(),w,x,this.canvas,o.element,u,c,this.scope);var M=this._jsPlumb.floatingEndpoint.anchor;if(null==l)this.setHover(!1,!1),(l=a({sourceEndpoint:this,targetEndpoint:this._jsPlumb.floatingEndpoint,source:this.element,target:o.element,anchors:[this.anchor,this._jsPlumb.floatingEndpoint.anchor],paintStyle:h.connectorStyle,hoverPaintStyle:h.connectorHoverStyle,connector:h.connector,overlays:h.connectorOverlays,type:this.connectionType,cssClass:this.connectorClass,hoverClass:this.connectorHoverClass,scope:h.scope,data:n})).pending=!0,l.addClass(u.draggingClass),this._jsPlumb.floatingEndpoint.addClass(u.draggingClass),this._jsPlumb.floatingEndpoint.anchor=M,u.fire("connectionDrag",l),u.anchorManager.newConnection(l);else{f=!0,l.setHover(!1);var T=l.endpoints[0].id===this.id?0:1;this.detachFromConnection(l,null,!0);var C=u.getDragScope(g);u.setAttribute(this.canvas,"originalScope",C),u.fire("connectionDrag",l),0===T?(v=[l.source,l.sourceId,g,C],u.anchorManager.sourceChanged(l.endpoints[T].elementId,o.id,l,o.element)):(v=[l.target,l.targetId,g,C],l.target=o.element,l.targetId=o.id,u.anchorManager.updateOtherEndpoint(l.sourceId,l.endpoints[T].elementId,l.targetId,l)),l.suspendedEndpoint=l.endpoints[T],l.suspendedElement=l.endpoints[T].getElement(),l.suspendedElementId=l.endpoints[T].elementId,l.suspendedElementType=0===T?"source":"target",l.suspendedEndpoint.setHover(!1),this._jsPlumb.floatingEndpoint.referenceEndpoint=l.suspendedEndpoint,l.endpoints[T]=this._jsPlumb.floatingEndpoint,l.addClass(u.draggingClass),this._jsPlumb.floatingEndpoint.addClass(u.draggingClass)}u.registerFloatingConnection(o,l,this._jsPlumb.floatingEndpoint),u.currentlyDragging=!0}.bind(this),M=function(){if(u.setConnectionBeingDragged(!1),l&&null!=l.endpoints){var t=u.getDropEvent(arguments),i=u.getFloatingAnchorIndex(l);if(l.endpoints[0===i?1:0].anchor.unlock(),l.removeClass(u.draggingClass),this._jsPlumb&&(l.deleteConnectionNow||l.endpoints[i]===this._jsPlumb.floatingEndpoint)&&f&&l.suspendedEndpoint){0===i?(l.floatingElement=l.source,l.floatingId=l.sourceId,l.floatingEndpoint=l.endpoints[0],l.floatingIndex=0,l.source=v[0],l.sourceId=v[1]):(l.floatingElement=l.target,l.floatingId=l.targetId,l.floatingEndpoint=l.endpoints[1],l.floatingIndex=1,l.target=v[0],l.targetId=v[1]);var n=this._jsPlumb.floatingEndpoint;u.setDragScope(v[2],v[3]),l.endpoints[i]=l.suspendedEndpoint,l.isReattach()||l._forceReattach||l._forceDetach||!u.deleteConnection(l,{originalEvent:t})?(l.setHover(!1),l._forceDetach=null,l._forceReattach=null,this._jsPlumb.floatingEndpoint.detachFromConnection(l),l.suspendedEndpoint.addConnection(l),1===i?u.anchorManager.updateOtherEndpoint(l.sourceId,l.floatingId,l.targetId,l):u.anchorManager.sourceChanged(l.floatingId,l.sourceId,l,l.source),u.repaint(v[1])):u.deleteObject({endpoint:n})}this.deleteAfterDragStop?u.deleteObject({endpoint:this}):this._jsPlumb&&this.paint({recalc:!1}),u.fire("connectionDragStop",l,t),l.pending&&u.fire("connectionAborted",l,t),u.currentlyDragging=!1,l.suspendedElement=null,l.suspendedEndpoint=null,l=null}o&&o.element&&u.remove(o.element,!1,!1),this._jsPlumb&&(this.canvas.style.visibility="visible",this.anchor.unlock(),this._jsPlumb.floatingEndpoint=null)}.bind(this);(m=t.extend({},m)).scope=this.scope||m.scope,m[b]=i.wrap(m[b],function(t){r=t.e.payload||{}},!1),m[g]=i.wrap(m[g],w,!1),m[x]=i.wrap(m[x],p.drag),m[y]=i.wrap(m[y],M),m.multipleDrop=!1,m.canDrag=function(){return this.isSource||this.isTemporarySource||this.connections.length>0&&!1!==this.connectionsDetachable}.bind(this),u.initDraggable(this.canvas,m,"internal"),this.canvas._jsPlumbRelatedElement=this.element,d=!0}};var p=h.endpoint||this._jsPlumb.instance.Defaults.Endpoint||t.Defaults.Endpoint;this.setEndpoint(p,!0);var m=h.anchor?h.anchor:h.anchors?h.anchors:u.Defaults.Anchor||"Top";this.setAnchor(m,!0);var g=["default",h.type||""].join(" ");this.addType(g,h.data,!0),this.canvas=this.endpoint.canvas,this.canvas._jsPlumb=this,this.initDraggable();var y=function(n,e,s,r){if(t.isDropSupported(this.element)){var o=h.dropOptions||u.Defaults.DropOptions||t.Defaults.DropOptions;(o=t.extend({},o)).scope=o.scope||this.scope;var a=t.dragEvents.drop,c=t.dragEvents.over,l=t.dragEvents.out,f=this,v=u.EndpointDropHandler({getEndpoint:function(){return f},jsPlumb:u,enabled:function(){return null==s||s.isEnabled()},isFull:function(){return s.isFull()},element:this.element,elementId:this.elementId,isSource:this.isSource,isTarget:this.isTarget,addClass:function(t){f.addClass(t)},removeClass:function(t){f.removeClass(t)},isDropAllowed:function(){return f.isDropAllowed.apply(f,arguments)},reference:r,isRedrop:function(t,i){return t.suspendedEndpoint&&i.reference&&t.suspendedEndpoint.id===i.reference.id}});o[a]=i.wrap(o[a],v,!0),o[c]=i.wrap(o[c],function(){var i=t.getDragObject(arguments),n=u.getAttribute(t.getElement(i),"dragId"),e=u.getFloatingConnectionFor(n);if(null!=e){var s=u.getFloatingAnchorIndex(e),r=this.isTarget&&0!==s||e.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===e.suspendedEndpoint.id;if(r){var o=u.checkCondition("checkDropAllowed",{sourceEndpoint:e.endpoints[s],targetEndpoint:this,connection:e});this[(o?"add":"remove")+"Class"](u.endpointDropAllowedClass),this[(o?"remove":"add")+"Class"](u.endpointDropForbiddenClass),e.endpoints[s].anchor.over(this.anchor,this)}}}.bind(this)),o[l]=i.wrap(o[l],function(){var i=t.getDragObject(arguments),n=null==i?null:u.getAttribute(t.getElement(i),"dragId"),e=n?u.getFloatingConnectionFor(n):null;if(null!=e){var s=u.getFloatingAnchorIndex(e),r=this.isTarget&&0!==s||e.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===e.suspendedEndpoint.id;r&&(this.removeClass(u.endpointDropAllowedClass),this.removeClass(u.endpointDropForbiddenClass),e.endpoints[s].anchor.out())}}.bind(this)),u.initDroppable(n,o,"internal",e)}}.bind(this);return this.anchor.isFloating||y(this.canvas,!(h._transient||this.anchor.isFloating),this,h.reference),this},i.extend(t.Endpoint,t.OverlayCapableJsPlumbUIComponent,{setVisible:function(t,i,n){if(this._jsPlumb.visible=t,this.canvas&&(this.canvas.style.display=t?"block":"none"),this[t?"showOverlays":"hideOverlays"](),!i)for(var e=0;e<this.connections.length;e++)if(this.connections[e].setVisible(t),!n){var s=this===this.connections[e].endpoints[0]?1:0;1===this.connections[e].endpoints[s].connections.length&&this.connections[e].endpoints[s].setVisible(t,!0,!0)}},getAttachedElements:function(){return this.connections},applyType:function(i,n){this.setPaintStyle(i.endpointStyle||i.paintStyle,n),this.setHoverPaintStyle(i.endpointHoverStyle||i.hoverPaintStyle,n),null!=i.maxConnections&&(this._jsPlumb.maxConnections=i.maxConnections),i.scope&&(this.scope=i.scope),t.extend(this,i,r),null!=i.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,i.cssClass),t.OverlayCapableJsPlumbUIComponent.applyType(this,i)},isEnabled:function(){return this._jsPlumb.enabled},setEnabled:function(t){this._jsPlumb.enabled=t},cleanup:function(){t.removeClass(this.element,this._jsPlumb.instance.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"")),this.anchor=null,this.endpoint.cleanup(!0),this.endpoint.destroy(),this.endpoint=null,this._jsPlumb.instance.destroyDraggable(this.canvas,"internal"),this._jsPlumb.instance.destroyDroppable(this.canvas,"internal")},setHover:function(t){this.endpoint&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&this.endpoint.setHover(t)},isFull:function(){return 0===this._jsPlumb.maxConnections||!(this.isFloating()||this._jsPlumb.maxConnections<0||this.connections.length<this._jsPlumb.maxConnections)},isFloating:function(){return null!=this.anchor&&this.anchor.isFloating},isConnectedTo:function(t){var i=!1;if(t)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t){i=!0;break}return i},getConnectionCost:function(){return this._jsPlumb.connectionCost},setConnectionCost:function(t){this._jsPlumb.connectionCost=t},areConnectionsDirected:function(){return this._jsPlumb.connectionsDirected},setConnectionsDirected:function(t){this._jsPlumb.connectionsDirected=t},setElementId:function(t){this.elementId=t,this.anchor.elementId=t},setReferenceElement:function(i){this.element=t.getElement(i)},setDragAllowedWhenFull:function(t){this.dragAllowedWhenFull=t},equals:function(t){return this.anchor.equals(t.anchor)},getUuid:function(){return this._jsPlumb.uuid},computeAnchor:function(t){return this.anchor.compute(t)}}),this.jsPlumbInstance.prototype.EndpointDropHandler=function(t){return function(n){var e=t.jsPlumb;t.removeClass(e.endpointDropAllowedClass),t.removeClass(e.endpointDropForbiddenClass);var s=e.getDropEvent(arguments),r=e.getDragObject(arguments),o=e.getAttribute(r,"dragId"),h=(e.getAttribute(r,"elId"),e.getAttribute(r,"originalScope")),u=e.getFloatingConnectionFor(o);if(null!=u){var a=null!=u.suspendedEndpoint;if(!a||null!=u.suspendedEndpoint._jsPlumb){var c=t.getEndpoint(u);if(null!=c){if(t.isRedrop(u,t))return u._forceReattach=!0,u.setHover(!1),void(t.maybeCleanup&&t.maybeCleanup(c));var l=e.getFloatingAnchorIndex(u);if(0===l&&!t.isSource||1===l&&!t.isTarget)t.maybeCleanup&&t.maybeCleanup(c);else{t.onDrop&&t.onDrop(u),h&&e.setDragScope(r,h);var f=t.isFull(n);if(f&&c.fire("maxConnections",{endpoint:this,connection:u,maxConnections:c._jsPlumb.maxConnections},s),!f&&t.enabled()){var v=!0;0===l?(u.floatingElement=u.source,u.floatingId=u.sourceId,u.floatingEndpoint=u.endpoints[0],u.floatingIndex=0,u.source=t.element,u.sourceId=t.elementId):(u.floatingElement=u.target,u.floatingId=u.targetId,u.floatingEndpoint=u.endpoints[1],u.floatingIndex=1,u.target=t.element,u.targetId=t.elementId),a&&u.suspendedEndpoint.id!==c.id&&(u.isDetachAllowed(u)&&u.endpoints[l].isDetachAllowed(u)&&u.suspendedEndpoint.isDetachAllowed(u)&&e.checkCondition("beforeDetach",u)||(v=!1));var d=function(n){u.endpoints[l].detachFromConnection(u),u.suspendedEndpoint&&u.suspendedEndpoint.detachFromConnection(u),u.endpoints[l]=c,c.addConnection(u);var r=c.getParameters();for(var o in r)u.setParameter(o,r[o]);if(a){var h=u.suspendedEndpoint.elementId;e.fireMoveEvent({index:l,originalSourceId:0===l?h:u.sourceId,newSourceId:0===l?c.elementId:u.sourceId,originalTargetId:1===l?h:u.targetId,newTargetId:1===l?c.elementId:u.targetId,originalSourceEndpoint:0===l?u.suspendedEndpoint:u.endpoints[0],newSourceEndpoint:0===l?c:u.endpoints[0],originalTargetEndpoint:1===l?u.suspendedEndpoint:u.endpoints[1],newTargetEndpoint:1===l?c:u.endpoints[1],connection:u},s)}else r.draggable&&e.initDraggable(this.element,t.dragOptions,"internal",e);1===l?e.anchorManager.updateOtherEndpoint(u.sourceId,u.floatingId,u.targetId,u):e.anchorManager.sourceChanged(u.floatingId,u.sourceId,u,u.source),u.endpoints[0].finalEndpoint&&(u.endpoints[0].detachFromConnection(u),u.endpoints[0]=u.endpoints[0].finalEndpoint,u.endpoints[0].addConnection(u)),i.isObject(n)&&u.mergeData(n),e.finaliseConnection(u,null,s,!1),u.setHover(!1),e.revalidate(u.endpoints[0].element)}.bind(this),p=function(){u.suspendedEndpoint&&(u.endpoints[l]=u.suspendedEndpoint,u.setHover(!1),u._forceDetach=!0,0===l?(u.source=u.suspendedEndpoint.element,u.sourceId=u.suspendedEndpoint.elementId):(u.target=u.suspendedEndpoint.element,u.targetId=u.suspendedEndpoint.elementId),u.suspendedEndpoint.addConnection(u),1===l?e.anchorManager.updateOtherEndpoint(u.sourceId,u.floatingId,u.targetId,u):e.anchorManager.sourceChanged(u.floatingId,u.sourceId,u,u.source),e.repaint(u.sourceId),u._forceDetach=!1)};if(v=v&&t.isDropAllowed(u.sourceId,u.targetId,u.scope,u,c))return d(v),!0;p()}t.maybeCleanup&&t.maybeCleanup(c),e.currentlyDragging=!1}}}}}}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,i=t.jsPlumb,n=t.jsPlumbUtil,e=function(t,e,s,r,o){if(i.Connectors[e]=i.Connectors[e]||{},null==i.Connectors[e][s]){if(null==i.Connectors[s]){if(t.Defaults.DoNotThrowErrors)return null;throw new TypeError("jsPlumb: unknown connector type '"+s+"'")}i.Connectors[e][s]=function(){i.Connectors[s].apply(this,arguments),i.ConnectorRenderers[e].apply(this,arguments)},n.extend(i.Connectors[e][s],[i.Connectors[s],i.ConnectorRenderers[e]])}return new i.Connectors[e][s](r,o)},s=function(t,i,n){return t?n.makeAnchor(t,i,n):null},r=function(t,i,e,s){null!=i&&(i._jsPlumbConnections=i._jsPlumbConnections||{},s?delete i._jsPlumbConnections[t.id]:i._jsPlumbConnections[t.id]=!0,n.isEmpty(i._jsPlumbConnections)?e.removeClass(i,e.connectedClass):e.addClass(i,e.connectedClass))};i.Connection=function(t){var e=t.newEndpoint;this.id=t.id,this.connector=null,this.idPrefix="_jsplumb_c_",this.defaultLabelLocation=.5,this.defaultOverlayKeys=["Overlays","ConnectionOverlays"],this.previousConnection=t.previousConnection,this.source=i.getElement(t.source),this.target=i.getElement(t.target),i.OverlayCapableJsPlumbUIComponent.apply(this,arguments),t.sourceEndpoint?(this.source=t.sourceEndpoint.getElement(),this.sourceId=t.sourceEndpoint.elementId):this.sourceId=this._jsPlumb.instance.getId(this.source),t.targetEndpoint?(this.target=t.targetEndpoint.getElement(),this.targetId=t.targetEndpoint.elementId):this.targetId=this._jsPlumb.instance.getId(this.target),this.scope=t.scope,this.endpoints=[],this.endpointStyles=[];var s=this._jsPlumb.instance;s.manage(this.sourceId,this.source),s.manage(this.targetId,this.target),this._jsPlumb.visible=!0,this._jsPlumb.params={cssClass:t.cssClass,container:t.container,"pointer-events":t["pointer-events"],editorParams:t.editorParams,overlays:t.overlays},this._jsPlumb.lastPaintedAt=null,this.bind("mouseover",function(){this.setHover(!0)}.bind(this)),this.bind("mouseout",function(){this.setHover(!1)}.bind(this)),this.makeEndpoint=function(i,n,r,o){return r=r||this._jsPlumb.instance.getId(n),this.prepareEndpoint(s,e,this,o,i?0:1,t,n,r)},t.type&&(t.endpoints=t.endpoints||this._jsPlumb.instance.deriveEndpointAndAnchorSpec(t.type).endpoints);var r=this.makeEndpoint(!0,this.source,this.sourceId,t.sourceEndpoint),o=this.makeEndpoint(!1,this.target,this.targetId,t.targetEndpoint);r&&n.addToList(t.endpointsByElement,this.sourceId,r),o&&n.addToList(t.endpointsByElement,this.targetId,o),this.scope||(this.scope=this.endpoints[0].scope),null!=t.deleteEndpointsOnEmpty&&(this.endpoints[0].setDeleteOnEmpty(t.deleteEndpointsOnEmpty),this.endpoints[1].setDeleteOnEmpty(t.deleteEndpointsOnEmpty));var h=s.Defaults.ConnectionsDetachable;!1===t.detachable&&(h=!1),!1===this.endpoints[0].connectionsDetachable&&(h=!1),!1===this.endpoints[1].connectionsDetachable&&(h=!1);var u=t.reattach||this.endpoints[0].reattachConnections||this.endpoints[1].reattachConnections||s.Defaults.ReattachConnections;this.appendToDefaultType({detachable:h,reattach:u,paintStyle:this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||t.paintStyle||s.Defaults.PaintStyle||i.Defaults.PaintStyle,hoverPaintStyle:this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||t.hoverPaintStyle||s.Defaults.HoverPaintStyle||i.Defaults.HoverPaintStyle});var a=s.getSuspendedAt();if(!s.isSuspendDrawing()){var c=s.getCachedData(this.sourceId),l=c.o,f=c.s,v=s.getCachedData(this.targetId),d=v.o,p=v.s,m=a||s.timestamp(),g=this.endpoints[0].anchor.compute({xy:[l.left,l.top],wh:f,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[d.left,d.top],twh:p,tElement:this.endpoints[1],timestamp:m});this.endpoints[0].paint({anchorLoc:g,timestamp:m}),g=this.endpoints[1].anchor.compute({xy:[d.left,d.top],wh:p,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[l.left,l.top],twh:f,tElement:this.endpoints[0],timestamp:m}),this.endpoints[1].paint({anchorLoc:g,timestamp:m})}this.getTypeDescriptor=function(){return"connection"},this.getAttachedElements=function(){return this.endpoints},this.isDetachable=function(t){return!1!==this._jsPlumb.detachable&&(null!=t?!0===t.connectionsDetachable:!0===this._jsPlumb.detachable)},this.setDetachable=function(t){this._jsPlumb.detachable=!0===t},this.isReattach=function(){return!0===this._jsPlumb.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections},this.setReattach=function(t){this._jsPlumb.reattach=!0===t},this._jsPlumb.cost=t.cost||this.endpoints[0].getConnectionCost(),this._jsPlumb.directed=t.directed,null==t.directed&&(this._jsPlumb.directed=this.endpoints[0].areConnectionsDirected());var y=i.extend({},this.endpoints[1].getParameters());i.extend(y,this.endpoints[0].getParameters()),i.extend(y,this.getParameters()),this.setParameters(y),this.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||t.connector||s.Defaults.Connector||i.Defaults.Connector,!0);var x=null!=t.data&&n.isObject(t.data)?t.data:{};this.getData=function(){return x},this.setData=function(t){x=t||{}},this.mergeData=function(t){x=i.extend(x,t)};var b=["default",this.endpoints[0].connectionType,this.endpoints[1].connectionType,t.type].join(" ");/[^\s]/.test(b)&&this.addType(b,t.data,!0),this.updateConnectedClass()},n.extend(i.Connection,i.OverlayCapableJsPlumbUIComponent,{applyType:function(t,n,e){var s=null;null!=t.connector&&(null==(s=this.getCachedTypeItem("connector",e.connector))&&(s=this.prepareConnector(t.connector,e.connector),this.cacheTypeItem("connector",s,e.connector)),this.setPreparedConnector(s)),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope),null!=t.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,t.cssClass);var r=null;t.anchor?null==(r=this.getCachedTypeItem("anchors",e.anchor))&&(r=[this._jsPlumb.instance.makeAnchor(t.anchor),this._jsPlumb.instance.makeAnchor(t.anchor)],this.cacheTypeItem("anchors",r,e.anchor)):t.anchors&&null==(r=this.getCachedTypeItem("anchors",e.anchors))&&(r=[this._jsPlumb.instance.makeAnchor(t.anchors[0]),this._jsPlumb.instance.makeAnchor(t.anchors[1])],this.cacheTypeItem("anchors",r,e.anchors)),null!=r&&(this.endpoints[0].anchor=r[0],this.endpoints[1].anchor=r[1],this.endpoints[1].anchor.isDynamic&&this._jsPlumb.instance.repaint(this.endpoints[1].elementId)),i.OverlayCapableJsPlumbUIComponent.applyType(this,t)},addClass:function(t,i){i&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(t)),this.connector&&this.connector.addClass(t)},removeClass:function(t,i){i&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(t)),this.connector&&this.connector.removeClass(t)},isVisible:function(){return this._jsPlumb.visible},setVisible:function(t){this._jsPlumb.visible=t,this.connector&&this.connector.setVisible(t),this.repaint()},cleanup:function(){this.updateConnectedClass(!0),this.endpoints=null,this.source=null,this.target=null,null!=this.connector&&(this.connector.cleanup(!0),this.connector.destroy(!0)),this.connector=null},updateConnectedClass:function(t){this._jsPlumb&&(r(this,this.source,this._jsPlumb.instance,t),r(this,this.target,this._jsPlumb.instance,t))},setHover:function(i){this.connector&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&(this.connector.setHover(i),t.jsPlumb[i?"addClass":"removeClass"](this.source,this._jsPlumb.instance.hoverSourceClass),t.jsPlumb[i?"addClass":"removeClass"](this.target,this._jsPlumb.instance.hoverTargetClass))},getUuids:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]},getCost:function(){return this._jsPlumb?this._jsPlumb.cost:-1/0},setCost:function(t){this._jsPlumb.cost=t},isDirected:function(){return this._jsPlumb.directed},getConnector:function(){return this.connector},prepareConnector:function(t,i){var s,r={_jsPlumb:this._jsPlumb.instance,cssClass:this._jsPlumb.params.cssClass,container:this._jsPlumb.params.container,"pointer-events":this._jsPlumb.params["pointer-events"]},o=this._jsPlumb.instance.getRenderMode();return n.isString(t)?s=e(this._jsPlumb.instance,o,t,r,this):n.isArray(t)&&(s=e(this._jsPlumb.instance,o,t[0],1===t.length?r:n.merge(t[1],r),this)),null!=i&&(s.typeId=i),s},setPreparedConnector:function(t,i,n,e){if(this.connector!==t){var s,r="";if(null!=this.connector&&(r=(s=this.connector).getClass(),this.connector.cleanup(),this.connector.destroy()),this.connector=t,e&&this.cacheTypeItem("connector",t,e),this.canvas=this.connector.canvas,this.bgCanvas=this.connector.bgCanvas,this.connector.reattach(this._jsPlumb.instance),this.addClass(r),this.canvas&&(this.canvas._jsPlumb=this),this.bgCanvas&&(this.bgCanvas._jsPlumb=this),null!=s)for(var o=this.getOverlays(),h=0;h<o.length;h++)o[h].transfer&&o[h].transfer(this.connector);n||this.setListenerComponent(this.connector),i||this.repaint()}},setConnector:function(t,i,n,e){var s=this.prepareConnector(t,e);this.setPreparedConnector(s,i,n,e)},paint:function(t){if(!this._jsPlumb.instance.isSuspendDrawing()&&this._jsPlumb.visible){var i=(t=t||{}).timestamp,n=this.targetId;if(null==i||i!==this._jsPlumb.lastPaintedAt){var e=this._jsPlumb.instance.updateOffset({elId:this.sourceId}).o,s=this._jsPlumb.instance.updateOffset({elId:n}).o,r=this.endpoints[0],o=this.endpoints[1],h=r.anchor.getCurrentLocation({xy:[e.left,e.top],wh:[e.width,e.height],element:r,timestamp:i}),u=o.anchor.getCurrentLocation({xy:[s.left,s.top],wh:[s.width,s.height],element:o,timestamp:i});this.connector.resetBounds(),this.connector.compute({sourcePos:h,targetPos:u,sourceOrientation:r.anchor.getOrientation(r),targetOrientation:o.anchor.getOrientation(o),sourceEndpoint:this.endpoints[0],targetEndpoint:this.endpoints[1],"stroke-width":this._jsPlumb.paintStyleInUse.strokeWidth,sourceInfo:e,targetInfo:s});var a={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};for(var c in this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(c)){var l=this._jsPlumb.overlays[c];l.isVisible()&&(this._jsPlumb.overlayPlacements[c]=l.draw(this.connector,this._jsPlumb.paintStyleInUse,this.getAbsoluteOverlayPosition(l)),a.minX=Math.min(a.minX,this._jsPlumb.overlayPlacements[c].minX),a.maxX=Math.max(a.maxX,this._jsPlumb.overlayPlacements[c].maxX),a.minY=Math.min(a.minY,this._jsPlumb.overlayPlacements[c].minY),a.maxY=Math.max(a.maxY,this._jsPlumb.overlayPlacements[c].maxY))}var f=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||1)/2,v=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||0),d={xmin:Math.min(this.connector.bounds.minX-(f+v),a.minX),ymin:Math.min(this.connector.bounds.minY-(f+v),a.minY),xmax:Math.max(this.connector.bounds.maxX+(f+v),a.maxX),ymax:Math.max(this.connector.bounds.maxY+(f+v),a.maxY)};for(var p in this.connector.paint(this._jsPlumb.paintStyleInUse,null,d),this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(p)){var m=this._jsPlumb.overlays[p];m.isVisible()&&m.paint(this._jsPlumb.overlayPlacements[p],d)}}this._jsPlumb.lastPaintedAt=i}},repaint:function(t){var i=jsPlumb.extend(t||{},{});i.elId=this.sourceId,this.paint(i)},prepareEndpoint:function(t,n,e,r,o,h,u,a){var c;if(r)e.endpoints[o]=r,r.addConnection(e);else{h.endpoints||(h.endpoints=[null,null]);var l=h.endpoints[o]||h.endpoint||t.Defaults.Endpoints[o]||i.Defaults.Endpoints[o]||t.Defaults.Endpoint||i.Defaults.Endpoint;h.endpointStyles||(h.endpointStyles=[null,null]),h.endpointHoverStyles||(h.endpointHoverStyles=[null,null]);var f=h.endpointStyles[o]||h.endpointStyle||t.Defaults.EndpointStyles[o]||i.Defaults.EndpointStyles[o]||t.Defaults.EndpointStyle||i.Defaults.EndpointStyle;null==f.fill&&null!=h.paintStyle&&(f.fill=h.paintStyle.stroke),null==f.outlineStroke&&null!=h.paintStyle&&(f.outlineStroke=h.paintStyle.outlineStroke),null==f.outlineWidth&&null!=h.paintStyle&&(f.outlineWidth=h.paintStyle.outlineWidth);var v=h.endpointHoverStyles[o]||h.endpointHoverStyle||t.Defaults.EndpointHoverStyles[o]||i.Defaults.EndpointHoverStyles[o]||t.Defaults.EndpointHoverStyle||i.Defaults.EndpointHoverStyle;null!=h.hoverPaintStyle&&(null==v&&(v={}),null==v.fill&&(v.fill=h.hoverPaintStyle.stroke));var d=h.anchors?h.anchors[o]:h.anchor?h.anchor:s(t.Defaults.Anchors[o],a,t)||s(i.Defaults.Anchors[o],a,t)||s(t.Defaults.Anchor,a,t)||s(i.Defaults.Anchor,a,t);c=n({paintStyle:f,hoverPaintStyle:v,endpoint:l,connections:[e],uuid:h.uuids?h.uuids[o]:null,anchor:d,source:u,scope:h.scope,reattach:h.reattach||t.Defaults.ReattachConnections,detachable:h.detachable||t.Defaults.ConnectionsDetachable}),null==r&&c.setDeleteOnEmpty(!0),e.endpoints[o]=c,!1===h.drawEndpoints&&c.setVisible(!1,!0,!0)}return c}})}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumbUtil,i=this.jsPlumb;i.AnchorManager=function(n){var e={},s={},r={},o={},h=this,u={},a=n.jsPlumbInstance,c={},l=function(t){return function(i,n){return!1==(t?i[0][0]<n[0][0]:i[0][0]>n[0][0])?-1:1}},f={top:function(t,i){return t[0]>i[0]?1:-1},right:l(!0),bottom:l(!0),left:function(t,i){return(t[0][0]<0?-Math.PI-t[0][0]:Math.PI-t[0][0])>(i[0][0]<0?-Math.PI-i[0][0]:Math.PI-i[0][0])?1:-1}},v=function(t,i){var n=a.getCachedData(t),e=n.s,o=n.o,h=function(i,n,e,o,h,u,a){if(o.length>0)for(var c=function(t,i,n,e,s,r,o){for(var h=[],u=i[s?0:1]/(e.length+1),a=0;a<e.length;a++){var c=(a+1)*u,l=r*i[s?1:0];o&&(c=i[s?0:1]-c);var f=s?c:l,v=s?l:c;h.push([n[0]+f,n[1]+v,f/i[0],v/i[1],e[a][1],e[a][2]])}return h}(0,n,e,o.sort(f[i]),h,u,"right"===i||"top"===i),l=function(t,i){s[t.id]=[i[0],i[1],i[2],i[3]],r[t.id]=a},v=0;v<c.length;v++){var d=c[v][4],p=d.endpoints[1].elementId===t;d.endpoints[0].elementId===t&&l(d.endpoints[0],c[v]),p&&l(d.endpoints[1],c[v])}};h("bottom",e,[o.left,o.top],i.bottom,!0,1,[0,1]),h("top",e,[o.left,o.top],i.top,!0,0,[0,-1]),h("left",e,[o.left,o.top],i.left,!1,0,[-1,0]),h("right",e,[o.left,o.top],i.right,!1,1,[1,0])};this.reset=function(){e={},o={},u={}},this.addFloatingConnection=function(t,i){c[t]=i},this.removeFloatingConnection=function(t){delete c[t]},this.newConnection=function(n){var e=n.sourceId,s=n.targetId,r=n.endpoints,h=!0,u=function(u,a,c,l,f){e===s&&c.isContinuous&&(n._jsPlumb.instance.removeElement(r[1].canvas),h=!1),t.addToList(o,l,[f,a,c.constructor===i.DynamicAnchor])};u(0,r[0],r[0].anchor,s,n),h&&u(0,r[1],r[1].anchor,e,n)};var d=function(i){!function(i,n){if(i){var e=function(t){return t[4]===n};t.removeWithFunction(i.top,e),t.removeWithFunction(i.left,e),t.removeWithFunction(i.bottom,e),t.removeWithFunction(i.right,e)}}(u[i.elementId],i.id)};this.connectionDetached=function(i,n){var e=i.connection||i,s=i.targetId,r=function(i,n,e,s,r){t.removeWithFunction(o[s],function(t){return t[0].id===r.id})};r(0,0,0,i.sourceId,e),r(0,0,0,s,e),e.floatingId&&(r(0,0,0,e.floatingId,e),d(e.floatingEndpoint)),d(e.endpoints[0]),d(e.endpoints[1]),n||(h.redraw(e.sourceId),e.targetId!==e.sourceId&&h.redraw(e.targetId))},this.add=function(i,n){t.addToList(e,n,i)},this.changeId=function(t,i){o[i]=o[t],e[i]=e[t],delete o[t],delete e[t]},this.getConnectionsFor=function(t){return o[t]||[]},this.getEndpointsFor=function(t){return e[t]||[]},this.deleteEndpoint=function(i){t.removeWithFunction(e[i.elementId],function(t){return t.id===i.id}),d(i)},this.clearFor=function(t){delete e[t],e[t]=[]};var p=function(i,e,s,r,o,h,u,a,c,l,f,v){var d,p,m=-1,g=r.endpoints[u],y=g.id,x=[1,0][u],b=[[e,s],r,o,h,y],w=i[c],M=g._continuousAnchorEdge?i[g._continuousAnchorEdge]:null;if(M){var T=t.findWithFunction(M,function(t){return t[4]===y});if(-1!==T)for(M.splice(T,1),d=0;d<M.length;d++)t.addWithFunction(f,p=M[d][1],function(t){return t.id===p.id}),t.addWithFunction(v,M[d][1].endpoints[u],function(t){return t.id===p.endpoints[u].id}),t.addWithFunction(v,M[d][1].endpoints[x],function(t){return t.id===p.endpoints[x].id})}for(d=0;d<w.length;d++)1===n.idx&&w[d][3]===h&&-1===m&&(m=d),t.addWithFunction(f,p=w[d][1],function(t){return t.id===p.id}),t.addWithFunction(v,w[d][1].endpoints[u],function(t){return t.id===p.endpoints[u].id}),t.addWithFunction(v,w[d][1].endpoints[x],function(t){return t.id===p.endpoints[x].id});w.splice(a?-1!==m?m:0:w.length,0,b),g._continuousAnchorEdge=c};this.updateOtherEndpoint=function(n,e,s,r){var h=t.findWithFunction(o[n],function(t){return t[0].id===r.id}),u=t.findWithFunction(o[e],function(t){return t[0].id===r.id});-1!==h&&(o[n][h][0]=r,o[n][h][1]=r.endpoints[1],o[n][h][2]=r.endpoints[1].anchor.constructor===i.DynamicAnchor),u>-1&&(o[e].splice(u,1),t.addToList(o,s,[r,r.endpoints[0],r.endpoints[0].anchor.constructor===i.DynamicAnchor])),r.updateConnectedClass()},this.sourceChanged=function(n,e,s,r){if(n!==e){s.sourceId=e,s.source=r,t.removeWithFunction(o[n],function(t){return t[0].id===s.id});var h=t.findWithFunction(o[s.targetId],function(t){return t[0].id===s.id});h>-1&&(o[s.targetId][h][0]=s,o[s.targetId][h][1]=s.endpoints[0],o[s.targetId][h][2]=s.endpoints[0].anchor.constructor===i.DynamicAnchor),t.addToList(o,e,[s,s.endpoints[1],s.endpoints[1].anchor.constructor===i.DynamicAnchor]),s.endpoints[1].anchor.isContinuous&&(s.source===s.target?s._jsPlumb.instance.removeElement(s.endpoints[1].canvas):null==s.endpoints[1].canvas.parentNode&&s._jsPlumb.instance.appendElement(s.endpoints[1].canvas)),s.updateConnectedClass()}},this.rehomeEndpoint=function(t,i,n){var s=e[i]||[],r=a.getId(n);if(r!==i){var o=s.indexOf(t);if(o>-1){var u=s.splice(o,1)[0];h.add(u,r)}}for(var c=0;c<t.connections.length;c++)t.connections[c].sourceId===i?h.sourceChanged(i,t.elementId,t.connections[c],t.element):t.connections[c].targetId===i&&(t.connections[c].targetId=t.elementId,t.connections[c].target=t.element,h.updateOtherEndpoint(t.connections[c].sourceId,i,t.elementId,t.connections[c]))},this.redraw=function(n,s,r,h,l,f){if(!a.isSuspendDrawing()){var d=e[n]||[],m=o[n]||[],g=[],y=[],x=[];r=r||a.timestamp(),h=h||{left:0,top:0},s&&(s={left:s.left+h.left,top:s.top+h.top});for(var b=a.updateOffset({elId:n,offset:s,recalc:!1,timestamp:r}),w={},M=0;M<m.length;M++){var T=m[M][0],C=T.sourceId,S=T.targetId,E=T.endpoints[0].anchor.isContinuous,j=T.endpoints[1].anchor.isContinuous;if(E||j){var k=C+"_"+S,D=w[k],A=T.sourceId===n?1:0;E&&!u[C]&&(u[C]={top:[],right:[],bottom:[],left:[]}),j&&!u[S]&&(u[S]={top:[],right:[],bottom:[],left:[]}),n!==S&&a.updateOffset({elId:S,timestamp:r}),n!==C&&a.updateOffset({elId:C,timestamp:r});var P=a.getCachedData(S),O=a.getCachedData(C);S===C&&(E||j)?(p(u[C],-Math.PI/2,0,T,!1,S,0,!1,"top",0,g,y),p(u[S],-Math.PI/2,0,T,!1,C,1,!1,"top",0,g,y)):(D||(D=this.calculateOrientation(C,S,O.o,P.o,T.endpoints[0].anchor,T.endpoints[1].anchor,T),w[k]=D),E&&p(u[C],D.theta,0,T,!1,S,0,!1,D.a[0],0,g,y),j&&p(u[S],D.theta2,-1,T,!0,C,1,!0,D.a[1],0,g,y)),E&&t.addWithFunction(x,C,function(t){return t===C}),j&&t.addWithFunction(x,S,function(t){return t===S}),t.addWithFunction(g,T,function(t){return t.id===T.id}),(E&&0===A||j&&1===A)&&t.addWithFunction(y,T.endpoints[A],function(t){return t.id===T.endpoints[A].id})}}for(M=0;M<d.length;M++)0===d[M].connections.length&&d[M].anchor.isContinuous&&(u[n]||(u[n]={top:[],right:[],bottom:[],left:[]}),p(u[n],-Math.PI/2,0,{endpoints:[d[M],d[M]],paint:function(){}},!1,n,0,!1,d[M].anchor.getDefaultFace(),0,g,y),t.addWithFunction(x,n,function(t){return t===n}));for(M=0;M<x.length;M++)v(x[M],u[x[M]]);for(M=0;M<d.length;M++)d[M].paint({timestamp:r,offset:b,dimensions:b.s,recalc:!0!==f});for(M=0;M<y.length;M++){var I=a.getCachedData(y[M].elementId);y[M].paint({timestamp:null,offset:I,dimensions:I.s})}for(M=0;M<m.length;M++){var L=m[M][1];if(L.anchor.constructor===i.DynamicAnchor){L.paint({elementWithPrecedence:n,timestamp:r}),t.addWithFunction(g,m[M][0],function(t){return t.id===m[M][0].id});for(var H=0;H<L.connections.length;H++)L.connections[H]!==m[M][0]&&t.addWithFunction(g,L.connections[H],function(t){return t.id===L.connections[H].id})}else t.addWithFunction(g,m[M][0],function(t){return t.id===m[M][0].id})}var _=c[n];for(_&&_.paint({timestamp:r,recalc:!1,elId:n}),M=0;M<g.length;M++)g[M].paint({elId:n,timestamp:null,recalc:!1,clearEdits:l})}};var m=function(i){t.EventGenerator.apply(this),this.type="Continuous",this.isDynamic=!0,this.isContinuous=!0;for(var n=i.faces||["top","right","bottom","left"],e=!(!1===i.clockwise),o={},h={top:"bottom",right:"left",left:"right",bottom:"top"},u={top:"right",right:"bottom",left:"top",bottom:"left"},a={top:"left",right:"top",left:"bottom",bottom:"right"},c=e?u:a,l=e?a:u,f=i.cssClass||"",v=null,d=null,p=["left","right"],m=["top","bottom"],g=null,y=0;y<n.length;y++)o[n[y]]=!0;this.getDefaultFace=function(){return 0===n.length?"top":n[0]},this.isRelocatable=function(){return!0},this.isSnapOnRelocate=function(){return!0},this.verifyEdge=function(t){return o[t]?t:o[h[t]]?h[t]:o[c[t]]?c[t]:o[l[t]]?l[t]:t},this.isEdgeSupported=function(t){return null==g?null==d?!0===o[t]:d===t:-1!==g.indexOf(t)},this.setCurrentFace=function(t,i){v=t,i&&null!=d&&(d=v)},this.getCurrentFace=function(){return v},this.getSupportedFaces=function(){var t=[];for(var i in o)o[i]&&t.push(i);return t},this.lock=function(){d=v},this.unlock=function(){d=null},this.isLocked=function(){return null!=d},this.lockCurrentAxis=function(){null!=v&&(g="left"===v||"right"===v?p:m)},this.unlockCurrentAxis=function(){g=null},this.compute=function(t){return s[t.element.id]||[0,0]},this.getCurrentLocation=function(t){return s[t.element.id]||[0,0]},this.getOrientation=function(t){return r[t.id]||[0,0]},this.getCssClass=function(){return f}};a.continuousAnchorFactory={get:function(t){return new m(t)},clear:function(t){delete s[t]}}},i.AnchorManager.prototype.calculateOrientation=function(t,i,n,e,s,r){var o=["left","top","right","bottom"];if(t===i)return{orientation:"identity",a:["top","top"]};var h=Math.atan2(e.centery-n.centery,e.centerx-n.centerx),u=Math.atan2(n.centery-e.centery,n.centerx-e.centerx),a=[],c={};!function(t,i){for(var n=0;n<t.length;n++)c[t[n]]={left:[i[n].left,i[n].centery],right:[i[n].right,i[n].centery],top:[i[n].centerx,i[n].top],bottom:[i[n].centerx,i[n].bottom]}}(["source","target"],[n,e]);for(var l=0;l<o.length;l++)for(var f=0;f<o.length;f++)a.push({source:o[l],target:o[f],dist:Biltong.lineLength(c.source[o[l]],c.target[o[f]])});a.sort(function(t,i){return t.dist<i.dist?-1:t.dist>i.dist?1:0});for(var v=a[0].source,d=a[0].target,p=0;p<a.length&&(v=!s.isContinuous||s.isEdgeSupported(a[p].source)?a[p].source:null,d=!r.isContinuous||r.isEdgeSupported(a[p].target)?a[p].target:null,null==v||null==d);p++);return s.isContinuous&&s.setCurrentFace(v),r.isContinuous&&r.setCurrentFace(d),{a:[v,d],theta:h,theta2:u}},i.Anchor=function(i){this.x=i.x||0,this.y=i.y||0,this.elementId=i.elementId,this.cssClass=i.cssClass||"",this.userDefinedLocation=null,this.orientation=i.orientation||[0,0],this.lastReturnValue=null,this.offsets=i.offsets||[0,0],this.timestamp=null;var n=!1!==i.relocatable;this.isRelocatable=function(){return n},this.setRelocatable=function(t){n=t};var e=!1!==i.snapOnRelocate;this.isSnapOnRelocate=function(){return e};var s=!1;this.lock=function(){s=!0},this.unlock=function(){s=!1},this.isLocked=function(){return s},t.EventGenerator.apply(this),this.compute=function(t){var i=t.xy,n=t.wh,e=t.timestamp;return t.clearUserDefinedLocation&&(this.userDefinedLocation=null),e&&e===this.timestamp?this.lastReturnValue:(this.lastReturnValue=null!=this.userDefinedLocation?this.userDefinedLocation:[i[0]+this.x*n[0]+this.offsets[0],i[1]+this.y*n[1]+this.offsets[1],this.x,this.y],this.timestamp=e,this.lastReturnValue)},this.getCurrentLocation=function(t){return t=t||{},null==this.lastReturnValue||null!=t.timestamp&&this.timestamp!==t.timestamp?this.compute(t):this.lastReturnValue},this.setPosition=function(t,i,n,e,r){s&&!r||(this.x=t,this.y=i,this.orientation=[n,e],this.lastReturnValue=null)}},t.extend(i.Anchor,t.EventGenerator,{equals:function(t){if(!t)return!1;var i=t.getOrientation(),n=this.getOrientation();return this.x===t.x&&this.y===t.y&&this.offsets[0]===t.offsets[0]&&this.offsets[1]===t.offsets[1]&&n[0]===i[0]&&n[1]===i[1]},getUserDefinedLocation:function(){return this.userDefinedLocation},setUserDefinedLocation:function(t){this.userDefinedLocation=t},clearUserDefinedLocation:function(){this.userDefinedLocation=null},getOrientation:function(){return this.orientation},getCssClass:function(){return this.cssClass}}),i.FloatingAnchor=function(t){i.Anchor.apply(this,arguments);var n=t.reference,e=t.referenceCanvas,s=i.getSize(e),r=0,o=0,h=null,u=null;this.orientation=null,this.x=0,this.y=0,this.isFloating=!0,this.compute=function(t){var i=t.xy,n=[i[0]+s[0]/2,i[1]+s[1]/2];return u=n,n},this.getOrientation=function(t){if(h)return h;var i=n.getOrientation(t);return[Math.abs(i[0])*r*-1,Math.abs(i[1])*o*-1]},this.over=function(t,i){h=t.getOrientation(i)},this.out=function(){h=null},this.getCurrentLocation=function(t){return null==u?this.compute(t):u}},t.extend(i.FloatingAnchor,i.Anchor);var n=function(t,n,e){return t.constructor===i.Anchor?t:n.makeAnchor(t,e,n)};i.DynamicAnchor=function(t){i.Anchor.apply(this,arguments),this.isDynamic=!0,this.anchors=[],this.elementId=t.elementId,this.jsPlumbInstance=t.jsPlumbInstance;for(var e=0;e<t.anchors.length;e++)this.anchors[e]=n(t.anchors[e],this.jsPlumbInstance,this.elementId);this.getAnchors=function(){return this.anchors};var s=this.anchors.length>0?this.anchors[0]:null,r=s,o=this,h=function(t,i,n,e,s){var r=e[0]+t.x*s[0],o=e[1]+t.y*s[1],h=e[0]+s[0]/2,u=e[1]+s[1]/2;return Math.sqrt(Math.pow(i-r,2)+Math.pow(n-o,2))+Math.sqrt(Math.pow(h-r,2)+Math.pow(u-o,2))},u=t.selector||function(t,i,n,e,s){for(var r=n[0]+e[0]/2,o=n[1]+e[1]/2,u=-1,a=1/0,c=0;c<s.length;c++){var l=h(s[c],r,o,t,i);l<a&&(u=c+0,a=l)}return s[u]};this.compute=function(t){var i=t.xy,n=t.wh,e=t.txy,h=t.twh;this.timestamp=t.timestamp;var a=o.getUserDefinedLocation();return null!=a?a:this.isLocked()||null==e||null==h?s.compute(t):(t.timestamp=null,s=u(i,n,e,h,this.anchors),this.x=s.x,this.y=s.y,s!==r&&this.fire("anchorChanged",s),r=s,s.compute(t))},this.getCurrentLocation=function(t){return this.getUserDefinedLocation()||(null!=s?s.getCurrentLocation(t):null)},this.getOrientation=function(t){return null!=s?s.getOrientation(t):[0,0]},this.over=function(t,i){null!=s&&s.over(t,i)},this.out=function(){null!=s&&s.out()},this.setAnchor=function(t){s=t},this.getCssClass=function(){return s&&s.getCssClass()||""},this.setAnchorCoordinates=function(t){var i=jsPlumbUtil.findWithFunction(this.anchors,function(i){return i.x===t[0]&&i.y===t[1]});return-1!==i&&(this.setAnchor(this.anchors[i]),!0)}},t.extend(i.DynamicAnchor,i.Anchor);var e=function(t,n,e,s,r,o){i.Anchors[r]=function(i){var h=i.jsPlumbInstance.makeAnchor([t,n,e,s,0,0],i.elementId,i.jsPlumbInstance);return h.type=r,o&&o(h,i),h}};e(.5,0,0,-1,"TopCenter"),e(.5,1,0,1,"BottomCenter"),e(0,.5,-1,0,"LeftMiddle"),e(1,.5,1,0,"RightMiddle"),e(.5,0,0,-1,"Top"),e(.5,1,0,1,"Bottom"),e(0,.5,-1,0,"Left"),e(1,.5,1,0,"Right"),e(.5,.5,0,0,"Center"),e(1,0,0,-1,"TopRight"),e(1,1,0,1,"BottomRight"),e(0,0,0,-1,"TopLeft"),e(0,1,0,1,"BottomLeft"),i.Defaults.DynamicAnchors=function(t){return t.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],t.elementId,t.jsPlumbInstance)},i.Anchors.AutoDefault=function(t){var n=t.jsPlumbInstance.makeDynamicAnchor(i.Defaults.DynamicAnchors(t));return n.type="AutoDefault",n};var s=function(t,n){i.Anchors[t]=function(i){var e=i.jsPlumbInstance.makeAnchor(["Continuous",{faces:n}],i.elementId,i.jsPlumbInstance);return e.type=t,e}};i.Anchors.Continuous=function(t){return t.jsPlumbInstance.continuousAnchorFactory.get(t)},s("ContinuousLeft",["left"]),s("ContinuousTop",["top"]),s("ContinuousBottom",["bottom"]),s("ContinuousRight",["right"]),e(0,0,0,0,"Assign",function(t,i){var n=i.position||"Fixed";t.positionFinder=n.constructor===String?i.jsPlumbInstance.AnchorPositionFinders[n]:n,t.constructorParams=i}),this.jsPlumbInstance.prototype.AnchorPositionFinders={Fixed:function(t,i,n){return[(t.left-i.left)/n[0],(t.top-i.top)/n[1]]},Grid:function(t,i,n,e){var s=t.top-i.top,r=n[0]/e.grid[0],o=n[1]/e.grid[1],h=Math.floor((t.left-i.left)/r),u=Math.floor(s/o);return[(h*r+r/2)/n[0],(u*o+o/2)/n[1]]}},i.Anchors.Perimeter=function(t){var i=(t=t||{}).anchorCount||60,n=t.shape;if(!n)throw new Error("no shape supplied to Perimeter Anchor type");var e=function(){for(var t=2*Math.PI/i,n=0,e=[],s=0;s<i;s++){var r=.5+.5*Math.sin(n),o=.5+.5*Math.cos(n);e.push([r,o,0,0]),n+=t}return e},s=function(t){for(var n=i/t.length,e=[],s=function(t,s,r,o,h,u,a){for(var c=(r-t)/(n=i*h),l=(o-s)/n,f=0;f<n;f++)e.push([t+c*f,s+l*f,null==u?0:u,null==a?0:a])},r=0;r<t.length;r++)s.apply(null,t[r]);return e},r=function(t){for(var i=[],n=0;n<t.length;n++)i.push([t[n][0],t[n][1],t[n][2],t[n][3],1/t.length,t[n][4],t[n][5]]);return s(i)},o=function(){return r([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]])},h={Circle:e,Ellipse:e,Diamond:function(){return r([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]])},Rectangle:o,Square:o,Triangle:function(){return r([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]])},Path:function(t){for(var i=t.points,n=[],e=0,r=0;r<i.length-1;r++){var o=Math.sqrt(Math.pow(i[r][2]-i[r][0])+Math.pow(i[r][3]-i[r][1]));e+=o,n.push([i[r][0],i[r][1],i[r+1][0],i[r+1][1],o])}for(var h=0;h<n.length;h++)n[h][4]=n[h][4]/e;return s(n)}};if(!h[n])throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type");var u=h[n](t);t.rotation&&(u=function(i){for(var n=[],e=t.rotation/180*Math.PI,s=0;s<i.length;s++){var r=i[s][0]-.5,o=i[s][1]-.5;n.push([r*Math.cos(e)-o*Math.sin(e)+.5,r*Math.sin(e)+o*Math.cos(e)+.5,i[s][2],i[s][3]])}return n}(u));var a=t.jsPlumbInstance.makeDynamicAnchor(u);return a.type="Perimeter",a}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,i=t.jsPlumb,n=t.jsPlumbUtil,e=t.Biltong;i.Segments={AbstractSegment:function(t){this.params=t,this.findClosestPointOnPath=function(){return{d:1/0,x:null,y:null,l:null}},this.getBounds=function(){return{minX:Math.min(t.x1,t.x2),minY:Math.min(t.y1,t.y2),maxX:Math.max(t.x1,t.x2),maxY:Math.max(t.y1,t.y2)}},this.lineIntersection=function(){return[]},this.boxIntersection=function(t,i,n,e){var s=[];return s.push.apply(s,this.lineIntersection(t,i,t+n,i)),s.push.apply(s,this.lineIntersection(t+n,i,t+n,i+e)),s.push.apply(s,this.lineIntersection(t+n,i+e,t,i+e)),s.push.apply(s,this.lineIntersection(t,i+e,t,i)),s},this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.y)}},Straight:function(t){i.Segments.AbstractSegment.apply(this,arguments);var n,s,r,o,h,u,a,c=function(){n=Math.sqrt(Math.pow(h-o,2)+Math.pow(a-u,2)),s=e.gradient({x:o,y:u},{x:h,y:a}),r=-1/s};this.type="Straight",this.getLength=function(){return n},this.getGradient=function(){return s},this.getCoordinates=function(){return{x1:o,y1:u,x2:h,y2:a}},this.setCoordinates=function(t){o=t.x1,u=t.y1,h=t.x2,a=t.y2,c()},this.setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),this.getBounds=function(){return{minX:Math.min(o,h),minY:Math.min(u,a),maxX:Math.max(o,h),maxY:Math.max(u,a)}},this.pointOnPath=function(t,i){return 0!==t||i?1!==t||i?e.pointOnLine({x:o,y:u},{x:h,y:a},i?t>0?t:n+t:t*n):{x:h,y:a}:{x:o,y:u}},this.gradientAtPoint=function(){return s},this.pointAlongPathFrom=function(t,i,n){var s=this.pointOnPath(t,n),r=i<=0?{x:o,y:u}:{x:h,y:a};return i<=0&&Math.abs(i)>1&&(i*=-1),e.pointOnLine(s,r,i)};var l=function(t,i,n){return n>=Math.min(t,i)&&n<=Math.max(t,i)},f=function(t,i,n){return Math.abs(n-t)<Math.abs(n-i)?t:i};this.findClosestPointOnPath=function(t,i){var c={d:1/0,x:null,y:null,l:null,x1:o,x2:h,y1:u,y2:a};if(0===s)c.y=u,c.x=l(o,h,t)?t:f(o,h,t);else if(s===1/0||s===-1/0)c.x=o,c.y=l(u,a,i)?i:f(u,a,i);else{var v=u-s*o,d=(i-r*t-v)/(s-r),p=s*d+v;c.x=l(o,h,d)?d:f(o,h,d),c.y=l(u,a,p)?p:f(u,a,p)}var m=e.lineLength([c.x,c.y],[o,u]);return c.d=e.lineLength([t,i],[c.x,c.y]),c.l=m/n,c};var v=function(t,i,n){return n>i?i<=t&&t<=n:i>=t&&t>=n},d=v;this.lineIntersection=function(t,i,n,r){var c=Math.abs(e.gradient({x:t,y:i},{x:n,y:r})),l=Math.abs(s),f=l===1/0?o:u-l*o,v=[],p=c===1/0?t:i-c*t;if(c!==l)if(c===1/0&&0===l)d(t,o,h)&&d(u,i,r)&&(v=[t,u]);else if(0===c&&l===1/0)d(i,u,a)&&d(o,t,n)&&(v=[o,i]);else{var m,g;c===1/0?d(m=t,o,h)&&d(g=l*t+f,i,r)&&(v=[m,g]):0===c?d(g=i,u,a)&&d(m=(i-f)/l,t,n)&&(v=[m,g]):(g=l*(m=(p-f)/(l-c))+f,d(m,o,h)&&d(g,u,a)&&(v=[m,g]))}return v},this.boxIntersection=function(t,i,n,e){var s=[];return s.push.apply(s,this.lineIntersection(t,i,t+n,i)),s.push.apply(s,this.lineIntersection(t+n,i,t+n,i+e)),s.push.apply(s,this.lineIntersection(t+n,i+e,t,i+e)),s.push.apply(s,this.lineIntersection(t,i+e,t,i)),s},this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}},Arc:function(t){i.Segments.AbstractSegment.apply(this,arguments);var n=function(i,n){return e.theta([t.cx,t.cy],[i,n])},s=function(t,i){if(t.anticlockwise){var n=t.startAngle<t.endAngle?t.startAngle+r:t.startAngle;return n-Math.abs(n-t.endAngle)*i}var e=Math.abs((t.endAngle<t.startAngle?t.endAngle+r:t.endAngle)-t.startAngle);return t.startAngle+e*i},r=2*Math.PI;this.radius=t.r,this.anticlockwise=t.ac,this.type="Arc",t.startAngle&&t.endAngle?(this.startAngle=t.startAngle,this.endAngle=t.endAngle,this.x1=t.cx+this.radius*Math.cos(t.startAngle),this.y1=t.cy+this.radius*Math.sin(t.startAngle),this.x2=t.cx+this.radius*Math.cos(t.endAngle),this.y2=t.cy+this.radius*Math.sin(t.endAngle)):(this.startAngle=n(t.x1,t.y1),this.endAngle=n(t.x2,t.y2),this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2),this.endAngle<0&&(this.endAngle+=r),this.startAngle<0&&(this.startAngle+=r);var o=this.endAngle<this.startAngle?this.endAngle+r:this.endAngle;this.sweep=Math.abs(o-this.startAngle),this.anticlockwise&&(this.sweep=r-this.sweep);var h=2*Math.PI*this.radius,u=this.sweep/r,a=h*u;this.getLength=function(){return a},this.getBounds=function(){return{minX:t.cx-t.r,maxX:t.cx+t.r,minY:t.cy-t.r,maxY:t.cy+t.r}};var c=1e-10,l=function(t){var i=Math.floor(t),n=Math.ceil(t);return t-i<c?i:n-t<c?n:t};this.pointOnPath=function(i,n){if(0===i)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===i)return{x:this.x2,y:this.y2,theta:this.endAngle};n&&(i/=a);var e=s(this,i),r=t.cx+t.r*Math.cos(e),o=t.cy+t.r*Math.sin(e);return{x:l(r),y:l(o),theta:e}},this.gradientAtPoint=function(i,n){var s=this.pointOnPath(i,n),r=e.normal([t.cx,t.cy],[s.x,s.y]);return this.anticlockwise||r!==1/0&&r!==-1/0||(r*=-1),r},this.pointAlongPathFrom=function(i,n,e){var s=this.pointOnPath(i,e),r=n/h*2*Math.PI,o=s.theta+(this.anticlockwise?-1:1)*r;return{x:t.cx+this.radius*Math.cos(o),y:t.cy+this.radius*Math.sin(o)}}},Bezier:function(n){this.curve=[{x:n.x1,y:n.y1},{x:n.cp1x,y:n.cp1y},{x:n.cp2x,y:n.cp2y},{x:n.x2,y:n.y2}],i.Segments.AbstractSegment.apply(this,arguments),this.bounds={minX:Math.min(n.x1,n.x2,n.cp1x,n.cp2x),minY:Math.min(n.y1,n.y2,n.cp1y,n.cp2y),maxX:Math.max(n.x1,n.x2,n.cp1x,n.cp2x),maxY:Math.max(n.y1,n.y2,n.cp1y,n.cp2y)},this.type="Bezier";var e=function(i,n,e){return e&&(n=t.jsBezier.locationAlongCurveFrom(i,n>0?0:1,n)),n};this.pointOnPath=function(i,n){return i=e(this.curve,i,n),t.jsBezier.pointOnCurve(this.curve,i)},this.gradientAtPoint=function(i,n){return i=e(this.curve,i,n),t.jsBezier.gradientAtPoint(this.curve,i)},this.pointAlongPathFrom=function(i,n,s){return i=e(this.curve,i,s),t.jsBezier.pointAlongCurveFrom(this.curve,i,n)},this.getLength=function(){return t.jsBezier.getLength(this.curve)},this.getBounds=function(){return this.bounds},this.findClosestPointOnPath=function(i,n){var e=t.jsBezier.nearestPointOnCurve({x:i,y:n},this.curve);return{d:Math.sqrt(Math.pow(e.point.x-i,2)+Math.pow(e.point.y-n,2)),x:e.point.x,y:e.point.y,l:e.location,s:this}},this.lineIntersection=function(i,n,e,s){return t.jsBezier.lineIntersection(i,n,e,s,this.curve)}}},i.SegmentRenderer={getPath:function(t,i){return{Straight:function(i){var n=t.getCoordinates();return(i?"M "+n.x1+" "+n.y1+" ":"")+"L "+n.x2+" "+n.y2},Bezier:function(i){var n=t.params;return(i?"M "+n.x2+" "+n.y2+" ":"")+"C "+n.cp2x+" "+n.cp2y+" "+n.cp1x+" "+n.cp1y+" "+n.x1+" "+n.y1},Arc:function(i){var n=t.sweep>Math.PI?1:0;return(i?"M"+t.x1+" "+t.y1+" ":"")+"A "+t.radius+" "+t.params.r+" 0 "+n+","+(t.anticlockwise?0:1)+" "+t.x2+" "+t.y2}}[t.type](i)}};var s=function(){this.resetBounds=function(){this.bounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}},this.resetBounds()};i.Connectors.AbstractConnector=function(t){s.apply(this,arguments);var r=[],o=0,h=[],u=[],a=t.stub||0,c=n.isArray(a)?a[0]:a,l=n.isArray(a)?a[1]:a,f=t.gap||0,v=n.isArray(f)?f[0]:f,d=n.isArray(f)?f[1]:f,p=null,m=null;this.getPathData=function(){for(var t="",n=0;n<r.length;n++)t+=i.SegmentRenderer.getPath(r[n],0===n),t+=" ";return t},this.findSegmentForPoint=function(t,i){for(var n={d:1/0,s:null,x:null,y:null,l:null},e=0;e<r.length;e++){var s=r[e].findClosestPointOnPath(t,i);s.d<n.d&&(n.d=s.d,n.l=s.l,n.x=s.x,n.y=s.y,n.s=r[e],n.x1=s.x1,n.x2=s.x2,n.y1=s.y1,n.y2=s.y2,n.index=e)}return n},this.lineIntersection=function(t,i,n,e){for(var s=[],o=0;o<r.length;o++)s.push.apply(s,r[o].lineIntersection(t,i,n,e));return s},this.boxIntersection=function(t,i,n,e){for(var s=[],o=0;o<r.length;o++)s.push.apply(s,r[o].boxIntersection(t,i,n,e));return s},this.boundingBoxIntersection=function(t){for(var i=[],n=0;n<r.length;n++)i.push.apply(i,r[n].boundingBoxIntersection(t));return i};var g=function(){for(var t=0,i=0;i<r.length;i++){var n=r[i].getLength();u[i]=n/o,h[i]=[t,t+=n/o]}},y=function(t,i){i&&(t=t>0?t/o:(o+t)/o);for(var n=h.length-1,e=1,s=0;s<h.length;s++)if(h[s][1]>=t){n=s,e=1===t?1:0===t?0:(t-h[s][0])/u[s];break}return{segment:r[n],proportion:e,index:n}},x=function(t,n,e){if(e.x1!==e.x2||e.y1!==e.y2){var s=new i.Segments[n](e);r.push(s),o+=s.getLength(),t.updateBounds(s)}},b=function(){o=r.length=h.length=u.length=0};this.setSegments=function(t){p=[],o=0;for(var i=0;i<t.length;i++)p.push(t[i]),o+=t[i].getLength()},this.getLength=function(){return o};var w=function(t){this.strokeWidth=t.strokeWidth;var i=e.quadrant(t.sourcePos,t.targetPos),n=t.targetPos[0]<t.sourcePos[0],s=t.targetPos[1]<t.sourcePos[1],r=t.strokeWidth||1,o=t.sourceEndpoint.anchor.getOrientation(t.sourceEndpoint),h=t.targetEndpoint.anchor.getOrientation(t.targetEndpoint),u=n?t.targetPos[0]:t.sourcePos[0],a=s?t.targetPos[1]:t.sourcePos[1],f=Math.abs(t.targetPos[0]-t.sourcePos[0]),p=Math.abs(t.targetPos[1]-t.sourcePos[1]);if(0===o[0]&&0===o[1]||0===h[0]&&0===h[1]){var m=f>p?0:1,g=[1,0][m];h=[],(o=[])[m]=t.sourcePos[m]>t.targetPos[m]?-1:1,h[m]=t.sourcePos[m]>t.targetPos[m]?1:-1,o[g]=0,h[g]=0}var y=n?f+v*o[0]:v*o[0],x=s?p+v*o[1]:v*o[1],b=n?d*h[0]:f+d*h[0],w=s?d*h[1]:p+d*h[1],M=o[0]*h[0]+o[1]*h[1],T={sx:y,sy:x,tx:b,ty:w,lw:r,xSpan:Math.abs(b-y),ySpan:Math.abs(w-x),mx:(y+b)/2,my:(x+w)/2,so:o,to:h,x:u,y:a,w:f,h:p,segment:i,startStubX:y+o[0]*c,startStubY:x+o[1]*c,endStubX:b+h[0]*l,endStubY:w+h[1]*l,isXGreaterThanStubTimes2:Math.abs(y-b)>c+l,isYGreaterThanStubTimes2:Math.abs(x-w)>c+l,opposite:-1===M,perpendicular:0===M,orthogonal:1===M,sourceAxis:0===o[0]?"y":"x",points:[u,a,f,p,y,x,b,w],stubs:[c,l]};return T.anchorOrientation=T.opposite?"opposite":T.orthogonal?"orthogonal":"perpendicular",T};return this.getSegments=function(){return r},this.updateBounds=function(t){var i=t.getBounds();this.bounds.minX=Math.min(this.bounds.minX,i.minX),this.bounds.maxX=Math.max(this.bounds.maxX,i.maxX),this.bounds.minY=Math.min(this.bounds.minY,i.minY),this.bounds.maxY=Math.max(this.bounds.maxY,i.maxY)},this.pointOnPath=function(t,i){var n=y(t,i);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||[0,0]},this.gradientAtPoint=function(t,i){var n=y(t,i);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0},this.pointAlongPathFrom=function(t,i,n){var e=y(t,n);return e.segment&&e.segment.pointAlongPathFrom(e.proportion,i,!1)||[0,0]},this.compute=function(t){m=w.call(this,t),b(),this._compute(m,t),this.x=m.points[0],this.y=m.points[1],this.w=m.points[2],this.h=m.points[3],this.segment=m.segment,g()},{addSegment:x,prepareCompute:w,sourceStub:c,targetStub:l,maxStub:Math.max(c,l),sourceGap:v,targetGap:d,maxGap:Math.max(v,d)}},n.extend(i.Connectors.AbstractConnector,s),i.Endpoints.AbstractEndpoint=function(t){s.apply(this,arguments);var i=this.compute=function(t,i,n,e){var s=this._compute.apply(this,arguments);return this.x=s[0],this.y=s[1],this.w=s[2],this.h=s[3],this.bounds.minX=this.x,this.bounds.minY=this.y,this.bounds.maxX=this.x+this.w,this.bounds.maxY=this.y+this.h,s};return{compute:i,cssClass:t.cssClass}},n.extend(i.Endpoints.AbstractEndpoint,s),i.Endpoints.Dot=function(t){this.type="Dot",i.Endpoints.AbstractEndpoint.apply(this,arguments),this.radius=(t=t||{}).radius||10,this.defaultOffset=.5*this.radius,this.defaultInnerRadius=this.radius/3,this._compute=function(t,i,n){this.radius=n.radius||this.radius;var e=t[0]-this.radius,s=t[1]-this.radius,r=2*this.radius,o=2*this.radius;if(n.stroke){var h=n.strokeWidth||1;e-=h,s-=h,r+=2*h,o+=2*h}return[e,s,r,o,this.radius]}},n.extend(i.Endpoints.Dot,i.Endpoints.AbstractEndpoint),i.Endpoints.Rectangle=function(t){this.type="Rectangle",i.Endpoints.AbstractEndpoint.apply(this,arguments),this.width=(t=t||{}).width||20,this.height=t.height||20,this._compute=function(t,i,n){var e=n.width||this.width,s=n.height||this.height;return[t[0]-e/2,t[1]-s/2,e,s]}},n.extend(i.Endpoints.Rectangle,i.Endpoints.AbstractEndpoint);var r=function(){i.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.displayElements=[]};n.extend(r,i.jsPlumbUIComponent,{getDisplayElements:function(){return this._jsPlumb.displayElements},appendDisplayElement:function(t){this._jsPlumb.displayElements.push(t)}}),i.Endpoints.Image=function(e){this.type="Image",r.apply(this,arguments),i.Endpoints.AbstractEndpoint.apply(this,arguments);var s=e.onload,o=e.src||e.url,h=e.cssClass?" "+e.cssClass:"";this._jsPlumb.img=new Image,this._jsPlumb.ready=!1,this._jsPlumb.initialized=!1,this._jsPlumb.deleted=!1,this._jsPlumb.widthToUse=e.width,this._jsPlumb.heightToUse=e.height,this._jsPlumb.endpoint=e.endpoint,this._jsPlumb.img.onload=function(){null!=this._jsPlumb&&(this._jsPlumb.ready=!0,this._jsPlumb.widthToUse=this._jsPlumb.widthToUse||this._jsPlumb.img.width,this._jsPlumb.heightToUse=this._jsPlumb.heightToUse||this._jsPlumb.img.height,s&&s(this))}.bind(this),this._jsPlumb.endpoint.setImage=function(t,i){var n=t.constructor===String?t:t.src;s=i,this._jsPlumb.img.src=n,null!=this.canvas&&this.canvas.setAttribute("src",this._jsPlumb.img.src)}.bind(this),this._jsPlumb.endpoint.setImage(o,s),this._compute=function(t){return this.anchorPoint=t,this._jsPlumb.ready?[t[0]-this._jsPlumb.widthToUse/2,t[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse]:[0,0,0,0]},this.canvas=i.createElement("img",{position:"absolute",margin:0,padding:0,outline:0},this._jsPlumb.instance.endpointClass+h),this._jsPlumb.widthToUse&&this.canvas.setAttribute("width",this._jsPlumb.widthToUse),this._jsPlumb.heightToUse&&this.canvas.setAttribute("height",this._jsPlumb.heightToUse),this._jsPlumb.instance.appendElement(this.canvas),this.actuallyPaint=function(){this._jsPlumb.deleted||(this._jsPlumb.initialized||(this.canvas.setAttribute("src",this._jsPlumb.img.src),this.appendDisplayElement(this.canvas),this._jsPlumb.initialized=!0),n.sizeElement(this.canvas,this.anchorPoint[0]-this._jsPlumb.widthToUse/2,this.anchorPoint[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse))},this.paint=function(i,n){null!=this._jsPlumb&&(this._jsPlumb.ready?this.actuallyPaint(i,n):t.setTimeout(function(){this.paint(i,n)}.bind(this),200))}},n.extend(i.Endpoints.Image,[r,i.Endpoints.AbstractEndpoint],{cleanup:function(t){t&&(this._jsPlumb.deleted=!0,this.canvas&&this.canvas.parentNode.removeChild(this.canvas),this.canvas=null)}}),i.Endpoints.Blank=function(t){i.Endpoints.AbstractEndpoint.apply(this,arguments),this.type="Blank",r.apply(this,arguments),this._compute=function(t){return[t[0],t[1],10,0]};var e=t.cssClass?" "+t.cssClass:"";this.canvas=i.createElement("div",{display:"block",width:"1px",height:"1px",background:"transparent",position:"absolute"},this._jsPlumb.instance.endpointClass+e),this._jsPlumb.instance.appendElement(this.canvas),this.paint=function(){n.sizeElement(this.canvas,this.x,this.y,this.w,this.h)}},n.extend(i.Endpoints.Blank,[i.Endpoints.AbstractEndpoint,r],{cleanup:function(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}),i.Endpoints.Triangle=function(t){this.type="Triangle",i.Endpoints.AbstractEndpoint.apply(this,arguments);var n=this;(t=t||{}).width=t.width||55,t.height=t.height||55,this.width=t.width,this.height=t.height,this._compute=function(t,i,e){var s=e.width||n.width,r=e.height||n.height;return[t[0]-s/2,t[1]-r/2,s,r]}};var o=i.Overlays.AbstractOverlay=function(t){this.visible=!0,this.isAppendedAtTopLevel=!0,this.component=t.component,this.loc=null==t.location?.5:t.location,this.endpointLoc=null==t.endpointLocation?[.5,.5]:t.endpointLocation,this.visible=!1!==t.visible};o.prototype={cleanup:function(t){t&&(this.component=null,this.canvas=null,this.endpointLoc=null)},reattach:function(){},setVisible:function(t){this.visible=t,this.component.repaint()},isVisible:function(){return this.visible},hide:function(){this.setVisible(!1)},show:function(){this.setVisible(!0)},incrementLocation:function(t){this.loc+=t,this.component.repaint()},setLocation:function(t){this.loc=t,this.component.repaint()},getLocation:function(){return this.loc},updateFrom:function(){}},i.Overlays.Arrow=function(t){this.type="Arrow",o.apply(this,arguments),this.isAppendedAtTopLevel=!1;var s=this;this.length=(t=t||{}).length||20,this.width=t.width||20,this.id=t.id,this.direction=(t.direction||1)<0?-1:1;var r=t.paintStyle||{"stroke-width":1},h=t.foldback||.623;this.computeMaxSize=function(){return 1.5*s.width},this.elementCreated=function(n){if(this.path=n,t.events)for(var e in t.events)i.on(n,e,t.events[e])},this.draw=function(t,i){var s,o,u,a;if(t.pointAlongPathFrom){if(n.isString(this.loc)||this.loc>1||this.loc<0){var c=parseInt(this.loc,10),l=this.loc<0?1:0;s=t.pointAlongPathFrom(l,c,!1),o=t.pointAlongPathFrom(l,c-this.direction*this.length/2,!1),u=e.pointOnLine(s,o,this.length)}else if(1===this.loc){if(s=t.pointOnPath(this.loc),o=t.pointAlongPathFrom(this.loc,-this.length),u=e.pointOnLine(s,o,this.length),-1===this.direction){var f=u;u=s,s=f}}else if(0===this.loc){if(u=t.pointOnPath(this.loc),o=t.pointAlongPathFrom(this.loc,this.length),s=e.pointOnLine(u,o,this.length),-1===this.direction){var v=u;u=s,s=v}}else s=t.pointAlongPathFrom(this.loc,this.direction*this.length/2),o=t.pointOnPath(this.loc),u=e.pointOnLine(s,o,this.length);return{component:t,d:{hxy:s,tail:a=e.perpendicularLineTo(s,u,this.width),cxy:e.pointOnLine(s,u,h*this.length)},"stroke-width":r.strokeWidth||i.strokeWidth,stroke:r.stroke||i.stroke,fill:r.fill||i.stroke,minX:Math.min(s.x,a[0].x,a[1].x),maxX:Math.max(s.x,a[0].x,a[1].x),minY:Math.min(s.y,a[0].y,a[1].y),maxY:Math.max(s.y,a[0].y,a[1].y)}}return{component:t,minX:0,maxX:0,minY:0,maxY:0}}},n.extend(i.Overlays.Arrow,o,{updateFrom:function(t){this.length=t.length||this.length,this.width=t.width||this.width,this.direction=null!=t.direction?t.direction:this.direction,this.foldback=t.foldback||this.foldback},cleanup:function(){this.path&&this.canvas&&this.canvas.removeChild(this.path)}}),i.Overlays.PlainArrow=function(t){var n=i.extend(t=t||{},{foldback:1});i.Overlays.Arrow.call(this,n),this.type="PlainArrow"},n.extend(i.Overlays.PlainArrow,i.Overlays.Arrow),i.Overlays.Diamond=function(t){var n=i.extend(t=t||{},{length:(t.length||40)/2,foldback:2});i.Overlays.Arrow.call(this,n),this.type="Diamond"},n.extend(i.Overlays.Diamond,i.Overlays.Arrow);var h=function(t,i){return(null==t._jsPlumb.cachedDimensions||i)&&(t._jsPlumb.cachedDimensions=t.getDimensions()),t._jsPlumb.cachedDimensions},u=function(t){i.jsPlumbUIComponent.apply(this,arguments),o.apply(this,arguments);var e=this.fire;this.fire=function(){e.apply(this,arguments),this.component&&this.component.fire.apply(this.component,arguments)},this.detached=!1,this.id=t.id,this._jsPlumb.div=null,this._jsPlumb.initialised=!1,this._jsPlumb.component=t.component,this._jsPlumb.cachedDimensions=null,this._jsPlumb.create=t.create,this._jsPlumb.initiallyInvisible=!1===t.visible,this.getElement=function(){if(null==this._jsPlumb.div){var n=this._jsPlumb.div=i.getElement(this._jsPlumb.create(this._jsPlumb.component));n.style.position="absolute",jsPlumb.addClass(n,this._jsPlumb.instance.overlayClass+" "+(this.cssClass?this.cssClass:t.cssClass?t.cssClass:"")),this._jsPlumb.instance.appendElement(n),this._jsPlumb.instance.getId(n),this.canvas=n;var e="translate(-50%, -50%)";n.style.webkitTransform=e,n.style.mozTransform=e,n.style.msTransform=e,n.style.oTransform=e,n.style.transform=e,n._jsPlumb=this,!1===t.visible&&(n.style.display="none")}return this._jsPlumb.div},this.draw=function(t,i,e){var s=h(this);if(null!=s&&2===s.length){var r={x:0,y:0};if(e)r={x:e[0],y:e[1]};else if(t.pointOnPath){var o=this.loc,u=!1;(n.isString(this.loc)||this.loc<0||this.loc>1)&&(o=parseInt(this.loc,10),u=!0),r=t.pointOnPath(o,u)}else{var a=this.loc.constructor===Array?this.loc:this.endpointLoc;r={x:a[0]*t.w,y:a[1]*t.h}}var c=r.x-s[0]/2,l=r.y-s[1]/2;return{component:t,d:{minx:c,miny:l,td:s,cxy:r},minX:c,maxX:c+s[0],minY:l,maxY:l+s[1]}}return{minX:0,maxX:0,minY:0,maxY:0}}};n.extend(u,[i.jsPlumbUIComponent,o],{getDimensions:function(){return[1,1]},setVisible:function(t){this._jsPlumb.div&&(this._jsPlumb.div.style.display=t?"block":"none",t&&this._jsPlumb.initiallyInvisible&&(h(this,!0),this.component.repaint(),this._jsPlumb.initiallyInvisible=!1))},clearCachedDimensions:function(){this._jsPlumb.cachedDimensions=null},cleanup:function(t){t?null!=this._jsPlumb.div&&(this._jsPlumb.div._jsPlumb=null,this._jsPlumb.instance.removeElement(this._jsPlumb.div)):(this._jsPlumb&&this._jsPlumb.div&&this._jsPlumb.div.parentNode&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div),this.detached=!0)},reattach:function(t){null!=this._jsPlumb.div&&t.getContainer().appendChild(this._jsPlumb.div),this.detached=!1},computeMaxSize:function(){var t=h(this);return Math.max(t[0],t[1])},paint:function(t){this._jsPlumb.initialised||(this.getElement(),t.component.appendDisplayElement(this._jsPlumb.div),this._jsPlumb.initialised=!0,this.detached&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div)),this._jsPlumb.div.style.left=t.component.x+t.d.minx+"px",this._jsPlumb.div.style.top=t.component.y+t.d.miny+"px"}}),i.Overlays.Custom=function(t){this.type="Custom",u.apply(this,arguments)},n.extend(i.Overlays.Custom,u),i.Overlays.GuideLines=function(){var t=this;t.length=50,t.strokeWidth=5,this.type="GuideLines",o.apply(this,arguments),i.jsPlumbUIComponent.apply(this,arguments),this.draw=function(i){var n=i.pointAlongPathFrom(t.loc,t.length/2),s=i.pointOnPath(t.loc),r=e.pointOnLine(n,s,t.length),o=e.perpendicularLineTo(n,r,40),h=e.perpendicularLineTo(r,n,20);return{connector:i,head:n,tail:r,headLine:h,tailLine:o,minX:Math.min(n.x,r.x,h[0].x,h[1].x),minY:Math.min(n.y,r.y,h[0].y,h[1].y),maxX:Math.max(n.x,r.x,h[0].x,h[1].x),maxY:Math.max(n.y,r.y,h[0].y,h[1].y)}}},i.Overlays.Label=function(t){this.labelStyle=t.labelStyle,this.cssClass=null!=this.labelStyle?this.labelStyle.cssClass:null;var n=i.extend({create:function(){return i.createElement("div")}},t);if(i.Overlays.Custom.call(this,n),this.type="Label",this.label=t.label||"",this.labelText=null,this.labelStyle){var e=this.getElement();this.labelStyle.font=this.labelStyle.font||"12px sans-serif",e.style.font=this.labelStyle.font,e.style.color=this.labelStyle.color||"black",this.labelStyle.fill&&(e.style.background=this.labelStyle.fill),this.labelStyle.borderWidth>0&&(e.style.border=this.labelStyle.borderWidth+"px solid "+(this.labelStyle.borderStyle?this.labelStyle.borderStyle:"black")),this.labelStyle.padding&&(e.style.padding=this.labelStyle.padding)}},n.extend(i.Overlays.Label,i.Overlays.Custom,{cleanup:function(t){t&&(this.div=null,this.label=null,this.labelText=null,this.cssClass=null,this.labelStyle=null)},getLabel:function(){return this.label},setLabel:function(t){this.label=t,this.labelText=null,this.clearCachedDimensions(),this.update(),this.component.repaint()},getDimensions:function(){return this.update(),u.prototype.getDimensions.apply(this,arguments)},update:function(){if("function"==typeof this.label){var t=this.label(this);this.getElement().innerHTML=t.replace(/\r\n/g,"<br/>")}else null==this.labelText&&(this.labelText=this.label,this.getElement().innerHTML=this.labelText.replace(/\r\n/g,"<br/>"))},updateFrom:function(t){null!=t.label&&this.setLabel(t.label)}})}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,i=t.jsPlumbUtil,n=t.jsPlumbInstance,e="stop",s="revert",r="_jsPlumbGroup",o="show",h="hide",u=function(t){var n={},e={},s={},u=this;function a(i,n){for(var e=i.getMembers(),s=0;s<e.length;s++)t[n?o:h](e[s],!0)}t.bind("connection",function(t){null!=t.source[r]&&null!=t.target[r]&&t.source[r]===t.target[r]?(e[t.connection.id]=t.source[r],s[t.connection.id]=t.source[r]):(null!=t.source[r]&&(i.suggest(t.source[r].connections.source,t.connection),e[t.connection.id]=t.source[r]),null!=t.target[r]&&(i.suggest(t.target[r].connections.target,t.connection),s[t.connection.id]=t.target[r]))}),t.bind("internal.connectionDetached",function(t){!function(t){delete t.proxies;var n,r=e[t.id];null!=r&&(i.removeWithFunction(r.connections.source,n=function(i){return i.id===t.id}),i.removeWithFunction(r.connections.target,n),delete e[t.id]),null!=(r=s[t.id])&&(i.removeWithFunction(r.connections.source,n=function(i){return i.id===t.id}),i.removeWithFunction(r.connections.target,n),delete s[t.id])}(t.connection)}),t.bind("connectionMoved",function(t){var i=(0===t.index?e:s)[t.connection.id];if(i){var n=i.connections[0===t.index?"source":"target"],r=n.indexOf(t.connection);-1!==r&&n.splice(r,1)}}),this.addGroup=function(i){t.addClass(i.getEl(),"jtk-group-expanded"),n[i.id]=i,i.manager=this,f(i),t.fire("group:add",{group:i})},this.addToGroup=function(i,n,e){if(i=this.getGroup(i)){var s=i.getEl();if(n._isJsPlumbGroup)return;var r=n._jsPlumbGroup;if(r!==i){var o=t.getOffset(n,!0),h=t.getOffset(i.collapsed?s:i.getDragArea(),!0);null!=r&&(r.remove(n,!1,e,!1,i),u.updateConnectionsForGroup(r)),i.add(n,e);var a=function(t,n){var e=0===n?1:0;t.each(function(t){t.setVisible(!1),t.endpoints[e].element._jsPlumbGroup===i?(t.endpoints[e].setVisible(!1),l(t,e,i)):(t.endpoints[n].setVisible(!1),c(t,n,i))})};i.collapsed&&(a(t.select({source:n}),0),a(t.select({target:n}),1));var f=t.getId(n);t.dragManager.setParent(n,f,s,t.getId(s),o);var v={left:o.left-h.left,top:o.top-h.top};if(t.setPosition(n,v),t.dragManager.revalidateParent(n,f,o),u.updateConnectionsForGroup(i),t.revalidate(f),!e){var d={group:i,el:n,pos:v};r&&(d.sourceGroup=r),t.fire("group:addMember",d)}}}},this.removeFromGroup=function(t,i,n){(t=this.getGroup(t))&&t.remove(i,null,n)},this.getGroup=function(t){var e=t;if(i.isString(t)&&null==(e=n[t]))throw new TypeError("No such group ["+t+"]");return e},this.getGroups=function(){var t=[];for(var i in n)t.push(n[i]);return t},this.removeGroup=function(i,e,s,r){i=this.getGroup(i),this.expandGroup(i,!0);var o=i[e?"removeAll":"orphanAll"](s,r);return t.remove(i.getEl()),delete n[i.id],delete t._groups[i.id],t.fire("group:remove",{group:i}),o},this.removeAllGroups=function(t,i,e){for(var s in n)this.removeGroup(n[s],t,i,e)};var c=function(i,n,e){var s=i.endpoints[0===n?1:0].element;if(!s[r]||s[r].shouldProxy()||!s[r].collapsed){var o=e.getEl(),h=t.getId(o);t.proxyConnection(i,n,o,h,function(t,i){return e.getEndpoint(t,i)},function(t,i){return e.getAnchor(t,i)})}};this.collapseGroup=function(i){if(null!=(i=this.getGroup(i))&&!i.collapsed){var n=i.getEl();if(a(i,!1),i.shouldProxy()){var e=function(t,n){for(var e=0;e<t.length;e++)c(t[e],n,i)};e(i.connections.source,0),e(i.connections.target,1)}i.collapsed=!0,t.removeClass(n,"jtk-group-expanded"),t.addClass(n,"jtk-group-collapsed"),t.revalidate(n),t.fire("group:collapse",{group:i})}};var l=function(i,n,e){t.unproxyConnection(i,n,t.getId(e.getEl()))};function f(i){var n=i.getMembers(),r=t.getConnections({source:n,scope:"*"},!0),o=t.getConnections({target:n,scope:"*"},!0),h={};i.connections.source.length=0,i.connections.target.length=0;var u=function(t){for(var n=0;n<t.length;n++)h[t[n].id]||(h[t[n].id]=!0,t[n].source._jsPlumbGroup===i?(t[n].target._jsPlumbGroup!==i&&i.connections.source.push(t[n]),e[t[n].id]=i):t[n].target._jsPlumbGroup===i&&(i.connections.target.push(t[n]),s[t[n].id]=i))};u(r),u(o)}this.expandGroup=function(i,n){if(null!=(i=this.getGroup(i))&&i.collapsed){var e=i.getEl();if(a(i,!0),i.shouldProxy()){var s=function(t,n){for(var e=0;e<t.length;e++)l(t[e],n,i)};s(i.connections.source,0),s(i.connections.target,1)}i.collapsed=!1,t.addClass(e,"jtk-group-expanded"),t.removeClass(e,"jtk-group-collapsed"),t.revalidate(e),this.repaintGroup(i),n||t.fire("group:expand",{group:i})}},this.repaintGroup=function(i){for(var n=(i=this.getGroup(i)).getMembers(),e=0;e<n.length;e++)t.revalidate(n[e])},this.updateConnectionsForGroup=f,this.refreshAllGroups=function(){for(var i in n)f(n[i]),t.dragManager.updateOffsets(t.getId(n[i].getEl()))}},a=function(n,o){var h=this,u=o.el;this.getEl=function(){return u},this.id=o.id||i.uuid(),u._isJsPlumbGroup=!0;var a=this.getDragArea=function(){var t=n.getSelector(u,"[jtk-group-content]");return t&&t.length>0?t[0]:u},c=!0===o.ghost,l=c||!0===o.constrain,f=!1!==o.revert,v=!0===o.orphan,d=!0===o.prune,p=!0===o.dropOverride,m=!1!==o.proxied,g=[];if(this.connections={source:[],target:[],internal:[]},this.getAnchor=function(){return o.anchor||"Continuous"},this.getEndpoint=function(){return o.endpoint||["Dot",{radius:10}]},this.collapsed=!1,!1!==o.draggable){var y={stop:function(t){n.fire("groupDragStop",jsPlumb.extend(t,{group:h}))},scope:"_jsPlumbGroupDrag"};o.dragOptions&&t.jsPlumb.extend(y,o.dragOptions),n.draggable(o.el,y)}!1!==o.droppable&&n.droppable(o.el,{drop:function(t){var i=t.drag.el;if(!i._isJsPlumbGroup){var e=i._jsPlumbGroup;if(e!==h){if(null!=e&&e.overrideDrop(i,h))return;n.getGroupManager().addToGroup(h,i,!1)}}}});var x=function(t,i){for(var n=null==t.nodeType?t:[t],e=0;e<n.length;e++)i(n[e])};function b(t,i){var e=function(t){return t.offsetParent}(t),s=n.getSize(e),r=n.getSize(t),o=i[0],h=i[1];return o+r[0]>0&&o<s[0]&&h+r[1]>0&&h<s[1]}function w(t){var i=n.getId(t),e=n.getOffset(t);return t.parentNode.removeChild(t),n.getContainer().appendChild(t),n.setPosition(t,e),delete t._jsPlumbGroup,C(t),n.dragManager.clearParent(t,i),[i,e]}function M(t){var i=null;if(!b(t.el,t.pos)){var e=t.el._jsPlumbGroup;d?n.remove(t.el):i=w(t.el),e.remove(t.el)}return i}function T(t){var i=n.getId(t);n.revalidate(t),n.dragManager.revalidateParent(t,i)}function C(t){t._katavorioDrag&&((d||v)&&t._katavorioDrag.off(e,M),d||v||!f||(t._katavorioDrag.off(s,T),t._katavorioDrag.setRevert(null)))}function S(t){t._katavorioDrag&&((d||v)&&t._katavorioDrag.on(e,M),l&&t._katavorioDrag.setConstrain(!0),c&&t._katavorioDrag.setUseGhostProxy(!0),d||v||!f||(t._katavorioDrag.on(s,T),t._katavorioDrag.setRevert(function(t,i){return!b(t,i)})))}this.overrideDrop=function(){return p&&(f||d||v)},this.add=function(t,i){var e=a();x(t,function(t){if(null!=t._jsPlumbGroup){if(t._jsPlumbGroup===h)return;t._jsPlumbGroup.remove(t,!0,i,!1)}t._jsPlumbGroup=h,g.push(t),n.isAlreadyDraggable(t)&&S(t),t.parentNode!==e&&e.appendChild(t)}),n.getGroupManager().updateConnectionsForGroup(h)},this.remove=function(t,e,s,r,o){x(t,function(t){if(delete t._jsPlumbGroup,i.removeWithFunction(g,function(i){return i===t}),e)try{h.getDragArea().removeChild(t)}catch(t){jsPlumbUtil.log("Could not remove element from Group "+t)}if(C(t),!s){var r={group:h,el:t};o&&(r.targetGroup=o),n.fire("group:removeMember",r)}}),r||n.getGroupManager().updateConnectionsForGroup(h)},this.removeAll=function(t,i){for(var e=0,s=g.length;e<s;e++){var r=g[0];h.remove(r,t,i,!0),n.remove(r,!0)}g.length=0,n.getGroupManager().updateConnectionsForGroup(h)},this.orphanAll=function(){for(var t={},i=0;i<g.length;i++){var n=w(g[i]);t[n[0]]=n[1]}return g.length=0,t},this.getMembers=function(){return g},u[r]=this,n.bind("elementDraggable",function(t){t.el._jsPlumbGroup===this&&S(t.el)}.bind(this)),this.shouldProxy=function(){return m},n.getGroupManager().addGroup(this)};n.prototype.addGroup=function(t){var i=this;if(i._groups=i._groups||{},null!=i._groups[t.id])throw new TypeError("cannot create Group ["+t.id+"]; a Group with that ID exists");if(null!=t.el[r])throw new TypeError("cannot create Group ["+t.id+"]; the given element is already a Group");var n=new a(i,t);return i._groups[n.id]=n,t.collapsed&&this.collapseGroup(n),n},n.prototype.addToGroup=function(t,i,n){var e=function(i){var e=this.getId(i);this.manage(e,i),this.getGroupManager().addToGroup(t,i,n)}.bind(this);if(Array.isArray(i))for(var s=0;s<i.length;s++)e(i[s]);else e(i)},n.prototype.removeFromGroup=function(t,i,n){this.getGroupManager().removeFromGroup(t,i,n)},n.prototype.removeGroup=function(t,i,n,e){return this.getGroupManager().removeGroup(t,i,n,e)},n.prototype.removeAllGroups=function(t,i,n){this.getGroupManager().removeAllGroups(t,i,n)},n.prototype.getGroup=function(t){return this.getGroupManager().getGroup(t)},n.prototype.getGroups=function(){return this.getGroupManager().getGroups()},n.prototype.expandGroup=function(t){this.getGroupManager().expandGroup(t)},n.prototype.collapseGroup=function(t){this.getGroupManager().collapseGroup(t)},n.prototype.repaintGroup=function(t){this.getGroupManager().repaintGroup(t)},n.prototype.toggleGroup=function(t){null!=(t=this.getGroupManager().getGroup(t))&&this.getGroupManager()[t.collapsed?"expandGroup":"collapseGroup"](t)},n.prototype.getGroupManager=function(){var t=this._groupManager;return null==t&&(t=this._groupManager=new u(this)),t},n.prototype.removeGroupManager=function(){delete this._groupManager},n.prototype.getGroupFor=function(t){if(t=this.getElement(t))return t[r]}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,i=this.jsPlumbUtil;t.Connectors.Flowchart=function(i){this.type="Flowchart",(i=i||{}).stub=null==i.stub?30:i.stub;var n,e=t.Connectors.AbstractConnector.apply(this,arguments),s=null==i.midpoint?.5:i.midpoint,r=!0===i.alwaysRespectStubs,o=null,h=null,u=null!=i.cornerRadius?i.cornerRadius:0,a=function(t){return t<0?-1:0===t?0:1},c=function(t){return[a(t[2]-t[0]),a(t[3]-t[1])]},l=function(t,i,n,e){if(o!==i||h!==n){var s=null==o?e.sx:o,r=null==h?e.sy:h;o=i,h=n,t.push([s,r,i,n,s===i?"v":"h"])}},f=function(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))},v=function(t){var i=[];return i.push.apply(i,t),i},d=function(t,i,n){for(var s,r,o,h=null,a=0;a<i.length-1;a++){if(h=h||v(i[a]),s=v(i[a+1]),r=c(h),o=c(s),u>0&&h[4]!==s[4]){var l=Math.min(f(h),f(s)),d=Math.min(u,l/2);h[2]-=r[0]*d,h[3]-=r[1]*d,s[0]+=o[0]*d,s[1]+=o[1]*d;var p=r[1]===o[0]&&1===o[0]||r[1]===o[0]&&0===o[0]&&r[0]!==o[1]||r[1]===o[0]&&-1===o[0],m=(s[1]>h[3]?1:-1)==(s[0]>h[2]?1:-1),g=m&&p||!m&&!p?s[0]:h[2],y=m&&p||!m&&!p?h[3]:s[1];e.addSegment(t,"Straight",{x1:h[0],y1:h[1],x2:h[2],y2:h[3]}),e.addSegment(t,"Arc",{r:d,x1:h[2],y1:h[3],x2:s[0],y2:s[1],cx:g,cy:y,ac:p})}else{var x=h[2]===h[0]?0:h[2]>h[0]?n.lw/2:-n.lw/2,b=h[3]===h[1]?0:h[3]>h[1]?n.lw/2:-n.lw/2;e.addSegment(t,"Straight",{x1:h[0]-x,y1:h[1]-b,x2:h[2]+x,y2:h[3]+b})}h=s}null!=s&&e.addSegment(t,"Straight",{x1:s[0],y1:s[1],x2:s[2],y2:s[3]})};this._compute=function(t,i){n=[],o=null,h=null;var u=function(){return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]},a={perpendicular:u,orthogonal:u,opposite:function(i){var n=t,e="x"===i?0:1;return!r&&{x:function(){return 1===n.so[e]&&(n.startStubX>n.endStubX&&n.tx>n.startStubX||n.sx>n.endStubX&&n.tx>n.sx)||-1===n.so[e]&&(n.startStubX<n.endStubX&&n.tx<n.startStubX||n.sx<n.endStubX&&n.tx<n.sx)},y:function(){return 1===n.so[e]&&(n.startStubY>n.endStubY&&n.ty>n.startStubY||n.sy>n.endStubY&&n.ty>n.sy)||-1===n.so[e]&&(n.startStubY<n.endStubY&&n.ty<n.startStubY||n.sy<n.endStubY&&n.ty<n.sy)}}[i]()?{x:[(t.sx+t.tx)/2,t.startStubY,(t.sx+t.tx)/2,t.endStubY],y:[t.startStubX,(t.sy+t.ty)/2,t.endStubX,(t.sy+t.ty)/2]}[i]:[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}}[t.anchorOrientation](t.sourceAxis),c="x"===t.sourceAxis?0:1,f="x"===t.sourceAxis?1:0,v=a[c],p=a[f],m=a[c+2],g=a[f+2];l(n,a[0],a[1],t);var y=t.startStubX+(t.endStubX-t.startStubX)*s,x=t.startStubY+(t.endStubY-t.startStubY)*s,b={x:[0,1],y:[1,0]},w={perpendicular:function(i){var n={x:[[t.startStubX,t.endStubX],null,[t.endStubX,t.startStubX]],y:[[t.startStubY,t.endStubY],null,[t.endStubY,t.startStubY]]},e={x:[t.startStubY,t.endStubY],y:[t.startStubX,t.endStubX]},s=b[i][1],r=t.so[b[i][0]]+1,o=-1===t.to[s]&&e[i][1]<e[i][0]||1===t.to[s]&&e[i][1]>e[i][0],h=n[i][r][0],u=n[i][r][1],a={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[i][r][t.to[s]+1];return t.segment===a[3]||t.segment===a[2]&&o?{x:[[y,t.startStubY],[y,t.endStubY]],y:[[t.startStubX,x],[t.endStubX,x]]}[i]:t.segment===a[2]&&u<h?{x:[[t.endStubX,t.startStubY]],y:[[t.startStubX,t.endStubY]]}[i]:t.segment===a[2]&&u>=h||t.segment===a[1]&&!o?{x:[[t.startStubX,x],[t.endStubX,x],[t.endStubX,t.endStubY]],y:[[y,t.startStubY],[y,t.endStubY],[t.endStubX,t.endStubY]]}[i]:t.segment===a[0]||t.segment===a[1]&&o?{x:[[t.startStubX,t.endStubY],[t.endStubX,t.endStubY]],y:[[t.endStubX,t.startStubY],[t.endStubX,t.endStubY]]}[i]:void 0},orthogonal:function(i,n,e,s,r){var o=t,h={x:-1===o.so[0]?Math.min(n,s):Math.max(n,s),y:-1===o.so[1]?Math.min(n,s):Math.max(n,s)}[i];return{x:[[h,e],[h,r],[s,r]],y:[[e,h],[r,h],[r,s]]}[i]},opposite:function(n,s,r,o){var h=t,u={x:"y",y:"x"}[n],a={x:"height",y:"width"}[n],l=h["is"+n.toUpperCase()+"GreaterThanStubTimes2"];if(i.sourceEndpoint.elementId===i.targetEndpoint.elementId){var f=r+(1-i.sourceEndpoint.anchor[u])*i.sourceInfo[a]+e.maxStub;return{x:[[s,f],[o,f]],y:[[f,s],[f,o]]}[n]}return!l||1===h.so[c]&&s>o||-1===h.so[c]&&s<o?{x:[[s,x],[o,x]],y:[[y,s],[y,o]]}[n]:1===h.so[c]&&s<o||-1===h.so[c]&&s>o?{x:[[y,h.sy],[y,h.ty]],y:[[h.sx,x],[h.tx,x]]}[n]:void 0}}[t.anchorOrientation](t.sourceAxis,v,p,m,g);if(w)for(var M=0;M<w.length;M++)l(n,w[M][0],w[M][1],t);l(n,a[2],a[3],t),l(n,t.tx,t.ty,t),d(this,n,t)}},i.extend(t.Connectors.Flowchart,t.Connectors.AbstractConnector)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,i=this.jsPlumbUtil;t.Connectors.AbstractBezierConnector=function(i){var n,e=!1!==(i=i||{}).showLoopback,s=i.margin||5,r=i.orientation&&"clockwise"===i.orientation,o=i.loopbackRadius||25;return this._compute=function(t,i){var h=i.sourcePos,u=i.targetPos,a=Math.abs(h[0]-u[0]),c=Math.abs(h[1]-u[1]);if(e&&i.sourceEndpoint.elementId===i.targetEndpoint.elementId){var l=i.sourcePos[0],f=i.sourcePos[1]-s,v=l,d=f-o,p=v-o,m=d-o;a=2*o,c=2*o,t.points[0]=p,t.points[1]=m,t.points[2]=a,t.points[3]=c,n.addSegment(this,"Arc",{loopback:!0,x1:l-p+4,y1:f-m,startAngle:0,endAngle:2*Math.PI,r:o,ac:!r,x2:l-p-4,y2:f-m,cx:v-p,cy:d-m})}else this._computeBezier(t,i,h,u,a,c)},n=t.Connectors.AbstractConnector.apply(this,arguments)},i.extend(t.Connectors.AbstractBezierConnector,t.Connectors.AbstractConnector);var n=function(i){i=i||{},this.type="Bezier";var n=t.Connectors.AbstractBezierConnector.apply(this,arguments),e=i.curviness||150,s=10;this.getCurviness=function(){return e},this._findControlPoint=function(t,i,n,r,o,h,u){var a=[];return h[0]!==u[0]||h[1]===u[1]?(a.push(0===u[0]?n[0]<i[0]?t[0]+s:t[0]-s:t[0]+e*u[0]),a.push(0===u[1]?n[1]<i[1]?t[1]+s:t[1]-s:t[1]+e*h[1])):(a.push(0===h[0]?i[0]<n[0]?t[0]+s:t[0]-s:t[0]-e*h[0]),a.push(0===h[1]?i[1]<n[1]?t[1]+s:t[1]-s:t[1]+e*u[1])),a},this._computeBezier=function(t,i,e,s,r,o){var h,u,a=e[0]<s[0]?r:0,c=e[1]<s[1]?o:0,l=e[0]<s[0]?0:r,f=e[1]<s[1]?0:o;h=this._findControlPoint([a,c],e,s,i.sourceEndpoint,i.targetEndpoint,t.so,t.to),u=this._findControlPoint([l,f],s,e,i.targetEndpoint,i.sourceEndpoint,t.to,t.so),n.addSegment(this,"Bezier",{x1:a,y1:c,x2:l,y2:f,cp1x:h[0],cp1y:h[1],cp2x:u[0],cp2y:u[1]})}};t.Connectors.Bezier=n,i.extend(n,t.Connectors.AbstractBezierConnector)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,i=this.jsPlumbUtil,n=function(t,i,n,e){return t<=n&&e<=i?1:t<=n&&i<=e?2:n<=t&&e>=i?3:4},e=function(t,i,n,e,s,r,o,h,u){return h<=u?[t,i]:1===n?e[3]<=0&&s[3]>=1?[t+(e[2]<.5?-1*r:r),i]:e[2]>=1&&s[2]<=0?[t,i+(e[3]<.5?-1*o:o)]:[t+-1*r,i+-1*o]:2===n?e[3]>=1&&s[3]<=0?[t+(e[2]<.5?-1*r:r),i]:e[2]>=1&&s[2]<=0?[t,i+(e[3]<.5?-1*o:o)]:[t+r,i+-1*o]:3===n?e[3]>=1&&s[3]<=0?[t+(e[2]<.5?-1*r:r),i]:e[2]<=0&&s[2]>=1?[t,i+(e[3]<.5?-1*o:o)]:[t+-1*r,i+-1*o]:4===n?e[3]<=0&&s[3]>=1?[t+(e[2]<.5?-1*r:r),i]:e[2]<=0&&s[2]>=1?[t,i+(e[3]<.5?-1*o:o)]:[t+r,i+-1*o]:void 0},s=function(i){i=i||{},this.type="StateMachine";var s,r=t.Connectors.AbstractBezierConnector.apply(this,arguments),o=i.curviness||10,h=i.margin||5,u=i.proximityLimit||80;this._computeBezier=function(t,i,a,c,l,f){var v=i.sourcePos[0]<i.targetPos[0]?0:l,d=i.sourcePos[1]<i.targetPos[1]?0:f,p=i.sourcePos[0]<i.targetPos[0]?l:0,m=i.sourcePos[1]<i.targetPos[1]?f:0;0===i.sourcePos[2]&&(v-=h),1===i.sourcePos[2]&&(v+=h),0===i.sourcePos[3]&&(d-=h),1===i.sourcePos[3]&&(d+=h),0===i.targetPos[2]&&(p-=h),1===i.targetPos[2]&&(p+=h),0===i.targetPos[3]&&(m-=h),1===i.targetPos[3]&&(m+=h);var g=(v+p)/2,y=(d+m)/2,x=n(v,d,p,m),b=Math.sqrt(Math.pow(p-v,2)+Math.pow(m-d,2));s=e(g,y,x,i.sourcePos,i.targetPos,o,o,b,u),r.addSegment(this,"Bezier",{x1:p,y1:m,x2:v,y2:d,cp1x:s[0],cp1y:s[1],cp2x:s[0],cp2y:s[1]})}};t.Connectors.StateMachine=s,i.extend(s,t.Connectors.AbstractBezierConnector)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,i=this.jsPlumbUtil,n=function(){this.type="Straight";var i=t.Connectors.AbstractConnector.apply(this,arguments);this._compute=function(t){i.addSegment(this,"Straight",{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY}),i.addSegment(this,"Straight",{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY}),i.addSegment(this,"Straight",{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty})}};t.Connectors.Straight=n,i.extend(n,t.Connectors.AbstractConnector)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,i=this.jsPlumbUtil,n={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},e="http://www.w3.org/2000/svg",s=function(t,i){for(var n in i)t.setAttribute(n,""+i[n])},r=function(i,n){return(n=n||{}).version="1.1",n.xmlns=e,t.createElementNS(e,i,null,null,n)},o=function(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"},h=function(t){for(var i=t.querySelectorAll(" defs,linearGradient,radialGradient"),n=0;n<i.length;n++)i[n].parentNode.removeChild(i[n])},u=function(t,i,e,s,o){if(i.setAttribute("fill",e.fill?e.fill:"none"),i.setAttribute("stroke",e.stroke?e.stroke:"none"),e.gradient?function(t,i,n,e,s){var o,u="jsplumb_gradient_"+s._jsPlumb.instance.idstamp();h(t),o=n.gradient.offset?r("radialGradient",{id:u}):r("linearGradient",{id:u,gradientUnits:"userSpaceOnUse"});var a=r("defs");t.appendChild(a),a.appendChild(o);for(var c=0;c<n.gradient.stops.length;c++){var l=n.gradient.stops[1===s.segment||2===s.segment?c:n.gradient.stops.length-1-c][1],f=r("stop",{offset:Math.floor(100*n.gradient.stops[c][0])+"%","stop-color":l});o.appendChild(f)}i.setAttribute(n.stroke?"stroke":"fill","url(#"+u+")")}(t,i,e,0,o):(h(t),i.setAttribute("style","")),e.strokeWidth&&i.setAttribute("stroke-width",e.strokeWidth),e.dashstyle&&e.strokeWidth&&!e["stroke-dasharray"]){var u=-1===e.dashstyle.indexOf(",")?" ":",",a=e.dashstyle.split(u),c="";a.forEach(function(t){c+=Math.floor(t*e.strokeWidth)+u}),i.setAttribute("stroke-dasharray",c)}else e["stroke-dasharray"]&&i.setAttribute("stroke-dasharray",e["stroke-dasharray"]);for(var l in n)e[l]&&i.setAttribute(n[l],e[l])},a=function(t,i,n){t.childNodes.length>n?t.insertBefore(i,t.childNodes[n]):t.appendChild(i)};i.svg={node:r,attr:s,pos:o};var c=function(n){var e=n.pointerEventsSpec||"all",h={};t.jsPlumbUIComponent.apply(this,n.originalArgs),this.canvas=null,this.path=null,this.svg=null,this.bgCanvas=null;var u=n.cssClass+" "+(n.originalArgs[0].cssClass||"");this.svg=r("svg",{style:"",width:0,height:0,"pointer-events":e,position:"absolute"}),n.useDivWrapper?(this.canvas=t.createElement("div",{position:"absolute"}),i.sizeElement(this.canvas,0,0,1,1),this.canvas.className=u):(s(this.svg,{class:u}),this.canvas=this.svg),n._jsPlumb.appendElement(this.canvas,n.originalArgs[0].parent),n.useDivWrapper&&this.canvas.appendChild(this.svg);var a=[this.canvas];return this.getDisplayElements=function(){return a},this.appendDisplayElement=function(t){a.push(t)},this.paint=function(t,e,r){if(null!=t){var u,a=[this.x,this.y],c=[this.w,this.h];null!=r&&(r.xmin<0&&(a[0]+=r.xmin),r.ymin<0&&(a[1]+=r.ymin),c[0]=r.xmax+(r.xmin<0?-r.xmin:0),c[1]=r.ymax+(r.ymin<0?-r.ymin:0)),n.useDivWrapper?(i.sizeElement(this.canvas,a[0],a[1],c[0],c[1]),a[0]=0,a[1]=0,u=o([0,0])):u=o([a[0],a[1]]),h.paint.apply(this,arguments),s(this.svg,{style:u,width:c[0]||0,height:c[1]||0})}},{renderer:h}};i.extend(c,t.jsPlumbUIComponent,{cleanup:function(t){t||null==this.typeId?(this.canvas&&(this.canvas._jsPlumb=null),this.svg&&(this.svg._jsPlumb=null),this.bgCanvas&&(this.bgCanvas._jsPlumb=null),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.svg=null,this.canvas=null,this.path=null,this.group=null):(this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.bgCanvas.parentNode.removeChild(this.bgCanvas))},reattach:function(t){var i=t.getContainer();this.canvas&&null==this.canvas.parentNode&&i.appendChild(this.canvas),this.bgCanvas&&null==this.bgCanvas.parentNode&&i.appendChild(this.bgCanvas)},setVisible:function(t){this.canvas&&(this.canvas.style.display=t?"block":"none")}}),t.ConnectorRenderers.svg=function(i){var n=this,e=c.apply(this,[{cssClass:i._jsPlumb.connectorClass,originalArgs:arguments,pointerEventsSpec:"none",_jsPlumb:i._jsPlumb}]);e.renderer.paint=function(e,o,h){var c=n.getSegments(),l=[0,0];if(h.xmin<0&&(l[0]=-h.xmin),h.ymin<0&&(l[1]=-h.ymin),c.length>0){var f={d:n.getPathData(),transform:"translate("+l[0]+","+l[1]+")","pointer-events":i["pointer-events"]||"visibleStroke"},v=null;if(e.outlineStroke){var d=e.strokeWidth+2*(e.outlineWidth||1);delete(v=t.extend({},e)).gradient,v.stroke=e.outlineStroke,v.strokeWidth=d,null==n.bgPath?(n.bgPath=r("path",f),t.addClass(n.bgPath,t.connectorOutlineClass),a(n.svg,n.bgPath,0)):s(n.bgPath,f),u(n.svg,n.bgPath,v,0,n)}null==n.path?(n.path=r("path",f),a(n.svg,n.path,e.outlineStroke?1:0)):s(n.path,f),u(n.svg,n.path,e,0,n)}}},i.extend(t.ConnectorRenderers.svg,c);var l=t.SvgEndpoint=function(i){var n=c.apply(this,[{cssClass:i._jsPlumb.endpointClass,originalArgs:arguments,pointerEventsSpec:"all",useDivWrapper:!0,_jsPlumb:i._jsPlumb}]);n.renderer.paint=function(i){var n=t.extend({},i);n.outlineStroke&&(n.stroke=n.outlineStroke),null==this.node?(this.node=this.makeNode(n),this.svg.appendChild(this.node)):null!=this.updateNode&&this.updateNode(this.node),u(this.svg,this.node,n,0,this)}.bind(this)};i.extend(l,c),t.Endpoints.svg.Dot=function(){t.Endpoints.Dot.apply(this,arguments),l.apply(this,arguments),this.makeNode=function(){return r("circle",{cx:this.w/2,cy:this.h/2,r:this.radius})},this.updateNode=function(t){s(t,{cx:this.w/2,cy:this.h/2,r:this.radius})}},i.extend(t.Endpoints.svg.Dot,[t.Endpoints.Dot,l]),t.Endpoints.svg.Rectangle=function(){t.Endpoints.Rectangle.apply(this,arguments),l.apply(this,arguments),this.makeNode=function(){return r("rect",{width:this.w,height:this.h})},this.updateNode=function(t){s(t,{width:this.w,height:this.h})}},i.extend(t.Endpoints.svg.Rectangle,[t.Endpoints.Rectangle,l]),t.Endpoints.svg.Image=t.Endpoints.Image,t.Endpoints.svg.Blank=t.Endpoints.Blank,t.Overlays.svg.Label=t.Overlays.Label,t.Overlays.svg.Custom=t.Overlays.Custom;var f=function(i,n){i.apply(this,n),t.jsPlumbUIComponent.apply(this,n),this.isAppendedAtTopLevel=!1,this.path=null,this.paint=function(t,i){if(t.component.svg&&i){null==this.path&&(this.path=r("path",{"pointer-events":"all"}),t.component.svg.appendChild(this.path),this.elementCreated&&this.elementCreated(this.path,t.component),this.canvas=t.component.svg);var o=n&&1===n.length&&n[0].cssClass||"",h=[0,0];i.xmin<0&&(h[0]=-i.xmin),i.ymin<0&&(h[1]=-i.ymin),s(this.path,{d:e(t.d),class:o,stroke:t.stroke?t.stroke:null,fill:t.fill?t.fill:null,transform:"translate("+h[0]+","+h[1]+")"})}};var e=function(t){return isNaN(t.cxy.x)||isNaN(t.cxy.y)?"":"M"+t.hxy.x+","+t.hxy.y+" L"+t.tail[0].x+","+t.tail[0].y+" L"+t.cxy.x+","+t.cxy.y+" L"+t.tail[1].x+","+t.tail[1].y+" L"+t.hxy.x+","+t.hxy.y};this.transfer=function(t){t.canvas&&this.path&&this.path.parentNode&&(this.path.parentNode.removeChild(this.path),t.canvas.appendChild(this.path))}};i.extend(f,[t.jsPlumbUIComponent,t.Overlays.AbstractOverlay],{cleanup:function(t){null!=this.path&&(t?this._jsPlumb.instance.removeElement(this.path):this.path.parentNode&&this.path.parentNode.removeChild(this.path))},reattach:function(t,i){this.path&&i.canvas&&i.canvas.appendChild(this.path)},setVisible:function(t){null!=this.path&&(this.path.style.display=t?"block":"none")}}),t.Overlays.svg.Arrow=function(){f.apply(this,[t.Overlays.Arrow,arguments])},i.extend(t.Overlays.svg.Arrow,[t.Overlays.Arrow,f]),t.Overlays.svg.PlainArrow=function(){f.apply(this,[t.Overlays.PlainArrow,arguments])},i.extend(t.Overlays.svg.PlainArrow,[t.Overlays.PlainArrow,f]),t.Overlays.svg.Diamond=function(){f.apply(this,[t.Overlays.Diamond,arguments])},i.extend(t.Overlays.svg.Diamond,[t.Overlays.Diamond,f]),t.Overlays.svg.GuideLines=function(){var i,n,e=null,o=this;t.Overlays.GuideLines.apply(this,arguments),this.paint=function(t,u){null==e&&(e=r("path"),t.connector.svg.appendChild(e),o.attachListeners(e,t.connector),o.attachListeners(e,o),i=r("path"),t.connector.svg.appendChild(i),o.attachListeners(i,t.connector),o.attachListeners(i,o),n=r("path"),t.connector.svg.appendChild(n),o.attachListeners(n,t.connector),o.attachListeners(n,o));var a=[0,0];u.xmin<0&&(a[0]=-u.xmin),u.ymin<0&&(a[1]=-u.ymin),s(e,{d:h(t.head,t.tail),stroke:"red",fill:null,transform:"translate("+a[0]+","+a[1]+")"}),s(i,{d:h(t.tailLine[0],t.tailLine[1]),stroke:"blue",fill:null,transform:"translate("+a[0]+","+a[1]+")"}),s(n,{d:h(t.headLine[0],t.headLine[1]),stroke:"green",fill:null,transform:"translate("+a[0]+","+a[1]+")"})};var h=function(t,i){return"M "+t.x+","+t.y+" L"+i.x+","+i.y}},i.extend(t.Overlays.svg.GuideLines,t.Overlays.GuideLines)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t,i,n=this,e=n.jsPlumb,s=n.jsPlumbUtil,r=n.Katavorio,o=n.Biltong,h=function(t,i){var n="_katavorio_"+(i=i||"main"),s=t[n],h=t.getEventManager();return s||((s=new r({bind:h.on,unbind:h.off,getSize:e.getSize,getConstrainingRectangle:function(t){return[t.parentNode.scrollWidth,t.parentNode.scrollHeight]},getPosition:function(i,n){var e=t.getOffset(i,n,i._katavorioDrag?i.offsetParent:null);return[e.left,e.top]},setPosition:function(t,i){t.style.left=i[0]+"px",t.style.top=i[1]+"px"},addClass:e.addClass,removeClass:e.removeClass,intersects:o.intersects,indexOf:function(t,i){return t.indexOf(i)},scope:t.getDefaultScope(),css:{noSelect:t.dragSelectClass,droppable:"jtk-droppable",draggable:"jtk-draggable",drag:"jtk-drag",selected:"jtk-drag-selected",active:"jtk-drag-active",hover:"jtk-drag-hover",ghostProxy:"jtk-ghost-proxy"}})).setZoom(t.getZoom()),t[n]=s,t.bind("zoom",s.setZoom)),s},u=function(t,i){if(null==i)return[0,0];var n=v(i),e=f(n,0);return[e[t+"X"],e[t+"Y"]]},a=u.bind(this,"page"),c=u.bind(this,"screen"),l=u.bind(this,"client"),f=function(t,i){return t.item?t.item(i):t[i]},v=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},d=function(t){var i={},n=[],e={},s={},r={};this.register=function(o){var h,u=t.getId(o);i[u]||(i[u]=o,n.push(o),e[u]={});var a=function(i){if(i)for(var n=0;n<i.childNodes.length;n++)if(3!==i.childNodes[n].nodeType&&8!==i.childNodes[n].nodeType){var c=jsPlumb.getElement(i.childNodes[n]),l=t.getId(i.childNodes[n],null,!0);if(l&&s[l]&&s[l]>0){h||(h=t.getOffset(o));var f=t.getOffset(c);e[u][l]={id:l,offset:{left:f.left-h.left,top:f.top-h.top}},r[l]=u}a(i.childNodes[n])}};a(o)},this.updateOffsets=function(i,n){if(null!=i){n=n||{};var s,o=jsPlumb.getElement(i),h=t.getId(o),u=e[h];if(u)for(var a in u)if(u.hasOwnProperty(a)){var c=jsPlumb.getElement(a),l=n[a]||t.getOffset(c);if(null==c.offsetParent&&null!=e[h][a])continue;s||(s=t.getOffset(o)),e[h][a]={id:a,offset:{left:l.left-s.left,top:l.top-s.top}},r[a]=h}}},this.endpointAdded=function(n,o){o=o||t.getId(n);var h=document.body,u=n.parentNode;for(s[o]=s[o]?s[o]+1:1;null!=u&&u!==h;){var a=t.getId(u,null,!0);if(a&&i[a]){var c=t.getOffset(u);if(null==e[a][o]){var l=t.getOffset(n);e[a][o]={id:o,offset:{left:l.left-c.left,top:l.top-c.top}},r[o]=a}break}u=u.parentNode}},this.endpointDeleted=function(t){if(s[t.elementId]&&(s[t.elementId]--,s[t.elementId]<=0))for(var i in e)e.hasOwnProperty(i)&&e[i]&&(delete e[i][t.elementId],delete r[t.elementId])},this.changeId=function(t,i){e[i]=e[t],e[t]={},r[i]=r[t],r[t]=null},this.getElementsForDraggable=function(t){return e[t]},this.elementRemoved=function(t){var i=r[t];i&&(delete e[i][t],delete r[t])},this.reset=function(){i={},n=[],e={},s={}},this.dragEnded=function(i){if(null!=i.offsetParent){var n=t.getId(i),e=r[n];e&&this.updateOffsets(e)}},this.setParent=function(i,n,s,o,h){var u=r[n];e[o]||(e[o]={});var a=t.getOffset(s),c=h||t.getOffset(i);u&&e[u]&&delete e[u][n],e[o][n]={id:n,offset:{left:c.left-a.left,top:c.top-a.top}},r[n]=o},this.clearParent=function(t,i){var n=r[i];n&&(delete e[n][i],delete r[i])},this.revalidateParent=function(i,n,e){var s=r[n];if(s){var o={};o[n]=e,this.updateOffsets(s,o),t.revalidate(s)}},this.getDragAncestor=function(i){var n=jsPlumb.getElement(i),e=t.getId(n),s=r[e];return s?jsPlumb.getElement(s):null}},p=function(t,i,n){i=s.fastTrim(i),void 0!==t.className.baseVal?t.className.baseVal=i:t.className=i;try{var e=t.classList;if(null!=e){for(;e.length>0;)e.remove(e.item(0));for(var r=0;r<n.length;r++)n[r]&&e.add(n[r])}}catch(t){s.log("JSPLUMB: cannot set class list",t)}},m=function(t){return void 0===t.className.baseVal?t.className:t.className.baseVal},g=function(t,i,n){i=null==i?[]:s.isArray(i)?i:i.split(/\s+/),n=null==n?[]:s.isArray(n)?n:n.split(/\s+/);var e=m(t).split(/\s+/),r=function(t,i){for(var n=0;n<i.length;n++)if(t)-1===e.indexOf(i[n])&&e.push(i[n]);else{var s=e.indexOf(i[n]);-1!==s&&e.splice(s,1)}};r(!0,i),r(!1,n),p(t,e.join(" "),e)};n.jsPlumb.extend(n.jsPlumbInstance.prototype,{headless:!1,pageLocation:a,screenLocation:c,clientLocation:l,getDragManager:function(){return null==this.dragManager&&(this.dragManager=new d(this)),this.dragManager},recalculateOffsets:function(t){this.getDragManager().updateOffsets(t)},createElement:function(t,i,n,e){return this.createElementNS(null,t,i,n,e)},createElementNS:function(t,i,n,e,s){var r,o=null==t?document.createElement(i):document.createElementNS(t,i);for(r in n=n||{})o.style[r]=n[r];for(r in e&&(o.className=e),s=s||{})o.setAttribute(r,""+s[r]);return o},getAttribute:function(t,i){return null!=t.getAttribute?t.getAttribute(i):null},setAttribute:function(t,i,n){null!=t.setAttribute&&t.setAttribute(i,n)},setAttributes:function(t,i){for(var n in i)i.hasOwnProperty(n)&&t.setAttribute(n,i[n])},appendToRoot:function(t){document.body.appendChild(t)},getRenderModes:function(){return["svg"]},getClass:m,addClass:function(t,i){jsPlumb.each(t,function(t){g(t,i)})},hasClass:function(t,i){return(t=jsPlumb.getElement(t)).classList?t.classList.contains(i):-1!==m(t).indexOf(i)},removeClass:function(t,i){jsPlumb.each(t,function(t){g(t,null,i)})},toggleClass:function(t,i){jsPlumb.hasClass(t,i)?jsPlumb.removeClass(t,i):jsPlumb.addClass(t,i)},updateClasses:function(t,i,n){jsPlumb.each(t,function(t){g(t,i,n)})},setClass:function(t,i){null!=i&&jsPlumb.each(t,function(t){p(t,i,i.split(/\s+/))})},setPosition:function(t,i){t.style.left=i.left+"px",t.style.top=i.top+"px"},getPosition:function(t){var i=function(i){var n=t.style[i];return n?n.substring(0,n.length-2):0};return{left:i("left"),top:i("top")}},getStyle:function(t,i){return void 0!==window.getComputedStyle?getComputedStyle(t,null).getPropertyValue(i):t.currentStyle[i]},getSelector:function(t,i){return 1===arguments.length?null!=t.nodeType?t:document.querySelectorAll(t):t.querySelectorAll(i)},getOffset:function(t,i,n){t=jsPlumb.getElement(t),n=n||this.getContainer();for(var e={left:t.offsetLeft,top:t.offsetTop},s=i||null!=n&&t!==n&&t.offsetParent!==n?t.offsetParent:null,r=function(t){null!=t&&t!==document.body&&(t.scrollTop>0||t.scrollLeft>0)&&(e.left-=t.scrollLeft,e.top-=t.scrollTop)}.bind(this);null!=s;)e.left+=s.offsetLeft,e.top+=s.offsetTop,r(s),s=i?s.offsetParent:s.offsetParent===n?null:s.offsetParent;if(null!=n&&!i&&(n.scrollTop>0||n.scrollLeft>0)){var o=null!=t.offsetParent?this.getStyle(t.offsetParent,"position"):"static",h=this.getStyle(t,"position");"absolute"!==h&&"fixed"!==h&&"absolute"!==o&&"fixed"!==o&&(e.left-=n.scrollLeft,e.top-=n.scrollTop)}return e},getPositionOnElement:function(t,i,n){var e=void 0!==i.getBoundingClientRect?i.getBoundingClientRect():{left:0,top:0,width:0,height:0},s=document.body,r=document.documentElement,o=window.pageYOffset||r.scrollTop||s.scrollTop,h=window.pageXOffset||r.scrollLeft||s.scrollLeft,u=e.top+o-(r.clientTop||s.clientTop||0)+0*n,a=e.left+h-(r.clientLeft||s.clientLeft||0)+0*n,c=jsPlumb.pageLocation(t);return[(c[0]-a)/(e.width||i.offsetWidth*n),(c[1]-u)/(e.height||i.offsetHeight*n)]},getAbsolutePosition:function(t){var i=function(i){var n=t.style[i];if(n)return parseFloat(n.substring(0,n.length-2))};return[i("left"),i("top")]},setAbsolutePosition:function(t,i,n,e){n?this.animate(t,{left:"+="+(i[0]-n[0]),top:"+="+(i[1]-n[1])},e):(t.style.left=i[0]+"px",t.style.top=i[1]+"px")},getSize:function(t){return[t.offsetWidth,t.offsetHeight]},getWidth:function(t){return t.offsetWidth},getHeight:function(t){return t.offsetHeight},getRenderMode:function(){return"svg"},draggable:function(t,i){var n;return t=s.isArray(t)||null!=t.length&&!s.isString(t)?t:[t],Array.prototype.slice.call(t).forEach(function(t){(n=this.info(t)).el&&this._initDraggableIfNecessary(n.el,!0,i,n.id,!0)}.bind(this)),this},initDraggable:function(t,i,n){h(this,n).draggable(t,i),t._jsPlumbDragOptions=i},destroyDraggable:function(t,i){h(this,i).destroyDraggable(t),delete t._jsPlumbDragOptions},unbindDraggable:function(t,i,n,e){h(this,e).destroyDraggable(t,i,n)},setDraggable:function(t,i){return jsPlumb.each(t,function(t){this.isDragSupported(t)&&(this._draggableStates[this.getAttribute(t,"id")]=i,this.setElementDraggable(t,i))}.bind(this))},_draggableStates:{},toggleDraggable:function(t){var i;return jsPlumb.each(t,function(t){var n=this.getAttribute(t,"id");return this._draggableStates[n]=i=!(i=null!=this._draggableStates[n]&&this._draggableStates[n]),this.setDraggable(t,i),i}.bind(this)),i},_initDraggableIfNecessary:function(t,i,n,e,r){if(!jsPlumb.headless&&null!=i&&i&&jsPlumb.isDragSupported(t,this)){var o=n||this.Defaults.DragOptions;if(o=jsPlumb.extend({},o),jsPlumb.isAlreadyDraggable(t,this))n.force&&this.initDraggable(t,o);else{var h=jsPlumb.dragEvents.drag,u=jsPlumb.dragEvents.stop,a=jsPlumb.dragEvents.start;this.manage(e,t),o[a]=s.wrap(o[a],function(t){var i=t.el._jsPlumbDragOptions,n=!0;return i.canDrag&&(n=i.canDrag()),n&&(this.setHoverSuspended(!0),this.select({source:t.el}).addClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,!0),this.select({target:t.el}).addClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,!0),this.setConnectionBeingDragged(!0)),n}.bind(this)),o[h]=s.wrap(o[h],function(t){var i=this.getUIPosition(arguments,this.getZoom());if(null!=i){var n=t.el._jsPlumbDragOptions;this.draw(t.el,i,null,!0),n._dragging&&this.addClass(t.el,"jtk-dragged"),n._dragging=!0}}.bind(this)),o[u]=s.wrap(o[u],function(t){for(var i,n=t.selection,e=function(t){null!=t[1]&&(i=this.getUIPosition([{el:t[2].el,pos:[t[1].left,t[1].top]}]),this.draw(t[2].el,i)),delete t[0]._jsPlumbDragOptions._dragging,this.removeClass(t[0],"jtk-dragged"),this.select({source:t[2].el}).removeClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,!0),this.select({target:t[2].el}).removeClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,!0),this.getDragManager().dragEnded(t[2].el)}.bind(this),s=0;s<n.length;s++)e(n[s]);this.setHoverSuspended(!1),this.setConnectionBeingDragged(!1)}.bind(this));var c=this.getId(t);this._draggableStates[c]=!0;var l=this._draggableStates[c];o.disabled=null!=l&&!l,this.initDraggable(t,o),this.getDragManager().register(t),r&&this.fire("elementDraggable",{el:t,options:o})}}},animationSupported:!0,getElement:function(t){return null==t?null:"string"==typeof(t="string"==typeof t?t:null!=t.length&&null==t.enctype?t[0]:t)?document.getElementById(t):t},removeElement:function(t){h(this).elementRemoved(t),this.getEventManager().remove(t)},doAnimate:function(t,i,n){n=n||{};var r=this.getOffset(t),o=function(t,i){var n=function(n){if(null!=i[n]){if(s.isString(i[n])){var e=i[n].match(/-=/)?-1:1,r=i[n].substring(2);return t[n]+e*r}return i[n]}return t[n]};return[n("left"),n("top")]}(r,i),h=n.duration||250,u=h/15,a=15/h*(o[0]-r.left),c=15/h*(o[1]-r.top),l=0,f=setInterval(function(){e.setPosition(t,{left:r.left+a*(l+1),top:r.top+c*(l+1)}),null!=n.step&&n.step(l,Math.ceil(u)),++l>=u&&(window.clearInterval(f),null!=n.complete&&n.complete())},15)},destroyDroppable:function(t,i){h(this,i).destroyDroppable(t)},unbindDroppable:function(t,i,n,e){h(this,e).destroyDroppable(t,i,n)},droppable:function(t,i){var n;return t=s.isArray(t)||null!=t.length&&!s.isString(t)?t:[t],(i=i||{}).allowLoopback=!1,Array.prototype.slice.call(t).forEach(function(t){(n=this.info(t)).el&&this.initDroppable(n.el,i)}.bind(this)),this},initDroppable:function(t,i,n){h(this,n).droppable(t,i)},isAlreadyDraggable:function(t){return null!=t._katavorioDrag},isDragSupported:function(){return!0},isDropSupported:function(){return!0},isElementDraggable:function(t){return(t=e.getElement(t))._katavorioDrag&&t._katavorioDrag.isEnabled()},getDragObject:function(t){return t[0].drag.getDragElement()},getDragScope:function(t){return t._katavorioDrag&&t._katavorioDrag.scopes.join(" ")||""},getDropEvent:function(t){return t[0].e},getUIPosition:function(t){var i=t[0].el;if(null==i.offsetParent)return null;var n=t[0].finalPos||t[0].pos,e={left:n[0],top:n[1]};if(i._katavorioDrag&&i.offsetParent!==this.getContainer()){var s=this.getOffset(i.offsetParent);e.left+=s.left,e.top+=s.top}return e},setDragFilter:function(t,i,n){t._katavorioDrag&&t._katavorioDrag.setFilter(i,n)},setElementDraggable:function(t,i){(t=e.getElement(t))._katavorioDrag&&t._katavorioDrag.setEnabled(i)},setDragScope:function(t,i){t._katavorioDrag&&t._katavorioDrag.k.setDragScope(t,i)},setDropScope:function(t,i){t._katavorioDrop&&t._katavorioDrop.length>0&&t._katavorioDrop[0].k.setDropScope(t,i)},addToPosse:function(t,i){var n=Array.prototype.slice.call(arguments,1),s=h(this);e.each(t,function(t){(t=[e.getElement(t)]).push.apply(t,n),s.addToPosse.apply(s,t)})},setPosse:function(t,i){var n=Array.prototype.slice.call(arguments,1),s=h(this);e.each(t,function(t){(t=[e.getElement(t)]).push.apply(t,n),s.setPosse.apply(s,t)})},removeFromPosse:function(t,i){var n=Array.prototype.slice.call(arguments,1),s=h(this);e.each(t,function(t){(t=[e.getElement(t)]).push.apply(t,n),s.removeFromPosse.apply(s,t)})},removeFromAllPosses:function(t){var i=h(this);e.each(t,function(t){i.removeFromAllPosses(e.getElement(t))})},setPosseState:function(t,i,n){var s=h(this);e.each(t,function(t){s.setPosseState(e.getElement(t),i,n)})},dragEvents:{start:"start",stop:"stop",drag:"drag",step:"step",over:"over",out:"out",drop:"drop",complete:"complete",beforeStart:"beforeStart"},animEvents:{step:"step",complete:"complete"},stopDrag:function(t){t._katavorioDrag&&t._katavorioDrag.abort()},addToDragSelection:function(t){h(this).select(t)},removeFromDragSelection:function(t){h(this).deselect(t)},clearDragSelection:function(){h(this).deselectAll()},trigger:function(t,i,n,e){this.getEventManager().trigger(t,i,n,e)},doReset:function(){for(var t in this)0===t.indexOf("_katavorio_")&&this[t].reset()},getEventManager:function(){return(t=this._mottle)||(t=this._mottle=new n.Mottle),t;var t},on:function(t,i,n){return this.getEventManager().on.apply(this,arguments),this},off:function(t,i,n){return this.getEventManager().off.apply(this,arguments),this}}),t=e.init,(i=function(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?t():setTimeout(i,9)})()}.call("undefined"!=typeof window?window:commonjsGlobal)}),jsplumb_6=jsplumb.jsPlumb,rng;class JsPlumbUtils{}JsPlumbUtils.createInstance=(t,i)=>jsplumb_6.getInstance({ConnectionsDetachable:!i,DragOptions:{cursor:"pointer",zIndex:2e3},ConnectionOverlays:[["Arrow",{location:1,visible:!0,width:11,length:11}],["Label",{location:.5,id:"label",cssClass:"connection-label"}]],Container:t}),JsPlumbUtils.createEndpointUuid=(t,i)=>`activity-${t}-${i}`,JsPlumbUtils.getSourceEndpointOptions=(t,i,n)=>{const e=n?"#6faa44":"#999999";return{type:"Dot",anchor:"Continuous",paintStyle:{stroke:"#7da7f2",fill:"#7da7f2",strokeWidth:2},isSource:!0,connector:["Flowchart",{stub:[40,60],gap:0,cornerRadius:5,alwaysRespectStubs:!0}],connectorStyle:{strokeWidth:2,stroke:e},connectorHoverStyle:{strokeWidth:2,stroke:e},connectorOverlays:[["Label",{location:[3,-1.5],cssClass:"endpointSourceLabel"}]],hoverPaintStyle:{fill:"#7da7f2",stroke:"#7da7f2"},dragOptions:{},uuid:JsPlumbUtils.createEndpointUuid(t,i),parameters:{outcome:i},scope:null,reattachConnections:!0,maxConnections:1}};var crypto=void 0!==commonjsGlobal&&(commonjsGlobal.crypto||commonjsGlobal.msCrypto);if(crypto&&crypto.getRandomValues){var rnds8=new Uint8Array(16);rng=function(){return crypto.getRandomValues(rnds8),rnds8}}if(!rng){var rnds=new Array(16);rng=function(){for(var t,i=0;i<16;i++)0==(3&i)&&(t=4294967296*Math.random()),rnds[i]=t>>>((3&i)<<3)&255;return rnds}}for(var rngBrowser=rng,byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);function bytesToUuid(t,i){var n=i||0;return byteToHex[t[n++]]+byteToHex[t[n++]]+byteToHex[t[n++]]+byteToHex[t[n++]]+"-"+byteToHex[t[n++]]+byteToHex[t[n++]]+"-"+byteToHex[t[n++]]+byteToHex[t[n++]]+"-"+byteToHex[t[n++]]+byteToHex[t[n++]]+"-"+byteToHex[t[n++]]+byteToHex[t[n++]]+byteToHex[t[n++]]+byteToHex[t[n++]]+byteToHex[t[n++]]+byteToHex[t[n++]]}var bytesToUuid_1=bytesToUuid;function v4(t,i,n){var e=i&&n||0;"string"==typeof t&&(i="binary"==t?new Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||rngBrowser)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,i)for(var r=0;r<16;++r)i[e+r]=s[r];return i||bytesToUuid_1(s)}var v4_1=v4;function deepClone(t){const i=JSON.stringify(t);return JSON.parse(i)}class Designer{constructor(t){registerInstance(this,t),this.activityDefinitions=[],this.workflow={activities:[],connections:[]},this.lastClickedLocation=null,this.elem=()=>this.el,this.renderContextMenu=()=>this.readonly?null:[h("wf-context-menu",{target:this.elem()},h("wf-context-menu-item",{text:"Add Activity",onClick:this.onAddActivityClick})),h("wf-context-menu",{ref:t=>this.activityContextMenu=t},h("wf-context-menu-item",{text:"Edit",onClick:this.onEditActivityClick}),h("wf-context-menu-item",{text:"Delete",onClick:this.onDeleteActivityClick}))],this.deleteActivity=async t=>{const i=this.workflow.activities.filter(i=>i.id!==t.id),n=this.workflow.connections.filter(i=>i.sourceActivityId!=t.id&&i.destinationActivityId!=t.id);this.workflow=Object.assign({},this.workflow,{activities:i,connections:n})},this.setupJsPlumb=()=>{this.jsPlumb.reset(),this.setupJsPlumbEventHandlers(),this.jsPlumb.batch(()=>{this.getActivityElements().forEach(this.setupActivityElement),this.setupConnections()}),this.jsPlumb.repaintEverything()},this.setupPopovers=()=>{$('[data-toggle="popover"]').popover({})},this.setupActivityElement=t=>{this.readonly||this.setupDragDrop(t),this.setupTargets(t),this.setupOutcomes(t),this.jsPlumb.revalidate(t)},this.setupDragDrop=t=>{let i=null,n=!1;this.jsPlumb.draggable(t,{containment:"true",start:t=>{i={left:t.e.screenX,top:t.e.screenY}},stop:async e=>{if(!(n=i.left!==e.e.screenX||i.top!==e.e.screenY))return;const s=Object.assign({},this.findActivityByElement(t));s.left=e.pos[0],s.top=e.pos[1],await this.updateActivityInternal(s)}})},this.setupConnections=()=>{for(let t of this.workflow.connections){const i=JsPlumbUtils.createEndpointUuid(t.sourceActivityId,t.outcome),n=this.jsPlumb.getEndpoint(i);this.jsPlumb.connect({source:n,target:`wf-activity-${t.destinationActivityId}`})}},this.findActivityByElement=t=>{const i=Designer.getActivityId(t);return this.findActivityById(i)},this.findActivityById=t=>this.workflow.activities.find(i=>i.id===t),this.updateActivityInternal=async t=>{const i=[...this.workflow.activities],n=i.findIndex(i=>i.id==t.id);i[n]=Object.assign({},t),this.workflow=Object.assign({},this.workflow,{activities:i})},this.setupJsPlumbEventHandlers=()=>{this.jsPlumb.bind("connection",this.connectionCreated),this.jsPlumb.bind("connectionDetached",this.connectionDetached)},this.connectionCreated=async t=>{const i=t.connection,n=t.sourceEndpoint.getParameter("outcome");i.getOverlay("label").setLabel(n);const e=this.findActivityByElement(t.source),s=this.findActivityByElement(t.target);if(!this.workflow.connections.find(t=>t.sourceActivityId===e.id&&t.destinationActivityId==s.id)){const t=[...this.workflow.connections,{sourceActivityId:e.id,destinationActivityId:s.id,outcome:n}];this.workflow=Object.assign({},this.workflow,{connections:t})}},this.connectionDetached=async t=>{const i=t.sourceEndpoint.getParameter("outcome"),n=this.findActivityByElement(t.source),e=this.findActivityByElement(t.target),s=this.workflow.connections.filter(t=>!(t.sourceActivityId===n.id&&t.destinationActivityId===e.id&&t.outcome===i));this.workflow=Object.assign({},this.workflow,{connections:s})},this.onAddActivityClick=t=>{const i=this.elem();this.lastClickedLocation={left:t.pageX-i.offsetLeft,top:t.pageY-i.offsetTop},this.addActivityEvent.emit()},this.onDeleteActivityClick=async()=>{await this.deleteActivity(this.selectedActivity)},this.onEditActivityClick=()=>{this.onEditActivity(this.selectedActivity)},this.editActivityEvent=createEvent(this,"edit-activity",7),this.addActivityEvent=createEvent(this,"add-activity",7),this.workflowChanged=createEvent(this,"workflowChanged",7)}onWorkflowChanged(t){this.workflowChanged.emit(deepClone(t))}async newWorkflow(){this.workflow={activities:[],connections:[]}}async getWorkflow(){return deepClone(this.workflow)}async addActivity(t){const i=this.lastClickedLocation?this.lastClickedLocation.left:150,n=this.lastClickedLocation?this.lastClickedLocation.top:150,e={id:v4_1(),top:n,left:i,type:t.type,state:{}};this.lastClickedLocation=null;const s=[...this.workflow.activities,e];this.workflow=Object.assign({},this.workflow,{activities:s})}async updateActivity(t){await this.updateActivityInternal(t)}componentWillLoad(){this.jsPlumb=JsPlumbUtils.createInstance(".workflow-canvas",this.readonly)}componentDidRender(){this.setupJsPlumb(),this.setupPopovers()}render(){const t=this.createActivityModels();return h("host",{class:"workflow-canvas",ref:t=>this.canvas=t,style:{height:this.canvasHeight}},t.map(t=>{const i=t.activity,n={left:`${i.left}px`,top:`${i.top}px`},e={activity:!0,"activity-blocking":!!i.blocking,"activity-executed":!!i.executed,"activity-faulted":i.faulted};if(this.readonly){e.noselect=!0;const s={};return i.message&&(s["data-toggle"]="popover",s["data-trigger"]="hover",s.title=i.message.title,s["data-content"]=i.message.content),h("div",Object.assign({id:`wf-activity-${i.id}`,"data-activity-id":i.id,class:e,style:n},s),h("wf-activity-renderer",{activity:i,activityDefinition:t.definition,displayMode:ActivityDisplayMode.Design}))}return h("div",{id:`wf-activity-${i.id}`,"data-activity-id":i.id,class:e,style:n,onDblClick:()=>this.onEditActivity(i),onContextMenu:t=>this.onActivityContextMenu(t,i)},h("wf-activity-renderer",{activity:i,activityDefinition:t.definition,displayMode:ActivityDisplayMode.Design}))}),this.renderContextMenu())}createActivityModels(){const t=this.activityDefinitions||[];return(this.workflow||{activities:[],connections:[]}).activities.map(i=>{const n=t.find(t=>t.type==i.type);return{activity:i,definition:n}})}setupTargets(t){this.jsPlumb.makeTarget(t,{dropOptions:{hoverClass:"hover"},anchor:"Continuous",endpoint:["Blank",{radius:4}]})}setupOutcomes(t){const i=this.findActivityByElement(t),n=this.activityDefinitions.find(t=>t.type==i.type),e=ActivityManager$1.getOutcomes(i,n),s=i.executed;for(let n of e){const e=JsPlumbUtils.getSourceEndpointOptions(i.id,n,s);this.jsPlumb.addEndpoint(t,{connectorOverlays:[["Label",{label:n,cssClass:"connection-label"}]]},e)}}getActivityElements(){return this.elem().querySelectorAll(".activity")}static getActivityId(t){return t.attributes["data-activity-id"].value}onEditActivity(t){const i=deepClone(t);this.editActivityEvent.emit(i)}async onActivityContextMenu(t,i){this.selectedActivity=i,await this.activityContextMenu.handleContextMenuEvent(t)}get el(){return getElement(this)}static get watchers(){return{workflow:["onWorkflowChanged"]}}static get style(){return".jtk-group,.jtk-node{position:absolute}.jtk-group{overflow:visible}[jtk-group-content]{position:relative}.katavorio-clone-drag{pointer-events:none}.jtk-surface{overflow:hidden!important;position:relative;cursor:move;cursor:-moz-grab;cursor:-webkit-grab;-ms-touch-action:none;touch-action:none}.jtk-surface-panning{cursor:-moz-grabbing;cursor:-webkit-grabbing;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.jtk-surface-canvas{overflow:visible!important}.jtk-surface-droppable-node{-ms-touch-action:none;touch-action:none}.jtk-surface-nopan{overflow:scroll!important;cursor:default}.jtk-surface-tile{border:none;outline:none;margin:0;-webkit-transition:opacity .3s ease .15s;-moz-transition:opacity .3s ease .15s;-o-transition:opacity .3s ease .15s;-ms-transition:opacity .3s ease .15s;transition:opacity .3s ease .15s}.jtk-lasso{border:2px solid #3177b8;background-color:#f5f5f5;opacity:.5;display:none;z-index:20000;position:absolute}.jtk-lasso-select-defeat *{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.jtk-lasso-mask{position:fixed;z-index:20000;display:none;opacity:.5;background-color:#07234e;top:0;bottom:0;left:0;right:0}.jtk-surface-selected-element{border:2px dashed #f76258!important}.jtk-surface-pan{background-color:azure;opacity:.4;text-align:center;cursor:pointer;z-index:2;-webkit-transition:background-color .15s ease-in;-moz-transition:background-color .15s ease-in;-o-transition:background-color .15s ease-in;transition:background-color .15s ease-in}.jtk-surface-pan-bottom,.jtk-surface-pan-top{width:100%;height:20px}.jtk-surface-pan-bottom:hover,.jtk-surface-pan-left:hover,.jtk-surface-pan-right:hover,.jtk-surface-pan-top:hover{opacity:.6;background-color:#3177b8;color:#fff;font-weight:700}.jtk-surface-pan-left,.jtk-surface-pan-right{width:20px;height:100%;line-height:40}.jtk-surface-pan-active,.jtk-surface-pan-active:hover{background-color:#f76258}.jtk-miniview{overflow:hidden!important;width:125px;height:125px;position:relative;background-color:#b2c9cd;border:1px solid #e2e6cd;border-radius:4px;opacity:.8}.jtk-miniview-panner{border:5px dotted #f5f5f5;opacity:.4;background-color:#4f6f7e;cursor:move;cursor:-moz-grab;cursor:-webkit-grab}.jtk-miniview-panning{cursor:-moz-grabbing;cursor:-webkit-grabbing}.jtk-miniview-element{background-color:#607a86;position:absolute}.jtk-miniview-group-element{background:transparent;border:2px solid #607a86}.jtk-miniview-collapse{color:#f5f5f5;position:absolute;font-size:18px;top:-1px;right:3px;cursor:pointer;font-weight:700}.jtk-miniview-collapse:before{content:\"\\2012\"}.jtk-miniview-collapsed{background-color:#449ea6;border-radius:4px;height:22px;margin-right:0;padding:4px;width:21px}.jtk-miniview-collapsed .jtk-miniview-element,.jtk-miniview-collapsed .jtk-miniview-panner{visibility:hidden}.jtk-miniview-collapsed .jtk-miniview-collapse:before{content:\"+\"}.jtk-miniview-collapse:hover{color:#e4f013}.jtk-dialog-underlay{left:0;right:0;top:0;bottom:0;position:fixed;z-index:100000;opacity:.8;background-color:#ccc;display:none}.jtk-dialog-overlay{position:fixed;z-index:100001;display:none;background-color:#fff;font-family:Open Sans,sans-serif;padding:7px;-webkit-box-shadow:0 0 5px grey;box-shadow:0 0 5px grey;overflow:hidden}.jtk-dialog-overlay-x{max-height:0;transition:max-height .5s ease-in;-moz-transition:max-height .5s ease-in;-ms-transition:max-height .5s ease-in;-o-transition:max-height .5s ease-in;-webkit-transition:max-height .5s ease-in}.jtk-dialog-overlay-y{max-width:0;transition:max-width .5s ease-in;-moz-transition:max-width .5s ease-in;-ms-transition:max-width .5s ease-in;-o-transition:max-width .5s ease-in;-webkit-transition:max-width .5s ease-in}.jtk-dialog-overlay-top{top:20px}.jtk-dialog-overlay-bottom{bottom:20px}.jtk-dialog-overlay-left{left:20px}.jtk-dialog-overlay-right{right:20px}.jtk-dialog-overlay-x.jtk-dialog-overlay-visible{max-height:1000px}.jtk-dialog-overlay-y.jtk-dialog-overlay-visible{max-width:1000px}.jtk-dialog-buttons{text-align:right;margin-top:5px}.jtk-dialog-button{border:none;cursor:pointer;margin-right:5px;min-width:56px;background-color:#fff;outline:1px solid #ccc}.jtk-dialog-button:hover{color:#fff;background-color:#234b5e}.jtk-dialog-title{text-align:left;font-size:14px;margin-bottom:9px}.jtk-dialog-content{font-size:12px;text-align:left;min-width:250px;margin:0 14px}.jtk-dialog-content ul{width:100%;padding-left:0}.jtk-dialog-content label{cursor:pointer;font-weight:inherit}.jtk-dialog-overlay input,.jtk-dialog-overlay textarea{background-color:#fff;border:1px solid #ccc;color:#333;font-size:14px;font-style:normal;outline:none;padding:6px 4px;margin-right:6px}.jtk-dialog-overlay input:focus,.jtk-dialog-overlay textarea:focus{background-color:#cbeae1;border:1px solid #83b8a8;color:#333;font-size:14px;font-style:normal;outline:none}.jtk-draw-skeleton{position:absolute;left:0;right:0;top:0;bottom:0;outline:2px solid #84acb3;opacity:.8}.jtk-draw-handle{position:absolute;width:7px;height:7px;background-color:#84acb3}.jtk-draw-handle-tl{left:0;top:0;cursor:nw-resize}.jtk-draw-handle-tr{right:0;top:0;cursor:ne-resize}.jtk-draw-handle-bl{left:0;bottom:0;cursor:sw-resize}.jtk-draw-handle-br{bottom:0;right:0;cursor:se-resize}.jtk-draw-drag{display:none;position:absolute;left:50%;top:50%;margin-left:-10px;margin-top:-10px;width:20px;height:20px;background-color:#84acb3;cursor:move}.jtk-drag-select-defeat *{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.workflow-canvas{position:relative;display:block;-ms-touch-action:none;touch-action:none;width:auto;height:100vh}.workflow-canvas .noselect{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.workflow-canvas .activity{display:block;border:1px solid #ccc;-webkit-box-shadow:2px 2px 19px #aaa;box-shadow:2px 2px 19px #aaa;border-radius:.5em;opacity:.8;min-width:80px;min-height:80px;max-width:250px;text-align:left;z-index:20;position:absolute;background-color:#f1f1f1;color:#3d3d3d;font-family:helvetica,sans-serif;padding:1em;font-size:.7em;cursor:default;-webkit-transition:-webkit-box-shadow .15s ease-in;transition:-webkit-box-shadow .15s ease-in;transition:box-shadow .15s ease-in;transition:box-shadow .15s ease-in,-webkit-box-shadow .15s ease-in}.workflow-canvas .activity .activity-status{position:absolute;right:4px;bottom:4px;cursor:pointer}.workflow-canvas .activity .activity-status i{font-size:2em}.workflow-canvas .activity.activity-definition{border:1px solid #5a8fee}.workflow-canvas .activity.activity-executed{border:1px solid #6faa44;background-color:#6faa44;color:#fff}.workflow-canvas .activity.activity-executed h5,.workflow-canvas .activity.activity-executed h5 i{color:#fff}.workflow-canvas .activity.activity-blocking{border:1px solid #5a8fee;background-color:#5a8fee;color:#fff}.workflow-canvas .activity.activity-blocking h5,.workflow-canvas .activity.activity-blocking h5 i{color:#fff}.workflow-canvas .activity.activity-faulted{border:1px solid #d23c3c;background-color:#d23c3c;color:#fff}.workflow-canvas .activity.activity-faulted h5,.workflow-canvas .activity.activity-faulted h5 i{color:#fff}.jtk-connector{z-index:4}.endpointSourceLabel,.endpointTargetLabel,.jtk-endpoint{z-index:21;cursor:pointer}.endpointSourceLabel,.endpointTargetLabel{font-size:8px}.jtk-overlay{background-color:transparent}.connection-label{z-index:31;border:1px solid #ccc;padding:0 .5em;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;background-color:#fff}"}}var dragscroll=createCommonjsModule(function(t,i){!function(t){var i,n,e=window,s=document,r="mousemove",o="mouseup",h="mousedown",u="EventListener",a="add"+u,c="remove"+u,l=[],f=function(t,u){for(t=0;t<l.length;)(u=(u=l[t++]).container||u)[c](h,u.md,0),e[c](o,u.mu,0),e[c](r,u.mm,0);for(l=[].slice.call(s.getElementsByClassName("dragscroll")),t=0;t<l.length;)!function(t,u,c,l,f,v){(v=t.container||t)[a](h,v.md=function(i){t.hasAttribute("nochilddrag")&&s.elementFromPoint(i.pageX,i.pageY)!=v||(l=1,u=i.clientX,c=i.clientY,i.preventDefault())},0),e[a](o,v.mu=function(){l=0},0),e[a](r,v.mm=function(e){l&&((f=t.scroller||t).scrollLeft-=i=-u+(u=e.clientX),f.scrollTop-=n=-c+(c=e.clientY),t==s.body&&((f=s.documentElement).scrollLeft-=i,f.scrollTop-=n))},0)}(l[t++])};"complete"==s.readyState?f():e[a]("load",f,0),t.reset=f}(i)});class BooleanFieldDriver{constructor(){this.displayEditor=(t,i)=>{const n=i.name;return`<wf-boolean-field name="${n}" label="${i.label}" hint="${i.hint}" checked="${"true"===t.state[n]}"></wf-boolean-field>`},this.updateEditor=(t,i,n)=>{t.state[i.name]=n.get(i.name)}}}class ExpressionFieldDriver{constructor(){this.displayEditor=(t,i)=>{const n=i.name,e=i.label,s=t.state[n]||{expression:"",syntax:"Literal"},r=(i.options||{}).multiline||!1,o=s.expression.replace(/"/g,"&quot;");return`<wf-expression-field name="${n}" label="${e}" hint="${i.hint}" value="${o}" syntax="${s.syntax}" multiline="${r}"></wf-expression-field>`},this.updateEditor=(t,i,n)=>{const e=`${i.name}.syntax`,s=n.get(`${i.name}.expression`).toString().trim(),r=n.get(e).toString();t.state[i.name]={expression:s,syntax:r}}}}class ListFieldDriver{constructor(){this.displayEditor=(t,i)=>{const n=i.name,e=i.label,s=(t.state[n]||[]).join(", ");return`<wf-list-field name="${n}" label="${e}" hint="${i.hint}" items="${s}"></wf-list-field>`},this.updateEditor=(t,i,n)=>{const e=n.get(i.name).toString();t.state[i.name]=e.split(",").map(t=>t.trim())}}}class TextFieldDriver{constructor(){this.displayEditor=(t,i)=>{const n=i.name;return`<wf-text-field name="${n}" label="${i.label}" hint="${i.hint}" value="${t.state[n]||""}"></wf-text-field>`},this.updateEditor=(t,i,n)=>{t.state[i.name]=n.get(i.name).toString().trim()}}}class SelectFieldDriver{constructor(){this.displayEditor=(t,i)=>{const n=i.name,e=i.label,s=t.state[n]||"",r=encodeURI(JSON.stringify(i.options.items||[]));return`<wf-select-field name="${n}" label="${e}" hint="${i.hint}" data-items="${r}" value="${s}"></wf-select-field>`},this.updateEditor=(t,i,n)=>{const e=n.get(i.name).toString();t.state[i.name]=e.trim()}}}class WorkflowPluginStore{constructor(){this.plugins=[],this.add=t=>{this.plugins=[...this.plugins,t]},this.list=()=>[...this.plugins]}}const pluginStore=new WorkflowPluginStore,win=window,elsa=win.elsa||{};var OutcomeNames;elsa.pluginStore=pluginStore,win.elsa=elsa,function(t){t.Done="Done",t.True="True",t.False="False"}(OutcomeNames||(OutcomeNames={}));class ConsoleActivities{constructor(){this.getName=()=>"ConsoleActivities",this.getActivityDefinitions=()=>[this.readLine(),this.writeLine()],this.readLine=()=>({type:"ReadLine",displayName:"Read Line",description:"Read text from standard in.",runtimeDescription:"a => !!a.state.variableName ? `Read text from standard in and store into <strong>${ a.state.variableName }</strong>.` : 'Read text from standard in.'",outcomes:[OutcomeNames.Done],category:ConsoleActivities.Category,icon:"fas fa-terminal",properties:[{name:"variableName",type:"text",label:"Variable Name",hint:"The name of the variable to store the value into."}]}),this.writeLine=()=>({type:"WriteLine",displayName:"Write Line",description:"Write text to standard out.",category:ConsoleActivities.Category,icon:"fas fa-terminal",runtimeDescription:"x => !!x.state.textExpression ? `Write <strong>${ x.state.textExpression.expression }</strong> to standard out.` : x.definition.description",outcomes:[OutcomeNames.Done],properties:[{name:"textExpression",type:"expression",label:"Text",hint:"The text to write."}]})}}ConsoleActivities.Category="Console",pluginStore.add(new ConsoleActivities);class ControlFlowActivities{constructor(){this.getName=()=>"ControlFlowActivities",this.getActivityDefinitions=()=>[this.fork(),this.ifElse(),this.join(),this.switch()],this.fork=()=>({type:"Fork",displayName:"Fork",description:"Fork workflow execution into multiple branches.",category:ControlFlowActivities.Category,icon:"fas fa-code-branch fa-rotate-180",outcomes:"x => x.state.branches",properties:[{name:"branches",type:"list",label:"Branches",hint:"Enter one or more names representing branches, separated with a comma. Example: Branch 1, Branch 2"}]}),this.ifElse=()=>({type:"IfElse",displayName:"If/Else",description:"Evaluate a Boolean expression and continue execution depending on the result.",category:ControlFlowActivities.Category,runtimeDescription:"x => !!x.state.expression ? `Evaluate <strong>${ x.state.expression.expression }</strong> and continue execution depending on the result.` : x.definition.description",outcomes:[OutcomeNames.True,OutcomeNames.False],properties:[{name:"expression",type:"expression",label:"Expression",hint:"The expression to evaluate. The evaluated value will be used to switch on."}]}),this.join=()=>({type:"Join",displayName:"Join",description:"Merge workflow execution back into a single branch.",category:ControlFlowActivities.Category,icon:"fas fa-code-branch",runtimeDescription:"x => !!x.state.joinMode ? `Merge workflow execution back into a single branch using mode <strong>${ x.state.joinMode }</strong>` : x.definition.description",outcomes:[OutcomeNames.Done],properties:[{name:"joinMode",type:"text",label:"Join Mode",hint:"Either 'WaitAll' or 'WaitAny'"}]}),this.switch=()=>({type:"Switch",displayName:"Switch",description:"Switch execution based on a given expression.",category:ControlFlowActivities.Category,icon:"far fa-list-alt",runtimeDescription:"x => !!x.state.expression ? `Switch execution based on <strong>${ x.state.expression.expression }</strong>.` : x.definition.description",outcomes:"x => x.state.cases.map(c => c.toString())",properties:[{name:"expression",type:"expression",label:"Expression",hint:"The expression to evaluate. The evaluated value will be used to switch on."},{name:"cases",type:"list",label:"Cases",hint:"A comma-separated list of possible outcomes of the expression."}]})}}ControlFlowActivities.Category="Control Flow",pluginStore.add(new ControlFlowActivities);class EmailActivities{constructor(){this.getName=()=>"EmailActivities",this.getActivityDefinitions=()=>[this.sendEmail()],this.sendEmail=()=>({type:"SendEmail",displayName:"Send Email",description:"Send an email message.",category:EmailActivities.Category,icon:"far fa-envelope",outcomes:[OutcomeNames.Done],properties:[{name:"from",type:"expression",label:"From",hint:"The sender's email address"},{name:"to",type:"expression",label:"To",hint:"The recipient's email address"},{name:"subject",type:"expression",label:"Subject",hint:"The subject of the email message."},{name:"body",type:"expression",label:"Body",hint:"The body of the email message.",options:{multiline:!0}}]})}}EmailActivities.Category="Email",pluginStore.add(new EmailActivities);class HttpActivities{constructor(){this.getName=()=>"HttpActivities",this.getActivityDefinitions=()=>[this.sendHttpRequest(),this.sendHttpResponse(),this.handleHttpRequest()],this.sendHttpRequest=()=>({type:"HttpRequestAction",displayName:"Send HTTP Request",description:"Send an HTTP request.",category:HttpActivities.Category,icon:"fas fa-cloud",properties:[{name:"url",type:"text",label:"URL",hint:"The URL to send the HTTP request to."},{name:"method",type:"select",label:"Method",hint:"The HTTP method to use when making the request.",options:{items:["GET","POST","PUT","DELETE","OPTIONS","HEAD"]}},{name:"content",type:"expression",label:"Content",hint:"The HTTP content to send along with the request."},{name:"statusCodes",type:"list",label:"Status Codes",hint:"A list of possible HTTP status codes to handle, comma-separated. Example: 200, 400, 404"}],outcomes:"x => !!x.state.statusCodes ? x.state.statusCodes : []"}),this.handleHttpRequest=()=>({type:"HttpRequestEvent",displayName:"Handle HTTP Request",description:"Handle an incoming HTTP request.",category:HttpActivities.Category,icon:"fas fa-cloud",properties:[{name:"path",type:"text",label:"Path",hint:"The relative path that triggers this activity."},{name:"method",type:"select",label:"Method",hint:"The HTTP method that triggers this activity.",options:{items:["GET","POST","PUT","DELETE","OPTIONS","HEAD"]}},{name:"readContent",type:"boolean",label:"Read Content",hint:"Check if the HTTP request content body should be read and stored as part of the HTTP request model. The stored format depends on the content-type header."}],runtimeDescription:"x => !!x.state.path ? `Handle <strong>${ x.state.method } ${ x.state.path }</strong>.` : x.definition.description",outcomes:[OutcomeNames.Done]}),this.sendHttpResponse=()=>({type:"HttpResponseAction",displayName:"Send HTTP Response",description:"Send an HTTP response.",category:HttpActivities.Category,icon:"fas fa-cloud",properties:[{name:"statusCode",type:"select",label:"Status Code",hint:"The HTTP status code to write.",options:{items:[{label:"2xx",options:[200,201,202,203,204]},{label:"3xx",options:[301,302,304,307,308]},{label:"4xx",options:[400,401,402,403,404,405,409,410,412,413,415,417,418,420,428,429]}]}},{name:"content",type:"expression",label:"Content",hint:"The HTTP content to write.",options:{multiline:!0}},{name:"contentType",type:"select",label:"Content Type",hint:"The HTTP content type header to write.",options:{items:["text/plain","text/html","application/json","application/xml"]}},{name:"responseHeaders",type:"expression",label:"Response Headers",hint:"The headers to send along with the response. One 'header: value' pair per line.",options:{multiline:!0}}],runtimeDescription:"x => !!x.state.statusCode ? `Send an HTTP <strong>${ x.state.statusCode }</strong><br/><br/> ${ x.state.contentType }</strong><br/>${ !!x.state.content ? x.state.content.expression ? x.state.content.expression.substr(0,100) + '...' : '' : '' }` : x.definition.description",outcomes:[OutcomeNames.Done]})}}HttpActivities.Category="HTTP",pluginStore.add(new HttpActivities);class MassTransitActivities{constructor(){this.getName=()=>"MassTransitActivities",this.getActivityDefinitions=()=>[this.receiveMassTransitMessage(),this.sendMassTransitMessage()],this.receiveMassTransitMessage=()=>({type:"ReceiveMassTransitMessage",displayName:"Receive MassTransit Message",description:"Receive a message via MassTransit.",category:MassTransitActivities.Category,icon:"fas fa-envelope-open-text",properties:[{name:"messageType",type:"text",label:"Message Type",hint:"The assembly-qualified type name of the message to receive."}],outcomes:[OutcomeNames.Done]}),this.sendMassTransitMessage=()=>({type:"SendMassTransitMessage",displayName:"Send MassTransit Message",description:"Send a message via MassTransit.",category:MassTransitActivities.Category,icon:"fas fa-envelope",properties:[{name:"messageType",type:"text",label:"Message Type",hint:"The assembly-qualified type name of the message to send."},{name:"message",type:"expression",label:"Message",hint:"An expression that evaluates to the message to send."}],outcomes:[OutcomeNames.Done]})}}MassTransitActivities.Category="MassTransit",pluginStore.add(new MassTransitActivities);class PrimitiveActivities{constructor(){this.getName=()=>"PrimitiveActivities",this.getActivityDefinitions=()=>[this.log(),this.setVariable()],this.log=()=>({type:"Log",displayName:"Log",description:"Log a message.",category:PrimitiveActivities.Category,icon:"fas fa-feather-alt",properties:[{name:"message",type:"text",label:"Message",hint:"The text to log."},{name:"logLevel",type:"text",label:"Log Level",hint:"The log level to use."}],runtimeDescription:"x => !!x.state.message ? `Log <strong>${x.state.logLevel}: ${x.state.message}</strong>` : x.definition.description",outcomes:[OutcomeNames.Done]}),this.setVariable=()=>({type:"SetVariable",displayName:"Set Variable",description:"Set a variable on the workflow.",category:PrimitiveActivities.Category,properties:[{name:"variableName",type:"text",label:"Variable Name",hint:"The name of the variable to store the value into."},{name:"expression",type:"expression",label:"Variable Expression",hint:"An expression that evaluates to the value to store in the variable."}],runtimeDescription:"x => !!x.state.variableName ? `${x.state.expression.syntax}: <strong>${x.state.variableName}</strong> = <strong>${x.state.expression.expression}</strong>` : x.definition.description",outcomes:[OutcomeNames.Done]})}}PrimitiveActivities.Category="Primitives",pluginStore.add(new PrimitiveActivities);class TimerActivities{constructor(){this.getName=()=>"TimerActivities",this.getActivityDefinitions=()=>[this.timerEvent()],this.timerEvent=()=>({type:"TimerEvent",displayName:"Timer Event",description:"Triggers after a specified amount of time.",category:TimerActivities.Category,icon:"fas fa-hourglass-start",properties:[{name:"expression",type:"expression",label:"Timeout Expression",hint:"The amount of time to wait before this timer event is triggered. Format: 'd.HH:mm:ss'."},{name:"name",type:"text",label:"Name",hint:"Optionally provide a name for this activity. You can reference named activities from expressions."},{name:"title",type:"text",label:"Title",hint:"Optionally provide a custom title for this activity."},{name:"description",type:"text",label:"Description",hint:"Optionally provide a custom description for this activity."}],runtimeDescription:"x => !!x.state.expression ? `Triggers after <strong>${ x.state.expression.expression }</strong>` : x.definition.description",outcomes:[OutcomeNames.Done]})}}TimerActivities.Category="Timers",pluginStore.add(new TimerActivities);class DesignerHost{constructor(t){registerInstance(this,t),this.activityDefinitions=[],this.loadActivityDefinitions=()=>{const t=(this.pluginsData||"").split(/[ ,]+/).map(t=>t.trim());return pluginStore.list().filter(i=>t.indexOf(i.getName())>-1).filter(t=>!!t.getActivityDefinitions).map(t=>t.getActivityDefinitions()).reduce((t,i)=>t.concat(i),[])},this.onWorkflowChanged=t=>{this.workflowChanged.emit(t.detail)},this.initActivityDefinitions=()=>{if(this.activityDefinitions=this.loadActivityDefinitions(),this.activityDefinitionsData){const t=JSON.parse(this.activityDefinitionsData);this.activityDefinitions=[...this.activityDefinitions,...t]}},this.initFieldDrivers=()=>{DisplayManager$1.addDriver("text",new TextFieldDriver),DisplayManager$1.addDriver("expression",new ExpressionFieldDriver),DisplayManager$1.addDriver("list",new ListFieldDriver),DisplayManager$1.addDriver("boolean",new BooleanFieldDriver),DisplayManager$1.addDriver("select",new SelectFieldDriver)},this.initWorkflow=()=>{if(this.workflowData){const t=JSON.parse(this.workflowData);t.activities||(t.activities=[]),t.connections||(t.connections=[]),this.designer.workflow=t}},this.workflowChanged=createEvent(this,"workflowChanged",7)}async newWorkflow(){await this.designer.newWorkflow()}async getWorkflow(){return await this.designer.getWorkflow()}async showActivityPicker(){await this.activityPicker.show()}async export(t){await this.importExport.export(this.designer,t)}async import(){await this.importExport.import()}async onActivityPicked(t){await this.designer.addActivity(t.detail)}async onEditActivity(t){this.activityEditor.activity=t.detail,this.activityEditor.show=!0}async onAddActivity(){await this.showActivityPicker()}async onUpdateActivity(t){await this.designer.updateActivity(t.detail)}async onExportWorkflow(t){this.importExport&&await this.importExport.export(this.designer,t.detail)}async onImportWorkflow(t){this.designer.workflow=deepClone(t.detail)}componentWillLoad(){this.initActivityDefinitions(),this.initFieldDrivers()}componentDidLoad(){this.initWorkflow()}render(){const t=this.activityDefinitions;return h("host",null,h("wf-activity-picker",{activityDefinitions:t,ref:t=>this.activityPicker=t}),h("wf-activity-editor",{activityDefinitions:t,ref:t=>this.activityEditor=t}),h("wf-import-export",{ref:t=>this.importExport=t}),h("div",{class:"workflow-designer-wrapper dragscroll"},h("wf-designer",{activityDefinitions:t,ref:t=>this.designer=t,canvasHeight:this.canvasHeight,workflow:this.workflow,readonly:this.readonly,onWorkflowChanged:this.onWorkflowChanged})))}get el(){return getElement(this)}static get style(){return".workflow-designer-wrapper{height:80vh;overflow-y:auto}"}}class ExportButton{constructor(t){registerInstance(this,t),this.workflowFormats={json:{format:"json",fileExtension:".json",mimeType:"application/json",displayName:"JSON"},yaml:{format:"yaml",fileExtension:".yaml",mimeType:"application/x-yaml",displayName:"YAML"},xml:{format:"xml",fileExtension:".xml",mimeType:"application/xml",displayName:"XML"},object:{format:"object",fileExtension:".bin",mimeType:"application/binary",displayName:"Binary"}},this.getWorkflowHost=()=>this.designerHostId?document.querySelector(`#${this.designerHostId}`):null,this.handleExportClick=async(t,i)=>{t.preventDefault(),this.exportClickedEvent.emit(i);const n=this.getWorkflowHost();n&&await n.export(i)},this.exportClickedEvent=createEvent(this,"export",7)}render(){const t=this.workflowFormats;return h("div",{class:"dropdown"},h("button",{class:"btn btn-secondary dropdown-toggle",type:"button",id:"exportButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"Export"),h("div",{class:"dropdown-menu","aria-labelledby":"exportButton"},Object.keys(t).map(i=>{const n=t[i];return h("a",{class:"dropdown-item",href:"#",onClick:t=>this.handleExportClick(t,n)},n.displayName)})))}get el(){return getElement(this)}}var remedial=createCommonjsModule(function(t){!function(){var i,n,e=Function("return this")(),s="Boolean Number String Function Array Date RegExp Object".split(" "),r={};for(i in s)s.hasOwnProperty(i)&&(r["[object "+(n=s[i])+"]"]=n.toLowerCase());function o(t){return null==t?String(t):r[Object.prototype.toString.call(t)]||"object"}function h(t){var i,n;if("object"===o(t))for(i in t)if(void 0!==(n=t[i])&&"function"!==o(n))return!1;return!0}String.prototype.entityify||(String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}),String.prototype.quote||(String.prototype.quote=function(){var t,i,n=this.length,e='"';for(i=0;i<n;i+=1)if((t=this.charAt(i))>=" ")"\\"!==t&&'"'!==t||(e+="\\"),e+=t;else switch(t){case"\b":e+="\\b";break;case"\f":e+="\\f";break;case"\n":e+="\\n";break;case"\r":e+="\\r";break;case"\t":e+="\\t";break;default:t=t.charCodeAt(),e+="\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)}return e+'"'}),String.prototype.supplant||(String.prototype.supplant=function(t){return this.replace(/{([^{}]*)}/g,function(i,n){var e=t[n];return"string"==typeof e||"number"==typeof e?e:i})}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s*(\S*(?:\s+\S+)*)\s*$/,"$1")}),t.exports={typeOf:o,isEmpty:h},e.typeOf=e.typeOf||o,e.isEmpty=e.isEmpty||h}()}),json2yaml=createCommonjsModule(function(t){var i;i=remedial.typeOf,t.exports.stringify=function(t){var n,e="";return"---"+(n={undefined:function(){return"null"},null:function(){return"null"},number:function(t){return t},boolean:function(t){return t?"true":"false"},string:function(t){return JSON.stringify(t)},array:function(t){var s="";return 0===t.length?s+="[]":(e=e.replace(/$/,"  "),t.forEach(function(t){var r=n[i(t)];if(!r)throw new Error("what the crap: "+i(t));s+="\n"+e+"- "+r(t)}),e=e.replace(/  /,""),s)},object:function(t){var s="";return 0===Object.keys(t).length?s+="{}":(e=e.replace(/$/,"  "),Object.keys(t).forEach(function(r){var o=t[r],h=n[i(o)];if(void 0!==o){if(!h)throw new Error("what the crap: "+i(o));s+="\n"+e+r+": "+h(o)}}),e=e.replace(/  /,""),s)},function:function(){return"[object Function]"}})[i(t)](t)+"\n"}});class ImportExport{constructor(t){registerInstance(this,t),this.importWorkflow=()=>{const t=this.fileInput.files[0],i=new FileReader;i.onload=async()=>{const t={data:i.result,format:"json"};await this.import(t)},i.readAsText(t)},this.serialize=(t,i)=>{switch(i){case"json":return JSON.stringify(t);case"yaml":return json2yaml.stringify(t);case"xml":return JSON.stringify(t);default:return t}},this.importEvent=createEvent(this,"import-workflow",7)}async export(t,i){let n=this.blobUrl;n&&window.URL.revokeObjectURL(n);const e=this.serialize(t.workflow,i.format),s=new Blob([e],{type:i.mimeType});this.blobUrl=n=window.URL.createObjectURL(s);const r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download",`workflow.${i.fileExtension}`),document.body.appendChild(r),r.click(),document.body.removeChild(r)}async import(t){if(t){const i=JSON.parse(t.data);this.importEvent.emit(i)}else this.fileInput.click()}render(){return h("host",null,h("input",{type:"file",class:"import-button",onChange:this.importWorkflow,ref:t=>this.fileInput=t}))}get el(){return getElement(this)}static get style(){return".import-button{display:none}"}}export{ActivityEditor as wf_activity_editor,ActivityPicker as wf_activity_picker,ActivityRenderer as wf_activity_renderer,ContextMenu as wf_context_menu,ContextMenuItem as wf_context_menu_item,Designer as wf_designer,DesignerHost as wf_designer_host,ExportButton as wf_export_button,ImportExport as wf_import_export};