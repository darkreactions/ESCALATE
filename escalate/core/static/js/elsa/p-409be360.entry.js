import{r as registerInstance,c as createEvent,h,g as getElement,H as Host}from"./p-f1e6bb7b.js";var ActivityDisplayMode;!function(t){t.Design="Design",t.Edit="Edit"}(ActivityDisplayMode||(ActivityDisplayMode={}));const activityEditorCss="",ActivityEditor=class{constructor(t){registerInstance(this,t),this.submit=createEvent(this,"update-activity",7),this.activityDefinitions=[]}async onSubmit(t){t.preventDefault();const i=new FormData(t.target),n=await this.renderer.updateEditor(i);this.submit.emit(n),this.show=!1}componentDidRender(){$(this.el.querySelector(".modal")).modal(this.show?"show":"hide")}render(){const t=this.activity;if(!t)return null;const i=this.activityDefinitions.find(i=>i.type==t.type);if(i)return h("div",null,h("div",{class:"modal",tabindex:"-1",role:"dialog"},h("div",{class:"modal-dialog modal-xl",role:"document"},h("div",{class:"modal-content"},h("form",{onSubmit:t=>this.onSubmit(t)},h("div",{class:"modal-header"},h("h5",{class:"modal-title"},"Edit ",i.displayName),h("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},h("span",{"aria-hidden":"true"},"×"))),h("div",{class:"modal-body"},h("wf-activity-renderer",{activity:t,activityDefinition:i,displayMode:ActivityDisplayMode.Edit,ref:t=>this.renderer=t})),h("div",{class:"modal-footer"},h("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancel"),h("button",{type:"submit",class:"btn btn-primary"},"Save")))))));console.error(`No activity of type ${this.activity.type} exists in the library.`)}get el(){return getElement(this)}};ActivityEditor.style=activityEditorCss;const activityPickerCss="",ActivityPicker=class{constructor(t){registerInstance(this,t),this.activitySelected=createEvent(this,"activity-picked",7),this.activityDefinitions=[],this.filterText="",this.selectedCategory=null,this.onFilterTextChanged=t=>{this.filterText=t.target.value},this.selectCategory=t=>{this.selectedCategory=t},this.renderActivity=t=>h("div",{class:"card activity"},h("div",{class:"card-body"},h("h4",{class:"card-title"},h("i",{class:(t.icon||"fas fa-cog")+" mr-1"}),t.displayName),h("p",null,t.description),h("a",{href:"#",onClick:i=>{i.preventDefault(),this.selectCategory(t.category)}},h("span",{class:"badge badge-light"},t.category))),h("div",{class:"card-footer text-muted text-xs-right"},h("a",{class:"btn btn-primary btn-sm",href:"#",onClick:async i=>{i.preventDefault(),await this.onActivitySelected(t)}},"Select")))}async show(){this.isVisible=!0,$(this.modal).modal("show")}async hide(){$(this.modal).modal("hide"),this.isVisible=!1}async onActivitySelected(t){this.activitySelected.emit(t),await this.hide()}render(){const t=this.activityDefinitions,i=[null,...new Set(t.map(t=>t.category))],n=this.filterText,e=this.selectedCategory;let s=t;return e&&(s=s.filter(t=>t.category.toLowerCase()===e.toLowerCase())),n&&(s=s.filter(t=>t.displayName.toLowerCase().includes(n.toLowerCase()))),h("div",null,h("div",{class:"modal",tabindex:"-1",role:"dialog",ref:t=>this.modal=t},h("div",{class:"modal-dialog modal-lg ",role:"document"},h("div",{class:"modal-content"},h("div",{class:"modal-header"},h("h5",{class:"modal-title"},"Available Activities"),h("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},h("span",{"aria-hidden":"true"},"×"))),h("div",{class:"modal-body"},h("div",{class:"row"},h("div",{class:"col-sm-3 col-md-3 col-lg-2"},h("div",{class:"form-group"},h("input",{class:"form-control",type:"search",placeholder:"Filter","aria-label":"Filter",autofocus:!0,onKeyUp:this.onFilterTextChanged})),h("ul",{class:"nav nav-pills flex-column activity-picker-categories"},i.map(t=>h("li",{class:"nav-item"},h("a",{class:{"nav-link":!0,active:t===this.selectedCategory},href:"#","data-toggle":"pill",onClick:i=>{i.preventDefault(),this.selectCategory(t)}},t||"All"))))),h("div",{class:"col-sm-9 col-md-9 col-lg-10"},h("div",{class:"card-columns tab-content"},s.map(this.renderActivity))))),h("div",{class:"modal-footer"},h("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancel"))))))}get el(){return getElement(this)}};ActivityPicker.style=activityPickerCss;class FormUpdater{static updateEditor(t,i){const n=Object.assign({},t.state);return i.forEach((t,i)=>{n[i]=t}),Object.assign(Object.assign({},t),{state:n})}}class DefaultActivityHandler{constructor(){this.renderDesigner=(activity,definition)=>{let description=null;description=activity.state.description?activity.state.description:definition.runtimeDescription?definition.runtimeDescription:definition.description;try{const fun=eval(description);description=fun({activity,definition,state:activity.state})}catch(_a){}return{title:activity.state.title||definition.displayName,description,icon:definition.icon||"fas fa-cog"}},this.updateEditor=(t,i)=>FormUpdater.updateEditor(t,i),this.getOutcomes=(activity,definition)=>{let outcomes=[];if(definition){const lambda=definition.outcomes;if(lambda instanceof Array)outcomes=lambda;else{const value=eval(lambda);if(value instanceof Array)outcomes=value;else if(value instanceof Function)try{outcomes=value({activity,definition,state:activity.state})}catch(e){console.warn(e),outcomes=[]}}}return outcomes||[]}}}class ActivityManager{constructor(){this.addHandler=(t,i)=>{this.handlers[t]=Object.assign({},i)},this.renderDesigner=(t,i)=>{const n=this.getHandler(t.type);return n.renderDesigner?n.renderDesigner(t,i):{title:t.state.title||i.displayName,description:t.state.description||i.description,icon:i.icon||"fas fa-cog"}},this.updateEditor=(t,i)=>(this.getHandler(t.type).updateEditor||FormUpdater.updateEditor)(t,i),this.getOutcomes=(t,i)=>{const n=this.getHandler(t.type);return n.getOutcomes?n.getOutcomes(t,i):[]},this.getHandler=t=>this.handlers[t]||new DefaultActivityHandler,this.handlers={}}}const ActivityManager$1=new ActivityManager;class DisplayManager{constructor(){this.addDriver=(t,i)=>{this.drivers[t]=Object.assign({},i)},this.displayEditor=(t,i)=>{const n=this.drivers[i.type];return n?n.displayEditor(t,i):null},this.updateEditor=(t,i,n)=>{const e=this.drivers[i.type];e&&e.updateEditor(t,i,n)},this.drivers={}}}const DisplayManager$1=new DisplayManager,activityRendererCss="",ActivityRenderer=class{constructor(t){registerInstance(this,t),this.displayMode=ActivityDisplayMode.Design}render(){if(!this.activity||!this.activityDefinition)return null;switch(this.displayMode){case ActivityDisplayMode.Design:return this.renderDesigner();case ActivityDisplayMode.Edit:return this.renderEditor()}}renderDesigner(){const t=ActivityManager$1.renderDesigner(this.activity,this.activityDefinition);return h("div",null,h("h5",null,h("i",{class:t.icon+" mr-1"}),t.title),h("h6",{innerHTML:t.description}))}renderEditor(){const t=this.activity;return h(Host,null,this.activityDefinition.properties.map(i=>{const n=DisplayManager$1.displayEditor(t,i);return h("div",{class:"form-group",innerHTML:n})}))}async updateEditor(t){const i=Object.assign({},this.activity),n=this.activityDefinition.properties;for(const e of n)DisplayManager$1.updateEditor(i,e,t);return i}};ActivityRenderer.style=activityRendererCss;const contextMenuCss="",ContextMenu=class{constructor(t){registerInstance(this,t),this.contextMenuEvent=createEvent(this,"context-menu",7),this.isHidden=!0,this.position={left:0,top:0},this.onContextMenu=t=>{t.defaultPrevented||(t.preventDefault(),this.contextMenuEvent.emit(),this.position={left:t.pageX,top:t.pageY},this.isHidden=!1)},this.onContextMenuClick=()=>{this.isHidden=!0}}targetChangeHandler(t,i){i&&i.removeEventListener("contextmenu",this.onContextMenu),this.setupTarget(t)}targetSelectorChangeHandler(t){this.target=document.querySelector(t)}handleBodyClick(){this.isHidden=!0}handleContextMenu(){this.isHidden=!0}async handleContextMenuEvent(t){this.onContextMenu(t)}componentDidLoad(){this.setupTarget(this.target)}render(){return h(Host,{class:"dropdown-menu context-menu canvas-context-menu position-fixed",style:{left:this.position.left+"px",top:this.position.top+"px",display:this.isHidden?"none":"block"},onClick:this.onContextMenuClick},h("slot",null))}setupTarget(t){t&&t.addEventListener("contextmenu",this.onContextMenu,{capture:!1})}get el(){return getElement(this)}static get watchers(){return{target:["targetChangeHandler"],targetSelector:["targetSelectorChangeHandler"]}}};ContextMenu.style=contextMenuCss;const contextMenuItemCss="",ContextMenuItem=class{constructor(t){registerInstance(this,t)}render(){return h("a",{class:"dropdown-item",href:"#",onClick:t=>t.preventDefault()},this.text)}get el(){return getElement(this)}};ContextMenuItem.style=contextMenuItemCss;var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(t,i,n){return t(n={path:i,exports:{},require:function(){return commonjsRequire()}},n.exports),n.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var jsplumb=createCommonjsModule((function(t,i){(function(){void 0===Math.sgn&&(Math.sgn=function(t){return 0==t?0:t>0?1:-1});var t=function(t,i){return{x:t.x-i.x,y:t.y-i.y}},n=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},e=Math.pow(2,-65),s=function(i,e){for(var s=[],a=r(i,e),h=e.length-1,u=o(a,2*h-1,s,0),l=t(i,e[0]),f=n(l),v=0,d=0;d<u;d++){l=t(i,c(e,h,s[d],null,null));var p=n(l);p<f&&(f=p,v=s[d])}return l=t(i,e[h]),(p=n(l))<f&&(f=p,v=1),{location:v,distance:f}},r=function(i,n){for(var e=n.length-1,s=2*e-1,r=[],o=[],a=[],h=[],u=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],c=0;c<=e;c++)r[c]=t(n[c],i);for(c=0;c<=e-1;c++)o[c]=t(n[c+1],n[c]),o[c]={x:(l=o[c]).x*(f=3),y:l.y*f};for(var l,f,v,d,p=0;p<=e-1;p++)for(var m=0;m<=e;m++)a[p]||(a[p]=[]),a[p][m]=(v=o[p]).x*(d=r[m]).x+v.y*d.y;for(c=0;c<=s;c++)h[c]||(h[c]=[]),h[c].y=0,h[c].x=parseFloat(c)/s;for(var g=e,y=e-1,b=0;b<=g+y;b++){var x=Math.max(0,b-y),w=Math.min(b,g);for(c=x;c<=w;c++){var k=b-c;h[c+k].y+=a[k][c]*u[k][c]}}return h},o=function(t,i,n,e){var s,r,l=[],f=[],v=[],d=[];switch(a(t,i)){case 0:return 0;case 1:if(e>=64)return n[0]=(t[0].x+t[i].x)/2,1;if(h(t,i))return n[0]=u(t,i),1}c(t,i,.5,l,f),s=o(l,i,v,e+1),r=o(f,i,d,e+1);for(var p=0;p<s;p++)n[p]=v[p];for(p=0;p<r;p++)n[p+s]=d[p];return s+r},a=function(t,i){var n,e,s=0;n=e=Math.sgn(t[0].y);for(var r=1;r<=i;r++)(n=Math.sgn(t[r].y))!=e&&s++,e=n;return s},h=function(t,i){var n,s,r,o,a,h,u,c,l;o=t[0].y-t[i].y,a=t[i].x-t[0].x,h=t[0].x*t[i].y-t[i].x*t[0].y,c=l=0;for(var f=1;f<i;f++){var v=o*t[f].x+a*t[f].y+h;v>c?c=v:v<l&&(l=v)}return n=(1*(h-c)-0*(u=a))*(1/(0*u-1*o)),s=(1*(h-l)-0*(u=a))*(1/(0*u-1*o)),r=Math.min(n,s),Math.max(n,s)-r<e?1:0},u=function(t,i){var n=t[i].x-t[0].x,e=t[i].y-t[0].y;return 0+1/(0*n-1*e)*(n*(t[0].y-0)-e*(t[0].x-0))*1},c=function(t,i,n,e,s){for(var r=[[]],o=0;o<=i;o++)r[0][o]=t[o];for(var a=1;a<=i;a++)for(o=0;o<=i-a;o++)r[a]||(r[a]=[]),r[a][o]||(r[a][o]={}),r[a][o].x=(1-n)*r[a-1][o].x+n*r[a-1][o+1].x,r[a][o].y=(1-n)*r[a-1][o].y+n*r[a-1][o+1].y;if(null!=e)for(o=0;o<=i;o++)e[o]=r[o][0];if(null!=s)for(o=0;o<=i;o++)s[o]=r[i-o][o];return r[i][0]},l={},f=function(t,i){for(var n=function(t){var i=l[t];if(!i){var n=function(t){return function(){return t}},e=function(){return function(t){return t}},s=function(){return function(t){return 1-t}},r=function(t){return function(i){for(var n=1,e=0;e<t.length;e++)n*=t[e](i);return n}};(i=[]).push(new function(){return function(i){return Math.pow(i,t)}});for(var o=1;o<t;o++){for(var a=[new n(t)],h=0;h<t-o;h++)a.push(new e);for(h=0;h<o;h++)a.push(new s);i.push(new r(a))}i.push(new function(){return function(i){return Math.pow(1-i,t)}}),l[t]=i}return i}(t.length-1),e=0,s=0,r=0;r<t.length;r++)e+=t[r].x*n[r](i),s+=t[r].y*n[r](i);return{x:e,y:s}},v=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))},d=function(t){return t[0].x===t[1].x&&t[0].y===t[1].y},p=function(t,i,n){if(d(t))return{point:t[0],location:i};for(var e=f(t,i),s=0,r=i,o=n>0?1:-1,a=null;s<Math.abs(n);)a=f(t,r+=.005*o),s+=v(a,e),e=a;return{point:a,location:r}},m=function(t,i){var n=f(t,i),e=f(t.slice(0,t.length-1),i),s=e.y-n.y;return 0===s?1/0:Math.atan(s/(e.x-n.x))},g=function(t,i,n,e,s){var r=e-i,o=t-n,a=t*(i-e)+i*(n-t),h=function(t){return[y(t,"x"),y(t,"y")]}(s),u=x.apply(null,[r*h[0][0]+o*h[1][0],r*h[0][1]+o*h[1][1],r*h[0][2]+o*h[1][2],r*h[0][3]+o*h[1][3]+a]),c=[];if(null!=u)for(var l=0;l<3;l++){var f,v=u[l],d=Math.pow(v,2),p=Math.pow(v,3),m=[h[0][0]*p+h[0][1]*d+h[0][2]*v+h[0][3],h[1][0]*p+h[1][1]*d+h[1][2]*v+h[1][3]];f=n-t!=0?(m[0]-t)/(n-t):(m[1]-i)/(e-i),v>=0&&v<=1&&f>=0&&f<=1&&c.push(m)}return c};function y(t,i){return[3*t[1][i]-t[0][i]+-3*t[2][i]+t[3][i],3*t[0][i]-6*t[1][i]+3*t[2][i],-3*t[0][i]+3*t[1][i],t[0][i]]}function b(t){return t<0?-1:t>0?1:0}function x(t,i,n,e){var s,r,o=i/t,a=n/t,h=e/t,u=(3*a-Math.pow(o,2))/9,c=(9*o*a-27*h-2*Math.pow(o,3))/54,l=Math.pow(u,3)+Math.pow(c,2),f=[];if(l>=0)s=b(c+Math.sqrt(l))*Math.pow(Math.abs(c+Math.sqrt(l)),1/3),r=b(c-Math.sqrt(l))*Math.pow(Math.abs(c-Math.sqrt(l)),1/3),f[0]=-o/3+(s+r),f[1]=-o/3-(s+r)/2,f[2]=-o/3-(s+r)/2,0!==Math.abs(Math.sqrt(3)*(s-r)/2)&&(f[1]=-1,f[2]=-1);else{var v=Math.acos(c/Math.sqrt(-Math.pow(u,3)));f[0]=2*Math.sqrt(-u)*Math.cos(v/3)-o/3,f[1]=2*Math.sqrt(-u)*Math.cos((v+2*Math.PI)/3)-o/3,f[2]=2*Math.sqrt(-u)*Math.cos((v+4*Math.PI)/3)-o/3}for(var d=0;d<3;d++)(f[d]<0||f[d]>1)&&(f[d]=-1);return f}var w=this.jsBezier={distanceFromCurve:s,gradientAtPoint:m,gradientAtPointAlongCurveFrom:function(t,i,n){var e=p(t,i,n);return e.location>1&&(e.location=1),e.location<0&&(e.location=0),m(t,e.location)},nearestPointOnCurve:function(t,i){var n=s(t,i);return{point:c(i,i.length-1,n.location,null,null),location:n.location}},pointOnCurve:f,pointAlongCurveFrom:function(t,i,n){return p(t,i,n).point},perpendicularToCurveAt:function(t,i,n,e){var s=p(t,i,e=null==e?0:e),r=m(t,s.location),o=Math.atan(-1/r),a=n/2*Math.sin(o),h=n/2*Math.cos(o);return[{x:s.point.x+h,y:s.point.y+a},{x:s.point.x-h,y:s.point.y-a}]},locationAlongCurveFrom:function(t,i,n){return p(t,i,n).location},getLength:function(t){var i=(new Date).getTime();if(d(t))return 0;for(var n=f(t,0),e=0,s=0,r=null;s<1;)r=f(t,s+=.005),e+=v(r,n),n=r;return console.log("length",(new Date).getTime()-i),e},lineIntersection:g,boxIntersection:function(t,i,n,e,s){var r=[];return r.push.apply(r,g(t,i,t+n,i,s)),r.push.apply(r,g(t+n,i,t+n,i+e,s)),r.push.apply(r,g(t+n,i+e,t,i+e,s)),r.push.apply(r,g(t,i+e,t,i,s)),r},boundingBoxIntersection:function(t,i){var n=[];return n.push.apply(n,g(t.x,t.y,t.x+t.w,t.y,i)),n.push.apply(n,g(t.x+t.w,t.y,t.x+t.w,t.y+t.h,i)),n.push.apply(n,g(t.x+t.w,t.y+t.h,t.x,t.y+t.h,i)),n.push.apply(n,g(t.x,t.y+t.h,t.x,t.y,i)),n},version:"0.9.0"};i.jsBezier=w}).call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.Biltong={version:"0.4.0"};i.Biltong=t;var n=function(t){return"[object Array]"===Object.prototype.toString.call(t)},e=function(t,i,e){return e(t=n(t)?t:[t.x,t.y],i=n(i)?i:[i.x,i.y])},s=t.gradient=function(t,i){return e(t,i,(function(t,i){return i[0]==t[0]?i[1]>t[1]?1/0:-1/0:i[1]==t[1]?i[0]>t[0]?0:-0:(i[1]-t[1])/(i[0]-t[0])}))},r=(t.normal=function(t,i){return-1/s(t,i)},t.lineLength=function(t,i){return e(t,i,(function(t,i){return Math.sqrt(Math.pow(i[1]-t[1],2)+Math.pow(i[0]-t[0],2))}))},t.quadrant=function(t,i){return e(t,i,(function(t,i){return i[0]>t[0]||i[0]==t[0]?i[1]>t[1]?2:1:i[1]>t[1]?3:4}))}),o=(t.theta=function(t,i){return e(t,i,(function(t,i){var n=s(t,i),e=Math.atan(n),o=r(t,i);return 4!=o&&3!=o||(e+=Math.PI),e<0&&(e+=2*Math.PI),e}))},t.intersects=function(t,i){var n=t.x,e=t.x+t.w,s=t.y,r=t.y+t.h,o=i.x,a=i.x+i.w,h=i.y,u=i.y+i.h;return n<=o&&o<=e&&s<=h&&h<=r||n<=a&&a<=e&&s<=h&&h<=r||n<=o&&o<=e&&s<=u&&u<=r||n<=a&&o<=e&&s<=u&&u<=r||o<=n&&n<=a&&h<=s&&s<=u||o<=e&&e<=a&&h<=s&&s<=u||o<=n&&n<=a&&h<=r&&r<=u||o<=e&&n<=a&&h<=r&&r<=u},t.encloses=function(t,i,n){var e=t.y,s=t.y+t.h,r=i.y,o=i.y+i.h,a=function(t,i,e,s){return n?t<=i&&e>=s:t<i&&e>s};return a(t.x,i.x,t.x+t.w,i.x+i.w)&&a(e,r,s,o)},[null,[1,-1],[1,1],[-1,1],[-1,-1]]),a=[null,[-1,-1],[-1,1],[1,1],[1,-1]];t.pointOnLine=function(t,i,n){var e=s(t,i),h=r(t,i),u=n>0?o[h]:a[h],c=Math.atan(e),l=Math.abs(n*Math.sin(c))*u[1],f=Math.abs(n*Math.cos(c))*u[0];return{x:t.x+f,y:t.y+l}},t.perpendicularLineTo=function(t,i,n){var e=s(t,i),r=Math.atan(-1/e),o=n/2*Math.sin(r),a=n/2*Math.cos(r);return[{x:i.x+a,y:i.y+o},{x:i.x-a,y:i.y-o}]}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){function t(t,i,n,e,s,r,o,a){return new Touch({target:i,identifier:P(),pageX:n,pageY:e,screenX:s,screenY:r,clientX:o||s,clientY:a||r})}function n(){var t=[];return Array.prototype.push.apply(t,arguments),t.item=function(t){return this[t]},t}var e=function(t,i,n){for(var e=(n=n||t.parentNode).querySelectorAll(i),s=0;s<e.length;s++)if(e[s]===t)return!0;return!1},s=function(t){return"string"==typeof t||t.constructor===String?document.getElementById(t):t},r=function(t){return t.srcElement||t.target},o=function(t,i,n,e){if(e){if(void 0!==t.path&&t.path.indexOf)return{path:t.path,end:t.path.indexOf(n)};var s={path:[],end:-1},r=function(t){s.path.push(t),t===n?s.end=s.path.length-1:null!=t.parentNode&&r(t.parentNode)};return r(i),s}return{path:[i],end:1}},a=function(t,i){for(var n=0,e=t.length;n<e&&t[n]!=i;n++);n<t.length&&t.splice(n,1)},h=1,u=function(t,i,n){var e=h++;return t.__ta=t.__ta||{},t.__ta[i]=t.__ta[i]||{},t.__ta[i][e]=n,n.__tauid=e,e},c=function(t,i,n,s){if(null==t)return n;var a=t.split(","),h=function(s){h.__tauid=n.__tauid;var u=r(s),c=u,l=o(s,u,i,null!=t);if(-1!=l.end)for(var f=0;f<l.end;f++){c=l.path[f];for(var v=0;v<a.length;v++)e(c,a[v],i)&&n.apply(c,arguments)}};return l(n,s,h),h},l=function(t,i,n){t.__taExtra=t.__taExtra||[],t.__taExtra.push([i,n])},f=function(t,i,n,e){if(g&&b[i]){var s=c(e,t,n,b[i]);T(t,b[i],s,n)}"focus"===i&&null==t.getAttribute("tabindex")&&t.setAttribute("tabindex","1"),T(t,i,c(e,t,n,i),n)},v={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}},d=function(t,i){return function(n,s,h,u){if("contextmenu"==s&&y)f(n,s,h,u);else{if(null==n.__taTapHandler){var c=n.__taTapHandler={tap:[],dbltap:[],contextmenu:[],down:!1,taps:0,downSelectors:[]},l=function(){c.down=!1},d=function(){c.taps=0};f(n,"mousedown",(function(s){for(var a=r(s),h=o(s,a,n,null!=u),f=!1,v=0;v<h.end;v++){if(f)return;a=h.path[v];for(var p=0;p<c.downSelectors.length;p++)if(null==c.downSelectors[p]||e(a,c.downSelectors[p],n)){c.down=!0,setTimeout(l,t),setTimeout(d,i),f=!0;break}}})),f(n,"mouseup",(function(t){if(c.down){var i,s,a=r(t);c.taps++;var h=S(t);for(var u in v)if(v.hasOwnProperty(u)){var l=v[u];if(l.touches===h&&(1===l.taps||l.taps===c.taps))for(var f=0;f<c[u].length;f++){s=o(t,a,n,null!=c[u][f][1]);for(var d=0;d<s.end;d++)if(i=s.path[d],null==c[u][f][1]||e(i,c[u][f][1],n)){c[u][f][0].apply(i,[t]);break}}}}}))}n.__taTapHandler.downSelectors.push(u),n.__taTapHandler[s].push([h,u]),h.__taUnstore=function(){a(n.__taTapHandler[s],h)}}}},p=function(t,i,n,e){for(var s in n.__tamee[t])n.__tamee[t].hasOwnProperty(s)&&n.__tamee[t][s].apply(e,[i])},m=function(){var t=[];return function(i,n,s,o){if(!i.__tamee){i.__tamee={over:!1,mouseenter:[],mouseexit:[]};var a=function(n){var s=r(n);(null==o&&s==i&&!i.__tamee.over||e(s,o,i)&&(null==s.__tamee||!s.__tamee.over))&&(p("mouseenter",n,i,s),s.__tamee=s.__tamee||{},s.__tamee.over=!0,t.push(s))},h=function(n){for(var s=r(n),o=0;o<t.length;o++)s!=t[o]||e(n.relatedTarget||n.toElement,"*",s)||(s.__tamee.over=!1,t.splice(o,1),p("mouseexit",n,i,s))};T(i,"mouseover",c(o,i,a,"mouseover"),a),T(i,"mouseout",c(o,i,h,"mouseout"),h)}s.__taUnstore=function(){delete i.__tamee[n][s.__tauid]},u(i,n,s),i.__tamee[n][s.__tauid]=s}},g="ontouchstart"in document.documentElement||navigator.maxTouchPoints,y="onmousedown"in document.documentElement,b={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},x=function(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var i=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(i)&&(t=parseFloat(RegExp.$1))}return t}(),w=x>-1&&x<9,k=function(t,i){if(null==t)return[0,0];var n=C(t),e=j(n,0);return[e[i+"X"],e[i+"Y"]]},M=function(t){return null==t?[0,0]:w?[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop]:k(t,"page")},j=function(t,i){return t.item?t.item(i):t[i]},C=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},S=function(t){return C(t).length},T=function(t,i,n,e){if(u(t,i,n),e.__tauid=n.__tauid,t.addEventListener)t.addEventListener(i,n,!1);else if(t.attachEvent){var s=i+n.__tauid;t["e"+s]=n,t[s]=function(){t["e"+s]&&t["e"+s](window.event)},t.attachEvent("on"+i,t[s])}},E=function(t,i,n){null!=n&&A(t,(function(){var e=s(this);if(function(t,i,n){if(t.__ta&&t.__ta[i]&&delete t.__ta[i][n.__tauid],n.__taExtra){for(var e=0;e<n.__taExtra.length;e++)E(t,n.__taExtra[e][0],n.__taExtra[e][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(e,i,n),null!=n.__tauid)if(e.removeEventListener)e.removeEventListener(i,n,!1),g&&b[i]&&e.removeEventListener(b[i],n,!1);else if(this.detachEvent){var r=i+n.__tauid;e[r]&&e.detachEvent("on"+i,e[r]),e[r]=null,e["e"+r]=null}n.__taTouchProxy&&E(t,n.__taTouchProxy[1],n.__taTouchProxy[0])}))},A=function(t,i){if(null!=t){t="undefined"!=typeof Window&&"unknown"!=typeof t.top&&t==t.top?[t]:"string"!=typeof t&&null==t.tagName&&null!=t.length?t:"string"==typeof t?document.querySelectorAll(t):[t];for(var n=0;n<t.length;n++)i.apply(t[n])}},P=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=16*Math.random()|0;return("x"==t?i:3&i|8).toString(16)}))};this.Mottle=function(i){var e=(i=i||{}).clickThreshold||250,o=i.dblClickThreshold||450,h=new m,u=new d(e,o),c=i.smartClicks,l=function(t,i,n,e){null!=n&&A(t,(function(){var t=s(this);c&&"click"===i?function(t,i,n,e){null==t.__taSmartClicks&&(f(t,"mousedown",(function(i){t.__tad=M(i)}),e),f(t,"mouseup",(function(i){t.__tau=M(i)}),e),f(t,"click",(function(i){if(t.__tad&&t.__tau&&t.__tad[0]===t.__tau[0]&&t.__tad[1]===t.__tau[1])for(var n=0;n<t.__taSmartClicks.length;n++)t.__taSmartClicks[n].apply(r(i),[i])}),e),t.__taSmartClicks=[]),t.__taSmartClicks.push(n),n.__taUnstore=function(){a(t.__taSmartClicks,n)}}(t,0,n,e):"tap"===i||"dbltap"===i||"contextmenu"===i?u(t,i,n,e):"mouseenter"===i||"mouseexit"==i?h(t,i,n,e):f(t,i,n,e)}))};this.remove=function(t){return A(t,(function(){var t=s(this);if(t.__ta)for(var i in t.__ta)if(t.__ta.hasOwnProperty(i))for(var n in t.__ta[i])t.__ta[i].hasOwnProperty(n)&&E(t,i,t.__ta[i][n]);t.parentNode&&t.parentNode.removeChild(t)})),this},this.on=function(t,i,n,e){var s=arguments[0],r=4==arguments.length?arguments[2]:null,o=arguments[1],a=arguments[arguments.length-1];return l(s,o,a,r),this},this.off=function(t,i,n){return E(t,i,n),this},this.trigger=function(i,e,r,o){var a=y&&("undefined"==typeof MouseEvent||null==r||r.constructor===MouseEvent),h=g&&!y&&b[e]?b[e]:e,u=!(g&&!y&&b[e]),c=M(r),l=k(r,"screen"),f=function(t){return k(t,"client")}(r);return A(i,(function(){var i,v=s(this);r=r||{screenX:l[0],screenY:l[1],clientX:f[0],clientY:f[1]};var d=function(t){o&&(t.payload=o)},p={TouchEvent:function(i){var e=function(i,e,s,r,o,a,h,u){return n(t.apply(null,arguments))}(window,v,0,c[0],c[1],l[0],l[1],f[0],f[1]);(i.initTouchEvent||i.initEvent)(h,!0,!0,window,null,l[0],l[1],f[0],f[1],!1,!1,!1,!1,e,e,e,1,0)},MouseEvents:function(t){t.initMouseEvent(h,!0,!0,window,0,l[0],l[1],f[0],f[1],!1,!1,!1,!1,1,v)}};if(document.createEvent){var m=!u&&!a&&g&&b[e]?"TouchEvent":"MouseEvents";i=document.createEvent(m),p[m](i),d(i),v.dispatchEvent(i)}else document.createEventObject&&((i=document.createEventObject()).eventType=i.eventName=h,i.screenX=l[0],i.screenY=l[1],i.clientX=f[0],i.clientY=f[1],d(i),v.fireEvent("on"+h,i))})),this}},this.Mottle.consume=function(t,i){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!i&&t.preventDefault&&t.preventDefault()},this.Mottle.pageLocation=M,this.Mottle.setForceTouchEvents=function(t){g=t},this.Mottle.setForceMouseEvents=function(t){y=t},this.Mottle.version="0.8.0",i.Mottle=this.Mottle}.call("undefined"==typeof window?commonjsGlobal:window),function(){var t=function(t,i,n){return-1===t.indexOf(i)&&(n?t.unshift(i):t.push(i),!0)},n=function(t,i){var n=t.indexOf(i);-1!==n&&t.splice(n,1)},e=function(t,i){for(var n=[],e=0;e<t.length;e++)-1===i.indexOf(t[e])&&n.push(t[e]);return n},s=function(t){return null!=t&&("string"==typeof t||t.constructor===String)},r=function(t){var i=t.getBoundingClientRect(),n=document.body,e=document.documentElement,s=window.pageYOffset||e.scrollTop||n.scrollTop,r=window.pageXOffset||e.scrollLeft||n.scrollLeft,o=i.left+r-(e.clientLeft||n.clientLeft||0);return{top:Math.round(i.top+s-(e.clientTop||n.clientTop||0)),left:Math.round(o)}},o=function(t,i,n){for(var e=(n=n||t.parentNode).querySelectorAll(i),s=0;s<e.length;s++)if(e[s]===t)return!0;return!1},a=function(t,i,n){if(o(i,n,t))return i;for(var e=i.parentNode;null!=e&&e!==t;){if(o(e,n,t))return e;e=e.parentNode}},h=function(t,i,n){for(var e=null,s=i.getAttribute("katavorio-draggable"),r=null!=s?"[katavorio-draggable='"+s+"'] ":"",h=0;h<t.length;h++)if(null!=(e=a(i,n,r+t[h].selector))){if(t[h].filter){var u=o(n,t[h].filter,e);if(!0===t[h].filterExclude&&!u||u)return null}return[t[h],e]}return null},u=function(){var t=-1;if("Microsoft Internet Explorer"===navigator.appName){var i=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(i)&&(t=parseFloat(RegExp.$1))}return t}(),c=u>-1&&u<9,l=9===u,f=function(t){if(c)return[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop];var i=d(t),n=v(i,0);return l?[n.pageX||n.clientX,n.pageY||n.clientY]:[n.pageX,n.pageY]},v=function(t,i){return t.item?t.item(i):t[i]},d=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},p={delegatedDraggable:"katavorio-delegated-draggable",draggable:"katavorio-draggable",droppable:"katavorio-droppable",drag:"katavorio-drag",selected:"katavorio-drag-selected",active:"katavorio-drag-active",hover:"katavorio-drag-hover",noSelect:"katavorio-drag-no-select",ghostProxy:"katavorio-ghost-proxy",clonedDrag:"katavorio-clone-drag"},m=["stop","start","drag","drop","over","out","beforeStart"],g=function(){},y=function(){return!0},b=function(t,i,n){for(var e=0;e<t.length;e++)t[e]!=n&&i(t[e])},x=function(t,i,n,e){b(t,(function(t){t.setActive(i),i&&t.updatePosition(),n&&t.setHover(e,i)}))},w=function(t,i){if(null!=t){t=s(t)||null!=t.tagName||null==t.length?[t]:t;for(var n=0;n<t.length;n++)i.apply(t[n],[t[n]])}},k=function(t){t.stopPropagation?(t.stopPropagation(),t.preventDefault()):t.returnValue=!1},M=function(t,i,n){return!o(t.srcElement||t.target,n.getInputFilterSelector(),i)},j=function(t,i,n,e){this.params=i||{},this.el=t,this.params.addClass(this.el,this._class),this.uuid=A();var s=!0;return this.setEnabled=function(t){s=t},this.isEnabled=function(){return s},this.toggleEnabled=function(){s=!s},this.setScope=function(t){this.scopes=t?t.split(/\s+/):[e]},this.addScope=function(t){var i={};for(var n in w(this.scopes,(function(t){i[t]=!0})),w(t?t.split(/\s+/):[],(function(t){i[t]=!0})),this.scopes=[],i)this.scopes.push(n)},this.removeScope=function(t){var i={};for(var n in w(this.scopes,(function(t){i[t]=!0})),w(t?t.split(/\s+/):[],(function(t){delete i[t]})),this.scopes=[],i)this.scopes.push(n)},this.toggleScope=function(t){var i={};for(var n in w(this.scopes,(function(t){i[t]=!0})),w(t?t.split(/\s+/):[],(function(t){i[t]?delete i[t]:i[t]=!0})),this.scopes=[],i)this.scopes.push(n)},this.setScope(i.scope),this.k=i.katavorio,i.katavorio},C=function(){return!0},S=function(){return!1},T=function(t,i,n){this._class=n.draggable;var e=j.apply(this,arguments);this.rightButtonCanDrag=this.params.rightButtonCanDrag;var a,u,c,l,v,d,m=[0,0],g=null,b=null,w=[0,0],T=!1,E=[0,0],D=!1!==this.params.consumeStartEvent,O=this.el,I=this.params.clone,H=!1!==i.multipleDrop,L=!1,_=null,F=[],N=null,$=i.ghostProxyParent;if(a=!0===i.ghostProxy?C:i.ghostProxy&&"function"==typeof i.ghostProxy?i.ghostProxy:function(t,i){return!(!N||!N.useGhostProxy)&&N.useGhostProxy(t,i)},u=i.makeGhostProxy?i.makeGhostProxy:function(t){return N&&N.makeGhostProxy?N.makeGhostProxy(t):t.cloneNode(!0)},i.selector){var R=t.getAttribute("katavorio-draggable");null==R&&(R=""+(new Date).getTime(),t.setAttribute("katavorio-draggable",R)),F.push(i)}var z,G=i.snapThreshold,U=function(t,i,n,e,s){var r=i*Math.floor(t[0]/i),o=r+i,a=Math.abs(t[0]-r)<=e?r:Math.abs(o-t[0])<=e?o:t[0],h=n*Math.floor(t[1]/n),u=h+n;return[a,Math.abs(t[1]-h)<=s?h:Math.abs(u-t[1])<=s?u:t[1]]};this.posses=[],this.posseRoles={},this.toGrid=function(t){return null==this.params.grid?t:U(t,this.params.grid[0],this.params.grid[1],this.params.grid?this.params.grid[0]/2:G||5,this.params.grid?this.params.grid[1]/2:G||5)},this.snap=function(t,i){if(null!=O){t=t||(this.params.grid?this.params.grid[0]:10),i=i||(this.params.grid?this.params.grid[1]:10);var n=this.params.getPosition(O),e=U(n,t,i,this.params.grid?this.params.grid[0]/2:G,this.params.grid?this.params.grid[1]/2:G);return this.params.setPosition(O,e),e}},this.setUseGhostProxy=function(t){a=t?C:S};var B=function(t){return!1===i.allowNegative?[Math.max(0,t[0]),Math.max(0,t[1])]:t},Y=function(t){z="function"==typeof t?t:t?function(t,i,n,e){return B([Math.max(0,Math.min(n.w-e[0],t[0])),Math.max(0,Math.min(n.h-e[1],t[1]))])}.bind(this):function(t){return B(t)}}.bind(this);Y("function"==typeof this.params.constrain?this.params.constrain:this.params.constrain||this.params.containment),this.setConstrain=function(t){Y(t)};var X,W=function(t,i,n,e){return null!=N&&N.constrain&&"function"==typeof N.constrain?N.constrain(t,i,n,e):z(t,i,n,e)};this.setRevert=function(t){X=t},this.params.revert&&(X=this.params.revert);var q=function(t){return"function"==typeof t?(t._katavorioId=A(),t._katavorioId):t},J={},V=function(t){for(var i in J){var n=J[i],e=n[0](t);if(n[1]&&(e=!e),!e)return!1}return!0},K=this.setFilter=function(i,n){if(i){var e=q(i);J[e]=[function(n){var e,r=n.srcElement||n.target;return s(i)?e=o(r,i,t):"function"==typeof i&&(e=i(n,t)),e},!1!==n]}};this.addFilter=K,this.removeFilter=function(t){delete J["function"==typeof t?t._katavorioId:t]},this.clearAllFilters=function(){J={}},this.canDrag=this.params.canDrag||y;var Q,Z=[],tt=[];this.addSelector=function(t){t.selector&&F.push(t)},this.downListener=function(t){if(!t.defaultPrevented&&(this.rightButtonCanDrag||3!==t.which&&2!==t.button)&&this.isEnabled()&&this.canDrag())if(V(t)&&M(t,this.el,this.k)){if(N=null,_=null,F.length>0){var i=h(F,this.el,t.target||t.srcElement);if(null!=i&&(N=i[0],_=i[1]),null==_)return}else _=this.el;if(I)if(O=_.cloneNode(!0),this.params.addClass(O,p.clonedDrag),O.setAttribute("id",null),O.style.position="absolute",null!=this.params.parent){var s=this.params.getPosition(this.el);O.style.left=s[0]+"px",O.style.top=s[1]+"px",this.params.parent.appendChild(O)}else{var o=r(_);O.style.left=o.left+"px",O.style.top=o.top+"px",document.body.appendChild(O)}else O=_;D&&k(t),m=f(t),O&&O.parentNode&&(E=[O.parentNode.scrollLeft,O.parentNode.scrollTop]),this.params.bind(document,"mousemove",this.moveListener),this.params.bind(document,"mouseup",this.upListener),e.markSelection(this),e.markPosses(this),this.params.addClass(document.body,n.noSelect),et("beforeStart",{el:this.el,pos:g,e:t,drag:this})}else this.params.consumeFilteredEvents&&k(t)}.bind(this),this.moveListener=function(t){if(m){if(!T)if(!1!==et("start",{el:this.el,pos:g,e:t,drag:this})){if(!m)return;this.mark(!0),T=!0}else this.abort();if(m){tt.length=0;var i=f(t),n=i[0]-m[0],s=i[1]-m[1],r=this.params.ignoreZoom?1:e.getZoom();O&&O.parentNode&&(n+=O.parentNode.scrollLeft-E[0],s+=O.parentNode.scrollTop-E[1]),this.moveBy(n/=r,s/=r,t),e.updateSelection(n,s,this),e.updatePosses(n,s,this)}}}.bind(this),this.upListener=function(t){m&&(m=null,this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.params.removeClass(document.body,n.noSelect),this.unmark(t),e.unmarkSelection(this,t),e.unmarkPosses(this,t),this.stop(t),e.notifyPosseDragStop(this,t),T=!1,tt.length=0,I?(O&&O.parentNode&&O.parentNode.removeChild(O),O=null):X&&!0===X(O,this.params.getPosition(O))&&(this.params.setPosition(O,g),et("revert",O)))}.bind(this),this.getFilters=function(){return J},this.abort=function(){null!=m&&this.upListener()},this.getDragElement=function(t){return t?_||this.el:O||this.el};var it={start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]};i.events.start&&it.start.push(i.events.start),i.events.beforeStart&&it.beforeStart.push(i.events.beforeStart),i.events.stop&&it.stop.push(i.events.stop),i.events.drag&&it.drag.push(i.events.drag),i.events.revert&&it.revert.push(i.events.revert),this.on=function(t,i){it[t]&&it[t].push(i)},this.off=function(t,i){if(it[t]){for(var n=[],e=0;e<it[t].length;e++)it[t][e]!==i&&n.push(it[t][e]);it[t]=n}};var nt,et=function(t,i){var n=null;if(N&&N[t])n=N[t](i);else if(it[t])for(var e=0;e<it[t].length;e++)try{var s=it[t][e](i);null!=s&&(n=s)}catch(r){}return n};this.notifyStart=function(t){et("start",{el:this.el,pos:this.params.getPosition(O),e:t,drag:this})},this.stop=function(t,i){if(i||T){var n=[],s=e.getSelection(),r=this.params.getPosition(O);if(s.length>0)for(var o=0;o<s.length;o++){var a=this.params.getPosition(s[o].el);n.push([s[o].el,{left:a[0],top:a[1]},s[o]])}else n.push([O,{left:r[0],top:r[1]},this]);et("stop",{el:O,pos:nt||r,finalPos:r,e:t,drag:this,selection:n})}},this.mark=function(t){var i;g=this.params.getPosition(O),b=this.params.getPosition(O,!0),w=[b[0]-g[0],b[1]-g[1]],this.size=this.params.getSize(O),Z=e.getMatchingDroppables(this),x(Z,!0,!1,this),this.params.addClass(O,this.params.dragClass||n.drag),i=this.params.getConstrainingRectangle?this.params.getConstrainingRectangle(O):this.params.getSize(O.parentNode),Q={w:i[0],h:i[1]},v=0,d=0,t&&e.notifySelectionDragStart(this)},this.unmark=function(t,e){if(x(Z,!1,!0,this),L&&a(_,O)?(nt=[O.offsetLeft-v,O.offsetTop-d],O.parentNode.removeChild(O),O=_):nt=null,this.params.removeClass(O,this.params.dragClass||n.drag),Z.length=0,L=!1,!e){tt.length>0&&nt&&i.setPosition(_,nt),tt.sort(P);for(var s=0;s<tt.length&&!0!==tt[s].drop(this,t);s++);}},this.moveBy=function(t,n,e){tt.length=0;var s=this.toGrid([g[0]+t,g[1]+n]),r=W(s,O,Q,this.size);if(a(this.el,O))if(s[0]!==r[0]||s[1]!==r[1]){if(!L){var o=u(_);i.addClass(o,p.ghostProxy),$?($.appendChild(o),c=i.getPosition(_.parentNode,!0),l=i.getPosition(i.ghostProxyParent,!0),v=c[0]-l[0],d=c[1]-l[1]):_.parentNode.appendChild(o),O=o,L=!0}r=s}else L&&(O.parentNode.removeChild(O),O=_,L=!1,c=null,l=null,v=0,d=0);var h={x:r[0],y:r[1],w:this.size[0],h:this.size[1]},f={x:h.x+w[0],y:h.y+w[1],w:h.w,h:h.h},m=null;this.params.setPosition(O,[r[0]+v,r[1]+d]);for(var y=0;y<Z.length;y++)this.params.intersects(f,{x:Z[y].pagePosition[0],y:Z[y].pagePosition[1],w:Z[y].size[0],h:Z[y].size[1]})&&(H||null==m||m===Z[y].el)&&Z[y].canDrop(this)?(m||(m=Z[y].el),tt.push(Z[y]),Z[y].setHover(this,!0,e)):Z[y].isHover()&&Z[y].setHover(this,!1,e);et("drag",{el:this.el,pos:r,e,drag:this})},this.destroy=function(){this.params.unbind(this.el,"mousedown",this.downListener),this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null},this.params.bind(this.el,"mousedown",this.downListener),this.params.handle?K(this.params.handle,!1):K(this.params.filter,this.params.filterExclude)},E=function(t,i,n){this._class=n.droppable,this.params=i||{},this.rank=i.rank||0,this._activeClass=this.params.activeClass||n.active,this._hoverClass=this.params.hoverClass||n.hover,j.apply(this,arguments);var e=!1;this.allowLoopback=!1!==this.params.allowLoopback,this.setActive=function(t){this.params[t?"addClass":"removeClass"](this.el,this._activeClass)},this.updatePosition=function(){this.position=this.params.getPosition(this.el),this.pagePosition=this.params.getPosition(this.el,!0),this.size=this.params.getSize(this.el)},this.canDrop=this.params.canDrop||function(){return!0},this.isHover=function(){return e},this.setHover=function(t,i,n){(i||null==this.el._katavorioDragHover||this.el._katavorioDragHover===t.el._katavorio)&&(this.params[i?"addClass":"removeClass"](this.el,this._hoverClass),this.el._katavorioDragHover=i?t.el._katavorio:null,e!==i&&this.params.events[i?"over":"out"]({el:this.el,e:n,drag:t,drop:this}),e=i)},this.drop=function(t,i){return this.params.events.drop({drag:t,e:i,drop:this})},this.destroy=function(){this._class=null,this._activeClass=null,this._hoverClass=null,e=null}},A=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=16*Math.random()|0;return("x"===t?i:3&i|8).toString(16)}))},P=function(t,i){return t.rank<i.rank?1:t.rank>i.rank?-1:0},D=function(t){return null==t||null==(t="string"==typeof t||t.constructor===String?document.getElementById(t):t)?null:(t._katavorio=t._katavorio||A(),t)};this.Katavorio=function(i){var r=[],o={};this._dragsByScope={},this._dropsByScope={};var a=1,h=function(t,i){w(t,(function(t){for(var n=0;n<t.scopes.length;n++)i[t.scopes[n]]=i[t.scopes[n]]||[],i[t.scopes[n]].push(t)}))},u=function(t,n){var e=0;return w(t,(function(t){for(var s=0;s<t.scopes.length;s++)if(n[t.scopes[s]]){var r=i.indexOf(n[t.scopes[s]],t);-1!==r&&(n[t.scopes[s]].splice(r,1),e++)}})),e>0},c=(this.getMatchingDroppables=function(t){for(var i=[],n={},e=0;e<t.scopes.length;e++){var s=this._dropsByScope[t.scopes[e]];if(s)for(var r=0;r<s.length;r++)!s[r].canDrop(t)||n[s[r].uuid]||!s[r].allowLoopback&&s[r].el===t.el||(n[s[r].uuid]=!0,i.push(s[r]))}return i.sort(P),i},function(t){t=t||{};var n,e={events:{}};for(n in i)e[n]=i[n];for(n in t)e[n]=t[n];for(n=0;n<m.length;n++)e.events[m[n]]=t[m[n]]||g;return e.katavorio=this,e}.bind(this)),l=function(t,i){for(var n=0;n<m.length;n++)i[m[n]]&&t.on(m[n],i[m[n]])}.bind(this),f={},v=i.css||{},d=i.scope||"katavorio-drag-scope";for(var y in p)f[y]=p[y];for(var y in v)f[y]=v[y];var x=i.inputFilterSelector||"input,textarea,select,button,option";this.getInputFilterSelector=function(){return x},this.setInputFilterSelector=function(t){return x=t,this},this.draggable=function(t,n){var e=[];return w(t,function(t){if(null!=(t=D(t)))if(null==t._katavorioDrag){var s=c(n);t._katavorioDrag=new T(t,s,f,d),h(t._katavorioDrag,this._dragsByScope),e.push(t._katavorioDrag),i.addClass(t,s.selector?f.delegatedDraggable:f.draggable)}else l(t._katavorioDrag,n)}.bind(this)),e},this.droppable=function(t,n){var e=[];return w(t,function(t){if(null!=(t=D(t))){var s=new E(t,c(n),f,d);t._katavorioDrop=t._katavorioDrop||[],t._katavorioDrop.push(s),h(s,this._dropsByScope),e.push(s),i.addClass(t,f.droppable)}}.bind(this)),e},this.select=function(t){return w(t,(function(){var t=D(this);t&&t._katavorioDrag&&(o[t._katavorio]||(r.push(t._katavorioDrag),o[t._katavorio]=[t,r.length-1],i.addClass(t,f.selected)))})),this},this.deselect=function(t){return w(t,(function(){var t=D(this);if(t&&t._katavorio&&o[t._katavorio]){for(var n=[],e=0;e<r.length;e++)r[e].el!==t&&n.push(r[e]);r=n,delete o[t._katavorio],i.removeClass(t,f.selected)}})),this},this.deselectAll=function(){for(var t in o)i.removeClass(o[t][0],f.selected);r.length=0,o={}},this.markSelection=function(t){b(r,(function(t){t.mark()}),t)},this.markPosses=function(t){t.posses&&w(t.posses,(function(i){t.posseRoles[i]&&S[i]&&b(S[i].members,(function(t){t.mark()}),t)}))},this.unmarkSelection=function(t,i){b(r,(function(t){t.unmark(i)}),t)},this.unmarkPosses=function(t,i){t.posses&&w(t.posses,(function(n){t.posseRoles[n]&&S[n]&&b(S[n].members,(function(t){t.unmark(i,!0)}),t)}))},this.getSelection=function(){return r.slice(0)},this.updateSelection=function(t,i,n){b(r,(function(n){n.moveBy(t,i)}),n)};var k=function(t,i){i.posses&&w(i.posses,(function(n){i.posseRoles[n]&&S[n]&&b(S[n].members,(function(i){t(i)}),i)}))};this.updatePosses=function(t,i,n){k((function(n){n.moveBy(t,i)}),n)},this.notifyPosseDragStop=function(t,i){k((function(t){t.stop(i,!0)}),t)},this.notifySelectionDragStop=function(t,i){b(r,(function(t){t.stop(i,!0)}),t)},this.notifySelectionDragStart=function(t,i){b(r,(function(t){t.notifyStart(i)}),t)},this.setZoom=function(t){a=t},this.getZoom=function(){return a};var M=function(t,i,n,e){w(t,(function(t){u(t,n),t[e](i),h(t,n)}))};w(["set","add","remove","toggle"],function(t){this[t+"Scope"]=function(i,n){M(i._katavorioDrag,n,this._dragsByScope,t+"Scope"),M(i._katavorioDrop,n,this._dropsByScope,t+"Scope")}.bind(this),this[t+"DragScope"]=function(i,n){M(i.constructor===T?i:i._katavorioDrag,n,this._dragsByScope,t+"Scope")}.bind(this),this[t+"DropScope"]=function(i,n){M(i.constructor===E?i:i._katavorioDrop,n,this._dropsByScope,t+"Scope")}.bind(this)}.bind(this)),this.snapToGrid=function(t,i){for(var n in this._dragsByScope)b(this._dragsByScope[n],(function(n){n.snap(t,i)}))},this.getDragsForScope=function(t){return this._dragsByScope[t]},this.getDropsForScope=function(t){return this._dropsByScope[t]};var j=function(t,i,n){if((t=D(t))[i]){var e=r.indexOf(t[i]);e>=0&&r.splice(e,1),u(t[i],n)&&w(t[i],(function(t){t.destroy()})),delete t[i]}},C=function(t,i,n,e){(t=D(t))[i]&&t[i].off(n,e)};this.elementRemoved=function(t){t._katavorioDrag&&this.destroyDraggable(t),t._katavorioDrop&&this.destroyDroppable(t)},this.destroyDraggable=function(t,i,n){1===arguments.length?j(t,"_katavorioDrag",this._dragsByScope):C(t,"_katavorioDrag",i,n)},this.destroyDroppable=function(t,i,n){1===arguments.length?j(t,"_katavorioDrop",this._dropsByScope):C(t,"_katavorioDrop",i,n)},this.reset=function(){this._dragsByScope={},this._dropsByScope={},r=[],o={},S={}};var S={},A=function(i,n,e){var r,o=s(n)?n:n.id,a=!!s(n)||!1!==n.active,h=S[o]||(S[o]=r={name:o,members:[]},r);return w(i,(function(i){if(i._katavorioDrag){if(e&&null!=i._katavorioDrag.posseRoles[h.name])return;t(h.members,i._katavorioDrag),t(i._katavorioDrag.posses,h.name),i._katavorioDrag.posseRoles[h.name]=a}})),h};this.addToPosse=function(t,i){for(var n=[],e=1;e<arguments.length;e++)n.push(A(t,arguments[e]));return 1===n.length?n[0]:n},this.setPosse=function(t,i){for(var n=[],s=1;s<arguments.length;s++)n.push(A(t,arguments[s],!0).name);return w(t,function(t){if(t._katavorioDrag){var i=e(t._katavorioDrag.posses,n);Array.prototype.push.apply([],t._katavorioDrag.posses);for(var s=0;s<i.length;s++)this.removeFromPosse(t,i[s])}}.bind(this)),1===n.length?n[0]:n},this.removeFromPosse=function(t,i){if(arguments.length<2)throw new TypeError("No posse id provided for remove operation");for(var e=1;e<arguments.length;e++)i=arguments[e],w(t,(function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var e=t._katavorioDrag;w(i,(function(t){n(S[t].members,e),n(e.posses,t),delete e.posseRoles[t]}))}}))},this.removeFromAllPosses=function(t){w(t,(function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var i=t._katavorioDrag;w(i.posses,(function(t){n(S[t].members,i)})),i.posses.length=0,i.posseRoles={}}}))},this.setPosseState=function(t,i,n){var e=S[i];e&&w(t,(function(t){t._katavorioDrag&&t._katavorioDrag.posses&&(t._katavorioDrag.posseRoles[e.name]=n)}))}},this.Katavorio.version="1.0.0",i.Katavorio=this.Katavorio}.call("undefined"!=typeof window?window:commonjsGlobal),function(){this.jsPlumbUtil=this.jsPlumbUtil||{};var t=this.jsPlumbUtil;function n(t){return"[object Array]"===Object.prototype.toString.call(t)}function e(t){return"string"==typeof t}function s(t){return"boolean"==typeof t}function r(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)}function o(t){return"[object Date]"===Object.prototype.toString.call(t)}function a(t){return"[object Function]"===Object.prototype.toString.call(t)}function h(t){if(e(t))return""+t;if(s(t))return!!t;if(o(t))return new Date(t.getTime());if(a(t))return t;if(n(t)){for(var i=[],u=0;u<t.length;u++)i.push(h(t[u]));return i}if(r(t)){var c={};for(var l in t)c[l]=h(t[l]);return c}return t}function u(t,i,o,a){var u,c,l={},f={};for(o=o||[],a=a||[],c=0;c<o.length;c++)l[o[c]]=!0;for(c=0;c<a.length;c++)f[a[c]]=!0;var v=h(t);for(c in i)if(null==v[c]||f[c])v[c]=i[c];else if(e(i[c])||s(i[c]))l[c]?((u=[]).push.apply(u,n(v[c])?v[c]:[v[c]]),u.push.apply(u,s(i[c])?i[c]:[i[c]]),v[c]=u):v[c]=i[c];else if(n(i[c]))u=[],n(v[c])&&u.push.apply(u,v[c]),u.push.apply(u,i[c]),v[c]=u;else if(r(i[c]))for(var d in r(v[c])||(v[c]={}),i[c])v[c][d]=i[c][d];return v}function c(t,i){if(t)for(var n=0;n<t.length;n++)if(i(t[n]))return n;return-1}function l(t,i){var n=t.indexOf(i);return n>-1&&t.splice(n,1),-1!==n}function f(t,i,n,e){var s=t[i];return null==s&&(t[i]=s=[]),s[e?"unshift":"push"](n),s}i.jsPlumbUtil=t,t.isArray=n,t.isNumber=function(t){return"[object Number]"===Object.prototype.toString.call(t)},t.isString=e,t.isBoolean=s,t.isNull=function(t){return null==t},t.isObject=r,t.isDate=o,t.isFunction=a,t.isNamedFunction=function(t){return a(t)&&null!=t.name&&t.name.length>0},t.isEmpty=function(t){for(var i in t)if(t.hasOwnProperty(i))return!1;return!0},t.clone=h,t.merge=u,t.replace=function(t,i,n){if(null!=t){var e=t;return i.replace(/([^\.])+/g,(function(t,i,s,r){var o=t.match(/([^\[0-9]+){1}(\[)([0-9+])/),a=function(){return e[o[1]]||(e[o[1]]=[],e[o[1]])};if(s+t.length>=r.length)o?a()[o[3]]=n:e[t]=n;else if(o){var h=a();e=h[o[3]]||(h[o[3]]={},h[o[3]])}else e=e[t]||(e[t]={},e[t]);return""})),t}},t.functionChain=function(t,i,n){for(var e=0;e<n.length;e++){var s=n[e][0][n[e][1]].apply(n[e][0],n[e][2]);if(s===i)return s}return t},t.populate=function(t,i,s,o){var h=function(t){if(null!=t){if(e(t))return function(t){var n=t.match(/(\${.*?})/g);if(null!=n)for(var e=0;e<n.length;e++){var s=i[n[e].substring(2,n[e].length-1)]||"";null!=s&&(t=t.replace(n[e],s))}return t}(t);if(!a(t)||o||null!=s&&0!==(t.name||"").indexOf(s)){if(n(t)){for(var u=[],c=0;c<t.length;c++)u.push(h(t[c]));return u}if(r(t)){var l={};for(var f in t)l[f]=h(t[f]);return l}return t}return t(i)}};return h(t)},t.findWithFunction=c,t.removeWithFunction=function(t,i){var n=c(t,i);return n>-1&&t.splice(n,1),-1!==n},t.remove=l,t.addWithFunction=function(t,i,n){-1===c(t,n)&&t.push(i)},t.addToList=f,t.suggest=function(t,i,n){return-1===t.indexOf(i)&&(n?t.unshift(i):t.push(i),!0)},t.extend=function(t,i,e){var s;i=n(i)?i:[i];var r=function(i){for(var n=i.__proto__;null!=n;)if(null!=n.prototype){for(var e in n.prototype)n.prototype.hasOwnProperty(e)&&!t.prototype.hasOwnProperty(e)&&(t.prototype[e]=n.prototype[e]);n=n.prototype.__proto__}else n=null};for(s=0;s<i.length;s++){for(var o in i[s].prototype)i[s].prototype.hasOwnProperty(o)&&!t.prototype.hasOwnProperty(o)&&(t.prototype[o]=i[s].prototype[o]);r(i[s])}var a=function(t,n){return function(){for(s=0;s<i.length;s++)i[s].prototype[t]&&i[s].prototype[t].apply(this,arguments);return n.apply(this,arguments)}},h=function(i){for(var n in i)t.prototype[n]=a(n,i[n])};if(arguments.length>2)for(s=2;s<arguments.length;s++)h(arguments[s]);return t};for(var v=[],d=0;d<256;d++)v[d]=(d<16?"0":"")+d.toString(16);function p(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,e=4294967295*Math.random()|0;return v[255&t]+v[t>>8&255]+v[t>>16&255]+v[t>>24&255]+"-"+v[255&i]+v[i>>8&255]+"-"+v[i>>16&15|64]+v[i>>24&255]+"-"+v[63&n|128]+v[n>>8&255]+"-"+v[n>>16&255]+v[n>>24&255]+v[255&e]+v[e>>8&255]+v[e>>16&255]+v[e>>24&255]}function m(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];if(t.logEnabled&&"undefined"!=typeof console)try{var e=arguments[arguments.length-1];console.log(e)}catch(s){}}function g(t,i,n){var e=[t[0]-i[0],t[1]-i[1]],s=Math.cos(n/360*Math.PI*2),r=Math.sin(n/360*Math.PI*2);return[e[0]*s-e[1]*r+i[0],e[1]*s+e[0]*r+i[1],s,r]}t.uuid=p,t.fastTrim=function(t){if(null==t)return null;for(var i=t.replace(/^\s\s*/,""),n=/\s/,e=i.length;n.test(i.charAt(--e)););return i.slice(0,e+1)},t.each=function(t,i){t=null==t.length||"string"==typeof t?[t]:t;for(var n=0;n<t.length;n++)i(t[n])},t.map=function(t,i){for(var n=[],e=0;e<t.length;e++)n.push(i(t[e]));return n},t.mergeWithParents=function(t,i,n){n=n||"parent";var e=function(t){return t?i[t]:null},s=function(t){return t?e(t[n]):null},r=function(t,i){if(null==t)return i;var n=["anchor","anchors","cssClass","connector","paintStyle","hoverPaintStyle","endpoint","endpoints"];"override"===i.mergeStrategy&&Array.prototype.push.apply(n,["events","overlays"]);var e=u(t,i,[],n);return r(s(t),e)},o=function(t){if(null==t)return{};if("string"==typeof t)return e(t);if(t.length){for(var i=!1,n=0,s=void 0;!i&&n<t.length;)(s=o(t[n]))?i=!0:n++;return s}},a=o(t);return a?r(s(a),a):{}},t.logEnabled=!0,t.log=m,t.wrap=function(t,i,n){return function(){var e=null;try{null!=i&&(e=i.apply(this,arguments))}catch(s){m("jsPlumb function failed : "+s)}if(null!=t&&(null==n||e!==n))try{e=t.apply(this,arguments)}catch(s){m("wrapped function failed : "+s)}return e}},t.EventGenerator=function(){var t=this;this._listeners={},this.eventsSuspended=!1,this.tick=!1,this.eventsToDieOn={ready:!0},this.queue=[],this.bind=function(i,n,e){var s=function(i){f(t._listeners,i,n,e),n.__jsPlumb=n.__jsPlumb||{},n.__jsPlumb[p()]=i};if("string"==typeof i)s(i);else if(null!=i.length)for(var r=0;r<i.length;r++)s(i[r]);return t},this.fire=function(t,i,n){if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[t]){var e=this._listeners[t].length,s=0,r=!1,o=null;if(!this.shouldFireEvent||this.shouldFireEvent(t,i,n))for(;!r&&s<e&&!1!==o;){if(this.eventsToDieOn[t])this._listeners[t][s].apply(this,[i,n]);else try{o=this._listeners[t][s].apply(this,[i,n])}catch(a){m("jsPlumb: fire failed for event "+t+" : "+a)}s++,null!=this._listeners&&null!=this._listeners[t]||(r=!0)}}this.tick=!1,this._drain()}return this},this._drain=function(){var i=t.queue.pop();i&&t.fire.apply(t,i)},this.unbind=function(t,i){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof t)delete this._listeners[t];else if(t.__jsPlumb)for(var n in t.__jsPlumb)l(this._listeners[t.__jsPlumb[n]]||[],t)}else 2===arguments.length&&l(this._listeners[t]||[],i);return this},this.getListener=function(i){return t._listeners[i]},this.setSuspendEvents=function(i){t.eventsSuspended=i},this.isSuspendEvents=function(){return t.eventsSuspended},this.silently=function(i){t.setSuspendEvents(!0);try{i()}catch(n){m("Cannot execute silent function "+n)}t.setSuspendEvents(!1)},this.cleanupListeners=function(){for(var i in t._listeners)t._listeners[i]=null}},t.rotatePoint=g,t.rotateAnchorOrientation=function(t,i){var n=g(t,[0,0],i);return[Math.round(n[0]),Math.round(n[1])]}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){this.jsPlumbUtil.matchesSelector=function(t,i,n){for(var e=(n=n||t.parentNode).querySelectorAll(i),s=0;s<e.length;s++)if(e[s]===t)return!0;return!1},this.jsPlumbUtil.consume=function(t,i){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!i&&t.preventDefault&&t.preventDefault()},this.jsPlumbUtil.sizeElement=function(t,i,n,e,s){t&&(t.style.height=s+"px",t.height=s,t.style.width=e+"px",t.width=e,t.style.left=i+"px",t.style.top=n+"px")}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t={deriveAnchor:function(t,i){return{top:["TopRight","TopLeft"],bottom:["BottomRight","BottomLeft"]}[t][i]}},i=function(t,i){this.count=0,this.instance=t,this.lists={},this.options=i||{},this.instance.addList=function(t,i){return this.listManager.addList(t,i)},this.instance.removeList=function(t){this.listManager.removeList(t)},this.instance.bind("manageElement",function(t){for(var i=this.instance.getSelector(t.el,"[jtk-scrollable-list]"),n=0;n<i.length;n++)this.addList(i[n])}.bind(this)),this.instance.bind("unmanageElement",(function(t){this.removeList(t.el)})),this.instance.bind("connection",function(t,i){null==i&&(this._maybeUpdateParentList(t.source),this._maybeUpdateParentList(t.target))}.bind(this))};this.jsPlumbListManager=i,i.prototype={addList:function(i,e){var s=this.instance.extend({},t);this.instance.extend(s,this.options),e=this.instance.extend(s,e||{});var r=[this.instance.getInstanceIndex(),this.count++].join("_");this.lists[r]=new n(this.instance,i,e,r)},removeList:function(t){var i=this.lists[t._jsPlumbList];i&&(i.destroy(),delete this.lists[t._jsPlumbList])},_maybeUpdateParentList:function(t){for(var i=t.parentNode,n=this.instance.getContainer();null!=i&&i!==n;){if(null!=i._jsPlumbList&&null!=this.lists[i._jsPlumbList])return void i._jsPlumbScrollHandler();i=i.parentNode}}};var n=function(t,i,n,e){function s(t,i,e,s){return n.anchor?n.anchor:n.deriveAnchor(t,i,e,s)}function r(t,i,e,s){return n.deriveEndpoint?n.deriveEndpoint(t,i,e,s):n.endpoint?n.endpoint:e.type}i._jsPlumbList=e;var o=function(){for(var n=t.getSelector(i,".jtk-managed"),e=t.getId(i),o=0;o<n.length;o++){if(n[o].offsetTop<i.scrollTop)n[o]._jsPlumbProxies||(n[o]._jsPlumbProxies=n[o]._jsPlumbProxies||[],t.select({source:n[o]}).each((function(a){t.proxyConnection(a,0,i,e,(function(){return r("top",0,a.endpoints[0],a)}),(function(){return s("top",0,a.endpoints[0],a)})),n[o]._jsPlumbProxies.push([a,0])})),t.select({target:n[o]}).each((function(a){t.proxyConnection(a,1,i,e,(function(){return r("top",1,a.endpoints[1],a)}),(function(){return s("top",1,a.endpoints[1],a)})),n[o]._jsPlumbProxies.push([a,1])})));else if(n[o].offsetTop+n[o].offsetHeight>i.scrollTop+i.offsetHeight)n[o]._jsPlumbProxies||(n[o]._jsPlumbProxies=n[o]._jsPlumbProxies||[],t.select({source:n[o]}).each((function(a){t.proxyConnection(a,0,i,e,(function(){return r("bottom",0,a.endpoints[0],a)}),(function(){return s("bottom",0,a.endpoints[0],a)})),n[o]._jsPlumbProxies.push([a,0])})),t.select({target:n[o]}).each((function(a){t.proxyConnection(a,1,i,e,(function(){return r("bottom",1,a.endpoints[1],a)}),(function(){return s("bottom",1,a.endpoints[1],a)})),n[o]._jsPlumbProxies.push([a,1])})));else if(n[o]._jsPlumbProxies){for(var a=0;a<n[o]._jsPlumbProxies.length;a++)t.unproxyConnection(n[o]._jsPlumbProxies[a][0],n[o]._jsPlumbProxies[a][1],e);delete n[o]._jsPlumbProxies}t.revalidate(n[o])}!function(i){for(var n=i.parentNode,e=t.getContainer();null!=n&&n!==e;){if(t.hasClass(n,"jtk-managed"))return void t.recalculateOffsets(n);n=n.parentNode}}(i)};t.setAttribute(i,"jtk-scrollable-list","true"),i._jsPlumbScrollHandler=o,t.on(i,"scroll",o),o(),this.destroy=function(){t.off(i,"scroll",o),delete i._jsPlumbScrollHandler;for(var n=t.getSelector(i,".jtk-managed"),e=t.getId(i),s=0;s<n.length;s++)if(n[s]._jsPlumbProxies){for(var r=0;r<n[s]._jsPlumbProxies.length;r++)t.unproxyConnection(n[s]._jsPlumbProxies[r][0],n[s]._jsPlumbProxies[r][1],e);delete n[s]._jsPlumbProxies}}}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,n=t.jsPlumbUtil,e=function(t){if(t._jsPlumb.paintStyle&&t._jsPlumb.hoverPaintStyle){var i={};f.extend(i,t._jsPlumb.paintStyle),f.extend(i,t._jsPlumb.hoverPaintStyle),delete t._jsPlumb.hoverPaintStyle,i.gradient&&t._jsPlumb.paintStyle.fill&&delete i.gradient,t._jsPlumb.hoverPaintStyle=i}},s=["tap","dbltap","click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu"],r=function(t){return null==t?null:t.split(" ")},o=function(t,i,n){for(var e in i)t[e]=n},a=function(t,i,e){if(t.getDefaultType){var s=t.getTypeDescriptor(),r={},a=t.getDefaultType(),h=n.merge({},a);o(r,a,"__default");for(var u=0,c=t._jsPlumb.types.length;u<c;u++){var l=t._jsPlumb.types[u];if("__default"!==l){var f=t._jsPlumb.instance.getType(l,s);if(null!=f){var v=["anchor","anchors","connector","paintStyle","hoverPaintStyle","endpoint","endpoints","connectorOverlays","connectorStyle","connectorHoverStyle","endpointStyle","endpointHoverStyle"],d=[];"override"===f.mergeStrategy?Array.prototype.push.apply(v,["events","overlays","cssClass"]):d.push("cssClass"),h=n.merge(h,f,d,v),o(r,f,l)}}}i&&(h=n.populate(h,i,"_")),t.applyType(h,e,r),e||t.repaint()}},h=t.jsPlumbUIComponent=function(t){n.EventGenerator.apply(this,arguments);var i=this,e=arguments,s=i.idPrefix,r=s+(new Date).getTime();this._jsPlumb={instance:t._jsPlumb,parameters:t.parameters||{},paintStyle:null,hoverPaintStyle:null,paintStyleInUse:null,hover:!1,beforeDetach:t.beforeDetach,beforeDrop:t.beforeDrop,overlayPlacements:[],hoverClass:t.hoverClass||t._jsPlumb.Defaults.HoverClass,types:[],typeCache:{}},this.cacheTypeItem=function(t,i,n){this._jsPlumb.typeCache[n]=this._jsPlumb.typeCache[n]||{},this._jsPlumb.typeCache[n][t]=i},this.getCachedTypeItem=function(t,i){return this._jsPlumb.typeCache[i]?this._jsPlumb.typeCache[i][t]:null},this.getId=function(){return r};var o=t.overlays||[],a={};if(this.defaultOverlayKeys){for(var h=0;h<this.defaultOverlayKeys.length;h++)Array.prototype.push.apply(o,this._jsPlumb.instance.Defaults[this.defaultOverlayKeys[h]]||[]);for(h=0;h<o.length;h++){var u=f.convertToFullOverlaySpec(o[h]);a[u[1].id]=u}}var c={overlays:a,parameters:t.parameters||{},scope:t.scope||this._jsPlumb.instance.getDefaultScope()};if(this.getDefaultType=function(){return c},this.appendToDefaultType=function(t){for(var i in t)c[i]=t[i]},t.events)for(var l in t.events)i.bind(l,t.events[l]);this.clone=function(){var t=Object.create(this.constructor.prototype);return this.constructor.apply(t,e),t}.bind(this),this.isDetachAllowed=function(t){var i=!0;if(this._jsPlumb.beforeDetach)try{i=this._jsPlumb.beforeDetach(t)}catch(e){n.log("jsPlumb: beforeDetach callback failed",e)}return i},this.isDropAllowed=function(t,i,e,s,r,o,a){var h=this._jsPlumb.instance.checkCondition("beforeDrop",{sourceId:t,targetId:i,scope:e,connection:s,dropEndpoint:r,source:o,target:a});if(this._jsPlumb.beforeDrop)try{h=this._jsPlumb.beforeDrop({sourceId:t,targetId:i,scope:e,connection:s,dropEndpoint:r,source:o,target:a})}catch(u){n.log("jsPlumb: beforeDrop callback failed",u)}return h};var v=[];this.setListenerComponent=function(t){for(var i=0;i<v.length;i++)v[i][3]=t}},u=function(t,i){var n=t._jsPlumb.instance.getType(t._jsPlumb.types[i],t.getTypeDescriptor());null!=n&&n.cssClass&&t.canvas&&t._jsPlumb.instance.removeClass(t.canvas,n.cssClass)};n.extend(t.jsPlumbUIComponent,n.EventGenerator,{getParameter:function(t){return this._jsPlumb.parameters[t]},setParameter:function(t,i){this._jsPlumb.parameters[t]=i},getParameters:function(){return this._jsPlumb.parameters},setParameters:function(t){this._jsPlumb.parameters=t},getClass:function(){return f.getClass(this.canvas)},hasClass:function(t){return f.hasClass(this.canvas,t)},addClass:function(t){f.addClass(this.canvas,t)},removeClass:function(t){f.removeClass(this.canvas,t)},updateClasses:function(t,i){f.updateClasses(this.canvas,t,i)},setType:function(t,i,n){this.clearTypes(),this._jsPlumb.types=r(t)||[],a(this,i,n)},getType:function(){return this._jsPlumb.types},reapplyTypes:function(t,i){a(this,t,i)},hasType:function(t){return-1!==this._jsPlumb.types.indexOf(t)},addType:function(t,i,n){var e=r(t),s=!1;if(null!=e){for(var o=0,h=e.length;o<h;o++)this.hasType(e[o])||(this._jsPlumb.types.push(e[o]),s=!0);s&&a(this,i,n)}},removeType:function(t,i,n){var e=r(t),s=!1,o=function(t){var i=this._jsPlumb.types.indexOf(t);return-1!==i&&(u(this,i),this._jsPlumb.types.splice(i,1),!0)}.bind(this);if(null!=e){for(var h=0,c=e.length;h<c;h++)s=o(e[h])||s;s&&a(this,i,n)}},clearTypes:function(t,i){for(var n=this._jsPlumb.types.length,e=0;e<n;e++)u(this,0),this._jsPlumb.types.splice(0,1);a(this,t,i)},toggleType:function(t,i,n){var e=r(t);if(null!=e){for(var s=0,o=e.length;s<o;s++){var h=this._jsPlumb.types.indexOf(e[s]);-1!==h?(u(this,h),this._jsPlumb.types.splice(h,1)):this._jsPlumb.types.push(e[s])}a(this,i,n)}},applyType:function(t,i){if(this.setPaintStyle(t.paintStyle,i),this.setHoverPaintStyle(t.hoverPaintStyle,i),t.parameters)for(var n in t.parameters)this.setParameter(n,t.parameters[n]);this._jsPlumb.paintStyleInUse=this.getPaintStyle()},setPaintStyle:function(t,i){this._jsPlumb.paintStyle=t,this._jsPlumb.paintStyleInUse=this._jsPlumb.paintStyle,e(this),i||this.repaint()},getPaintStyle:function(){return this._jsPlumb.paintStyle},setHoverPaintStyle:function(t,i){this._jsPlumb.hoverPaintStyle=t,e(this),i||this.repaint()},getHoverPaintStyle:function(){return this._jsPlumb.hoverPaintStyle},destroy:function(t){(t||null==this.typeId)&&(this.cleanupListeners(),this.clone=null,this._jsPlumb=null)},isHover:function(){return this._jsPlumb.hover},setHover:function(t,i,n){if(this._jsPlumb&&!this._jsPlumb.instance.currentlyDragging&&!this._jsPlumb.instance.isHoverSuspended()){this._jsPlumb.hover=t;var e=t?"addClass":"removeClass";null!=this.canvas&&(null!=this._jsPlumb.instance.hoverClass&&this._jsPlumb.instance[e](this.canvas,this._jsPlumb.instance.hoverClass),null!=this._jsPlumb.hoverClass&&this._jsPlumb.instance[e](this.canvas,this._jsPlumb.hoverClass)),null!=this._jsPlumb.hoverPaintStyle&&(this._jsPlumb.paintStyleInUse=t?this._jsPlumb.hoverPaintStyle:this._jsPlumb.paintStyle,this._jsPlumb.instance.isSuspendDrawing()||(n=n||jsPlumbUtil.uuid(),this.repaint({timestamp:n,recalc:!1}))),this.getAttachedElements&&!i&&function(t,i,n,e){var s=t.getAttachedElements();if(s)for(var r=0,o=s.length;r<o;r++)e&&e===s[r]||s[r].setHover(i,!0,n)}(this,t,jsPlumbUtil.uuid(),this)}}});var c=0,l=t.jsPlumbInstance=function(i){this.version="2.15.5",this.Defaults={Anchor:"Bottom",Anchors:[null,null],ConnectionsDetachable:!0,ConnectionOverlays:[],Connector:"Bezier",Container:null,DoNotThrowErrors:!1,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fill:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},ListStyle:{},LogEnabled:!1,Overlays:[],MaxConnections:1,PaintStyle:{"stroke-width":4,stroke:"#456"},ReattachConnections:!1,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"},i&&f.extend(this.Defaults,i),this.logEnabled=this.Defaults.LogEnabled,this._connectionTypes={},this._endpointTypes={},n.EventGenerator.apply(this);var e=this,r=function(){var t=c+1;return c++,t}(),o=e.bind,a={},u=1,l=function(t){if(null==t)return null;if(3===t.nodeType||8===t.nodeType)return{el:t,text:!0};var i=e.getElement(t);return{el:i,id:n.isString(t)&&null==i?t:R(i)}};for(var v in this.getInstanceIndex=function(){return r},this.setZoom=function(t,i){return e.fire("zoom",u=t),i&&e.repaintEverything(),!0},this.getZoom=function(){return u},this.Defaults)a[v]=this.Defaults[v];var d,p=[];this.unbindContainer=function(){if(null!=d&&p.length>0)for(var t=0;t<p.length;t++)e.off(d,p[t][0],p[t][1])},this.setContainer=function(t){this.unbindContainer(),t=this.getElement(t),this.select().each((function(i){i.moveParent(t)})),this.selectEndpoints().each((function(i){i.moveParent(t)}));var i=d;d=t,p.length=0;for(var n={endpointclick:"endpointClick",endpointdblclick:"endpointDblClick"},r=function(t,i,s){var r=i.srcElement||i.target,o=(r&&r.parentNode?r.parentNode._jsPlumb:null)||(r?r._jsPlumb:null)||(r&&r.parentNode&&r.parentNode.parentNode?r.parentNode.parentNode._jsPlumb:null);o&&(o.fire(t,o,i),e.fire(s&&n[s+t]||t,o.component||o,i))},o=function(t,i,n){p.push([t,n]),e.on(d,t,i,n)},a=function(t){o(t,".jtk-connector",(function(i){r(t,i)})),o(t,".jtk-endpoint",(function(i){r(t,i,"endpoint")})),o(t,".jtk-overlay",(function(i){r(t,i)}))},h=0;h<s.length;h++)a(s[h]);for(var u in w){var c=w[u].el;c.parentNode===i&&(i.removeChild(c),d.appendChild(c))}},this.getContainer=function(){return d},this.bind=function(t,i){"ready"===t&&g?i():o.apply(e,[t,i])},e.importDefaults=function(t){for(var i in t)e.Defaults[i]=t[i];return t.Container&&e.setContainer(t.Container),e},e.restoreDefaults=function(){return e.Defaults=f.extend({},a),e};var m=null,g=!1,y=[],b={},x={},w={},k={},M={},j=!1,C=[],S=!1,T=null,E=this.Defaults.Scope,A=1,P=function(){return""+A++},D=function(t,i){d?d.appendChild(t):i?this.getElement(i).appendChild(t):this.appendToRoot(t)}.bind(this),O=function(t,i,n,s){var r={c:[],e:[]};if(!S&&null!=(t=e.getElement(t))){var o=R(t),a=t.querySelectorAll(".jtk-managed");null==n&&(n=jsPlumbUtil.uuid()),rt({elId:o,offset:i,recalc:!1,timestamp:n});for(var h=0;h<a.length;h++)rt({elId:a[h].getAttribute("id"),recalc:!0,timestamp:n});var u=e.router.redraw(o,i,n,null,s);if(Array.prototype.push.apply(r.c,u.c),Array.prototype.push.apply(r.e,u.e),a)for(var c=0;c<a.length;c++)u=e.router.redraw(a[c].getAttribute("id"),null,n,null,s,!0),Array.prototype.push.apply(r.c,u.c),Array.prototype.push.apply(r.e,u.e)}return r},I=function(t){return x[t]},H=function(t,i){var s=f.extend({},t);if(i&&f.extend(s,i),s.source&&(s.source.endpoint?s.sourceEndpoint=s.source:s.source=e.getElement(s.source)),s.target&&(s.target.endpoint?s.targetEndpoint=s.target:s.target=e.getElement(s.target)),t.uuids&&(s.sourceEndpoint=I(t.uuids[0]),s.targetEndpoint=I(t.uuids[1])),s.sourceEndpoint&&s.sourceEndpoint.isFull())n.log(e,"could not add connection; source endpoint is full");else if(s.targetEndpoint&&s.targetEndpoint.isFull())n.log(e,"could not add connection; target endpoint is full");else{if(!s.type&&s.sourceEndpoint&&(s.type=s.sourceEndpoint.connectionType),s.sourceEndpoint&&s.sourceEndpoint.connectorOverlays){s.overlays=s.overlays||[];for(var r=0,o=s.sourceEndpoint.connectorOverlays.length;r<o;r++)s.overlays.push(s.sourceEndpoint.connectorOverlays[r])}s.sourceEndpoint&&s.sourceEndpoint.scope&&(s.scope=s.sourceEndpoint.scope),!s["pointer-events"]&&s.sourceEndpoint&&s.sourceEndpoint.connectorPointerEvents&&(s["pointer-events"]=s.sourceEndpoint.connectorPointerEvents);var a=function(t,i,n,r){if(s[t]&&!s[t].endpoint&&!s[t+"Endpoint"]&&!s.newConnection){var o=n[R(s[t])];if(o=o?o[r]:null){if(!o.enabled)return!1;var a=f.extend({},o.def);delete a.label;var h=null!=o.endpoint&&o.endpoint._jsPlumb?o.endpoint:function(t,i,n){var r=function(t,i){var n=f.extend({},t);for(var e in i)i[e]&&(n[e]=i[e]);return n}(i,{anchor:s.anchors?s.anchors[n]:s.anchor,endpoint:s.endpoints?s.endpoints[n]:s.endpoint,paintStyle:s.endpointStyles?s.endpointStyles[n]:s.endpointStyle,hoverPaintStyle:s.endpointHoverStyles?s.endpointHoverStyles[n]:s.endpointHoverStyle});return e.addEndpoint(t,r)}(s[t],a,i);if(h.isFull())return!1;s[t+"Endpoint"]=h,!s.scope&&a.scope&&(s.scope=a.scope),o.uniqueEndpoint?o.endpoint?h.finalEndpoint=o.endpoint:(o.endpoint=h,h.setDeleteOnEmpty(!1)):h.setDeleteOnEmpty(!0),0===i&&o.def.connectorOverlays&&(s.overlays=s.overlays||[],Array.prototype.push.apply(s.overlays,o.def.connectorOverlays))}}};if(!1!==a("source",0,this.sourceEndpointDefinitions,s.type||"default")&&!1!==a("target",1,this.targetEndpointDefinitions,s.type||"default"))return s.sourceEndpoint&&s.targetEndpoint&&(function(t,i){for(var n=t.scope.split(/\s/),e=i.scope.split(/\s/),s=0;s<n.length;s++)for(var r=0;r<e.length;r++)if(e[r]===n[s])return!0;return!1}(s.sourceEndpoint,s.targetEndpoint)||(s=null)),s}}.bind(e),L=function(t){var i=e.Defaults.ConnectionType||e.getDefaultConnectionType();t._jsPlumb=e,t.newConnection=L,t.newEndpoint=F,t.endpointsByUUID=x,t.endpointsByElement=b,t.finaliseConnection=_,t.id="con_"+P();var n=new i(t);return n.isDetachable()&&(n.endpoints[0].initDraggable("_jsPlumbSource"),n.endpoints[1].initDraggable("_jsPlumbTarget")),n},_=e.finaliseConnection=function(t,i,n,s){i=i||{},t.suspendedEndpoint||y.push(t),t.pending=null,t.endpoints[0].isTemporarySource=!1,!1!==s&&e.router.newConnection(t),O(t.source),i.doNotFireConnectionEvent||!1===i.fireEvent||e.fire("connection",{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]},n)},F=function(t,i){var n=e.Defaults.EndpointType||f.Endpoint,s=f.extend({},t);s._jsPlumb=e,s.newConnection=L,s.newEndpoint=F,s.endpointsByUUID=x,s.endpointsByElement=b,s.fireDetachEvent=U,s.elementId=i||R(s.source);var r=new n(s);return r.id="ep_"+P(),st(s.elementId,s.source),f.headless||e.getDragManager().endpointAdded(s.source,i),r},N=function(t,i,n){var e=b[t];if(e&&e.length)for(var s=0,r=e.length;s<r;s++){for(var o=0,a=e[s].connections.length;o<a;o++)if(i(e[s].connections[o]))return;n&&n(e[s])}},$=function(t,i,n){i="block"===i;var e=null;n&&(e=function(t){t.setVisible(i,!0,!0)});var s=l(t);N(s.id,(function(t){i&&n?t.endpoints[t.sourceId===s.id?1:0].isVisible()&&t.setVisible(!0):t.setVisible(i)}),e)},R=function(t,i,s){if(n.isString(t))return t;if(null==t)return null;var o=e.getAttribute(t,"id");return o&&"undefined"!==o||(2===arguments.length&&void 0!==arguments[1]?o=i:(1===arguments.length||3===arguments.length&&!arguments[2])&&(o="jsPlumb_"+r+"_"+P()),s||e.setAttribute(t,"id",o)),o};this.setConnectionBeingDragged=function(t){j=t},this.isConnectionBeingDragged=function(){return j},this.getManagedElements=function(){return w},this.connectorClass="jtk-connector",this.connectorOutlineClass="jtk-connector-outline",this.connectedClass="jtk-connected",this.hoverClass="jtk-hover",this.endpointClass="jtk-endpoint",this.endpointConnectedClass="jtk-endpoint-connected",this.endpointFullClass="jtk-endpoint-full",this.endpointDropAllowedClass="jtk-endpoint-drop-allowed",this.endpointDropForbiddenClass="jtk-endpoint-drop-forbidden",this.overlayClass="jtk-overlay",this.draggingClass="jtk-dragging",this.elementDraggingClass="jtk-element-dragging",this.sourceElementDraggingClass="jtk-source-element-dragging",this.targetElementDraggingClass="jtk-target-element-dragging",this.endpointAnchorClassPrefix="jtk-endpoint-anchor",this.hoverSourceClass="jtk-source-hover",this.hoverTargetClass="jtk-target-hover",this.dragSelectClass="jtk-drag-select",this.Anchors={},this.Connectors={svg:{}},this.Endpoints={svg:{}},this.Overlays={svg:{}},this.ConnectorRenderers={},this.SVG="svg",this.addEndpoint=function(t,i,s){var r=f.extend({},s=s||{});f.extend(r,i),r.endpoint=r.endpoint||e.Defaults.Endpoint,r.paintStyle=r.paintStyle||e.Defaults.EndpointStyle;for(var o=[],a=n.isArray(t)||null!=t.length&&!n.isString(t)?t:[t],h=0,u=a.length;h<u;h++){r.source=e.getElement(a[h]),et(r.source);var c=R(r.source),l=F(r,c),v=st(c,r.source,null,!S).info.o;n.addToList(b,c,l),S||l.paint({anchorLoc:l.anchor.compute({xy:[v.left,v.top],wh:C[c],element:l,timestamp:T,rotation:this.getRotation(c)}),timestamp:T}),o.push(l)}return 1===o.length?o[0]:o},this.addEndpoints=function(t,i,s){for(var r=[],o=0,a=i.length;o<a;o++){var h=e.addEndpoint(t,i[o],s);n.isArray(h)?Array.prototype.push.apply(r,h):r.push(h)}return r},this.animate=function(t,i,s){if(!this.animationSupported)return!1;s=s||{};var r=e.getElement(t),o=R(r),a=f.animEvents.step,h=f.animEvents.complete;s[a]=n.wrap(s[a],(function(){e.revalidate(o)})),s[h]=n.wrap(s[h],(function(){e.revalidate(o)})),e.doAnimate(r,i,s)},this.checkCondition=function(t,i){var s=e.getListener(t),r=!0;if(s&&s.length>0){var o=Array.prototype.slice.call(arguments,1);try{for(var a=0,h=s.length;a<h;a++)r=r&&s[a].apply(s[a],o)}catch(u){n.log(e,"cannot check condition ["+t+"]"+u)}}return r},this.connect=function(t,i){var e,s=H(t,i);if(s){if(null==s.source&&null==s.sourceEndpoint)return void n.log("Cannot establish connection - source does not exist");if(null==s.target&&null==s.targetEndpoint)return void n.log("Cannot establish connection - target does not exist");et(s.source),e=L(s),_(e,s)}return e};var z=[{el:"source",elId:"sourceId",epDefs:"sourceEndpointDefinitions"},{el:"target",elId:"targetId",epDefs:"targetEndpointDefinitions"}],G=function(t,i,n,e){var s,r,o,a=z[n],h=t[a.elId],u=t.endpoints[n],c={index:n,originalSourceId:0===n?h:t.sourceId,newSourceId:t.sourceId,originalTargetId:1===n?h:t.targetId,newTargetId:t.targetId,connection:t};if(i.constructor===f.Endpoint)(s=i).addConnection(t),i=s.element;else if(r=R(i),o=this[a.epDefs][r],r===t[a.elId])s=null;else if(o)for(var l in o){if(!o[l].enabled)return;s=null!=o[l].endpoint&&o[l].endpoint._jsPlumb?o[l].endpoint:this.addEndpoint(i,o[l].def),o[l].uniqueEndpoint&&(o[l].endpoint=s),s.addConnection(t)}else s=t.makeEndpoint(0===n,i,r);return null!=s&&(u.detachFromConnection(t),t.endpoints[n]=s,t[a.el]=s.element,t[a.elId]=s.elementId,c[0===n?"newSourceId":"newTargetId"]=s.elementId,B(c),e||t.repaint()),c.element=i,c}.bind(this);this.setSource=function(t,i,n){var e=G(t,i,0,n);this.router.sourceOrTargetChanged(e.originalSourceId,e.newSourceId,t,e.el,0)},this.setTarget=function(t,i,n){var e=G(t,i,1,n);this.router.sourceOrTargetChanged(e.originalTargetId,e.newTargetId,t,e.el,1)},this.deleteEndpoint=function(t,i,n){var s="string"==typeof t?x[t]:t;return s&&e.deleteObject({endpoint:s,dontUpdateHover:i,deleteAttachedObjects:n}),e},this.deleteEveryEndpoint=function(){var t=e.setSuspendDrawing(!0);for(var i in b){var n=b[i];if(n&&n.length)for(var s=0,r=n.length;s<r;s++)e.deleteEndpoint(n[s],!0)}b={},w={},x={},k={},M={},e.router.reset();var o=e.getDragManager();return o&&o.reset(),t||e.setSuspendDrawing(!1),e};var U=function(t,i,n){var s=e.Defaults.ConnectionType||e.getDefaultConnectionType(),r=t.constructor===s?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;i&&e.fire("connectionDetached",r,n),e.fire("internal.connectionDetached",r,n),e.router.connectionDetached(r)},B=e.fireMoveEvent=function(t,i){e.fire("connectionMoved",t,i)};this.unregisterEndpoint=function(t){for(var i in t._jsPlumb.uuid&&(x[t._jsPlumb.uuid]=null),e.router.deleteEndpoint(t),b){var n=b[i];if(n){for(var s=[],r=0,o=n.length;r<o;r++)n[r]!==t&&s.push(n[r]);b[i]=s}b[i].length<1&&delete b[i]}},this.deleteConnection=function(t,i){return!(null==t||!(i=i||{}).force&&!n.functionChain(!0,!1,[[t.endpoints[0],"isDetachAllowed",[t]],[t.endpoints[1],"isDetachAllowed",[t]],[t,"isDetachAllowed",[t]],[e,"checkCondition",["beforeDetach",t]]])||(t.setHover(!1),U(t,!t.pending&&!1!==i.fireEvent,i.originalEvent),t.endpoints[0].detachFromConnection(t),t.endpoints[1].detachFromConnection(t),n.removeWithFunction(y,(function(i){return t.id===i.id})),t.cleanup(),t.destroy(),0))},this.deleteEveryConnection=function(t){t=t||{};var i=y.length,n=0;return e.batch((function(){for(var s=0;s<i;s++)n+=e.deleteConnection(y[0],t)?1:0})),n},this.deleteConnectionsForElement=function(t,i){i=i||{},t=e.getElement(t);var n=R(t),s=b[n];if(s&&s.length)for(var r=0,o=s.length;r<o;r++)s[r].deleteEveryConnection(i);return e},this.deleteObject=function(t){var i={endpoints:{},connections:{},endpointCount:0,connectionCount:0},s=!1!==t.deleteAttachedObjects,r=function(n){null!=n&&null==i.connections[n.id]&&(t.dontUpdateHover||null==n._jsPlumb||n.setHover(!1),i.connections[n.id]=n,i.connectionCount++)};for(var o in t.connection?r(t.connection):function(n){if(null!=n&&null==i.endpoints[n.id]&&(t.dontUpdateHover||null==n._jsPlumb||n.setHover(!1),i.endpoints[n.id]=n,i.endpointCount++,s))for(var e=0;e<n.connections.length;e++)r(n.connections[e])}(t.endpoint),i.connections){var a=i.connections[o];if(a._jsPlumb){n.removeWithFunction(y,(function(t){return a.id===t.id})),U(a,!1!==t.fireEvent&&!a.pending,t.originalEvent);var h=null==t.deleteAttachedObjects?null:!t.deleteAttachedObjects;a.endpoints[0].detachFromConnection(a,null,h),a.endpoints[1].detachFromConnection(a,null,h),a.cleanup(!0),a.destroy(!0)}}for(var u in i.endpoints){var c=i.endpoints[u];c._jsPlumb&&(e.unregisterEndpoint(c),c.cleanup(!0),c.destroy(!0))}return i};var Y=function(t,i,n,e){for(var s=0,r=t.length;s<r;s++)t[s][i].apply(t[s],n);return e(t)},X=function(t,i,n){for(var e=[],s=0,r=t.length;s<r;s++)e.push([t[s][i].apply(t[s],n),t[s]]);return e},W=function(t,i,n){return function(){return Y(t,i,arguments,n)}},q=function(t,i){return function(){return X(t,i,arguments)}},J=function(t,i){var n=[];if(t)if("string"==typeof t){if("*"===t)return t;n.push(t)}else if(i)n=t;else if(t.length)for(var e=0,s=t.length;e<s;e++)n.push(l(t[e]).id);else n.push(l(t).id);return n},V=function(t,i,n){return"*"===t||(t.length>0?-1!==t.indexOf(i):!n)};this.getConnections=function(t,i){t?t.constructor===String&&(t={scope:t}):t={};for(var n=t.scope||e.getDefaultScope(),s=J(n,!0),r=J(t.source),o=J(t.target),a=!i&&s.length>1?{}:[],h=function(t,n){if(!i&&s.length>1){var e=a[t];null==e&&(e=a[t]=[]),e.push(n)}else a.push(n)},u=0,c=y.length;u<c;u++){var l=y[u],f=l.proxies&&l.proxies[0]?l.proxies[0].originalEp.elementId:l.sourceId,v=l.proxies&&l.proxies[1]?l.proxies[1].originalEp.elementId:l.targetId;V(s,l.scope)&&V(r,f)&&V(o,v)&&h(l.scope,l)}return a};var K=function(t,i){return function(n){for(var e=0,s=t.length;e<s;e++)n(t[e]);return i(t)}},Q=function(t){return function(i){return t[i]}},Z=function(t,i){var n,e,s={length:t.length,each:K(t,i),get:Q(t)},r=["setHover","removeAllOverlays","setLabel","addClass","addOverlay","removeOverlay","removeOverlays","showOverlay","hideOverlay","showOverlays","hideOverlays","setPaintStyle","setHoverPaintStyle","setSuspendEvents","setParameter","setParameters","setVisible","repaint","addType","toggleType","removeType","removeClass","setType","bind","unbind"],o=["getLabel","getOverlay","isHover","getParameter","getParameters","getPaintStyle","getHoverPaintStyle","isVisible","hasType","getType","isSuspendEvents"];for(n=0,e=r.length;n<e;n++)s[r[n]]=W(t,r[n],i);for(n=0,e=o.length;n<e;n++)s[o[n]]=q(t,o[n]);return s},tt=function(t){var i=Z(t,tt);return f.extend(i,{setDetachable:W(t,"setDetachable",tt),setReattach:W(t,"setReattach",tt),setConnector:W(t,"setConnector",tt),delete:function(){for(var i=0,n=t.length;i<n;i++)e.deleteConnection(t[i])},isDetachable:q(t,"isDetachable"),isReattach:q(t,"isReattach")})},it=function(t){var i=Z(t,it);return f.extend(i,{setEnabled:W(t,"setEnabled",it),setAnchor:W(t,"setAnchor",it),isEnabled:q(t,"isEnabled"),deleteEveryConnection:function(){for(var i=0,n=t.length;i<n;i++)t[i].deleteEveryConnection()},delete:function(){for(var i=0,n=t.length;i<n;i++)e.deleteEndpoint(t[i])}})};this.select=function(t){return(t=t||{}).scope=t.scope||"*",tt(t.connections||e.getConnections(t,!0))},this.selectEndpoints=function(t){(t=t||{}).scope=t.scope||"*";var i=!t.element&&!t.source&&!t.target,n=i?"*":J(t.element),e=i?"*":J(t.source),s=i?"*":J(t.target),r=J(t.scope,!0),o=[];for(var a in b){var h=V(n,a,!0),u=V(e,a,!0),c="*"!==e,l=V(s,a,!0),f="*"!==s;if(h||u||l)t:for(var v=0,d=b[a].length;v<d;v++){var p=b[a][v];if(V(r,p.scope,!0)){if(c&&e.length>0&&!p.isSource||f&&s.length>0&&!p.isTarget)continue t;o.push(p)}}}return it(o)},this.getAllConnections=function(){return y},this.getDefaultScope=function(){return E},this.getEndpoint=I,this.getEndpoints=function(t){return b[l(t).id]||[]},this.getDefaultEndpointType=function(){return f.Endpoint},this.getDefaultConnectionType=function(){return f.Connection},this.getId=R,this.draw=O,this.info=l,this.appendElement=D;var nt=!1;this.isHoverSuspended=function(){return nt},this.setHoverSuspended=function(t){nt=t},this.hide=function(t,i){return $(t,"none",i),e},this.idstamp=P;var et=function(t){if(!d&&t){var i=e.getElement(t);i.offsetParent&&e.setContainer(i.offsetParent)}},st=e.manage=function(t,i,n,s){return w[t]?s&&(w[t].info=rt({elId:t,timestamp:T,recalc:!0})):(w[t]={el:i,endpoints:[],connections:[],rotation:0},w[t].info=rt({elId:t,timestamp:T}),e.addClass(i,"jtk-managed"),n||e.fire("manageElement",{id:t,info:w[t].info,el:i})),w[t]};this.unmanage=function(t){if(w[t]){var i=w[t].el;e.removeClass(i,"jtk-managed"),delete w[t],e.fire("unmanageElement",{id:t,el:i})}},this.rotate=function(t,i,n){return w[t]&&(w[t].rotation=i,w[t].el.style.transform="rotate("+i+"deg)",w[t].el.style.transformOrigin="center center",!0!==n)?this.revalidate(t):{c:[],e:[]}},this.getRotation=function(t){return w[t]&&w[t].rotation||0};var rt=function(t){var i,n=t.timestamp,s=t.recalc,r=t.offset,o=t.elId;return S&&!n&&(n=T),!s&&n&&n===M[o]?{o:t.offset||k[o],s:C[o]}:(s||!r&&null==k[o]?null!=(i=w[o]?w[o].el:null)&&(C[o]=e.getSize(i),k[o]=e.getOffset(i),M[o]=n):(k[o]=r||k[o],null==C[o]&&null!=(i=w[o].el)&&(C[o]=e.getSize(i)),M[o]=n),k[o]&&!k[o].right&&(k[o].right=k[o].left+C[o][0],k[o].bottom=k[o].top+C[o][1],k[o].width=C[o][0],k[o].height=C[o][1],k[o].centerx=k[o].left+k[o].width/2,k[o].centery=k[o].top+k[o].height/2),{o:k[o],s:C[o]})};this.updateOffset=rt,this.init=function(){g||(e.Defaults.Container&&e.setContainer(e.Defaults.Container),e.router=new t.jsPlumb.DefaultRouter(e),e.anchorManager=e.router.anchorManager,g=!0,e.fire("ready",e))}.bind(this),this.log=m,this.jsPlumbUIComponent=h,this.makeAnchor=function(){var i,s=function(i,n){if(t.jsPlumb.Anchors[i])return new t.jsPlumb.Anchors[i](n);if(!e.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown anchor type '"+i+"'"}};if(0===arguments.length)return null;var r=arguments[0],o=arguments[1],a=null;if(r.compute&&r.getOrientation)return r;if("string"==typeof r)a=s(arguments[0],{elementId:o,jsPlumbInstance:e});else if(n.isArray(r))if(n.isArray(r[0])||n.isString(r[0]))2===r.length&&n.isObject(r[1])?n.isString(r[0])?(i=t.jsPlumb.extend({elementId:o,jsPlumbInstance:e},r[1]),a=s(r[0],i)):(i=t.jsPlumb.extend({elementId:o,jsPlumbInstance:e,anchors:r[0]},r[1]),a=new t.jsPlumb.DynamicAnchor(i)):a=new f.DynamicAnchor({anchors:r,selector:null,elementId:o,jsPlumbInstance:e});else{var h={x:r[0],y:r[1],orientation:r.length>=4?[r[2],r[3]]:[0,0],offsets:r.length>=6?[r[4],r[5]]:[0,0],elementId:o,jsPlumbInstance:e,cssClass:7===r.length?r[6]:null};(a=new t.jsPlumb.Anchor(h)).clone=function(){return new t.jsPlumb.Anchor(h)}}return a.id||(a.id="anchor_"+P()),a},this.makeAnchors=function(i,s,r){for(var o=[],a=0,h=i.length;a<h;a++)"string"==typeof i[a]?o.push(t.jsPlumb.Anchors[i[a]]({elementId:s,jsPlumbInstance:r})):n.isArray(i[a])&&o.push(e.makeAnchor(i[a],s,r));return o},this.makeDynamicAnchor=function(i,n){return new t.jsPlumb.DynamicAnchor({anchors:i,selector:n,elementId:null,jsPlumbInstance:e})},this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={};var ot=function(i,s,r,o,a){var u=new h(s),c=s._jsPlumb.EndpointDropHandler({jsPlumb:e,enabled:function(){return i.def.enabled},isFull:function(){var t=e.select({target:i.id}).length;return i.def.maxConnections>0&&t>=i.def.maxConnections},element:i.el,elementId:i.id,isSource:o,isTarget:a,addClass:function(t){e.addClass(i.el,t)},removeClass:function(t){e.removeClass(i.el,t)},onDrop:function(t){t.endpoints[0].anchor.locked=!1},isDropAllowed:function(){return u.isDropAllowed.apply(u,arguments)},isRedrop:function(t){return null!=t.suspendedElement&&null!=t.suspendedEndpoint&&t.suspendedEndpoint.element===i.el},getEndpoint:function(n){var r=i.def.endpoint;if(null==r||null==r._jsPlumb){var o=e.deriveEndpointAndAnchorSpec(n.getType().join(" "),!0),a=o.endpoints?t.jsPlumb.extend(s,{endpoint:i.def.def.endpoint||o.endpoints[1]}):s;o.anchors&&(a=t.jsPlumb.extend(a,{anchor:i.def.def.anchor||o.anchors[1]})),(r=e.addEndpoint(i.el,a))._mtNew=!0}if(s.uniqueEndpoint&&(i.def.endpoint=r),r.setDeleteOnEmpty(!0),n.isDetachable()&&r.initDraggable(),null!=r.anchor.positionFinder){var h=e.getUIPosition(arguments,e.getZoom()),u=e.getOffset(i.el),c=e.getSize(i.el),l=null==h?[0,0]:r.anchor.positionFinder(h,u,c,r.anchor.constructorParams);r.anchor.x=l[0],r.anchor.y=l[1]}return r},maybeCleanup:function(t){t._mtNew&&0===t.connections.length?e.deleteObject({endpoint:t}):delete t._mtNew}}),l=t.jsPlumb.dragEvents.drop;return r.scope=r.scope||s.scope||e.Defaults.Scope,r[l]=n.wrap(r[l],c,!0),r.rank=s.rank||0,a&&(r[t.jsPlumb.dragEvents.over]=function(){return!0}),!1===s.allowLoopback&&(r.canDrop=function(t){return t.getDragElement()._jsPlumbRelatedElement!==i.el}),e.initDroppable(i.el,r,"internal"),c};this.makeTarget=function(i,n,s){var r=t.jsPlumb.extend({_jsPlumb:this},s);t.jsPlumb.extend(r,n);for(var o=r.maxConnections||-1,a=function(i){var n=l(i),s=n.id,a=t.jsPlumb.extend({},r.dropOptions||{}),h=r.connectionType||"default";this.targetEndpointDefinitions[s]=this.targetEndpointDefinitions[s]||{},et(s),n.el._isJsPlumbGroup&&null==a.rank&&(a.rank=-1);var u={def:t.jsPlumb.extend({},r),uniqueEndpoint:r.uniqueEndpoint,maxConnections:o,enabled:!0};r.createEndpoint&&(u.uniqueEndpoint=!0,u.endpoint=e.addEndpoint(i,u.def),u.endpoint.setDeleteOnEmpty(!1)),n.def=u,this.targetEndpointDefinitions[s][h]=u,ot(n,r,a,!0===r.isSource,!0),n.el._katavorioDrop[n.el._katavorioDrop.length-1].targetDef=u}.bind(this),h=i.length&&i.constructor!==String?i:[i],u=0,c=h.length;u<c;u++)a(h[u]);return this},this.unmakeTarget=function(t,i){var n=l(t);return e.destroyDroppable(n.el,"internal"),i||delete this.targetEndpointDefinitions[n.id],this},this.makeSource=function(i,s,r){var o=t.jsPlumb.extend({_jsPlumb:this},r);t.jsPlumb.extend(o,s);var a=o.connectionType||"default",h=e.deriveEndpointAndAnchorSpec(a);o.endpoint=o.endpoint||h.endpoints[0],o.anchor=o.anchor||h.anchors[0];for(var c=o.maxConnections||-1,f=o.onMaxConnections,v=function(s){var r=s.id,h=this.getElement(s.el);this.sourceEndpointDefinitions[r]=this.sourceEndpointDefinitions[r]||{},et(r);var l={def:t.jsPlumb.extend({},o),uniqueEndpoint:o.uniqueEndpoint,maxConnections:c,enabled:!0};o.createEndpoint&&(l.uniqueEndpoint=!0,l.endpoint=e.addEndpoint(i,l.def),l.endpoint.setDeleteOnEmpty(!1)),this.sourceEndpointDefinitions[r][a]=l,s.def=l;var v=t.jsPlumb.dragEvents.stop,d=t.jsPlumb.dragEvents.drag,p=t.jsPlumb.extend({},o.dragOptions||{}),m=p.drag,g=p.stop,y=null,b=!1;p.scope=p.scope||o.scope,p[d]=n.wrap(p[d],(function(){m&&m.apply(this,arguments),b=!1})),p[v]=n.wrap(p[v],function(){if(g&&g.apply(this,arguments),this.currentlyDragging=!1,null!=y._jsPlumb){var t=o.anchor||this.Defaults.Anchor,i=y.anchor,n=y.connections[0],s=this.makeAnchor(t,r,this),a=y.element;if(null!=s.positionFinder){var h=e.getOffset(a),u=this.getSize(a),c={left:h.left+i.x*u[0],top:h.top+i.y*u[1]},l=s.positionFinder(c,h,u,s.constructorParams);s.x=l[0],s.y=l[1]}y.setAnchor(s,!0),y.repaint(),this.repaint(y.elementId),null!=n&&this.repaint(n.targetId)}}.bind(this));var x=function(i){if(3!==i.which&&2!==i.button){r=this.getId(this.getElement(s.el));var l=this.sourceEndpointDefinitions[r][a];if(l.enabled){if(o.filter&&!1===(n.isString(o.filter)?function(t,i,n,e,s){for(var r=t.target||t.srcElement,o=!1,a=e.getSelector(i,n),h=0;h<a.length;h++)if(a[h]===r){o=!0;break}return s?!o:o}(i,s.el,o.filter,this,o.filterExclude):o.filter(i,s.el)))return;var v=this.select({source:r}).length;if(l.maxConnections>=0&&v>=l.maxConnections)return f&&f({element:s.el,maxConnections:c},i),!1;var d=t.jsPlumb.getPositionOnElement(i,h,u),m={};t.jsPlumb.extend(m,l.def),m.isTemporarySource=!0,m.anchor=[d[0],d[1],0,0],m.dragOptions=p,l.def.scope&&(m.scope=l.def.scope),y=this.addEndpoint(r,m),b=!0,y.setDeleteOnEmpty(!0),l.uniqueEndpoint&&(l.endpoint?y.finalEndpoint=l.endpoint:(l.endpoint=y,y.setDeleteOnEmpty(!1)));var g=function(){e.off(y.canvas,"mouseup",g),e.off(s.el,"mouseup",g),b&&(b=!1,e.deleteEndpoint(y))};e.on(y.canvas,"mouseup",g),e.on(s.el,"mouseup",g);var x={};if(l.def.extract)for(var w in l.def.extract){var k=(i.srcElement||i.target).getAttribute(w);k&&(x[l.def.extract[w]]=k)}e.trigger(y.canvas,"mousedown",i,x),n.consume(i)}}}.bind(this);this.on(s.el,"mousedown",x),l.trigger=x,o.filter&&(n.isString(o.filter)||n.isFunction(o.filter))&&e.setDragFilter(s.el,o.filter);var w=t.jsPlumb.extend({},o.dropOptions||{});ot(s,o,w,!0,!0===o.isTarget)}.bind(this),d=i.length&&i.constructor!==String?i:[i],p=0,m=d.length;p<m;p++)v(l(d[p]));return this},this.unmakeSource=function(t,i,n){var s=l(t);e.destroyDroppable(s.el,"internal");var r=this.sourceEndpointDefinitions[s.id];if(r)for(var o in r)if(null==i||i===o){var a=r[o].trigger;a&&e.off(s.el,"mousedown",a),n||delete this.sourceEndpointDefinitions[s.id][o]}return this},this.unmakeEverySource=function(){for(var t in this.sourceEndpointDefinitions)e.unmakeSource(t,null,!0);return this.sourceEndpointDefinitions={},this};var at=function(t,i,e){i=n.isArray(i)?i:[i];var s=R(t);e=e||"default";for(var r=0;r<i.length;r++){var o=this[i[r]][s];if(o&&o[e])return o[e].def.scope||this.Defaults.Scope}}.bind(this),ht=function(t,i,e,s){e=n.isArray(e)?e:[e];var r=R(t);s=s||"default";for(var o=0;o<e.length;o++){var a=this[e[o]][r];a&&a[s]&&(a[s].def.scope=i)}}.bind(this);this.getScope=function(t){return at(t,["sourceEndpointDefinitions","targetEndpointDefinitions"])},this.getSourceScope=function(t){return at(t,"sourceEndpointDefinitions")},this.getTargetScope=function(t){return at(t,"targetEndpointDefinitions")},this.setScope=function(t,i,n){this.setSourceScope(t,i,n),this.setTargetScope(t,i,n)},this.setSourceScope=function(t,i,n){ht(t,i,"sourceEndpointDefinitions",n),this.setDragScope(t,i)},this.setTargetScope=function(t,i,n){ht(t,i,"targetEndpointDefinitions",n),this.setDropScope(t,i)},this.unmakeEveryTarget=function(){for(var t in this.targetEndpointDefinitions)e.unmakeTarget(t,!0);return this.targetEndpointDefinitions={},this};var ut=function(t,i,s,r,o){var a,h,u,c="source"===t?this.sourceEndpointDefinitions:this.targetEndpointDefinitions;if(o=o||"default",i.length&&!n.isString(i)){a=[];for(var f=0,v=i.length;f<v;f++)c[(h=l(i[f])).id]&&c[h.id][o]&&(a[f]=c[h.id][o].enabled,c[h.id][o].enabled=u=r?!a[f]:s,e[u?"removeClass":"addClass"](h.el,"jtk-"+t+"-disabled"))}else{var d=(h=l(i)).id;c[d]&&c[d][o]&&(a=c[d][o].enabled,c[d][o].enabled=u=r?!a:s,e[u?"removeClass":"addClass"](h.el,"jtk-"+t+"-disabled"))}return a}.bind(this),ct=function(t,i){if(null!=t){if(n.isString(t)||!t.length)return i.apply(this,[t]);if(t.length)return i.apply(this,[t[0]])}}.bind(this);this.toggleSourceEnabled=function(t,i){return ut("source",t,null,!0,i),this.isSourceEnabled(t,i)},this.setSourceEnabled=function(t,i,n){return ut("source",t,i,null,n)},this.isSource=function(t,i){return i=i||"default",ct(t,function(t){var n=this.sourceEndpointDefinitions[l(t).id];return null!=n&&null!=n[i]}.bind(this))},this.isSourceEnabled=function(t,i){return i=i||"default",ct(t,function(t){var n=this.sourceEndpointDefinitions[l(t).id];return n&&n[i]&&!0===n[i].enabled}.bind(this))},this.toggleTargetEnabled=function(t,i){return ut("target",t,null,!0,i),this.isTargetEnabled(t,i)},this.isTarget=function(t,i){return i=i||"default",ct(t,function(t){var n=this.targetEndpointDefinitions[l(t).id];return null!=n&&null!=n[i]}.bind(this))},this.isTargetEnabled=function(t,i){return i=i||"default",ct(t,function(t){var n=this.targetEndpointDefinitions[l(t).id];return n&&n[i]&&!0===n[i].enabled}.bind(this))},this.setTargetEnabled=function(t,i,n){return ut("target",t,i,null,n)},this.ready=function(t){e.bind("ready",t)},this.repaint=function(t,i,n){return function(t,i){if("object"==typeof t&&t.length)for(var n=0,s=t.length;n<s;n++)i(t[n]);else i(t);return e}(t,(function(t){O(t,i,n)}))},this.revalidate=function(t,i,n){var s=n?t:e.getId(t);e.updateOffset({elId:s,recalc:!0,timestamp:i});var r=e.getDragManager();return r&&r.updateOffsets(s),O(t,null,i)},this.repaintEverything=function(){var t,i=jsPlumbUtil.uuid();for(t in b)e.updateOffset({elId:t,recalc:!0,timestamp:i});for(t in b)O(t,null,i);return this},this.removeAllEndpoints=function(t,i,n){n=n||[];var s=function(t){var r,o,a=l(t),h=b[a.id];if(h)for(n.push(a),r=0,o=h.length;r<o;r++)e.deleteEndpoint(h[r],!1);if(delete b[a.id],i&&a.el&&3!==a.el.nodeType&&8!==a.el.nodeType)for(r=0,o=a.el.childNodes.length;r<o;r++)s(a.el.childNodes[r])};return s(t),this};var lt=function(t,i){e.removeAllEndpoints(t.id,!0,i);for(var n=e.getDragManager(),s=function(t){n&&n.elementRemoved(t.id),e.router.elementRemoved(t.id),e.isSource(t.el)&&e.unmakeSource(t.el),e.isTarget(t.el)&&e.unmakeTarget(t.el),e.destroyDraggable(t.el),e.destroyDroppable(t.el),delete e.floatingConnections[t.id],delete w[t.id],delete k[t.id],t.el&&(e.removeElement(t.el),t.el._jsPlumb=null)},r=1;r<i.length;r++)s(i[r]);s(t)};this.remove=function(t,i){var n=l(t),s=[];return n.text&&n.el.parentNode?n.el.parentNode.removeChild(n.el):n.id&&e.batch((function(){lt(n,s)}),!0===i),e},this.empty=function(t,i){var n=[],s=function(t,i){var e=l(t);if(e.text)e.el.parentNode.removeChild(e.el);else if(e.el){for(;e.el.childNodes.length>0;)s(e.el.childNodes[0]);i||lt(e,n)}};return e.batch((function(){s(t,!0)}),!1===i),e},this.reset=function(t){e.silently(function(){nt=!1,e.removeAllGroups(),e.removeGroupManager(),e.deleteEveryEndpoint(),t||e.unbind(),this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={},y.length=0,this.doReset&&this.doReset()}.bind(this))},this.destroy=function(){this.reset(),d=null,p=null};var ft=function(t){t.canvas&&t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),t.cleanup(),t.destroy()};this.clear=function(){e.select().each(ft),e.selectEndpoints().each(ft),b={},x={}},this.setDefaultScope=function(t){return E=t,e},this.deriveEndpointAndAnchorSpec=function(t,i){for(var n=((i?"":"default ")+t).split(/[\s]/),s=null,r=null,o=null,a=null,h=0;h<n.length;h++){var u=e.getType(n[h],"connection");u&&(u.endpoints&&(s=u.endpoints),u.endpoint&&(r=u.endpoint),u.anchors&&(a=u.anchors),u.anchor&&(o=u.anchor))}return{endpoints:s||[r,r],anchors:a||[o,o]}},this.setId=function(t,i,e){var s;n.isString(t)?s=t:(t=this.getElement(t),s=this.getId(t));var r=this.getConnections({source:s,scope:"*"},!0),o=this.getConnections({target:s,scope:"*"},!0);i=""+i,e?t=this.getElement(i):(t=this.getElement(s),this.setAttribute(t,"id",i)),b[i]=b[s]||[];for(var a=0,h=b[i].length;a<h;a++)b[i][a].setElementId(i),b[i][a].setReferenceElement(t);delete b[s],this.sourceEndpointDefinitions[i]=this.sourceEndpointDefinitions[s],delete this.sourceEndpointDefinitions[s],this.targetEndpointDefinitions[i]=this.targetEndpointDefinitions[s],delete this.targetEndpointDefinitions[s],this.router.changeId(s,i);var u=this.getDragManager();u&&u.changeId(s,i),w[i]=w[s],delete w[s];var c=function(n,e,s){for(var r=0,o=n.length;r<o;r++)n[r].endpoints[e].setElementId(i),n[r].endpoints[e].setReferenceElement(t),n[r][s+"Id"]=i,n[r][s]=t};c(r,0,"source"),c(o,1,"target"),this.repaint(i)},this.setDebugLog=function(t){m=t},this.setSuspendDrawing=function(t,i){var n=S;return S=t,T=t?(new Date).getTime():null,i&&this.repaintEverything(),n},this.isSuspendDrawing=function(){return S},this.getSuspendedAt=function(){return T},this.batch=function(t,i){var e=this.isSuspendDrawing();e||this.setSuspendDrawing(!0);try{t()}catch(s){n.log("Function run while suspended failed",s)}e||this.setSuspendDrawing(!1,!i)},this.doWhileSuspended=this.batch,this.getCachedData=function(t){var i=k[t];return i?{o:i,s:C[t]}:rt({elId:t})},this.show=function(t,i){return $(t,"block",i),e},this.toggleVisible=function(t,i){var n=null;i&&(n=function(t){var i=t.isVisible();t.setVisible(!i)}),N(t,(function(t){var i=t.isVisible();t.setVisible(!i)}),n)},this.addListener=this.bind;var vt=[];this.registerFloatingConnection=function(t,i,e){vt[t.id]=i,n.addToList(b,t.id,e)},this.getFloatingConnectionFor=function(t){return vt[t]},this.listManager=new t.jsPlumbListManager(this,this.Defaults.ListStyle)};n.extend(t.jsPlumbInstance,n.EventGenerator,{setAttribute:function(t,i,n){this.setAttribute(t,i,n)},getAttribute:function(i,n){return this.getAttribute(t.jsPlumb.getElement(i),n)},convertToFullOverlaySpec:function(t){return n.isString(t)&&(t=[t,{}]),t[1].id=t[1].id||n.uuid(),t},registerConnectionType:function(i,n){if(this._connectionTypes[i]=t.jsPlumb.extend({},n),n.overlays){for(var e={},s=0;s<n.overlays.length;s++){var r=this.convertToFullOverlaySpec(n.overlays[s]);e[r[1].id]=r}this._connectionTypes[i].overlays=e}},registerConnectionTypes:function(t){for(var i in t)this.registerConnectionType(i,t[i])},registerEndpointType:function(i,n){if(this._endpointTypes[i]=t.jsPlumb.extend({},n),n.overlays){for(var e={},s=0;s<n.overlays.length;s++){var r=this.convertToFullOverlaySpec(n.overlays[s]);e[r[1].id]=r}this._endpointTypes[i].overlays=e}},registerEndpointTypes:function(t){for(var i in t)this.registerEndpointType(i,t[i])},getType:function(t,i){return"connection"===i?this._connectionTypes[t]:this._endpointTypes[t]},setIdChanged:function(t,i){this.setId(t,i,!0)},setParent:function(t,i){var n=this.getElement(t),e=this.getId(n),s=this.getElement(i),r=this.getId(s),o=this.getDragManager();n.parentNode.removeChild(n),s.appendChild(n),o&&o.setParent(n,e,s,r)},extend:function(t,i,n){var e;if(n)for(e=0;e<n.length;e++)t[n[e]]=i[n[e]];else for(e in i)t[e]=i[e];return t},floatingConnections:{},getFloatingAnchorIndex:function(t){return t.endpoints[0].isFloating()?0:t.endpoints[1].isFloating()?1:-1},proxyConnection:function(t,i,n,e,s,r){var o,a=t.endpoints[i].elementId,h=t.endpoints[i];t.proxies=t.proxies||[],(o=t.proxies[i]?t.proxies[i].ep:this.addEndpoint(n,{endpoint:s(t,i),anchor:r(t,i),parameters:{isProxyEndpoint:!0}})).setDeleteOnEmpty(!0),t.proxies[i]={ep:o,originalEp:h},this.router.sourceOrTargetChanged(a,e,t,n,0===i?0:1),h.detachFromConnection(t,null,!0),o.connections=[t],t.endpoints[i]=o,h.setVisible(!1),t.setVisible(!0),this.revalidate(n)},unproxyConnection:function(t,i,n){if(null!=t._jsPlumb&&null!=t.proxies&&null!=t.proxies[i]){var e=t.proxies[i].originalEp.element,s=t.proxies[i].originalEp.elementId;t.endpoints[i]=t.proxies[i].originalEp,this.router.sourceOrTargetChanged(n,s,t,e,0===i?0:1),t.proxies[i].ep.detachFromConnection(t,null),t.proxies[i].originalEp.addConnection(t),t.isVisible()&&t.proxies[i].originalEp.setVisible(!0),delete t.proxies[i]}}});var f=new l;t.jsPlumb=f,f.getInstance=function(t,i){var n=new l(t);if(i)for(var e in i)n[e]=i[e];return n.init(),n},f.each=function(t,i){if(null!=t)if("string"==typeof t)i(f.getElement(t));else if(null!=t.length)for(var n=0;n<t.length;n++)i(f.getElement(t[n]));else i(t)},i.jsPlumb=f}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,i=t.jsPlumb,n=t.jsPlumbUtil;i.OverlayCapableJsPlumbUIComponent=function(i){t.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.overlays={},this._jsPlumb.overlayPositions={},i.label&&(this.getDefaultType().overlays.__label=["Label",{label:i.label,location:i.labelLocation||this.defaultLabelLocation||.5,labelStyle:i.labelStyle||this._jsPlumb.instance.Defaults.LabelStyle,id:"__label"}]),this.setListenerComponent=function(t){if(this._jsPlumb)for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i].setListenerComponent(t)}},i.OverlayCapableJsPlumbUIComponent.applyType=function(t,i){if(i.overlays){var n,e={};for(n in i.overlays){var s=t._jsPlumb.overlays[i.overlays[n][1].id];if(s)s.updateFrom(i.overlays[n][1]),e[i.overlays[n][1].id]=!0,s.reattach(t._jsPlumb.instance,t);else{var r=t.getCachedTypeItem("overlay",i.overlays[n][1].id);null!=r?(r.reattach(t._jsPlumb.instance,t),r.setVisible(!0),r.updateFrom(i.overlays[n][1]),t._jsPlumb.overlays[r.id]=r):r=t.addOverlay(i.overlays[n],!0),e[r.id]=!0}}for(n in t._jsPlumb.overlays)null==e[t._jsPlumb.overlays[n].id]&&t.removeOverlay(t._jsPlumb.overlays[n].id,!0)}},n.extend(i.OverlayCapableJsPlumbUIComponent,t.jsPlumbUIComponent,{setHover:function(t){if(this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged())for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i][t?"addClass":"removeClass"](this._jsPlumb.instance.hoverClass)},addOverlay:function(t,e){var s=function(t,e){var s=null;if(n.isArray(e)){var r=e[0],o=i.extend({component:t,_jsPlumb:t._jsPlumb.instance},e[1]);3===e.length&&i.extend(o,e[2]),s=new(i.Overlays[t._jsPlumb.instance.getRenderMode()][r])(o)}else s=e.constructor===String?new(i.Overlays[t._jsPlumb.instance.getRenderMode()][e])({component:t,_jsPlumb:t._jsPlumb.instance}):e;return s.id=s.id||n.uuid(),t.cacheTypeItem("overlay",s,s.id),t._jsPlumb.overlays[s.id]=s,s}(this,t);if(this.getData&&"Label"===s.type&&n.isArray(t)){var r=this.getData();if(r){var o=r?r[t[1].labelLocationAttribute||"labelLocation"]:null;o&&(s.loc=o)}}return e||this.repaint(),s},getOverlay:function(t){return this._jsPlumb.overlays[t]},getOverlays:function(){return this._jsPlumb.overlays},hideOverlay:function(t){var i=this.getOverlay(t);i&&i.hide()},hideOverlays:function(){for(var t in this._jsPlumb.overlays)this._jsPlumb.overlays[t].hide()},showOverlay:function(t){var i=this.getOverlay(t);i&&i.show()},showOverlays:function(){for(var t in this._jsPlumb.overlays)this._jsPlumb.overlays[t].show()},removeAllOverlays:function(t){for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i].cleanup&&this._jsPlumb.overlays[i].cleanup();this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null,this._jsPlumb.overlayPlacements={},t||this.repaint()},removeOverlay:function(t,i){var n=this._jsPlumb.overlays[t];n&&(n.setVisible(!1),!i&&n.cleanup&&n.cleanup(),delete this._jsPlumb.overlays[t],this._jsPlumb.overlayPositions&&delete this._jsPlumb.overlayPositions[t],this._jsPlumb.overlayPlacements&&delete this._jsPlumb.overlayPlacements[t])},removeOverlays:function(){for(var t=0,i=arguments.length;t<i;t++)this.removeOverlay(arguments[t])},moveParent:function(t){if(this.bgCanvas&&(this.bgCanvas.parentNode.removeChild(this.bgCanvas),t.appendChild(this.bgCanvas)),this.canvas&&this.canvas.parentNode)for(var i in this.canvas.parentNode.removeChild(this.canvas),t.appendChild(this.canvas),this._jsPlumb.overlays)if(this._jsPlumb.overlays[i].isAppendedAtTopLevel){var n=this._jsPlumb.overlays[i].getElement();n.parentNode.removeChild(n),t.appendChild(n)}},getLabel:function(){var t=this.getOverlay("__label");return null!=t?t.getLabel():null},getLabelOverlay:function(){return this.getOverlay("__label")},setLabel:function(t){var n,e,s,r=this.getOverlay("__label");r?t.constructor===String||t.constructor===Function?r.setLabel(t):(t.label&&r.setLabel(t.label),t.location&&r.setLocation(t.location)):(n=this,s=i.extend({cssClass:(e=t.constructor===String||t.constructor===Function?{label:t}:t).cssClass,labelStyle:n.labelStyle,id:"__label",component:n,_jsPlumb:n._jsPlumb.instance},e),r=new(i.Overlays[n._jsPlumb.instance.getRenderMode()].Label)(s),this._jsPlumb.overlays.__label=r),this._jsPlumb.instance.isSuspendDrawing()||this.repaint()},cleanup:function(t){for(var i in this._jsPlumb.overlays)this._jsPlumb.overlays[i].cleanup(t),this._jsPlumb.overlays[i].destroy(t);t&&(this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null)},setVisible:function(t){this[t?"showOverlays":"hideOverlays"]()},setAbsoluteOverlayPosition:function(t,i){this._jsPlumb.overlayPositions[t.id]=i},getAbsoluteOverlayPosition:function(t){return this._jsPlumb.overlayPositions?this._jsPlumb.overlayPositions[t.id]:null},_clazzManip:function(t,i,n){if(!n)for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e][t+"Class"](i)},addClass:function(t,i){this._clazzManip("add",t,i)},removeClass:function(t,i){this._clazzManip("remove",t,i)}})}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,i=this.jsPlumbUtil,n=function(t,i,n){var e=!1;return{drag:function(){if(e)return e=!1,!0;if(i.element){var s=n.getUIPosition(arguments,n.getZoom());null!=s&&n.setPosition(i.element,s),n.repaint(i.element,s),t.paint({anchorPoint:t.anchor.getCurrentLocation({element:t})})}},stopDrag:function(){e=!0}}},e=function(t,i,n,e){var s=i.createElement("div",{position:"absolute"});i.appendElement(s);var r=i.getId(s);i.setPosition(s,n),s.style.width=e[0]+"px",s.style.height=e[1]+"px",i.manage(r,s,!0),t.id=r,t.element=s},s=function(i,n,e,s,r,o,a,h){return a({paintStyle:i,endpoint:e,anchor:new t.FloatingAnchor({reference:n,referenceCanvas:s,jsPlumbInstance:o}),source:r,scope:h})},r=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],o=function(t,i){var n=0;if(null!=i)for(var e=0;e<t.connections.length;e++)if(t.connections[e].sourceId===i||t.connections[e].targetId===i){n=e;break}return t.connections[n]};t.Endpoint=function(a){var h=a._jsPlumb,u=a.newConnection,c=a.newEndpoint;this.idPrefix="_jsplumb_e_",this.defaultLabelLocation=[.5,.5],this.defaultOverlayKeys=["Overlays","EndpointOverlays"],t.OverlayCapableJsPlumbUIComponent.apply(this,arguments),this.appendToDefaultType({connectionType:a.connectionType,maxConnections:null==a.maxConnections?this._jsPlumb.instance.Defaults.MaxConnections:a.maxConnections,paintStyle:a.endpointStyle||a.paintStyle||a.style||this._jsPlumb.instance.Defaults.EndpointStyle||t.Defaults.EndpointStyle,hoverPaintStyle:a.endpointHoverStyle||a.hoverPaintStyle||this._jsPlumb.instance.Defaults.EndpointHoverStyle||t.Defaults.EndpointHoverStyle,connectorStyle:a.connectorStyle,connectorHoverStyle:a.connectorHoverStyle,connectorClass:a.connectorClass,connectorHoverClass:a.connectorHoverClass,connectorOverlays:a.connectorOverlays,connector:a.connector,connectorTooltip:a.connectorTooltip}),this._jsPlumb.enabled=!(!1===a.enabled),this._jsPlumb.visible=!0,this.element=t.getElement(a.source),this._jsPlumb.uuid=a.uuid,this._jsPlumb.floatingEndpoint=null,this._jsPlumb.uuid&&(a.endpointsByUUID[this._jsPlumb.uuid]=this),this.elementId=a.elementId,this.dragProxy=a.dragProxy,this._jsPlumb.connectionCost=a.connectionCost,this._jsPlumb.connectionsDirected=a.connectionsDirected,this._jsPlumb.currentAnchorClass="",this._jsPlumb.events={};var l=!0===a.deleteOnEmpty;this.setDeleteOnEmpty=function(t){l=t};var f=function(){var i=h.endpointAnchorClassPrefix+"-"+this._jsPlumb.currentAnchorClass;this._jsPlumb.currentAnchorClass=this.anchor.getCssClass();var n=h.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"");this.removeClass(i),this.addClass(n),t.updateClasses(this.element,n,i)}.bind(this);this.prepareAnchor=function(t){var i=this._jsPlumb.instance.makeAnchor(t,this.elementId,h);return i.bind("anchorChanged",function(t){this.fire("anchorChanged",{endpoint:this,anchor:t}),f()}.bind(this)),i},this.setPreparedAnchor=function(t,i){return this._jsPlumb.instance.continuousAnchorFactory.clear(this.elementId),this.anchor=t,f(),i||this._jsPlumb.instance.repaint(this.elementId),this},this.setAnchor=function(t,i){var n=this.prepareAnchor(t);return this.setPreparedAnchor(n,i),this};var v=function(t){if(this.connections.length>0)for(var i=0;i<this.connections.length;i++)this.connections[i].setHover(t,!1);else this.setHover(t)}.bind(this);this.bind("mouseover",(function(){v(!0)})),this.bind("mouseout",(function(){v(!1)})),a._transient||this._jsPlumb.instance.router.addEndpoint(this,this.elementId),this.prepareEndpoint=function(n,e){var s,r=function(i,n){var e=h.getRenderMode();if(t.Endpoints[e][i])return new t.Endpoints[e][i](n);if(!h.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown endpoint type '"+i+"'"}},o={_jsPlumb:this._jsPlumb.instance,cssClass:a.cssClass,container:a.container,tooltip:a.tooltip,connectorTooltip:a.connectorTooltip,endpoint:this};return i.isString(n)?s=r(n,o):i.isArray(n)?(o=i.merge(n[1],o),s=r(n[0],o)):s=n.clone(),s.clone=function(){return i.isString(n)?r(n,o):i.isArray(n)?(o=i.merge(n[1],o),r(n[0],o)):void 0}.bind(this),s.typeId=e,s},this.setEndpoint=function(t){var i=this.prepareEndpoint(t);this.setPreparedEndpoint(i,!0)},this.setPreparedEndpoint=function(t){null!=this.endpoint&&(this.endpoint.cleanup(),this.endpoint.destroy()),this.endpoint=t,this.type=this.endpoint.type,this.canvas=this.endpoint.canvas},t.extend(this,a,r),this.isSource=a.isSource||!1,this.isTemporarySource=a.isTemporarySource||!1,this.isTarget=a.isTarget||!1,this.connections=a.connections||[],this.connectorPointerEvents=a["connector-pointer-events"],this.scope=a.scope||h.getDefaultScope(),this.timestamp=null,this.reattachConnections=a.reattach||h.Defaults.ReattachConnections,this.connectionsDetachable=h.Defaults.ConnectionsDetachable,!1!==a.connectionsDetachable&&!1!==a.detachable||(this.connectionsDetachable=!1),this.dragAllowedWhenFull=!1!==a.dragAllowedWhenFull,a.onMaxConnections&&this.bind("maxConnections",a.onMaxConnections),this.addConnection=function(t){this.connections.push(t),this[(this.connections.length>0?"add":"remove")+"Class"](h.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](h.endpointFullClass)},this.detachFromConnection=function(t,i,n){(i=null==i?this.connections.indexOf(t):i)>=0&&(this.connections.splice(i,1),this[(this.connections.length>0?"add":"remove")+"Class"](h.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](h.endpointFullClass)),!n&&l&&0===this.connections.length&&h.deleteObject({endpoint:this,fireEvent:!1,deleteAttachedObjects:!0!==n})},this.deleteEveryConnection=function(t){for(var i=this.connections.length,n=0;n<i;n++)h.deleteConnection(this.connections[0],t)},this.detachFrom=function(t){for(var i=[],n=0;n<this.connections.length;n++)this.connections[n].endpoints[1]!==t&&this.connections[n].endpoints[0]!==t||i.push(this.connections[n]);for(var e=0,s=i.length;e<s;e++)h.deleteConnection(i[0]);return this},this.getElement=function(){return this.element},this.setElement=function(n){var e=this._jsPlumb.instance.getId(n),s=this.elementId;return i.removeWithFunction(a.endpointsByElement[this.elementId],function(t){return t.id===this.id}.bind(this)),this.element=t.getElement(n),this.elementId=h.getId(this.element),h.router.rehomeEndpoint(this,s,this.element),h.dragManager.endpointAdded(this.element),i.addToList(a.endpointsByElement,e,this),this},this.makeInPlaceCopy=function(){var t=this.anchor.getCurrentLocation({element:this}),i=this.anchor.getOrientation(this),n=this.anchor.getCssClass();return c({dropOptions:a.dropOptions,anchor:{bind:function(){},compute:function(){return[t[0],t[1]]},getCurrentLocation:function(){return[t[0],t[1]]},getOrientation:function(){return i},getCssClass:function(){return n}},source:this.element,paintStyle:this.getPaintStyle(),endpoint:a.hideOnDrag?"Blank":this.endpoint,_transient:!0,scope:this.scope,reference:this})},this.connectorSelector=function(){return this.connections[0]},this.setStyle=this.setPaintStyle,this.paint=function(t){var i=(t=t||{}).timestamp,n=!(!1===t.recalc);if(!i||this.timestamp!==i){var e=h.updateOffset({elId:this.elementId,timestamp:i}),s=t.offset?t.offset.o:e.o;if(null!=s){var r=t.anchorPoint,a=t.connectorPaintStyle;if(null==r){var u={xy:[s.left,s.top],wh:t.dimensions||e.s,element:this,timestamp:i};if(n&&this.anchor.isDynamic&&this.connections.length>0){var c=o(this,t.elementWithPrecedence),l=c.endpoints[0]===this?1:0,f=0===l?c.sourceId:c.targetId,v=h.getCachedData(f),d=v.o,p=v.s;u.index=0===l?1:0,u.connection=c,u.txy=[d.left,d.top],u.twh=p,u.tElement=c.endpoints[l],u.tRotation=h.getRotation(f)}else this.connections.length>0&&(u.connection=this.connections[0]);u.rotation=h.getRotation(this.elementId),r=this.anchor.compute(u)}for(var m in this.endpoint.compute(r,this.anchor.getOrientation(this),this._jsPlumb.paintStyleInUse,a||this.paintStyleInUse),this.endpoint.paint(this._jsPlumb.paintStyleInUse,this.anchor),this.timestamp=i,this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(m)){var g=this._jsPlumb.overlays[m];g.isVisible()&&(this._jsPlumb.overlayPlacements[m]=g.draw(this.endpoint,this._jsPlumb.paintStyleInUse),g.paint(this._jsPlumb.overlayPlacements[m]))}}}},this.getTypeDescriptor=function(){return"endpoint"},this.isVisible=function(){return this._jsPlumb.visible},this.repaint=this.paint;var d=!1;this.initDraggable=function(){if(!d&&t.isDragSupported(this.element)){var r,o={id:null,element:null},l=null,f=!1,v=null,p=n(this,o,h),m=a.dragOptions||{},g=t.dragEvents.start,y=t.dragEvents.stop,b=t.dragEvents.drag,x=t.dragEvents.beforeStart,w=function(){l=this.connectorSelector();var i=!0;this.isEnabled()||(i=!1),null!=l||this.isSource||this.isTemporarySource||(i=!1),!this.isSource||!this.isFull()||null!=l&&this.dragAllowedWhenFull||(i=!1),null==l||l.isDetachable(this)||(this.isFull()?i=!1:l=null);var n=h.checkCondition(null==l?"beforeDrag":"beforeStartDetach",{endpoint:this,source:this.element,sourceId:this.elementId,connection:l});if(!1===n?i=!1:"object"==typeof n?t.extend(n,r||{}):n=r||{},!1===i)return h.stopDrag&&h.stopDrag(this.canvas),p.stopDrag(),!1;for(var d=0;d<this.connections.length;d++)this.connections[d].setHover(!1);this.addClass("endpointDrag"),h.setConnectionBeingDragged(!0),l&&!this.isFull()&&this.isSource&&(l=null),h.updateOffset({elId:this.elementId});var m=this._jsPlumb.instance.getOffset(this.canvas),g=this.canvas,y=this._jsPlumb.instance.getSize(this.canvas);e(o,h,m,y),h.setAttributes(this.canvas,{dragId:o.id,elId:this.elementId});var b=this.dragProxy||this.endpoint;if(null==this.dragProxy&&null!=this.connectionType){var x=this._jsPlumb.instance.deriveEndpointAndAnchorSpec(this.connectionType);x.endpoints[1]&&(b=x.endpoints[1])}var w=this._jsPlumb.instance.makeAnchor("Center");w.isFloating=!0,this._jsPlumb.floatingEndpoint=s(this.getPaintStyle(),w,b,this.canvas,o.element,h,c,this.scope);var k=this._jsPlumb.floatingEndpoint.anchor;if(null==l)this.setHover(!1,!1),(l=u({sourceEndpoint:this,targetEndpoint:this._jsPlumb.floatingEndpoint,source:this.element,target:o.element,anchors:[this.anchor,this._jsPlumb.floatingEndpoint.anchor],paintStyle:a.connectorStyle,hoverPaintStyle:a.connectorHoverStyle,connector:a.connector,overlays:a.connectorOverlays,type:this.connectionType,cssClass:this.connectorClass,hoverClass:this.connectorHoverClass,scope:a.scope,data:n})).pending=!0,l.addClass(h.draggingClass),this._jsPlumb.floatingEndpoint.addClass(h.draggingClass),this._jsPlumb.floatingEndpoint.anchor=k,h.fire("connectionDrag",l),h.router.newConnection(l);else{f=!0,l.setHover(!1);var M=l.endpoints[0].id===this.id?0:1;this.detachFromConnection(l,null,!0);var j=h.getDragScope(g);h.setAttribute(this.canvas,"originalScope",j),h.fire("connectionDrag",l),0===M?(v=[l.source,l.sourceId,g,j],h.router.sourceOrTargetChanged(l.endpoints[M].elementId,o.id,l,o.element,0)):(v=[l.target,l.targetId,g,j],h.router.sourceOrTargetChanged(l.endpoints[M].elementId,o.id,l,o.element,1)),l.suspendedEndpoint=l.endpoints[M],l.suspendedElement=l.endpoints[M].getElement(),l.suspendedElementId=l.endpoints[M].elementId,l.suspendedElementType=0===M?"source":"target",l.suspendedEndpoint.setHover(!1),this._jsPlumb.floatingEndpoint.referenceEndpoint=l.suspendedEndpoint,l.endpoints[M]=this._jsPlumb.floatingEndpoint,l.addClass(h.draggingClass),this._jsPlumb.floatingEndpoint.addClass(h.draggingClass)}h.registerFloatingConnection(o,l,this._jsPlumb.floatingEndpoint),h.currentlyDragging=!0}.bind(this),k=function(){if(h.setConnectionBeingDragged(!1),l&&null!=l.endpoints){var t=h.getDropEvent(arguments),i=h.getFloatingAnchorIndex(l);if(l.endpoints[0===i?1:0].anchor.locked=!1,l.removeClass(h.draggingClass),this._jsPlumb&&(l.deleteConnectionNow||l.endpoints[i]===this._jsPlumb.floatingEndpoint)&&f&&l.suspendedEndpoint){0===i?(l.floatingElement=l.source,l.floatingId=l.sourceId,l.floatingEndpoint=l.endpoints[0],l.floatingIndex=0,l.source=v[0],l.sourceId=v[1]):(l.floatingElement=l.target,l.floatingId=l.targetId,l.floatingEndpoint=l.endpoints[1],l.floatingIndex=1,l.target=v[0],l.targetId=v[1]);var n=this._jsPlumb.floatingEndpoint;h.setDragScope(v[2],v[3]),l.endpoints[i]=l.suspendedEndpoint,l.isReattach()||l._forceReattach||l._forceDetach||!h.deleteConnection(l,{originalEvent:t})?(l.setHover(!1),l._forceDetach=null,l._forceReattach=null,this._jsPlumb.floatingEndpoint.detachFromConnection(l),l.suspendedEndpoint.addConnection(l),1===i?h.router.sourceOrTargetChanged(l.floatingId,l.targetId,l,l.target,i):h.router.sourceOrTargetChanged(l.floatingId,l.sourceId,l,l.source,i),h.repaint(v[1])):h.deleteObject({endpoint:n})}this.deleteAfterDragStop?h.deleteObject({endpoint:this}):this._jsPlumb&&this.paint({recalc:!1}),h.fire("connectionDragStop",l,t),l.pending&&h.fire("connectionAborted",l,t),h.currentlyDragging=!1,l.suspendedElement=null,l.suspendedEndpoint=null,l=null}o&&o.element&&h.remove(o.element,!1,!1),this._jsPlumb&&(this.canvas.style.visibility="visible",this.anchor.locked=!1,this._jsPlumb.floatingEndpoint=null)}.bind(this);(m=t.extend({},m)).scope=this.scope||m.scope,m[x]=i.wrap(m[x],(function(t){r=t.e.payload||{}}),!1),m[g]=i.wrap(m[g],w,!1),m[b]=i.wrap(m[b],p.drag),m[y]=i.wrap(m[y],k),m.multipleDrop=!1,m.canDrag=function(){return this.isSource||this.isTemporarySource||this.connections.length>0&&!1!==this.connectionsDetachable}.bind(this),h.initDraggable(this.canvas,m,"internal"),this.canvas._jsPlumbRelatedElement=this.element,d=!0}};var p=a.endpoint||this._jsPlumb.instance.Defaults.Endpoint||t.Defaults.Endpoint;this.setEndpoint(p,!0);var m=a.anchor?a.anchor:a.anchors?a.anchors:h.Defaults.Anchor||"Top";this.setAnchor(m,!0);var g=["default",a.type||""].join(" ");this.addType(g,a.data,!0),this.canvas=this.endpoint.canvas,this.canvas._jsPlumb=this,this.initDraggable();var y=function(n,e,s,r){if(t.isDropSupported(this.element)){var o=a.dropOptions||h.Defaults.DropOptions||t.Defaults.DropOptions;(o=t.extend({},o)).scope=o.scope||this.scope;var u=t.dragEvents.drop,c=t.dragEvents.over,l=t.dragEvents.out,f=this,v=h.EndpointDropHandler({getEndpoint:function(){return f},jsPlumb:h,enabled:function(){return null==s||s.isEnabled()},isFull:function(){return s.isFull()},element:this.element,elementId:this.elementId,isSource:this.isSource,isTarget:this.isTarget,addClass:function(t){f.addClass(t)},removeClass:function(t){f.removeClass(t)},isDropAllowed:function(){return f.isDropAllowed.apply(f,arguments)},reference:r,isRedrop:function(t,i){return t.suspendedEndpoint&&i.reference&&t.suspendedEndpoint.id===i.reference.id}});o[u]=i.wrap(o[u],v,!0),o[c]=i.wrap(o[c],function(){var i=t.getDragObject(arguments),n=h.getAttribute(t.getElement(i),"dragId"),e=h.getFloatingConnectionFor(n);if(null!=e){var s=h.getFloatingAnchorIndex(e),r=this.isTarget&&0!==s||e.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===e.suspendedEndpoint.id;if(r){var o=h.checkCondition("checkDropAllowed",{sourceEndpoint:e.endpoints[s],targetEndpoint:this,connection:e});this[(o?"add":"remove")+"Class"](h.endpointDropAllowedClass),this[(o?"remove":"add")+"Class"](h.endpointDropForbiddenClass),e.endpoints[s].anchor.over(this.anchor,this)}}}.bind(this)),o[l]=i.wrap(o[l],function(){var i=t.getDragObject(arguments),n=null==i?null:h.getAttribute(t.getElement(i),"dragId"),e=n?h.getFloatingConnectionFor(n):null;if(null!=e){var s=h.getFloatingAnchorIndex(e),r=this.isTarget&&0!==s||e.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===e.suspendedEndpoint.id;r&&(this.removeClass(h.endpointDropAllowedClass),this.removeClass(h.endpointDropForbiddenClass),e.endpoints[s].anchor.out())}}.bind(this)),h.initDroppable(n,o,"internal",e)}}.bind(this);return this.anchor.isFloating||y(this.canvas,!(a._transient||this.anchor.isFloating),this,a.reference),this},i.extend(t.Endpoint,t.OverlayCapableJsPlumbUIComponent,{setVisible:function(t,i,n){if(this._jsPlumb.visible=t,this.canvas&&(this.canvas.style.display=t?"block":"none"),this[t?"showOverlays":"hideOverlays"](),!i)for(var e=0;e<this.connections.length;e++)if(this.connections[e].setVisible(t),!n){var s=this===this.connections[e].endpoints[0]?1:0;1===this.connections[e].endpoints[s].connections.length&&this.connections[e].endpoints[s].setVisible(t,!0,!0)}},getAttachedElements:function(){return this.connections},applyType:function(i,n){this.setPaintStyle(i.endpointStyle||i.paintStyle,n),this.setHoverPaintStyle(i.endpointHoverStyle||i.hoverPaintStyle,n),null!=i.maxConnections&&(this._jsPlumb.maxConnections=i.maxConnections),i.scope&&(this.scope=i.scope),t.extend(this,i,r),null!=i.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,i.cssClass),t.OverlayCapableJsPlumbUIComponent.applyType(this,i)},isEnabled:function(){return this._jsPlumb.enabled},setEnabled:function(t){this._jsPlumb.enabled=t},cleanup:function(){t.removeClass(this.element,this._jsPlumb.instance.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"")),this.anchor=null,this.endpoint.cleanup(!0),this.endpoint.destroy(),this.endpoint=null,this._jsPlumb.instance.destroyDraggable(this.canvas,"internal"),this._jsPlumb.instance.destroyDroppable(this.canvas,"internal")},setHover:function(t){this.endpoint&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&this.endpoint.setHover(t)},isFull:function(){return 0===this._jsPlumb.maxConnections||!(this.isFloating()||this._jsPlumb.maxConnections<0||this.connections.length<this._jsPlumb.maxConnections)},isFloating:function(){return null!=this.anchor&&this.anchor.isFloating},isConnectedTo:function(t){var i=!1;if(t)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t){i=!0;break}return i},getConnectionCost:function(){return this._jsPlumb.connectionCost},setConnectionCost:function(t){this._jsPlumb.connectionCost=t},areConnectionsDirected:function(){return this._jsPlumb.connectionsDirected},setConnectionsDirected:function(t){this._jsPlumb.connectionsDirected=t},setElementId:function(t){this.elementId=t,this.anchor.elementId=t},setReferenceElement:function(i){this.element=t.getElement(i)},setDragAllowedWhenFull:function(t){this.dragAllowedWhenFull=t},equals:function(t){return this.anchor.equals(t.anchor)},getUuid:function(){return this._jsPlumb.uuid},computeAnchor:function(t){return this.anchor.compute(t)}}),this.jsPlumbInstance.prototype.EndpointDropHandler=function(t){return function(n){var e=t.jsPlumb;t.removeClass(e.endpointDropAllowedClass),t.removeClass(e.endpointDropForbiddenClass);var s=e.getDropEvent(arguments),r=e.getDragObject(arguments),o=e.getAttribute(r,"dragId"),a=(e.getAttribute(r,"elId"),e.getAttribute(r,"originalScope")),h=e.getFloatingConnectionFor(o);if(null!=h){var u=null!=h.suspendedEndpoint;if(!u||null!=h.suspendedEndpoint._jsPlumb){var c=t.getEndpoint(h);if(null!=c){if(t.isRedrop(h,t))return h._forceReattach=!0,h.setHover(!1),void(t.maybeCleanup&&t.maybeCleanup(c));var l=e.getFloatingAnchorIndex(h);if(0===l&&!t.isSource||1===l&&!t.isTarget)t.maybeCleanup&&t.maybeCleanup(c);else{t.onDrop&&t.onDrop(h),a&&e.setDragScope(r,a);var f=t.isFull(n);if(f&&c.fire("maxConnections",{endpoint:this,connection:h,maxConnections:c._jsPlumb.maxConnections},s),!f&&t.enabled()){var v=!0;0===l?(h.floatingElement=h.source,h.floatingId=h.sourceId,h.floatingEndpoint=h.endpoints[0],h.floatingIndex=0,h.source=t.element,h.sourceId=e.getId(t.element)):(h.floatingElement=h.target,h.floatingId=h.targetId,h.floatingEndpoint=h.endpoints[1],h.floatingIndex=1,h.target=t.element,h.targetId=e.getId(t.element)),u&&h.suspendedEndpoint.id!==c.id&&(h.isDetachAllowed(h)&&h.endpoints[l].isDetachAllowed(h)&&h.suspendedEndpoint.isDetachAllowed(h)&&e.checkCondition("beforeDetach",h)||(v=!1));var d=function(n){h.endpoints[l].detachFromConnection(h),h.suspendedEndpoint&&h.suspendedEndpoint.detachFromConnection(h),h.endpoints[l]=c,c.addConnection(h);var r=c.getParameters();for(var o in r)h.setParameter(o,r[o]);if(u){var a=h.suspendedEndpoint.elementId;e.fireMoveEvent({index:l,originalSourceId:0===l?a:h.sourceId,newSourceId:0===l?c.elementId:h.sourceId,originalTargetId:1===l?a:h.targetId,newTargetId:1===l?c.elementId:h.targetId,originalSourceEndpoint:0===l?h.suspendedEndpoint:h.endpoints[0],newSourceEndpoint:0===l?c:h.endpoints[0],originalTargetEndpoint:1===l?h.suspendedEndpoint:h.endpoints[1],newTargetEndpoint:1===l?c:h.endpoints[1],connection:h},s)}else r.draggable&&e.initDraggable(this.element,t.dragOptions,"internal",e);1===l?e.router.sourceOrTargetChanged(h.floatingId,h.targetId,h,h.target,1):e.router.sourceOrTargetChanged(h.floatingId,h.sourceId,h,h.source,0),h.endpoints[0].finalEndpoint&&(h.endpoints[0].detachFromConnection(h),h.endpoints[0]=h.endpoints[0].finalEndpoint,h.endpoints[0].addConnection(h)),i.isObject(n)&&h.mergeData(n),e.finaliseConnection(h,null,s,!1),h.setHover(!1),e.revalidate(h.endpoints[0].element)}.bind(this),p=function(){h.suspendedEndpoint&&(h.endpoints[l]=h.suspendedEndpoint,h.setHover(!1),h._forceDetach=!0,0===l?(h.source=h.suspendedEndpoint.element,h.sourceId=h.suspendedEndpoint.elementId):(h.target=h.suspendedEndpoint.element,h.targetId=h.suspendedEndpoint.elementId),h.suspendedEndpoint.addConnection(h),1===l?e.router.sourceOrTargetChanged(h.floatingId,h.targetId,h,h.target,1):e.router.sourceOrTargetChanged(h.floatingId,h.sourceId,h,h.source,0),e.repaint(h.sourceId),h._forceDetach=!1)};if(v=v&&t.isDropAllowed(h.sourceId,h.targetId,h.scope,h,c))return d(v),!0;p()}t.maybeCleanup&&t.maybeCleanup(c),e.currentlyDragging=!1}}}}}}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,i=t.jsPlumb,n=t.jsPlumbUtil,e=function(t,e,s,r,o){if(i.Connectors[e]=i.Connectors[e]||{},null==i.Connectors[e][s]){if(null==i.Connectors[s]){if(t.Defaults.DoNotThrowErrors)return null;throw new TypeError("jsPlumb: unknown connector type '"+s+"'")}i.Connectors[e][s]=function(){i.Connectors[s].apply(this,arguments),i.ConnectorRenderers[e].apply(this,arguments)},n.extend(i.Connectors[e][s],[i.Connectors[s],i.ConnectorRenderers[e]])}return new i.Connectors[e][s](r,o)},s=function(t,i,n){return t?n.makeAnchor(t,i,n):null},r=function(t,i,e,s){null!=i&&(i._jsPlumbConnections=i._jsPlumbConnections||{},s?delete i._jsPlumbConnections[t.id]:i._jsPlumbConnections[t.id]=!0,n.isEmpty(i._jsPlumbConnections)?e.removeClass(i,e.connectedClass):e.addClass(i,e.connectedClass))};i.Connection=function(t){var e=t.newEndpoint;this.id=t.id,this.connector=null,this.idPrefix="_jsplumb_c_",this.defaultLabelLocation=.5,this.defaultOverlayKeys=["Overlays","ConnectionOverlays"],this.previousConnection=t.previousConnection,this.source=i.getElement(t.source),this.target=i.getElement(t.target),i.OverlayCapableJsPlumbUIComponent.apply(this,arguments),t.sourceEndpoint?(this.source=t.sourceEndpoint.getElement(),this.sourceId=t.sourceEndpoint.elementId):this.sourceId=this._jsPlumb.instance.getId(this.source),t.targetEndpoint?(this.target=t.targetEndpoint.getElement(),this.targetId=t.targetEndpoint.elementId):this.targetId=this._jsPlumb.instance.getId(this.target),this.scope=t.scope,this.endpoints=[],this.endpointStyles=[];var s=this._jsPlumb.instance;s.manage(this.sourceId,this.source),s.manage(this.targetId,this.target),this._jsPlumb.visible=!0,this._jsPlumb.params={cssClass:t.cssClass,container:t.container,"pointer-events":t["pointer-events"],editorParams:t.editorParams,overlays:t.overlays},this._jsPlumb.lastPaintedAt=null,this.bind("mouseover",function(){this.setHover(!0)}.bind(this)),this.bind("mouseout",function(){this.setHover(!1)}.bind(this)),this.makeEndpoint=function(i,n,r,o,a){return r=r||this._jsPlumb.instance.getId(n),this.prepareEndpoint(s,e,this,o,i?0:1,t,n,r,a)},t.type&&(t.endpoints=t.endpoints||this._jsPlumb.instance.deriveEndpointAndAnchorSpec(t.type).endpoints);var r=this.makeEndpoint(!0,this.source,this.sourceId,t.sourceEndpoint),o=this.makeEndpoint(!1,this.target,this.targetId,t.targetEndpoint);r&&n.addToList(t.endpointsByElement,this.sourceId,r),o&&n.addToList(t.endpointsByElement,this.targetId,o),this.scope||(this.scope=this.endpoints[0].scope),null!=t.deleteEndpointsOnEmpty&&(this.endpoints[0].setDeleteOnEmpty(t.deleteEndpointsOnEmpty),this.endpoints[1].setDeleteOnEmpty(t.deleteEndpointsOnEmpty));var a=s.Defaults.ConnectionsDetachable;!1===t.detachable&&(a=!1),!1===this.endpoints[0].connectionsDetachable&&(a=!1),!1===this.endpoints[1].connectionsDetachable&&(a=!1);var h=t.reattach||this.endpoints[0].reattachConnections||this.endpoints[1].reattachConnections||s.Defaults.ReattachConnections;this.appendToDefaultType({detachable:a,reattach:h,paintStyle:this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||t.paintStyle||s.Defaults.PaintStyle||i.Defaults.PaintStyle,hoverPaintStyle:this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||t.hoverPaintStyle||s.Defaults.HoverPaintStyle||i.Defaults.HoverPaintStyle});var u=s.getSuspendedAt();if(!s.isSuspendDrawing()){var c=s.getCachedData(this.sourceId),l=c.o,f=c.s,v=s.getCachedData(this.targetId),d=v.o,p=v.s,m=u||jsPlumbUtil.uuid(),g=this.endpoints[0].anchor.compute({xy:[l.left,l.top],wh:f,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[d.left,d.top],twh:p,tElement:this.endpoints[1],timestamp:m,rotation:s.getRotation(this.endpoints[0].elementId)});this.endpoints[0].paint({anchorLoc:g,timestamp:m}),g=this.endpoints[1].anchor.compute({xy:[d.left,d.top],wh:p,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[l.left,l.top],twh:f,tElement:this.endpoints[0],timestamp:m,rotation:s.getRotation(this.endpoints[1].elementId)}),this.endpoints[1].paint({anchorLoc:g,timestamp:m})}this.getTypeDescriptor=function(){return"connection"},this.getAttachedElements=function(){return this.endpoints},this.isDetachable=function(t){return!1!==this._jsPlumb.detachable&&(null!=t?!0===t.connectionsDetachable:!0===this._jsPlumb.detachable)},this.setDetachable=function(t){this._jsPlumb.detachable=!0===t},this.isReattach=function(){return!0===this._jsPlumb.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections},this.setReattach=function(t){this._jsPlumb.reattach=!0===t},this._jsPlumb.cost=t.cost||this.endpoints[0].getConnectionCost(),this._jsPlumb.directed=t.directed,null==t.directed&&(this._jsPlumb.directed=this.endpoints[0].areConnectionsDirected());var y=i.extend({},this.endpoints[1].getParameters());i.extend(y,this.endpoints[0].getParameters()),i.extend(y,this.getParameters()),this.setParameters(y),this.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||t.connector||s.Defaults.Connector||i.Defaults.Connector,!0);var b=null!=t.data&&n.isObject(t.data)?t.data:{};this.getData=function(){return b},this.setData=function(t){b=t||{}},this.mergeData=function(t){b=i.extend(b,t)};var x=["default",this.endpoints[0].connectionType,this.endpoints[1].connectionType,t.type].join(" ");/[^\s]/.test(x)&&this.addType(x,t.data,!0),this.updateConnectedClass()},n.extend(i.Connection,i.OverlayCapableJsPlumbUIComponent,{applyType:function(t,n,e){var s=null;null!=t.connector&&(null==(s=this.getCachedTypeItem("connector",e.connector))&&(s=this.prepareConnector(t.connector,e.connector),this.cacheTypeItem("connector",s,e.connector)),this.setPreparedConnector(s)),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope),null!=t.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,t.cssClass);var r=null;t.anchor?null==(r=this.getCachedTypeItem("anchors",e.anchor))&&(r=[this._jsPlumb.instance.makeAnchor(t.anchor),this._jsPlumb.instance.makeAnchor(t.anchor)],this.cacheTypeItem("anchors",r,e.anchor)):t.anchors&&null==(r=this.getCachedTypeItem("anchors",e.anchors))&&(r=[this._jsPlumb.instance.makeAnchor(t.anchors[0]),this._jsPlumb.instance.makeAnchor(t.anchors[1])],this.cacheTypeItem("anchors",r,e.anchors)),null!=r&&(this.endpoints[0].anchor=r[0],this.endpoints[1].anchor=r[1],this.endpoints[1].anchor.isDynamic&&this._jsPlumb.instance.repaint(this.endpoints[1].elementId)),i.OverlayCapableJsPlumbUIComponent.applyType(this,t)},addClass:function(t,i){i&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(t)),this.connector&&this.connector.addClass(t)},removeClass:function(t,i){i&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(t)),this.connector&&this.connector.removeClass(t)},isVisible:function(){return this._jsPlumb.visible},setVisible:function(t){this._jsPlumb.visible=t,this.connector&&this.connector.setVisible(t),this.repaint()},cleanup:function(){this.updateConnectedClass(!0),this.endpoints=null,this.source=null,this.target=null,null!=this.connector&&(this.connector.cleanup(!0),this.connector.destroy(!0)),this.connector=null},updateConnectedClass:function(t){this._jsPlumb&&(r(this,this.source,this._jsPlumb.instance,t),r(this,this.target,this._jsPlumb.instance,t))},setHover:function(i){this.connector&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&(this.connector.setHover(i),t.jsPlumb[i?"addClass":"removeClass"](this.source,this._jsPlumb.instance.hoverSourceClass),t.jsPlumb[i?"addClass":"removeClass"](this.target,this._jsPlumb.instance.hoverTargetClass))},getUuids:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]},getCost:function(){return this._jsPlumb?this._jsPlumb.cost:-1/0},setCost:function(t){this._jsPlumb.cost=t},isDirected:function(){return this._jsPlumb.directed},getConnector:function(){return this.connector},prepareConnector:function(t,i){var s,r={_jsPlumb:this._jsPlumb.instance,cssClass:this._jsPlumb.params.cssClass,container:this._jsPlumb.params.container,"pointer-events":this._jsPlumb.params["pointer-events"]},o=this._jsPlumb.instance.getRenderMode();return n.isString(t)?s=e(this._jsPlumb.instance,o,t,r,this):n.isArray(t)&&(s=e(this._jsPlumb.instance,o,t[0],1===t.length?r:n.merge(t[1],r),this)),null!=i&&(s.typeId=i),s},setPreparedConnector:function(t,i,n,e){if(this.connector!==t){var s,r="";if(null!=this.connector&&(r=(s=this.connector).getClass(),this.connector.cleanup(),this.connector.destroy()),this.connector=t,e&&this.cacheTypeItem("connector",t,e),this.canvas=this.connector.canvas,this.bgCanvas=this.connector.bgCanvas,this.connector.reattach(this._jsPlumb.instance),this.addClass(r),this.canvas&&(this.canvas._jsPlumb=this),this.bgCanvas&&(this.bgCanvas._jsPlumb=this),null!=s)for(var o=this.getOverlays(),a=0;a<o.length;a++)o[a].transfer&&o[a].transfer(this.connector);n||this.setListenerComponent(this.connector),i||this.repaint()}},setConnector:function(t,i,n,e){var s=this.prepareConnector(t,e);this.setPreparedConnector(s,i,n,e)},paint:function(t){if(!this._jsPlumb.instance.isSuspendDrawing()&&this._jsPlumb.visible){var i=(t=t||{}).timestamp,n=this.targetId;if(null==i||i!==this._jsPlumb.lastPaintedAt){var e=this._jsPlumb.instance.updateOffset({elId:this.sourceId}).o,s=this._jsPlumb.instance.updateOffset({elId:n}).o,r=this.endpoints[0],o=this.endpoints[1],a=r.anchor.getCurrentLocation({xy:[e.left,e.top],wh:[e.width,e.height],element:r,timestamp:i,rotation:this._jsPlumb.instance.getRotation(this.sourceId)}),h=o.anchor.getCurrentLocation({xy:[s.left,s.top],wh:[s.width,s.height],element:o,timestamp:i,rotation:this._jsPlumb.instance.getRotation(this.targetId)});this.connector.resetBounds(),this.connector.compute({sourcePos:a,targetPos:h,sourceOrientation:r.anchor.getOrientation(r),targetOrientation:o.anchor.getOrientation(o),sourceEndpoint:this.endpoints[0],targetEndpoint:this.endpoints[1],"stroke-width":this._jsPlumb.paintStyleInUse.strokeWidth,sourceInfo:e,targetInfo:s});var u={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};for(var c in this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(c)){var l=this._jsPlumb.overlays[c];l.isVisible()&&(this._jsPlumb.overlayPlacements[c]=l.draw(this.connector,this._jsPlumb.paintStyleInUse,this.getAbsoluteOverlayPosition(l)),u.minX=Math.min(u.minX,this._jsPlumb.overlayPlacements[c].minX),u.maxX=Math.max(u.maxX,this._jsPlumb.overlayPlacements[c].maxX),u.minY=Math.min(u.minY,this._jsPlumb.overlayPlacements[c].minY),u.maxY=Math.max(u.maxY,this._jsPlumb.overlayPlacements[c].maxY))}var f=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||1)/2,v=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||0),d={xmin:Math.min(this.connector.bounds.minX-(f+v),u.minX),ymin:Math.min(this.connector.bounds.minY-(f+v),u.minY),xmax:Math.max(this.connector.bounds.maxX+(f+v),u.maxX),ymax:Math.max(this.connector.bounds.maxY+(f+v),u.maxY)};for(var p in this.connector.paintExtents=d,this.connector.paint(this._jsPlumb.paintStyleInUse,null,d),this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(p)){var m=this._jsPlumb.overlays[p];m.isVisible()&&m.paint(this._jsPlumb.overlayPlacements[p],d)}}this._jsPlumb.lastPaintedAt=i}},repaint:function(t){var i=jsPlumb.extend(t||{},{});i.elId=this.sourceId,this.paint(i)},prepareEndpoint:function(t,n,e,r,o,a,h,u,c){var l;if(r)e.endpoints[o]=r,r.addConnection(e);else{a.endpoints||(a.endpoints=[null,null]);var f=c||a.endpoints[o]||a.endpoint||t.Defaults.Endpoints[o]||i.Defaults.Endpoints[o]||t.Defaults.Endpoint||i.Defaults.Endpoint;a.endpointStyles||(a.endpointStyles=[null,null]),a.endpointHoverStyles||(a.endpointHoverStyles=[null,null]);var v=a.endpointStyles[o]||a.endpointStyle||t.Defaults.EndpointStyles[o]||i.Defaults.EndpointStyles[o]||t.Defaults.EndpointStyle||i.Defaults.EndpointStyle;null==v.fill&&null!=a.paintStyle&&(v.fill=a.paintStyle.stroke),null==v.outlineStroke&&null!=a.paintStyle&&(v.outlineStroke=a.paintStyle.outlineStroke),null==v.outlineWidth&&null!=a.paintStyle&&(v.outlineWidth=a.paintStyle.outlineWidth);var d=a.endpointHoverStyles[o]||a.endpointHoverStyle||t.Defaults.EndpointHoverStyles[o]||i.Defaults.EndpointHoverStyles[o]||t.Defaults.EndpointHoverStyle||i.Defaults.EndpointHoverStyle;null!=a.hoverPaintStyle&&(null==d&&(d={}),null==d.fill&&(d.fill=a.hoverPaintStyle.stroke));var p=a.anchors?a.anchors[o]:a.anchor?a.anchor:s(t.Defaults.Anchors[o],u,t)||s(i.Defaults.Anchors[o],u,t)||s(t.Defaults.Anchor,u,t)||s(i.Defaults.Anchor,u,t);l=n({paintStyle:v,hoverPaintStyle:d,endpoint:f,connections:[e],uuid:a.uuids?a.uuids[o]:null,anchor:p,source:h,scope:a.scope,reattach:a.reattach||t.Defaults.ReattachConnections,detachable:a.detachable||t.Defaults.ConnectionsDetachable}),null==r&&l.setDeleteOnEmpty(!0),e.endpoints[o]=l,!1===a.drawEndpoints&&l.setVisible(!1,!0,!0)}return l},replaceEndpoint:function(t,i){var n=this.endpoints[t],e=n.elementId,s=this._jsPlumb.instance.getEndpoints(e),r=s.indexOf(n),o=this.makeEndpoint(0===t,n.element,e,null,i);this.endpoints[t]=o,s.splice(r,1,o),this._jsPlumb.instance.deleteObject({endpoint:n,deleteAttachedObjects:!1}),this._jsPlumb.instance.fire("endpointReplaced",{previous:n,current:o}),this._jsPlumb.instance.router.sourceOrTargetChanged(this.endpoints[1].elementId,this.endpoints[1].elementId,this,this.endpoints[1].element,1)}})}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumbUtil,i=this.jsPlumb;i.AnchorManager=function(n){var e={},s={},r={},o={},a=this,h={},u=n.jsPlumbInstance,c={},l=function(t,i){return i[0][0]-t[0][0]},f=function(t,i){return(t[0][0]<0?-Math.PI-t[0][0]:Math.PI-t[0][0])-(i[0][0]<0?-Math.PI-i[0][0]:Math.PI-i[0][0])},v={top:f,right:l,bottom:l,left:f},d=function(t,i){var n=u.getCachedData(t),e=n.s,o=n.o,a=function(i,n,e,o,a,h,c){if(o.length>0)for(var l=function(t,i,n,e,s,r,o,a){for(var h=[],u=i[s?0:1]/(e.length+1),c=0;c<e.length;c++){var l=(c+1)*u,f=r*i[s?1:0];o&&(l=i[s?0:1]-l);var v=s?l:f,d=n.left+v,p=v/i[0],m=s?f:l,g=n.top+m,y=m/i[1];if(0!==a){var b=jsPlumbUtil.rotatePoint([d,g],[n.centerx,n.centery],a);d=b[0],g=b[1]}h.push([d,g,p,y,e[c][1],e[c][2]])}return h}(0,n,e,o.sort(v[i]),a,h,"right"===i||"top"===i,u.getRotation(t)),f=function(t,i){s[t.id]=[i[0],i[1],i[2],i[3]],r[t.id]=c},d=0;d<l.length;d++){var p=l[d][4],m=p.endpoints[1].elementId===t;p.endpoints[0].elementId===t&&f(p.endpoints[0],l[d]),m&&f(p.endpoints[1],l[d])}};a("bottom",e,o,i.bottom,!0,1,[0,1]),a("top",e,o,i.top,!0,0,[0,-1]),a("left",e,o,i.left,!1,0,[-1,0]),a("right",e,o,i.right,!1,1,[1,0])};this.reset=function(){e={},o={},h={}},this.addFloatingConnection=function(t,i){c[t]=i},this.newConnection=function(n){var e=n.sourceId,s=n.targetId,r=n.endpoints,a=!0,h=function(h,u,c,l,f){e===s&&c.isContinuous&&(n._jsPlumb.instance.removeElement(r[1].canvas),a=!1),t.addToList(o,l,[f,u,c.constructor===i.DynamicAnchor])};h(0,r[0],r[0].anchor,s,n),a&&h(0,r[1],r[1].anchor,e,n)};var p=function(i){!function(i,n){if(i){var e=function(t){return t[4]===n};t.removeWithFunction(i.top,e),t.removeWithFunction(i.left,e),t.removeWithFunction(i.bottom,e),t.removeWithFunction(i.right,e)}}(h[i.elementId],i.id)};this.connectionDetached=function(i,n){var e=i.connection||i,s=i.targetId,r=function(i,n,e,s,r){t.removeWithFunction(o[s],(function(t){return t[0].id===r.id}))};r(0,0,0,i.sourceId,e),r(0,0,0,s,e),e.floatingId&&(r(0,0,0,e.floatingId,e),p(e.floatingEndpoint)),p(e.endpoints[0]),p(e.endpoints[1]),n||(a.redraw(e.sourceId),e.targetId!==e.sourceId&&a.redraw(e.targetId))},this.addEndpoint=function(i,n){t.addToList(e,n,i)},this.changeId=function(t,i){o[i]=o[t],e[i]=e[t],delete o[t],delete e[t]},this.getConnectionsFor=function(t){return o[t]||[]},this.getEndpointsFor=function(t){return e[t]||[]},this.deleteEndpoint=function(i){t.removeWithFunction(e[i.elementId],(function(t){return t.id===i.id})),p(i)},this.elementRemoved=function(t){delete c[t],delete e[t],e[t]=[]};var m=function(i,e,s,r,o,a,h,u,c,l,f,v){var d,p,m=-1,g=r.endpoints[h],y=g.id,b=[1,0][h],x=[[e,s],r,o,a,y],w=i[c],k=g._continuousAnchorEdge?i[g._continuousAnchorEdge]:null;if(k){var M=t.findWithFunction(k,(function(t){return t[4]===y}));if(-1!==M)for(k.splice(M,1),d=0;d<k.length;d++)t.addWithFunction(f,p=k[d][1],(function(t){return t.id===p.id})),t.addWithFunction(v,k[d][1].endpoints[h],(function(t){return t.id===p.endpoints[h].id})),t.addWithFunction(v,k[d][1].endpoints[b],(function(t){return t.id===p.endpoints[b].id}))}for(d=0;d<w.length;d++)1===n.idx&&w[d][3]===a&&-1===m&&(m=d),t.addWithFunction(f,p=w[d][1],(function(t){return t.id===p.id})),t.addWithFunction(v,w[d][1].endpoints[h],(function(t){return t.id===p.endpoints[h].id})),t.addWithFunction(v,w[d][1].endpoints[b],(function(t){return t.id===p.endpoints[b].id}));w.splice(u?-1!==m?m:0:w.length,0,x),g._continuousAnchorEdge=c};this.sourceOrTargetChanged=function(n,e,s,r,a){if(0===a){if(n!==e){s.sourceId=e,s.source=r,t.removeWithFunction(o[n],(function(t){return t[0].id===s.id}));var h=t.findWithFunction(o[s.targetId],(function(t){return t[0].id===s.id}));h>-1&&(o[s.targetId][h][0]=s,o[s.targetId][h][1]=s.endpoints[0],o[s.targetId][h][2]=s.endpoints[0].anchor.constructor===i.DynamicAnchor),t.addToList(o,e,[s,s.endpoints[1],s.endpoints[1].anchor.constructor===i.DynamicAnchor]),s.endpoints[1].anchor.isContinuous&&(s.source===s.target?s._jsPlumb.instance.removeElement(s.endpoints[1].canvas):null==s.endpoints[1].canvas.parentNode&&s._jsPlumb.instance.appendElement(s.endpoints[1].canvas)),s.updateConnectedClass()}}else if(1===a){var u=s.endpoints[0].elementId;s.target=r,s.targetId=e;var c=t.findWithFunction(o[u],(function(t){return t[0].id===s.id})),l=t.findWithFunction(o[n],(function(t){return t[0].id===s.id}));-1!==c&&(o[u][c][0]=s,o[u][c][1]=s.endpoints[1],o[u][c][2]=s.endpoints[1].anchor.constructor===i.DynamicAnchor),l>-1&&(o[n].splice(l,1),t.addToList(o,e,[s,s.endpoints[0],s.endpoints[0].anchor.constructor===i.DynamicAnchor])),s.updateConnectedClass()}},this.rehomeEndpoint=function(t,i,n){var s=e[i]||[],r=u.getId(n);if(r!==i){var o=s.indexOf(t);if(o>-1){var h=s.splice(o,1)[0];a.add(h,r)}}for(var c=0;c<t.connections.length;c++)t.connections[c].sourceId===i?a.sourceOrTargetChanged(i,t.elementId,t.connections[c],t.element,0):t.connections[c].targetId===i&&a.sourceOrTargetChanged(i,t.elementId,t.connections[c],t.element,1)},this.redraw=function(n,s,r,a,l,f){var v=[],p=[],g=[];if(!u.isSuspendDrawing()){var y=e[n]||[],b=o[n]||[];r=r||jsPlumbUtil.uuid(),a=a||{left:0,top:0},s&&(s={left:s.left+a.left,top:s.top+a.top});for(var x=u.updateOffset({elId:n,offset:s,recalc:!1,timestamp:r}),w={},k=0;k<b.length;k++){var M=b[k][0],j=M.sourceId,C=M.targetId,S=M.endpoints[0].anchor.isContinuous,T=M.endpoints[1].anchor.isContinuous;if(S||T){var E=j+"_"+C,A=w[E],P=M.sourceId===n?1:0,D=u.getRotation(C),O=u.getRotation(j);S&&!h[j]&&(h[j]={top:[],right:[],bottom:[],left:[]}),T&&!h[C]&&(h[C]={top:[],right:[],bottom:[],left:[]}),n!==C&&u.updateOffset({elId:C,timestamp:r}),n!==j&&u.updateOffset({elId:j,timestamp:r});var I=u.getCachedData(C),H=u.getCachedData(j);C===j&&(S||T)?(m(h[j],-Math.PI/2,0,M,!1,C,0,!1,"top",0,v,p),m(h[C],-Math.PI/2,0,M,!1,j,1,!1,"top",0,v,p)):(A||(A=this.calculateOrientation(j,C,H.o,I.o,M.endpoints[0].anchor,M.endpoints[1].anchor,M,O,D),w[E]=A),S&&m(h[j],A.theta,0,M,!1,C,0,!1,A.a[0],0,v,p),T&&m(h[C],A.theta2,-1,M,!0,j,1,!0,A.a[1],0,v,p)),S&&t.addWithFunction(g,j,(function(t){return t===j})),T&&t.addWithFunction(g,C,(function(t){return t===C})),t.addWithFunction(v,M,(function(t){return t.id===M.id})),(S&&0===P||T&&1===P)&&t.addWithFunction(p,M.endpoints[P],(function(t){return t.id===M.endpoints[P].id}))}}for(k=0;k<y.length;k++)0===y[k].connections.length&&y[k].anchor.isContinuous&&(h[n]||(h[n]={top:[],right:[],bottom:[],left:[]}),m(h[n],-Math.PI/2,0,{endpoints:[y[k],y[k]],paint:function(){}},!1,n,0,!1,y[k].anchor.getDefaultFace(),0,v,p),t.addWithFunction(g,n,(function(t){return t===n})));for(k=0;k<g.length;k++)d(g[k],h[g[k]]);for(k=0;k<y.length;k++)y[k].paint({timestamp:r,offset:x,dimensions:x.s,recalc:!0!==f});for(k=0;k<p.length;k++){var L=u.getCachedData(p[k].elementId);p[k].paint({timestamp:null,offset:L,dimensions:L.s})}for(k=0;k<b.length;k++){var _=b[k][1];if(_.anchor.constructor===i.DynamicAnchor){_.paint({elementWithPrecedence:n,timestamp:r}),t.addWithFunction(v,b[k][0],(function(t){return t.id===b[k][0].id}));for(var F=0;F<_.connections.length;F++)_.connections[F]!==b[k][0]&&t.addWithFunction(v,_.connections[F],(function(t){return t.id===_.connections[F].id}))}else t.addWithFunction(v,b[k][0],(function(t){return t.id===b[k][0].id}))}var N=c[n];for(N&&N.paint({timestamp:r,recalc:!1,elId:n}),k=0;k<v.length;k++)v[k].paint({elId:n,timestamp:null,recalc:!1,clearEdits:l})}return{c:v,e:p}};var g=function(i){t.EventGenerator.apply(this),this.type="Continuous",this.isDynamic=!0,this.isContinuous=!0;for(var n=i.faces||["top","right","bottom","left"],e=!(!1===i.clockwise),o={},a={top:"bottom",right:"left",left:"right",bottom:"top"},h={top:"right",right:"bottom",left:"top",bottom:"left"},u={top:"left",right:"top",left:"bottom",bottom:"right"},c=e?h:u,l=e?u:h,f=i.cssClass||"",v=null,d=null,p=["left","right"],m=["top","bottom"],g=null,y=0;y<n.length;y++)o[n[y]]=!0;this.getDefaultFace=function(){return 0===n.length?"top":n[0]},this.isRelocatable=function(){return!0},this.isSnapOnRelocate=function(){return!0},this.verifyEdge=function(t){return o[t]?t:o[a[t]]?a[t]:o[c[t]]?c[t]:o[l[t]]?l[t]:t},this.isEdgeSupported=function(t){return null==g?null==d?!0===o[t]:d===t:-1!==g.indexOf(t)},this.setCurrentFace=function(t,i){v=t,i&&null!=d&&(d=v)},this.getCurrentFace=function(){return v},this.getSupportedFaces=function(){var t=[];for(var i in o)o[i]&&t.push(i);return t},this.lock=function(){d=v},this.unlock=function(){d=null},this.isLocked=function(){return null!=d},this.lockCurrentAxis=function(){null!=v&&(g="left"===v||"right"===v?p:m)},this.unlockCurrentAxis=function(){g=null},this.compute=function(t){return s[t.element.id]||[0,0]},this.getCurrentLocation=function(t){return s[t.element.id]||[0,0]},this.getOrientation=function(t){return r[t.id]||[0,0]},this.getCssClass=function(){return f}};u.continuousAnchorFactory={get:function(t){return new g(t)},clear:function(t){delete s[t]}}},i.AnchorManager.prototype.calculateOrientation=function(t,i,n,e,s,r,o,a,h){var u=["left","top","right","bottom"];if(t===i)return{orientation:"identity",a:["top","top"]};var c=Math.atan2(e.centery-n.centery,e.centerx-n.centerx),l=Math.atan2(n.centery-e.centery,n.centerx-e.centerx),f=[],v={};!function(t,i){for(var n=0;n<t.length;n++)if(v[t[n]]={left:[i[n][0].left,i[n][0].centery],right:[i[n][0].right,i[n][0].centery],top:[i[n][0].centerx,i[n][0].top],bottom:[i[n][0].centerx,i[n][0].bottom]},0!==i[n][1])for(var e in v[t[n]])v[t[n]][e]=jsPlumbUtil.rotatePoint(v[t[n]][e],[i[n][0].centerx,i[n][0].centery],i[n][1])}(["source","target"],[[n,a],[e,h]]);for(var d=0;d<u.length;d++)for(var p=0;p<u.length;p++)f.push({source:u[d],target:u[p],dist:Biltong.lineLength(v.source[u[d]],v.target[u[p]])});f.sort((function(t,i){return t.dist<i.dist?-1:t.dist>i.dist?1:0}));for(var m=f[0].source,g=f[0].target,y=0;y<f.length&&(m=s.isContinuous&&s.locked?s.getCurrentFace():!s.isContinuous||s.isEdgeSupported(f[y].source)?f[y].source:null,g=r.isContinuous&&r.locked?r.getCurrentFace():!r.isContinuous||r.isEdgeSupported(f[y].target)?f[y].target:null,null==m||null==g);y++);return s.isContinuous&&s.setCurrentFace(m),r.isContinuous&&r.setCurrentFace(g),{a:[m,g],theta:c,theta2:l}},i.Anchor=function(i){this.x=i.x||0,this.y=i.y||0,this.elementId=i.elementId,this.cssClass=i.cssClass||"",this.orientation=i.orientation||[0,0],this.lastReturnValue=null,this.offsets=i.offsets||[0,0],this.timestamp=null,this._unrotatedOrientation=[this.orientation[0],this.orientation[1]],this.relocatable=!1!==i.relocatable,this.snapOnRelocate=!1!==i.snapOnRelocate,this.locked=!1,t.EventGenerator.apply(this),this.compute=function(t){var i=t.xy,n=t.wh,e=t.timestamp;if(e&&e===this.timestamp)return this.lastReturnValue;var s=[i[0]+this.x*n[0]+this.offsets[0],i[1]+this.y*n[1]+this.offsets[1],this.x,this.y],r=t.rotation;if(null!=r&&0!==r){var o=jsPlumbUtil.rotatePoint(s,[i[0]+n[0]/2,i[1]+n[1]/2],r);this.orientation[0]=Math.round(this._unrotatedOrientation[0]*o[2]-this._unrotatedOrientation[1]*o[3]),this.orientation[1]=Math.round(this._unrotatedOrientation[1]*o[2]+this._unrotatedOrientation[0]*o[3]),this.lastReturnValue=[o[0],o[1],this.x,this.y]}else this.orientation[0]=this._unrotatedOrientation[0],this.orientation[1]=this._unrotatedOrientation[1],this.lastReturnValue=s;return this.timestamp=e,this.lastReturnValue},this.getCurrentLocation=function(t){return t=t||{},null==this.lastReturnValue||null!=t.timestamp&&this.timestamp!==t.timestamp?this.compute(t):this.lastReturnValue},this.setPosition=function(t,i,n,e,s){this.locked&&!s||(this.x=t,this.y=i,this.orientation=[n,e],this.lastReturnValue=null)}},t.extend(i.Anchor,t.EventGenerator,{equals:function(t){if(!t)return!1;var i=t.getOrientation(),n=this.getOrientation();return this.x===t.x&&this.y===t.y&&this.offsets[0]===t.offsets[0]&&this.offsets[1]===t.offsets[1]&&n[0]===i[0]&&n[1]===i[1]},getOrientation:function(){return this.orientation},getCssClass:function(){return this.cssClass}}),i.FloatingAnchor=function(t){i.Anchor.apply(this,arguments);var n=t.reference,e=t.referenceCanvas,s=i.getSize(e),r=0,o=0,a=null,h=null;this.orientation=null,this.x=0,this.y=0,this.isFloating=!0,this.compute=function(t){var i=t.xy,n=[i[0]+s[0]/2,i[1]+s[1]/2];return h=n,n},this.getOrientation=function(t){if(a)return a;var i=n.getOrientation(t);return[Math.abs(i[0])*r*-1,Math.abs(i[1])*o*-1]},this.over=function(t,i){a=t.getOrientation(i)},this.out=function(){a=null},this.getCurrentLocation=function(t){return null==h?this.compute(t):h}},t.extend(i.FloatingAnchor,i.Anchor);var n=function(t,n,e){return t.constructor===i.Anchor?t:n.makeAnchor(t,e,n)};i.DynamicAnchor=function(t){i.Anchor.apply(this,arguments),this.isDynamic=!0,this.anchors=[],this.elementId=t.elementId,this.jsPlumbInstance=t.jsPlumbInstance;for(var e=0;e<t.anchors.length;e++)this.anchors[e]=n(t.anchors[e],this.jsPlumbInstance,this.elementId);this.getAnchors=function(){return this.anchors};var s=this.anchors.length>0?this.anchors[0]:null,r=s,o=function(t,i,n,e,s,r){var o=e[0]+t.x*s[0],a=e[1]+t.y*s[1],h=e[0]+s[0]/2,u=e[1]+s[1]/2;if(null!=r&&0!==r){var c=jsPlumbUtil.rotatePoint([o,a],[h,u],r);o=c[0],a=c[1]}return Math.sqrt(Math.pow(i-o,2)+Math.pow(n-a,2))+Math.sqrt(Math.pow(h-o,2)+Math.pow(u-a,2))},a=t.selector||function(t,i,n,e,s,r,a){for(var h=n[0]+e[0]/2,u=n[1]+e[1]/2,c=-1,l=1/0,f=0;f<a.length;f++){var v=o(a[f],h,u,t,i,s);v<l&&(c=f+0,l=v)}return a[c]};this.compute=function(t){var i=t.xy,n=t.wh,e=t.txy,o=t.twh,h=t.rotation,u=t.tRotation;return this.timestamp=t.timestamp,this.locked||null==e||null==o?(this.lastReturnValue=s.compute(t),this.lastReturnValue):(t.timestamp=null,s=a(i,n,e,o,h,u,this.anchors),this.x=s.x,this.y=s.y,s!==r&&this.fire("anchorChanged",s),r=s,this.lastReturnValue=s.compute(t),this.lastReturnValue)},this.getCurrentLocation=function(t){return null!=s?s.getCurrentLocation(t):null},this.getOrientation=function(t){return null!=s?s.getOrientation(t):[0,0]},this.over=function(t,i){null!=s&&s.over(t,i)},this.out=function(){null!=s&&s.out()},this.setAnchor=function(t){s=t},this.getCssClass=function(){return s&&s.getCssClass()||""},this.setAnchorCoordinates=function(t){var i=jsPlumbUtil.findWithFunction(this.anchors,(function(i){return i.x===t[0]&&i.y===t[1]}));return-1!==i&&(this.setAnchor(this.anchors[i]),!0)}},t.extend(i.DynamicAnchor,i.Anchor);var e=function(t,n,e,s,r,o){i.Anchors[r]=function(i){var a=i.jsPlumbInstance.makeAnchor([t,n,e,s,0,0],i.elementId,i.jsPlumbInstance);return a.type=r,o&&o(a,i),a}};e(.5,0,0,-1,"TopCenter"),e(.5,1,0,1,"BottomCenter"),e(0,.5,-1,0,"LeftMiddle"),e(1,.5,1,0,"RightMiddle"),e(.5,0,0,-1,"Top"),e(.5,1,0,1,"Bottom"),e(0,.5,-1,0,"Left"),e(1,.5,1,0,"Right"),e(.5,.5,0,0,"Center"),e(1,0,0,-1,"TopRight"),e(1,1,0,1,"BottomRight"),e(0,0,0,-1,"TopLeft"),e(0,1,0,1,"BottomLeft"),i.Defaults.DynamicAnchors=function(t){return t.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],t.elementId,t.jsPlumbInstance)},i.Anchors.AutoDefault=function(t){var n=t.jsPlumbInstance.makeDynamicAnchor(i.Defaults.DynamicAnchors(t));return n.type="AutoDefault",n};var s=function(t,n){i.Anchors[t]=function(i){var e=i.jsPlumbInstance.makeAnchor(["Continuous",{faces:n}],i.elementId,i.jsPlumbInstance);return e.type=t,e}};i.Anchors.Continuous=function(t){return t.jsPlumbInstance.continuousAnchorFactory.get(t)},s("ContinuousLeft",["left"]),s("ContinuousTop",["top"]),s("ContinuousBottom",["bottom"]),s("ContinuousRight",["right"]),e(0,0,0,0,"Assign",(function(t,i){var n=i.position||"Fixed";t.positionFinder=n.constructor===String?i.jsPlumbInstance.AnchorPositionFinders[n]:n,t.constructorParams=i})),this.jsPlumbInstance.prototype.AnchorPositionFinders={Fixed:function(t,i,n){return[(t.left-i.left)/n[0],(t.top-i.top)/n[1]]},Grid:function(t,i,n,e){var s=t.top-i.top,r=n[0]/e.grid[0],o=n[1]/e.grid[1],a=Math.floor((t.left-i.left)/r),h=Math.floor(s/o);return[(a*r+r/2)/n[0],(h*o+o/2)/n[1]]}},i.Anchors.Perimeter=function(t){var i=(t=t||{}).anchorCount||60,n=t.shape;if(!n)throw new Error("no shape supplied to Perimeter Anchor type");var e=function(){for(var t=.5,n=2*Math.PI/i,e=0,s=[],r=0;r<i;r++){var o=t+t*Math.sin(e),a=t+t*Math.cos(e);s.push([o,a,0,0]),e+=n}return s},s=function(t){for(var n=i/t.length,e=[],s=function(t,s,r,o,a,h,u){for(var c=(r-t)/(n=i*a),l=(o-s)/n,f=0;f<n;f++)e.push([t+c*f,s+l*f,null==h?0:h,null==u?0:u])},r=0;r<t.length;r++)s.apply(null,t[r]);return e},r=function(t){for(var i=[],n=0;n<t.length;n++)i.push([t[n][0],t[n][1],t[n][2],t[n][3],1/t.length,t[n][4],t[n][5]]);return s(i)},o=function(){return r([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]])},a={Circle:e,Ellipse:e,Diamond:function(){return r([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]])},Rectangle:o,Square:o,Triangle:function(){return r([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]])},Path:function(t){for(var i=t.points,n=[],e=0,r=0;r<i.length-1;r++){var o=Math.sqrt(Math.pow(i[r][2]-i[r][0])+Math.pow(i[r][3]-i[r][1]));e+=o,n.push([i[r][0],i[r][1],i[r+1][0],i[r+1][1],o])}for(var a=0;a<n.length;a++)n[a][4]=n[a][4]/e;return s(n)}};if(!a[n])throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type");var h=a[n](t);t.rotation&&(h=function(t,i){for(var n=[],e=i/180*Math.PI,s=0;s<t.length;s++){var r=t[s][0]-.5,o=t[s][1]-.5;n.push([r*Math.cos(e)-o*Math.sin(e)+.5,r*Math.sin(e)+o*Math.cos(e)+.5,t[s][2],t[s][3]])}return n}(h,t.rotation));var u=t.jsPlumbInstance.makeDynamicAnchor(h);return u.type="Perimeter",u}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb;t.DefaultRouter=function(i){this.jsPlumbInstance=i,this.anchorManager=new t.AnchorManager({jsPlumbInstance:i}),this.sourceOrTargetChanged=function(t,i,n,e,s){this.anchorManager.sourceOrTargetChanged(t,i,n,e,s)},this.reset=function(){this.anchorManager.reset()},this.changeId=function(t,i){this.anchorManager.changeId(t,i)},this.elementRemoved=function(t){this.anchorManager.elementRemoved(t)},this.newConnection=function(t){this.anchorManager.newConnection(t)},this.connectionDetached=function(t,i){this.anchorManager.connectionDetached(t,i)},this.redraw=function(t,i,n,e,s,r){return this.anchorManager.redraw(t,i,n,e,s,r)},this.deleteEndpoint=function(t){this.anchorManager.deleteEndpoint(t)},this.rehomeEndpoint=function(t,i,n){this.anchorManager.rehomeEndpoint(t,i,n)},this.addEndpoint=function(t,i){this.anchorManager.addEndpoint(t,i)}}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,i=t.jsPlumb,n=t.jsPlumbUtil,e=t.Biltong;i.Segments={AbstractSegment:function(t){this.params=t,this.findClosestPointOnPath=function(){return{d:1/0,x:null,y:null,l:null}},this.getBounds=function(){return{minX:Math.min(t.x1,t.x2),minY:Math.min(t.y1,t.y2),maxX:Math.max(t.x1,t.x2),maxY:Math.max(t.y1,t.y2)}},this.lineIntersection=function(){return[]},this.boxIntersection=function(t,i,n,e){var s=[];return s.push.apply(s,this.lineIntersection(t,i,t+n,i)),s.push.apply(s,this.lineIntersection(t+n,i,t+n,i+e)),s.push.apply(s,this.lineIntersection(t+n,i+e,t,i+e)),s.push.apply(s,this.lineIntersection(t,i+e,t,i)),s},this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.y)}},Straight:function(t){i.Segments.AbstractSegment.apply(this,arguments);var n,s,r,o,a,h,u,c=function(){n=Math.sqrt(Math.pow(a-o,2)+Math.pow(u-h,2)),s=e.gradient({x:o,y:h},{x:a,y:u}),r=-1/s};this.type="Straight",this.getLength=function(){return n},this.getGradient=function(){return s},this.getCoordinates=function(){return{x1:o,y1:h,x2:a,y2:u}},this.setCoordinates=function(t){o=t.x1,h=t.y1,a=t.x2,u=t.y2,c()},this.setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),this.getBounds=function(){return{minX:Math.min(o,a),minY:Math.min(h,u),maxX:Math.max(o,a),maxY:Math.max(h,u)}},this.pointOnPath=function(t,i){return 0!==t||i?1!==t||i?e.pointOnLine({x:o,y:h},{x:a,y:u},i?t>0?t:n+t:t*n):{x:a,y:u}:{x:o,y:h}},this.gradientAtPoint=function(){return s},this.pointAlongPathFrom=function(t,i,n){var s=this.pointOnPath(t,n),r=i<=0?{x:o,y:h}:{x:a,y:u};return i<=0&&Math.abs(i)>1&&(i*=-1),e.pointOnLine(s,r,i)};var l=function(t,i,n){return n>=Math.min(t,i)&&n<=Math.max(t,i)},f=function(t,i,n){return Math.abs(n-t)<Math.abs(n-i)?t:i};this.findClosestPointOnPath=function(t,i){var c={d:1/0,x:null,y:null,l:null,x1:o,x2:a,y1:h,y2:u};if(0===s)c.y=h,c.x=l(o,a,t)?t:f(o,a,t);else if(s===1/0||s===-1/0)c.x=o,c.y=l(h,u,i)?i:f(h,u,i);else{var v=h-s*o,d=(i-r*t-v)/(s-r),p=s*d+v;c.x=l(o,a,d)?d:f(o,a,d),c.y=l(h,u,p)?p:f(h,u,p)}var m=e.lineLength([c.x,c.y],[o,h]);return c.d=e.lineLength([t,i],[c.x,c.y]),c.l=m/n,c};var v=function(t,i,n){return n>i?i<=t&&t<=n:i>=t&&t>=n},d=v;this.lineIntersection=function(t,i,n,r){var c=Math.abs(e.gradient({x:t,y:i},{x:n,y:r})),l=Math.abs(s),f=l===1/0?o:h-l*o,v=[],p=c===1/0?t:i-c*t;if(c!==l)if(c===1/0&&0===l)d(t,o,a)&&d(h,i,r)&&(v=[t,h]);else if(0===c&&l===1/0)d(i,h,u)&&d(o,t,n)&&(v=[o,i]);else{var m,g;c===1/0?d(m=t,o,a)&&d(g=l*t+f,i,r)&&(v=[m,g]):0===c?d(g=i,h,u)&&d(m=(i-f)/l,t,n)&&(v=[m,g]):(g=l*(m=(p-f)/(l-c))+f,d(m,o,a)&&d(g,h,u)&&(v=[m,g]))}return v},this.boxIntersection=function(t,i,n,e){var s=[];return s.push.apply(s,this.lineIntersection(t,i,t+n,i)),s.push.apply(s,this.lineIntersection(t+n,i,t+n,i+e)),s.push.apply(s,this.lineIntersection(t+n,i+e,t,i+e)),s.push.apply(s,this.lineIntersection(t,i+e,t,i)),s},this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}},Arc:function(t){i.Segments.AbstractSegment.apply(this,arguments);var n=function(i,n){return e.theta([t.cx,t.cy],[i,n])},s=function(t,i){if(t.anticlockwise){var n=t.startAngle<t.endAngle?t.startAngle+r:t.startAngle;return n-Math.abs(n-t.endAngle)*i}var e=Math.abs((t.endAngle<t.startAngle?t.endAngle+r:t.endAngle)-t.startAngle);return t.startAngle+e*i},r=2*Math.PI;this.radius=t.r,this.anticlockwise=t.ac,this.type="Arc",t.startAngle&&t.endAngle?(this.startAngle=t.startAngle,this.endAngle=t.endAngle,this.x1=t.cx+this.radius*Math.cos(t.startAngle),this.y1=t.cy+this.radius*Math.sin(t.startAngle),this.x2=t.cx+this.radius*Math.cos(t.endAngle),this.y2=t.cy+this.radius*Math.sin(t.endAngle)):(this.startAngle=n(t.x1,t.y1),this.endAngle=n(t.x2,t.y2),this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2),this.endAngle<0&&(this.endAngle+=r),this.startAngle<0&&(this.startAngle+=r);var o=this.endAngle<this.startAngle?this.endAngle+r:this.endAngle;this.sweep=Math.abs(o-this.startAngle),this.anticlockwise&&(this.sweep=r-this.sweep);var a=2*Math.PI*this.radius,h=this.sweep/r,u=a*h;this.getLength=function(){return u},this.getBounds=function(){return{minX:t.cx-t.r,maxX:t.cx+t.r,minY:t.cy-t.r,maxY:t.cy+t.r}};var c=1e-10,l=function(t){var i=Math.floor(t),n=Math.ceil(t);return t-i<c?i:n-t<c?n:t};this.pointOnPath=function(i,n){if(0===i)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===i)return{x:this.x2,y:this.y2,theta:this.endAngle};n&&(i/=u);var e=s(this,i),r=t.cx+t.r*Math.cos(e),o=t.cy+t.r*Math.sin(e);return{x:l(r),y:l(o),theta:e}},this.gradientAtPoint=function(i,n){var s=this.pointOnPath(i,n),r=e.normal([t.cx,t.cy],[s.x,s.y]);return this.anticlockwise||r!==1/0&&r!==-1/0||(r*=-1),r},this.pointAlongPathFrom=function(i,n,e){var s=this.pointOnPath(i,e),r=n/a*2*Math.PI,o=s.theta+(this.anticlockwise?-1:1)*r;return{x:t.cx+this.radius*Math.cos(o),y:t.cy+this.radius*Math.sin(o)}}},Bezier:function(n){this.curve=[{x:n.x1,y:n.y1},{x:n.cp1x,y:n.cp1y},{x:n.cp2x,y:n.cp2y},{x:n.x2,y:n.y2}];var e=function(t){return t[0].x===t[1].x&&t[0].y===t[1].y},s=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))},r=function(t){var i={x:0,y:0};if(0===t)return this.curve[0];var n=this.curve.length-1;if(1===t)return this.curve[n];var e=this.curve,s=1-t;if(0===n)return this.curve[0];if(1===n)return{x:s*e[0].x+t*e[1].x,y:s*e[0].y+t*e[1].y};if(n<4){var r,o,a,h=s*s,u=t*t,c=0;return 2===n?(e=[e[0],e[1],e[2],i],r=h,o=s*t*2,a=u):3===n&&(r=h*s,o=h*t*3,a=s*u*3,c=t*u),{x:r*e[0].x+o*e[1].x+a*e[2].x+c*e[3].x,y:r*e[0].y+o*e[1].y+a*e[2].y+c*e[3].y}}return i}.bind(this),o=function(t){var i=[];t--;for(var n=0;n<=t;n++)i.push(r(n/t));return i},a=function(){e(this.curve)&&(this.length=0);var t=o(16);this.length=0;for(var i=0;i<15;i++)this.length+=s(t[i],t[i+1])}.bind(this);i.Segments.AbstractSegment.apply(this,arguments),this.bounds={minX:Math.min(n.x1,n.x2,n.cp1x,n.cp2x),minY:Math.min(n.y1,n.y2,n.cp1y,n.cp2y),maxX:Math.max(n.x1,n.x2,n.cp1x,n.cp2x),maxY:Math.max(n.y1,n.y2,n.cp1y,n.cp2y)},this.type="Bezier",a();var h=function(i,n,e){return e&&(n=t.jsBezier.locationAlongCurveFrom(i,n>0?0:1,n)),n};this.pointOnPath=function(i,n){return i=h(this.curve,i,n),t.jsBezier.pointOnCurve(this.curve,i)},this.gradientAtPoint=function(i,n){return i=h(this.curve,i,n),t.jsBezier.gradientAtPoint(this.curve,i)},this.pointAlongPathFrom=function(i,n,e){return i=h(this.curve,i,e),t.jsBezier.pointAlongCurveFrom(this.curve,i,n)},this.getLength=function(){return this.length},this.getBounds=function(){return this.bounds},this.findClosestPointOnPath=function(i,n){var e=t.jsBezier.nearestPointOnCurve({x:i,y:n},this.curve);return{d:Math.sqrt(Math.pow(e.point.x-i,2)+Math.pow(e.point.y-n,2)),x:e.point.x,y:e.point.y,l:1-e.location,s:this}},this.lineIntersection=function(i,n,e,s){return t.jsBezier.lineIntersection(i,n,e,s,this.curve)}}},i.SegmentRenderer={getPath:function(t,i){return{Straight:function(i){var n=t.getCoordinates();return(i?"M "+n.x1+" "+n.y1+" ":"")+"L "+n.x2+" "+n.y2},Bezier:function(i){var n=t.params;return(i?"M "+n.x2+" "+n.y2+" ":"")+"C "+n.cp2x+" "+n.cp2y+" "+n.cp1x+" "+n.cp1y+" "+n.x1+" "+n.y1},Arc:function(i){var n=t.sweep>Math.PI?1:0;return(i?"M"+t.x1+" "+t.y1+" ":"")+"A "+t.radius+" "+t.params.r+" 0 "+n+","+(t.anticlockwise?0:1)+" "+t.x2+" "+t.y2}}[t.type](i)}};var s=function(){this.resetBounds=function(){this.bounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}},this.resetBounds()};i.Connectors.AbstractConnector=function(t){s.apply(this,arguments);var r=[],o=0,a=[],h=[],u=t.stub||0,c=n.isArray(u)?u[0]:u,l=n.isArray(u)?u[1]:u,f=t.gap||0,v=n.isArray(f)?f[0]:f,d=n.isArray(f)?f[1]:f,p=null,m=null;this.getPathData=function(){for(var t="",n=0;n<r.length;n++)t+=i.SegmentRenderer.getPath(r[n],0===n),t+=" ";return t},this.findSegmentForPoint=function(t,i){for(var n={d:1/0,s:null,x:null,y:null,l:null},e=0;e<r.length;e++){var s=r[e].findClosestPointOnPath(t,i);s.d<n.d&&(n.d=s.d,n.l=s.l,n.x=s.x,n.y=s.y,n.s=r[e],n.x1=s.x1,n.x2=s.x2,n.y1=s.y1,n.y2=s.y2,n.index=e,n.connectorLocation=a[e][0]+s.l*(a[e][1]-a[e][0]))}return n},this.lineIntersection=function(t,i,n,e){for(var s=[],o=0;o<r.length;o++)s.push.apply(s,r[o].lineIntersection(t,i,n,e));return s},this.boxIntersection=function(t,i,n,e){for(var s=[],o=0;o<r.length;o++)s.push.apply(s,r[o].boxIntersection(t,i,n,e));return s},this.boundingBoxIntersection=function(t){for(var i=[],n=0;n<r.length;n++)i.push.apply(i,r[n].boundingBoxIntersection(t));return i};var g=function(){for(var t=0,i=0;i<r.length;i++){var n=r[i].getLength();h[i]=n/o,a[i]=[t,t+=n/o]}},y=function(t,i){var n,e,s;if(i&&(t=t>0?t/o:(o+t)/o),1===t)n=r.length-1,s=1;else if(0===t)s=0,n=0;else if(t>=.5){for(n=0,s=0,e=a.length-1;e>-1;e--)if(a[e][1]>=t&&a[e][0]<=t){n=e,s=(t-a[e][0])/h[e];break}}else for(n=a.length-1,s=1,e=0;e<a.length;e++)if(a[e][1]>=t){n=e,s=(t-a[e][0])/h[e];break}return{segment:r[n],proportion:s,index:n}},b=function(t,n,e){if(e.x1!==e.x2||e.y1!==e.y2){var s=new i.Segments[n](e);r.push(s),o+=s.getLength(),t.updateBounds(s)}},x=function(){o=r.length=a.length=h.length=0};this.setSegments=function(t){p=[],o=0;for(var i=0;i<t.length;i++)p.push(t[i]),o+=t[i].getLength()},this.getLength=function(){return o};var w=function(t){this.strokeWidth=t.strokeWidth;var i=e.quadrant(t.sourcePos,t.targetPos),n=t.targetPos[0]<t.sourcePos[0],s=t.targetPos[1]<t.sourcePos[1],r=t.strokeWidth||1,o=t.sourceEndpoint.anchor.getOrientation(t.sourceEndpoint),a=t.targetEndpoint.anchor.getOrientation(t.targetEndpoint),h=n?t.targetPos[0]:t.sourcePos[0],u=s?t.targetPos[1]:t.sourcePos[1],f=Math.abs(t.targetPos[0]-t.sourcePos[0]),p=Math.abs(t.targetPos[1]-t.sourcePos[1]);if(0===o[0]&&0===o[1]||0===a[0]&&0===a[1]){var m=f>p?0:1,g=[1,0][m];a=[],(o=[])[m]=t.sourcePos[m]>t.targetPos[m]?-1:1,a[m]=t.sourcePos[m]>t.targetPos[m]?1:-1,o[g]=0,a[g]=0}var y=n?f+v*o[0]:v*o[0],b=s?p+v*o[1]:v*o[1],x=n?d*a[0]:f+d*a[0],w=s?d*a[1]:p+d*a[1],k=o[0]*a[0]+o[1]*a[1],M={sx:y,sy:b,tx:x,ty:w,lw:r,xSpan:Math.abs(x-y),ySpan:Math.abs(w-b),mx:(y+x)/2,my:(b+w)/2,so:o,to:a,x:h,y:u,w:f,h:p,segment:i,startStubX:y+o[0]*c,startStubY:b+o[1]*c,endStubX:x+a[0]*l,endStubY:w+a[1]*l,isXGreaterThanStubTimes2:Math.abs(y-x)>c+l,isYGreaterThanStubTimes2:Math.abs(b-w)>c+l,opposite:-1===k,perpendicular:0===k,orthogonal:1===k,sourceAxis:0===o[0]?"y":"x",points:[h,u,f,p,y,b,x,w],stubs:[c,l]};return M.anchorOrientation=M.opposite?"opposite":M.orthogonal?"orthogonal":"perpendicular",M};return this.getSegments=function(){return r},this.updateBounds=function(t){var i=t.getBounds();this.bounds.minX=Math.min(this.bounds.minX,i.minX),this.bounds.maxX=Math.max(this.bounds.maxX,i.maxX),this.bounds.minY=Math.min(this.bounds.minY,i.minY),this.bounds.maxY=Math.max(this.bounds.maxY,i.maxY)},this.pointOnPath=function(t,i){var n=y(t,i);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||[0,0]},this.gradientAtPoint=function(t,i){var n=y(t,i);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0},this.pointAlongPathFrom=function(t,i,n){var e=y(t,n);return e.segment&&e.segment.pointAlongPathFrom(e.proportion,i,!1)||[0,0]},this.compute=function(t){m=w.call(this,t),x(),this._compute(m,t),this.x=m.points[0],this.y=m.points[1],this.w=m.points[2],this.h=m.points[3],this.segment=m.segment,g()},{addSegment:b,prepareCompute:w,sourceStub:c,targetStub:l,maxStub:Math.max(c,l),sourceGap:v,targetGap:d,maxGap:Math.max(v,d)}},n.extend(i.Connectors.AbstractConnector,s),i.Endpoints.AbstractEndpoint=function(t){s.apply(this,arguments);var i=this.compute=function(t,i,n,e){var s=this._compute.apply(this,arguments);return this.x=s[0],this.y=s[1],this.w=s[2],this.h=s[3],this.bounds.minX=this.x,this.bounds.minY=this.y,this.bounds.maxX=this.x+this.w,this.bounds.maxY=this.y+this.h,s};return{compute:i,cssClass:t.cssClass}},n.extend(i.Endpoints.AbstractEndpoint,s),i.Endpoints.Dot=function(t){this.type="Dot",i.Endpoints.AbstractEndpoint.apply(this,arguments),this.radius=(t=t||{}).radius||10,this.defaultOffset=.5*this.radius,this.defaultInnerRadius=this.radius/3,this._compute=function(t,i,n){this.radius=n.radius||this.radius;var e=t[0]-this.radius,s=t[1]-this.radius,r=2*this.radius,o=2*this.radius;if(n.stroke){var a=n.strokeWidth||1;e-=a,s-=a,r+=2*a,o+=2*a}return[e,s,r,o,this.radius]}},n.extend(i.Endpoints.Dot,i.Endpoints.AbstractEndpoint),i.Endpoints.Rectangle=function(t){this.type="Rectangle",i.Endpoints.AbstractEndpoint.apply(this,arguments),this.width=(t=t||{}).width||20,this.height=t.height||20,this._compute=function(t,i,n){var e=n.width||this.width,s=n.height||this.height;return[t[0]-e/2,t[1]-s/2,e,s]}},n.extend(i.Endpoints.Rectangle,i.Endpoints.AbstractEndpoint);var r=function(){i.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.displayElements=[]};n.extend(r,i.jsPlumbUIComponent,{getDisplayElements:function(){return this._jsPlumb.displayElements},appendDisplayElement:function(t){this._jsPlumb.displayElements.push(t)}}),i.Endpoints.Image=function(e){this.type="Image",r.apply(this,arguments),i.Endpoints.AbstractEndpoint.apply(this,arguments);var s=e.onload,o=e.src||e.url,a=e.cssClass?" "+e.cssClass:"";this._jsPlumb.img=new Image,this._jsPlumb.ready=!1,this._jsPlumb.initialized=!1,this._jsPlumb.deleted=!1,this._jsPlumb.widthToUse=e.width,this._jsPlumb.heightToUse=e.height,this._jsPlumb.endpoint=e.endpoint,this._jsPlumb.img.onload=function(){null!=this._jsPlumb&&(this._jsPlumb.ready=!0,this._jsPlumb.widthToUse=this._jsPlumb.widthToUse||this._jsPlumb.img.width,this._jsPlumb.heightToUse=this._jsPlumb.heightToUse||this._jsPlumb.img.height,s&&s(this))}.bind(this),this._jsPlumb.endpoint.setImage=function(t,i){s=i,this._jsPlumb.img.src=t.constructor===String?t:t.src,null!=this.canvas&&this.canvas.setAttribute("src",this._jsPlumb.img.src)}.bind(this),this._jsPlumb.endpoint.setImage(o,s),this._compute=function(t){return this.anchorPoint=t,this._jsPlumb.ready?[t[0]-this._jsPlumb.widthToUse/2,t[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse]:[0,0,0,0]},this.canvas=i.createElement("img",{position:"absolute",margin:0,padding:0,outline:0},this._jsPlumb.instance.endpointClass+a),this._jsPlumb.widthToUse&&this.canvas.setAttribute("width",this._jsPlumb.widthToUse),this._jsPlumb.heightToUse&&this.canvas.setAttribute("height",this._jsPlumb.heightToUse),this._jsPlumb.instance.appendElement(this.canvas),this.actuallyPaint=function(){this._jsPlumb.deleted||(this._jsPlumb.initialized||(this.canvas.setAttribute("src",this._jsPlumb.img.src),this.appendDisplayElement(this.canvas),this._jsPlumb.initialized=!0),n.sizeElement(this.canvas,this.anchorPoint[0]-this._jsPlumb.widthToUse/2,this.anchorPoint[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse))},this.paint=function(i,n){null!=this._jsPlumb&&(this._jsPlumb.ready?this.actuallyPaint(i,n):t.setTimeout(function(){this.paint(i,n)}.bind(this),200))}},n.extend(i.Endpoints.Image,[r,i.Endpoints.AbstractEndpoint],{cleanup:function(t){t&&(this._jsPlumb.deleted=!0,this.canvas&&this.canvas.parentNode.removeChild(this.canvas),this.canvas=null)}}),i.Endpoints.Blank=function(t){i.Endpoints.AbstractEndpoint.apply(this,arguments),this.type="Blank",r.apply(this,arguments),this._compute=function(t){return[t[0],t[1],10,0]};var e=t.cssClass?" "+t.cssClass:"";this.canvas=i.createElement("div",{display:"block",width:"1px",height:"1px",background:"transparent",position:"absolute"},this._jsPlumb.instance.endpointClass+e),this._jsPlumb.instance.appendElement(this.canvas),this.paint=function(){n.sizeElement(this.canvas,this.x,this.y,this.w,this.h)}},n.extend(i.Endpoints.Blank,[i.Endpoints.AbstractEndpoint,r],{cleanup:function(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}),i.Endpoints.Triangle=function(t){this.type="Triangle",i.Endpoints.AbstractEndpoint.apply(this,arguments);var n=this;(t=t||{}).width=t.width||55,t.height=t.height||55,this.width=t.width,this.height=t.height,this._compute=function(t,i,e){var s=e.width||n.width,r=e.height||n.height;return[t[0]-s/2,t[1]-r/2,s,r]}};var o=i.Overlays.AbstractOverlay=function(t){this.visible=!0,this.isAppendedAtTopLevel=!0,this.component=t.component,this.loc=null==t.location?.5:t.location,this.endpointLoc=null==t.endpointLocation?[.5,.5]:t.endpointLocation,this.visible=!1!==t.visible};o.prototype={cleanup:function(t){t&&(this.component=null,this.canvas=null,this.endpointLoc=null)},reattach:function(){},setVisible:function(t){this.visible=t,this.component.repaint()},isVisible:function(){return this.visible},hide:function(){this.setVisible(!1)},show:function(){this.setVisible(!0)},incrementLocation:function(t){this.loc+=t,this.component.repaint()},setLocation:function(t){this.loc=t,this.component.repaint()},getLocation:function(){return this.loc},updateFrom:function(){}},i.Overlays.Arrow=function(t){this.type="Arrow",o.apply(this,arguments),this.isAppendedAtTopLevel=!1;var s=this;this.length=(t=t||{}).length||20,this.width=t.width||20,this.id=t.id,this.direction=(t.direction||1)<0?-1:1;var r=t.paintStyle||{"stroke-width":1},a=t.foldback||.623;this.computeMaxSize=function(){return 1.5*s.width},this.elementCreated=function(n){if(this.path=n,t.events)for(var e in t.events)i.on(n,e,t.events[e])},this.draw=function(t,i){var s,o,h,u;if(t.pointAlongPathFrom){if(n.isString(this.loc)||this.loc>1||this.loc<0){var c=parseInt(this.loc,10),l=this.loc<0?1:0;s=t.pointAlongPathFrom(l,c,!1),o=t.pointAlongPathFrom(l,c-this.direction*this.length/2,!1),h=e.pointOnLine(s,o,this.length)}else if(1===this.loc){if(s=t.pointOnPath(this.loc),o=t.pointAlongPathFrom(this.loc,-this.length),h=e.pointOnLine(s,o,this.length),-1===this.direction){var f=h;h=s,s=f}}else if(0===this.loc){if(h=t.pointOnPath(this.loc),o=t.pointAlongPathFrom(this.loc,this.length),s=e.pointOnLine(h,o,this.length),-1===this.direction){var v=h;h=s,s=v}}else s=t.pointAlongPathFrom(this.loc,this.direction*this.length/2),o=t.pointOnPath(this.loc),h=e.pointOnLine(s,o,this.length);return{component:t,d:{hxy:s,tail:u=e.perpendicularLineTo(s,h,this.width),cxy:e.pointOnLine(s,h,a*this.length)},"stroke-width":r.strokeWidth||i.strokeWidth,stroke:r.stroke||i.stroke,fill:r.fill||i.stroke,minX:Math.min(s.x,u[0].x,u[1].x),maxX:Math.max(s.x,u[0].x,u[1].x),minY:Math.min(s.y,u[0].y,u[1].y),maxY:Math.max(s.y,u[0].y,u[1].y)}}return{component:t,minX:0,maxX:0,minY:0,maxY:0}}},n.extend(i.Overlays.Arrow,o,{updateFrom:function(t){this.length=t.length||this.length,this.width=t.width||this.width,this.direction=null!=t.direction?t.direction:this.direction,this.foldback=t.foldback||this.foldback},cleanup:function(){this.path&&this.path.parentNode&&this.path.parentNode.removeChild(this.path)}}),i.Overlays.PlainArrow=function(t){var n=i.extend(t=t||{},{foldback:1});i.Overlays.Arrow.call(this,n),this.type="PlainArrow"},n.extend(i.Overlays.PlainArrow,i.Overlays.Arrow),i.Overlays.Diamond=function(t){var n=i.extend(t=t||{},{length:(t.length||40)/2,foldback:2});i.Overlays.Arrow.call(this,n),this.type="Diamond"},n.extend(i.Overlays.Diamond,i.Overlays.Arrow);var a=function(t,i){return(null==t._jsPlumb.cachedDimensions||i)&&(t._jsPlumb.cachedDimensions=t.getDimensions()),t._jsPlumb.cachedDimensions},h=function(t){i.jsPlumbUIComponent.apply(this,arguments),o.apply(this,arguments);var e=this.fire;this.fire=function(){e.apply(this,arguments),this.component&&this.component.fire.apply(this.component,arguments)},this.detached=!1,this.id=t.id,this._jsPlumb.div=null,this._jsPlumb.initialised=!1,this._jsPlumb.component=t.component,this._jsPlumb.cachedDimensions=null,this._jsPlumb.create=t.create,this._jsPlumb.initiallyInvisible=!1===t.visible,this.getElement=function(){if(null==this._jsPlumb.div){var n=this._jsPlumb.div=i.getElement(this._jsPlumb.create(this._jsPlumb.component));n.style.position="absolute",jsPlumb.addClass(n,this._jsPlumb.instance.overlayClass+" "+(this.cssClass?this.cssClass:t.cssClass?t.cssClass:"")),this._jsPlumb.instance.appendElement(n),this._jsPlumb.instance.getId(n),this.canvas=n;var e="translate(-50%, -50%)";n.style.webkitTransform=e,n.style.mozTransform=e,n.style.msTransform=e,n.style.oTransform=e,n.style.transform=e,n._jsPlumb=this,!1===t.visible&&(n.style.display="none")}return this._jsPlumb.div},this.draw=function(t,i,e){var s=a(this);if(null!=s&&2===s.length){var r={x:0,y:0};if(e)r={x:e[0],y:e[1]};else if(t.pointOnPath){var o=this.loc,h=!1;(n.isString(this.loc)||this.loc<0||this.loc>1)&&(o=parseInt(this.loc,10),h=!0),r=t.pointOnPath(o,h)}else{var u=this.loc.constructor===Array?this.loc:this.endpointLoc;r={x:u[0]*t.w,y:u[1]*t.h}}var c=r.x-s[0]/2,l=r.y-s[1]/2;return{component:t,d:{minx:c,miny:l,td:s,cxy:r},minX:c,maxX:c+s[0],minY:l,maxY:l+s[1]}}return{minX:0,maxX:0,minY:0,maxY:0}}};n.extend(h,[i.jsPlumbUIComponent,o],{getDimensions:function(){return[1,1]},setVisible:function(t){this._jsPlumb.div&&(this._jsPlumb.div.style.display=t?"block":"none",t&&this._jsPlumb.initiallyInvisible&&(a(this,!0),this.component.repaint(),this._jsPlumb.initiallyInvisible=!1))},clearCachedDimensions:function(){this._jsPlumb.cachedDimensions=null},cleanup:function(t){t?null!=this._jsPlumb.div&&(this._jsPlumb.div._jsPlumb=null,this._jsPlumb.instance.removeElement(this._jsPlumb.div)):(this._jsPlumb&&this._jsPlumb.div&&this._jsPlumb.div.parentNode&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div),this.detached=!0)},reattach:function(t){null!=this._jsPlumb.div&&t.getContainer().appendChild(this._jsPlumb.div),this.detached=!1},computeMaxSize:function(){var t=a(this);return Math.max(t[0],t[1])},paint:function(t){this._jsPlumb.initialised||(this.getElement(),t.component.appendDisplayElement(this._jsPlumb.div),this._jsPlumb.initialised=!0,this.detached&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div)),this._jsPlumb.div.style.left=t.component.x+t.d.minx+"px",this._jsPlumb.div.style.top=t.component.y+t.d.miny+"px"}}),i.Overlays.Custom=function(t){this.type="Custom",h.apply(this,arguments)},n.extend(i.Overlays.Custom,h),i.Overlays.GuideLines=function(){var t=this;t.length=50,t.strokeWidth=5,this.type="GuideLines",o.apply(this,arguments),i.jsPlumbUIComponent.apply(this,arguments),this.draw=function(i){var n=i.pointAlongPathFrom(t.loc,t.length/2),s=i.pointOnPath(t.loc),r=e.pointOnLine(n,s,t.length),o=e.perpendicularLineTo(n,r,40),a=e.perpendicularLineTo(r,n,20);return{connector:i,head:n,tail:r,headLine:a,tailLine:o,minX:Math.min(n.x,r.x,a[0].x,a[1].x),minY:Math.min(n.y,r.y,a[0].y,a[1].y),maxX:Math.max(n.x,r.x,a[0].x,a[1].x),maxY:Math.max(n.y,r.y,a[0].y,a[1].y)}}},i.Overlays.Label=function(t){this.labelStyle=t.labelStyle,this.cssClass=null!=this.labelStyle?this.labelStyle.cssClass:null;var n=i.extend({create:function(){return i.createElement("div")}},t);if(i.Overlays.Custom.call(this,n),this.type="Label",this.label=t.label||"",this.labelText=null,this.labelStyle){var e=this.getElement();this.labelStyle.font=this.labelStyle.font||"12px sans-serif",e.style.font=this.labelStyle.font,e.style.color=this.labelStyle.color||"black",this.labelStyle.fill&&(e.style.background=this.labelStyle.fill),this.labelStyle.borderWidth>0&&(e.style.border=this.labelStyle.borderWidth+"px solid "+(this.labelStyle.borderStyle?this.labelStyle.borderStyle:"black")),this.labelStyle.padding&&(e.style.padding=this.labelStyle.padding)}},n.extend(i.Overlays.Label,i.Overlays.Custom,{cleanup:function(t){t&&(this.div=null,this.label=null,this.labelText=null,this.cssClass=null,this.labelStyle=null)},getLabel:function(){return this.label},setLabel:function(t){this.label=t,this.labelText=null,this.clearCachedDimensions(),this.update(),this.component.repaint()},getDimensions:function(){return this.update(),h.prototype.getDimensions.apply(this,arguments)},update:function(){if("function"==typeof this.label){var t=this.label(this);this.getElement().innerHTML=t.replace(/\r\n/g,"<br/>")}else null==this.labelText&&(this.labelText=this.label,this.getElement().innerHTML=this.labelText.replace(/\r\n/g,"<br/>"))},updateFrom:function(t){null!=t.label&&this.setLabel(t.label)}})}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,i=t.jsPlumbUtil,n=t.jsPlumbInstance,e="_jsPlumbGroup",s=function(t){var n={},s={},r={},o=this;function a(i,n){for(var e=t.getContainer();;){if(null==i||i===e)return!1;if(i===n)return!0;i=i.parentNode}}function h(i,n){for(var e=i.getEl().querySelectorAll(".jtk-managed"),s=0;s<e.length;s++)t[n?"show":"hide"](e[s],!0)}t.bind("connection",(function(n){var e=t.getGroupFor(n.source),o=t.getGroupFor(n.target);null!=e&&null!=o&&e===o?(s[n.connection.id]=e,r[n.connection.id]=e):(null!=e&&(i.suggest(e.connections.source,n.connection),s[n.connection.id]=e),null!=o&&(i.suggest(o.connections.target,n.connection),r[n.connection.id]=o))})),t.bind("internal.connectionDetached",(function(t){!function(t){delete t.proxies;var n,e=s[t.id];null!=e&&(i.removeWithFunction(e.connections.source,n=function(i){return i.id===t.id}),i.removeWithFunction(e.connections.target,n),delete s[t.id]),null!=(e=r[t.id])&&(i.removeWithFunction(e.connections.source,n=function(i){return i.id===t.id}),i.removeWithFunction(e.connections.target,n),delete r[t.id])}(t.connection)})),t.bind("connectionMoved",(function(t){var i=(0===t.index?s:r)[t.connection.id];if(i){var n=i.connections[0===t.index?"source":"target"],e=n.indexOf(t.connection);-1!==e&&n.splice(e,1)}})),this.addGroup=function(i){t.addClass(i.getEl(),"jtk-group-expanded"),n[i.id]=i,i.manager=this,l(i),t.fire("group:add",{group:i})},this.addToGroup=function(i,n,e){if(i=this.getGroup(i)){var s=i.getEl();if(n._isJsPlumbGroup)return;var r=n._jsPlumbGroup;if(r!==i){t.removeFromDragSelection(n);var a=t.getOffset(n,!0),h=t.getOffset(i.collapsed?s:i.getDragArea(),!0);null!=r&&(r.remove(n,!1,e,!1,i),o.updateConnectionsForGroup(r)),i.add(n,e);var l=function(t,n){var e=0===n?1:0;t.each((function(t){t.setVisible(!1),t.endpoints[e].element._jsPlumbGroup===i?(t.endpoints[e].setVisible(!1),c(t,e,i)):(t.endpoints[n].setVisible(!1),u(t,n,i))}))};i.collapsed&&(l(t.select({source:n}),0),l(t.select({target:n}),1));var f=t.getId(n);t.dragManager.setParent(n,f,s,t.getId(s),a);var v={left:a.left-h.left,top:a.top-h.top};if(t.setPosition(n,v),t.dragManager.revalidateParent(n,f,a),o.updateConnectionsForGroup(i),t.revalidate(f),!e){var d={group:i,el:n,pos:v};r&&(d.sourceGroup=r),t.fire("group:addMember",d)}}}},this.removeFromGroup=function(t,i,n){if(t=this.getGroup(t)){if(t.collapsed){var e=function(n,e){for(var s=0;s<n.length;s++){var r=n[s];if(r.proxies)for(var o=0;o<r.proxies.length;o++)if(null!=r.proxies[o]){var h=r.proxies[o].originalEp.element;(h===i||a(h,i))&&c(r,e,t)}}};e(t.connections.source.slice(),0),e(t.connections.target.slice(),1)}t.remove(i,null,n)}},this.getGroup=function(t){var e=t;if(i.isString(t)&&null==(e=n[t]))throw new TypeError("No such group ["+t+"]");return e},this.getGroups=function(){var t=[];for(var i in n)t.push(n[i]);return t},this.removeGroup=function(i,e,s,r){i=this.getGroup(i),this.expandGroup(i,!0);var o=i[e?"removeAll":"orphanAll"](s,r);return t.remove(i.getEl()),delete n[i.id],delete t._groups[i.id],t.fire("group:remove",{group:i}),o},this.removeAllGroups=function(t,i,e){for(var s in n)this.removeGroup(n[s],t,i,e)};var u=function(i,n,s){var r=i.endpoints[0===n?1:0].element;if(!r[e]||r[e].shouldProxy()||!r[e].collapsed){var o=s.getEl(),a=t.getId(o);t.proxyConnection(i,n,o,a,(function(t,i){return s.getEndpoint(t,i)}),(function(t,i){return s.getAnchor(t,i)}))}};this.collapseGroup=function(i){if(null!=(i=this.getGroup(i))&&!i.collapsed){var n=i.getEl();if(h(i,!1),i.shouldProxy()){var e=function(t,n){for(var e=0;e<t.length;e++)u(t[e],n,i)};e(i.connections.source,0),e(i.connections.target,1)}i.collapsed=!0,t.removeClass(n,"jtk-group-expanded"),t.addClass(n,"jtk-group-collapsed"),t.revalidate(n),t.fire("group:collapse",{group:i})}};var c=function(i,n,e){t.unproxyConnection(i,n,t.getId(e.getEl()))};function l(i){for(var n=i.getMembers().slice(),e=[],o=0;o<n.length;o++)Array.prototype.push.apply(e,n[o].querySelectorAll(".jtk-managed"));Array.prototype.push.apply(n,e);var a=t.getConnections({source:n,scope:"*"},!0),h=t.getConnections({target:n,scope:"*"},!0),u={};i.connections.source.length=0,i.connections.target.length=0;var c=function(n){for(var e=0;e<n.length;e++)if(!u[n[e].id]){u[n[e].id]=!0;var o=t.getGroupFor(n[e].source),a=t.getGroupFor(n[e].target);o===i?(a!==i&&i.connections.source.push(n[e]),s[n[e].id]=i):a===i&&(i.connections.target.push(n[e]),r[n[e].id]=i)}};c(a),c(h)}this.expandGroup=function(i,n){if(null!=(i=this.getGroup(i))&&i.collapsed){var e=i.getEl();if(h(i,!0),i.shouldProxy()){var s=function(t,n){for(var e=0;e<t.length;e++)c(t[e],n,i)};s(i.connections.source,0),s(i.connections.target,1)}i.collapsed=!1,t.addClass(e,"jtk-group-expanded"),t.removeClass(e,"jtk-group-collapsed"),t.revalidate(e),this.repaintGroup(i),n||t.fire("group:expand",{group:i})}},this.repaintGroup=function(i){for(var n=(i=this.getGroup(i)).getMembers(),e=0;e<n.length;e++)t.revalidate(n[e])},this.updateConnectionsForGroup=l,this.refreshAllGroups=function(){for(var i in n)l(n[i]),t.dragManager.updateOffsets(t.getId(n[i].getEl()))}},r=function(n,s){var r=this,o=s.el;this.getEl=function(){return o},this.id=s.id||i.uuid(),o._isJsPlumbGroup=!0;var a=this.getDragArea=function(){var t=n.getSelector(o,"[jtk-group-content]");return t&&t.length>0?t[0]:o},h=!0===s.ghost,u=h||!0===s.constrain,c=!1!==s.revert,l=!0===s.orphan,f=!0===s.prune,v=!0===s.dropOverride,d=!1!==s.proxied,p=[];if(this.connections={source:[],target:[],internal:[]},this.getAnchor=function(){return s.anchor||"Continuous"},this.getEndpoint=function(){return s.endpoint||["Dot",{radius:10}]},this.collapsed=!1,!1!==s.draggable){var m={drag:function(){for(var t=0;t<p.length;t++)n.draw(p[t])},stop:function(t){n.fire("groupDragStop",jsPlumb.extend(t,{group:r}))},scope:"_jsPlumbGroupDrag"};s.dragOptions&&t.jsPlumb.extend(m,s.dragOptions),n.draggable(s.el,m)}!1!==s.droppable&&n.droppable(s.el,{drop:function(t){var i=t.drag.el;if(!i._isJsPlumbGroup){var e=i._jsPlumbGroup;if(e!==r){if(null!=e&&e.overrideDrop(i,r))return;n.getGroupManager().addToGroup(r,i,!1)}}}});var g=function(t,i){for(var n=null==t.nodeType?t:[t],e=0;e<n.length;e++)i(n[e])};function y(t,i){var e=function(t){return t.offsetParent}(t),s=n.getSize(e),r=n.getSize(t),o=i[0],a=i[1];return o+r[0]>0&&o<s[0]&&a+r[1]>0&&a<s[1]}function b(t){var i=n.getId(t),e=n.getOffset(t);return t.parentNode.removeChild(t),n.getContainer().appendChild(t),n.setPosition(t,e),k(t),n.dragManager.clearParent(t,i),[i,e]}function x(t){var i=[];function e(t,i,e){var s=null;if(!y(t,[i,e])){var r=t._jsPlumbGroup;f?n.remove(t):s=b(t),r.remove(t)}return s}for(var s=0;s<t.selection.length;s++)i.push(e(t.selection[s][0],t.selection[s][1].left,t.selection[s][1].top));return 1===i.length?i[0]:i}function w(t){var i=n.getId(t);n.revalidate(t),n.dragManager.revalidateParent(t,i)}function k(t){t._katavorioDrag&&((f||l)&&t._katavorioDrag.off("stop",x),f||l||!c||(t._katavorioDrag.off("revert",w),t._katavorioDrag.setRevert(null)))}function M(t){t._katavorioDrag&&((f||l)&&t._katavorioDrag.on("stop",x),u&&t._katavorioDrag.setConstrain(!0),h&&t._katavorioDrag.setUseGhostProxy(!0),f||l||!c||(t._katavorioDrag.on("revert",w),t._katavorioDrag.setRevert((function(t,i){return!y(t,i)}))))}this.overrideDrop=function(){return v&&(c||f||l)},this.add=function(t,i){var e=a();g(t,(function(t){if(null!=t._jsPlumbGroup){if(t._jsPlumbGroup===r)return;t._jsPlumbGroup.remove(t,!0,i,!1)}t._jsPlumbGroup=r,p.push(t),n.isAlreadyDraggable(t)&&M(t),t.parentNode!==e&&e.appendChild(t)})),n.getGroupManager().updateConnectionsForGroup(r)},this.remove=function(t,e,s,o,a){g(t,(function(t){if(t._jsPlumbGroup===r){if(delete t._jsPlumbGroup,i.removeWithFunction(p,(function(i){return i===t})),e)try{r.getDragArea().removeChild(t)}catch(h){jsPlumbUtil.log("Could not remove element from Group "+h)}if(k(t),!s){var o={group:r,el:t};a&&(o.targetGroup=a),n.fire("group:removeMember",o)}}})),o||n.getGroupManager().updateConnectionsForGroup(r)},this.removeAll=function(t,i){for(var e=0,s=p.length;e<s;e++){var o=p[0];r.remove(o,t,i,!0),n.remove(o,!0)}p.length=0,n.getGroupManager().updateConnectionsForGroup(r)},this.orphanAll=function(){for(var t={},i=0;i<p.length;i++){var n=b(p[i]);t[n[0]]=n[1]}return p.length=0,t},this.getMembers=function(){return p},o[e]=this,n.bind("elementDraggable",function(t){t.el._jsPlumbGroup===this&&M(t.el)}.bind(this)),this.shouldProxy=function(){return d},n.getGroupManager().addGroup(this)};n.prototype.addGroup=function(t){var i=this;if(i._groups=i._groups||{},null!=i._groups[t.id])throw new TypeError("cannot create Group ["+t.id+"]; a Group with that ID exists");if(null!=t.el[e])throw new TypeError("cannot create Group ["+t.id+"]; the given element is already a Group");var n=new r(i,t);return i._groups[n.id]=n,t.collapsed&&this.collapseGroup(n),n},n.prototype.addToGroup=function(t,i,n){var e=function(i){var e=this.getId(i);this.manage(e,i),this.getGroupManager().addToGroup(t,i,n)}.bind(this);if(Array.isArray(i))for(var s=0;s<i.length;s++)e(i[s]);else e(i)},n.prototype.removeFromGroup=function(t,i,n){this.getGroupManager().removeFromGroup(t,i,n),this.getContainer().appendChild(i)},n.prototype.removeGroup=function(t,i,n,e){return this.getGroupManager().removeGroup(t,i,n,e)},n.prototype.removeAllGroups=function(t,i,n){this.getGroupManager().removeAllGroups(t,i,n)},n.prototype.getGroup=function(t){return this.getGroupManager().getGroup(t)},n.prototype.getGroups=function(){return this.getGroupManager().getGroups()},n.prototype.expandGroup=function(t){this.getGroupManager().expandGroup(t)},n.prototype.collapseGroup=function(t){this.getGroupManager().collapseGroup(t)},n.prototype.repaintGroup=function(t){this.getGroupManager().repaintGroup(t)},n.prototype.toggleGroup=function(t){null!=(t=this.getGroupManager().getGroup(t))&&this.getGroupManager()[t.collapsed?"expandGroup":"collapseGroup"](t)},n.prototype.getGroupManager=function(){var t=this._groupManager;return null==t&&(t=this._groupManager=new s(this)),t},n.prototype.removeGroupManager=function(){delete this._groupManager},n.prototype.getGroupFor=function(t){if(t=this.getElement(t)){for(var i=this.getContainer(),n=!1,s=null;!n;)null==t||t===i?n=!0:t[e]?(s=t[e],n=!0):t=t.parentNode;return s}}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,i=this.jsPlumbUtil;t.Connectors.Flowchart=function(i){this.type="Flowchart",(i=i||{}).stub=null==i.stub?30:i.stub;var n,e=t.Connectors.AbstractConnector.apply(this,arguments),s=null==i.midpoint?.5:i.midpoint,r=!0===i.alwaysRespectStubs,o=null,a=null,h=null!=i.cornerRadius?i.cornerRadius:0,u=function(t){return t<0?-1:0===t?0:1},c=function(t){return[u(t[2]-t[0]),u(t[3]-t[1])]},l=function(t,i,n,e){if(o!==i||a!==n){var s=null==o?e.sx:o,r=null==a?e.sy:a;o=i,a=n,t.push([s,r,i,n,s===i?"v":"h"])}},f=function(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))},v=function(t){var i=[];return i.push.apply(i,t),i},d=function(t,i,n){for(var s,r,o,a=null,u=0;u<i.length-1;u++){if(a=a||v(i[u]),s=v(i[u+1]),r=c(a),o=c(s),h>0&&a[4]!==s[4]){var l=Math.min(f(a),f(s)),d=Math.min(h,l/2);a[2]-=r[0]*d,a[3]-=r[1]*d,s[0]+=o[0]*d,s[1]+=o[1]*d;var p=r[1]===o[0]&&1===o[0]||r[1]===o[0]&&0===o[0]&&r[0]!==o[1]||r[1]===o[0]&&-1===o[0],m=(s[1]>a[3]?1:-1)==(s[0]>a[2]?1:-1),g=m&&p||!m&&!p?s[0]:a[2],y=m&&p||!m&&!p?a[3]:s[1];e.addSegment(t,"Straight",{x1:a[0],y1:a[1],x2:a[2],y2:a[3]}),e.addSegment(t,"Arc",{r:d,x1:a[2],y1:a[3],x2:s[0],y2:s[1],cx:g,cy:y,ac:p})}else{var b=a[2]===a[0]?0:a[2]>a[0]?n.lw/2:-n.lw/2,x=a[3]===a[1]?0:a[3]>a[1]?n.lw/2:-n.lw/2;e.addSegment(t,"Straight",{x1:a[0]-b,y1:a[1]-x,x2:a[2]+b,y2:a[3]+x})}a=s}null!=s&&e.addSegment(t,"Straight",{x1:s[0],y1:s[1],x2:s[2],y2:s[3]})};this._compute=function(t,i){n=[],o=null,a=null;var h=function(){return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]},u={perpendicular:h,orthogonal:h,opposite:function(i){var n=t,e="x"===i?0:1;return!r&&{x:function(){return 1===n.so[e]&&(n.startStubX>n.endStubX&&n.tx>n.startStubX||n.sx>n.endStubX&&n.tx>n.sx)||-1===n.so[e]&&(n.startStubX<n.endStubX&&n.tx<n.startStubX||n.sx<n.endStubX&&n.tx<n.sx)},y:function(){return 1===n.so[e]&&(n.startStubY>n.endStubY&&n.ty>n.startStubY||n.sy>n.endStubY&&n.ty>n.sy)||-1===n.so[e]&&(n.startStubY<n.endStubY&&n.ty<n.startStubY||n.sy<n.endStubY&&n.ty<n.sy)}}[i]()?{x:[(t.sx+t.tx)/2,t.startStubY,(t.sx+t.tx)/2,t.endStubY],y:[t.startStubX,(t.sy+t.ty)/2,t.endStubX,(t.sy+t.ty)/2]}[i]:[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}}[t.anchorOrientation](t.sourceAxis),c="x"===t.sourceAxis?0:1,f="x"===t.sourceAxis?1:0,v=u[c],p=u[f],m=u[c+2],g=u[f+2];l(n,u[0],u[1],t);var y=t.startStubX+(t.endStubX-t.startStubX)*s,b=t.startStubY+(t.endStubY-t.startStubY)*s,x={x:[0,1],y:[1,0]},w={perpendicular:function(i){var n={x:[[t.startStubX,t.endStubX],null,[t.endStubX,t.startStubX]],y:[[t.startStubY,t.endStubY],null,[t.endStubY,t.startStubY]]},e={x:[t.startStubY,t.endStubY],y:[t.startStubX,t.endStubX]},s=x[i][1],r=t.so[x[i][0]]+1,o=-1===t.to[s]&&e[i][1]<e[i][0]||1===t.to[s]&&e[i][1]>e[i][0],a=n[i][r][0],h=n[i][r][1],u={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[i][r][t.to[s]+1];return t.segment===u[3]||t.segment===u[2]&&o?{x:[[y,t.startStubY],[y,t.endStubY]],y:[[t.startStubX,b],[t.endStubX,b]]}[i]:t.segment===u[2]&&h<a?{x:[[t.endStubX,t.startStubY]],y:[[t.startStubX,t.endStubY]]}[i]:t.segment===u[2]&&h>=a||t.segment===u[1]&&!o?{x:[[t.startStubX,b],[t.endStubX,b],[t.endStubX,t.endStubY]],y:[[y,t.startStubY],[y,t.endStubY],[t.endStubX,t.endStubY]]}[i]:t.segment===u[0]||t.segment===u[1]&&o?{x:[[t.startStubX,t.endStubY],[t.endStubX,t.endStubY]],y:[[t.endStubX,t.startStubY],[t.endStubX,t.endStubY]]}[i]:void 0},orthogonal:function(i,n,e,s,r){var o=t,a={x:-1===o.so[0]?Math.min(n,s):Math.max(n,s),y:-1===o.so[1]?Math.min(n,s):Math.max(n,s)}[i];return{x:[[a,e],[a,r],[s,r]],y:[[e,a],[r,a],[r,s]]}[i]},opposite:function(n,s,r,o){var a=t,h={x:"y",y:"x"}[n],u={x:"height",y:"width"}[n],l=a["is"+n.toUpperCase()+"GreaterThanStubTimes2"];if(i.sourceEndpoint.elementId===i.targetEndpoint.elementId){var f=r+(1-i.sourceEndpoint.anchor[h])*i.sourceInfo[u]+e.maxStub;return{x:[[s,f],[o,f]],y:[[f,s],[f,o]]}[n]}return!l||1===a.so[c]&&s>o||-1===a.so[c]&&s<o?{x:[[s,b],[o,b]],y:[[y,s],[y,o]]}[n]:1===a.so[c]&&s<o||-1===a.so[c]&&s>o?{x:[[y,a.sy],[y,a.ty]],y:[[a.sx,b],[a.tx,b]]}[n]:void 0}}[t.anchorOrientation](t.sourceAxis,v,p,m,g);if(w)for(var k=0;k<w.length;k++)l(n,w[k][0],w[k][1],t);l(n,u[2],u[3],t),l(n,t.tx,t.ty,t),d(this,n,t)}},i.extend(t.Connectors.Flowchart,t.Connectors.AbstractConnector)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,i=this.jsPlumbUtil;t.Connectors.AbstractBezierConnector=function(i){var n,e=!1!==(i=i||{}).showLoopback,s=i.margin||5,r=i.orientation&&"clockwise"===i.orientation,o=i.loopbackRadius||25;return this._compute=function(t,i){var a=i.sourcePos,h=i.targetPos,u=Math.abs(a[0]-h[0]),c=Math.abs(a[1]-h[1]);if(e&&i.sourceEndpoint.elementId===i.targetEndpoint.elementId){var l=i.sourcePos[0],f=i.sourcePos[1]-s,v=l,d=f-o,p=v-o,m=d-o;u=2*o,c=2*o,t.points[0]=p,t.points[1]=m,t.points[2]=u,t.points[3]=c,n.addSegment(this,"Arc",{loopback:!0,x1:l-p+4,y1:f-m,startAngle:0,endAngle:2*Math.PI,r:o,ac:!r,x2:l-p-4,y2:f-m,cx:v-p,cy:d-m})}else this._computeBezier(t,i,a,h,u,c)},n=t.Connectors.AbstractConnector.apply(this,arguments)},i.extend(t.Connectors.AbstractBezierConnector,t.Connectors.AbstractConnector);var n=function(i){i=i||{},this.type="Bezier";var n=t.Connectors.AbstractBezierConnector.apply(this,arguments),e=i.curviness||150,s=10;this.getCurviness=function(){return e},this._findControlPoint=function(t,i,n,r,o,a,h){var u=[];return a[0]!==h[0]||a[1]===h[1]?(u.push(0===h[0]?n[0]<i[0]?t[0]+s:t[0]-s:t[0]+e*h[0]),u.push(0===h[1]?n[1]<i[1]?t[1]+s:t[1]-s:t[1]+e*a[1])):(u.push(0===a[0]?i[0]<n[0]?t[0]+s:t[0]-s:t[0]-e*a[0]),u.push(0===a[1]?i[1]<n[1]?t[1]+s:t[1]-s:t[1]+e*h[1])),u},this._computeBezier=function(t,i,e,s,r,o){var a,h,u=e[0]<s[0]?r:0,c=e[1]<s[1]?o:0,l=e[0]<s[0]?0:r,f=e[1]<s[1]?0:o;a=this._findControlPoint([u,c],e,s,i.sourceEndpoint,i.targetEndpoint,t.so,t.to),h=this._findControlPoint([l,f],s,e,i.targetEndpoint,i.sourceEndpoint,t.to,t.so),n.addSegment(this,"Bezier",{x1:u,y1:c,x2:l,y2:f,cp1x:a[0],cp1y:a[1],cp2x:h[0],cp2y:h[1]})}};t.Connectors.Bezier=n,i.extend(n,t.Connectors.AbstractBezierConnector)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,i=this.jsPlumbUtil,n=function(t,i,n,e){return t<=n&&e<=i?1:t<=n&&i<=e?2:n<=t&&e>=i?3:4},e=function(t,i,n,e,s,r,o,a,h){return a<=h?[t,i]:1===n?e[3]<=0&&s[3]>=1?[t+(e[2]<.5?-1*r:r),i]:e[2]>=1&&s[2]<=0?[t,i+(e[3]<.5?-1*o:o)]:[t+-1*r,i+-1*o]:2===n?e[3]>=1&&s[3]<=0?[t+(e[2]<.5?-1*r:r),i]:e[2]>=1&&s[2]<=0?[t,i+(e[3]<.5?-1*o:o)]:[t+r,i+-1*o]:3===n?e[3]>=1&&s[3]<=0?[t+(e[2]<.5?-1*r:r),i]:e[2]<=0&&s[2]>=1?[t,i+(e[3]<.5?-1*o:o)]:[t+-1*r,i+-1*o]:4===n?e[3]<=0&&s[3]>=1?[t+(e[2]<.5?-1*r:r),i]:e[2]<=0&&s[2]>=1?[t,i+(e[3]<.5?-1*o:o)]:[t+r,i+-1*o]:void 0},s=function(i){i=i||{},this.type="StateMachine";var s,r=t.Connectors.AbstractBezierConnector.apply(this,arguments),o=i.curviness||10,a=i.margin||5,h=i.proximityLimit||80;this._computeBezier=function(t,i,u,c,l,f){var v=i.sourcePos[0]<i.targetPos[0]?0:l,d=i.sourcePos[1]<i.targetPos[1]?0:f,p=i.sourcePos[0]<i.targetPos[0]?l:0,m=i.sourcePos[1]<i.targetPos[1]?f:0;0===i.sourcePos[2]&&(v-=a),1===i.sourcePos[2]&&(v+=a),0===i.sourcePos[3]&&(d-=a),1===i.sourcePos[3]&&(d+=a),0===i.targetPos[2]&&(p-=a),1===i.targetPos[2]&&(p+=a),0===i.targetPos[3]&&(m-=a),1===i.targetPos[3]&&(m+=a);var g=(v+p)/2,y=(d+m)/2,b=n(v,d,p,m),x=Math.sqrt(Math.pow(p-v,2)+Math.pow(m-d,2));s=e(g,y,b,i.sourcePos,i.targetPos,o,o,x,h),r.addSegment(this,"Bezier",{x1:p,y1:m,x2:v,y2:d,cp1x:s[0],cp1y:s[1],cp2x:s[0],cp2y:s[1]})}};t.Connectors.StateMachine=s,i.extend(s,t.Connectors.AbstractBezierConnector)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,i=this.jsPlumbUtil,n=function(){this.type="Straight";var i=t.Connectors.AbstractConnector.apply(this,arguments);this._compute=function(t){i.addSegment(this,"Straight",{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY}),i.addSegment(this,"Straight",{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY}),i.addSegment(this,"Straight",{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty})}};t.Connectors.Straight=n,i.extend(n,t.Connectors.AbstractConnector)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,i=this.jsPlumbUtil,n={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},e="http://www.w3.org/2000/svg",s=function(t,i){for(var n in i)t.setAttribute(n,""+i[n])},r=function(i,n){return(n=n||{}).version="1.1",n.xmlns=e,t.createElementNS(e,i,null,null,n)},o=function(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"},a=function(t){for(var i=t.querySelectorAll(" defs,linearGradient,radialGradient"),n=0;n<i.length;n++)i[n].parentNode.removeChild(i[n])},h=function(t,i,e,s,o){if(i.setAttribute("fill",e.fill?e.fill:"none"),i.setAttribute("stroke",e.stroke?e.stroke:"none"),e.gradient?function(t,i,n,e,s){var o,h="jsplumb_gradient_"+s._jsPlumb.instance.idstamp();a(t),o=n.gradient.offset?r("radialGradient",{id:h}):r("linearGradient",{id:h,gradientUnits:"userSpaceOnUse"});var u=r("defs");t.appendChild(u),u.appendChild(o);for(var c=0;c<n.gradient.stops.length;c++){var l=n.gradient.stops[1===s.segment||2===s.segment?c:n.gradient.stops.length-1-c][1],f=r("stop",{offset:Math.floor(100*n.gradient.stops[c][0])+"%","stop-color":l});o.appendChild(f)}i.setAttribute(n.stroke?"stroke":"fill","url(#"+h+")")}(t,i,e,0,o):(a(t),i.setAttribute("style","")),e.strokeWidth&&i.setAttribute("stroke-width",e.strokeWidth),e.dashstyle&&e.strokeWidth&&!e["stroke-dasharray"]){var h=-1===e.dashstyle.indexOf(",")?" ":",",u=e.dashstyle.split(h),c="";u.forEach((function(t){c+=Math.floor(t*e.strokeWidth)+h})),i.setAttribute("stroke-dasharray",c)}else e["stroke-dasharray"]&&i.setAttribute("stroke-dasharray",e["stroke-dasharray"]);for(var l in n)e[l]&&i.setAttribute(n[l],e[l])},u=function(t,i,n){t.childNodes.length>n?t.insertBefore(i,t.childNodes[n]):t.appendChild(i)};i.svg={node:r,attr:s,pos:o};var c=function(n){var e=n.pointerEventsSpec||"all",a={};t.jsPlumbUIComponent.apply(this,n.originalArgs),this.canvas=null,this.path=null,this.svg=null,this.bgCanvas=null;var h=n.cssClass+" "+(n.originalArgs[0].cssClass||"");this.svg=r("svg",{style:"",width:0,height:0,"pointer-events":e,position:"absolute"}),n.useDivWrapper?(this.canvas=t.createElement("div",{position:"absolute"}),i.sizeElement(this.canvas,0,0,1,1),this.canvas.className=h):(s(this.svg,{class:h}),this.canvas=this.svg),n._jsPlumb.appendElement(this.canvas,n.originalArgs[0].parent),n.useDivWrapper&&this.canvas.appendChild(this.svg);var u=[this.canvas];return this.getDisplayElements=function(){return u},this.appendDisplayElement=function(t){u.push(t)},this.paint=function(t,e,r){if(null!=t){var h,u=[this.x,this.y],c=[this.w,this.h];null!=r&&(r.xmin<0&&(u[0]+=r.xmin),r.ymin<0&&(u[1]+=r.ymin),c[0]=r.xmax+(r.xmin<0?-r.xmin:0),c[1]=r.ymax+(r.ymin<0?-r.ymin:0)),n.useDivWrapper?(i.sizeElement(this.canvas,u[0],u[1],c[0]>0?c[0]:1,c[1]>0?c[1]:1),u[0]=0,u[1]=0,h=o([0,0])):h=o([u[0],u[1]]),a.paint.apply(this,arguments),s(this.svg,{style:h,width:c[0]||1,height:c[1]||1})}},{renderer:a}};i.extend(c,t.jsPlumbUIComponent,{cleanup:function(t){t||null==this.typeId?(this.canvas&&(this.canvas._jsPlumb=null),this.svg&&(this.svg._jsPlumb=null),this.bgCanvas&&(this.bgCanvas._jsPlumb=null),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.svg=null,this.canvas=null,this.path=null,this.group=null,this._jsPlumb=null):(this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.bgCanvas.parentNode.removeChild(this.bgCanvas))},reattach:function(t){var i=t.getContainer();this.canvas&&null==this.canvas.parentNode&&i.appendChild(this.canvas),this.bgCanvas&&null==this.bgCanvas.parentNode&&i.appendChild(this.bgCanvas)},setVisible:function(t){this.canvas&&(this.canvas.style.display=t?"block":"none")}}),t.ConnectorRenderers.svg=function(i){var n=this,e=c.apply(this,[{cssClass:i._jsPlumb.connectorClass,originalArgs:arguments,pointerEventsSpec:"none",_jsPlumb:i._jsPlumb}]);e.renderer.paint=function(e,o,a){var c=n.getSegments(),l=[0,0];if(a.xmin<0&&(l[0]=-a.xmin),a.ymin<0&&(l[1]=-a.ymin),c.length>0){var f={d:n.getPathData(),transform:"translate("+l[0]+","+l[1]+")","pointer-events":i["pointer-events"]||"visibleStroke"},v=null;if(e.outlineStroke){var d=e.strokeWidth+2*(e.outlineWidth||1);delete(v=t.extend({},e)).gradient,v.stroke=e.outlineStroke,v.strokeWidth=d,null==n.bgPath?(n.bgPath=r("path",f),t.addClass(n.bgPath,t.connectorOutlineClass),u(n.svg,n.bgPath,0)):s(n.bgPath,f),h(n.svg,n.bgPath,v,0,n)}null==n.path?(n.path=r("path",f),u(n.svg,n.path,e.outlineStroke?1:0)):s(n.path,f),h(n.svg,n.path,e,0,n)}}},i.extend(t.ConnectorRenderers.svg,c);var l=t.SvgEndpoint=function(i){var n=c.apply(this,[{cssClass:i._jsPlumb.endpointClass,originalArgs:arguments,pointerEventsSpec:"all",useDivWrapper:!0,_jsPlumb:i._jsPlumb}]);n.renderer.paint=function(i){var n=t.extend({},i);n.outlineStroke&&(n.stroke=n.outlineStroke),null==this.node?(this.node=this.makeNode(n),this.svg.appendChild(this.node)):null!=this.updateNode&&this.updateNode(this.node),h(this.svg,this.node,n,0,this)}.bind(this)};i.extend(l,c),t.Endpoints.svg.Dot=function(){t.Endpoints.Dot.apply(this,arguments),l.apply(this,arguments),this.makeNode=function(){return r("circle",{cx:this.w/2,cy:this.h/2,r:this.radius})},this.updateNode=function(t){s(t,{cx:this.w/2,cy:this.h/2,r:this.radius})}},i.extend(t.Endpoints.svg.Dot,[t.Endpoints.Dot,l]),t.Endpoints.svg.Rectangle=function(){t.Endpoints.Rectangle.apply(this,arguments),l.apply(this,arguments),this.makeNode=function(){return r("rect",{width:this.w,height:this.h})},this.updateNode=function(t){s(t,{width:this.w,height:this.h})}},i.extend(t.Endpoints.svg.Rectangle,[t.Endpoints.Rectangle,l]),t.Endpoints.svg.Image=t.Endpoints.Image,t.Endpoints.svg.Blank=t.Endpoints.Blank,t.Overlays.svg.Label=t.Overlays.Label,t.Overlays.svg.Custom=t.Overlays.Custom;var f=function(i,n){i.apply(this,n),t.jsPlumbUIComponent.apply(this,n),this.isAppendedAtTopLevel=!1,this.path=null,this.paint=function(t,i){if(t.component.svg&&i){null==this.path&&(this.path=r("path",{"pointer-events":"all"}),t.component.svg.appendChild(this.path),this.elementCreated&&this.elementCreated(this.path,t.component),this.canvas=t.component.svg);var o=n&&1===n.length&&n[0].cssClass||"",a=[0,0];i.xmin<0&&(a[0]=-i.xmin),i.ymin<0&&(a[1]=-i.ymin),s(this.path,{d:e(t.d),class:o,stroke:t.stroke?t.stroke:null,fill:t.fill?t.fill:null,transform:"translate("+a[0]+","+a[1]+")"})}};var e=function(t){return isNaN(t.cxy.x)||isNaN(t.cxy.y)?"":"M"+t.hxy.x+","+t.hxy.y+" L"+t.tail[0].x+","+t.tail[0].y+" L"+t.cxy.x+","+t.cxy.y+" L"+t.tail[1].x+","+t.tail[1].y+" L"+t.hxy.x+","+t.hxy.y};this.transfer=function(t){t.canvas&&this.path&&this.path.parentNode&&(this.path.parentNode.removeChild(this.path),t.canvas.appendChild(this.path))}},v={cleanup:function(t){null!=this.path&&(t?this._jsPlumb.instance.removeElement(this.path):this.path.parentNode&&this.path.parentNode.removeChild(this.path))},reattach:function(t,i){this.path&&i.canvas&&i.canvas.appendChild(this.path)},setVisible:function(t){null!=this.path&&(this.path.style.display=t?"block":"none")}};i.extend(f,[t.jsPlumbUIComponent,t.Overlays.AbstractOverlay]),t.Overlays.svg.Arrow=function(){f.apply(this,[t.Overlays.Arrow,arguments])},i.extend(t.Overlays.svg.Arrow,[t.Overlays.Arrow,f],v),t.Overlays.svg.PlainArrow=function(){f.apply(this,[t.Overlays.PlainArrow,arguments])},i.extend(t.Overlays.svg.PlainArrow,[t.Overlays.PlainArrow,f],v),t.Overlays.svg.Diamond=function(){f.apply(this,[t.Overlays.Diamond,arguments])},i.extend(t.Overlays.svg.Diamond,[t.Overlays.Diamond,f],v),t.Overlays.svg.GuideLines=function(){var i,n,e=null,o=this;t.Overlays.GuideLines.apply(this,arguments),this.paint=function(t,h){null==e&&(e=r("path"),t.connector.svg.appendChild(e),o.attachListeners(e,t.connector),o.attachListeners(e,o),i=r("path"),t.connector.svg.appendChild(i),o.attachListeners(i,t.connector),o.attachListeners(i,o),n=r("path"),t.connector.svg.appendChild(n),o.attachListeners(n,t.connector),o.attachListeners(n,o));var u=[0,0];h.xmin<0&&(u[0]=-h.xmin),h.ymin<0&&(u[1]=-h.ymin),s(e,{d:a(t.head,t.tail),stroke:"red",fill:null,transform:"translate("+u[0]+","+u[1]+")"}),s(i,{d:a(t.tailLine[0],t.tailLine[1]),stroke:"blue",fill:null,transform:"translate("+u[0]+","+u[1]+")"}),s(n,{d:a(t.headLine[0],t.headLine[1]),stroke:"green",fill:null,transform:"translate("+u[0]+","+u[1]+")"})};var a=function(t,i){return"M "+t.x+","+t.y+" L"+i.x+","+i.y}},i.extend(t.Overlays.svg.GuideLines,t.Overlays.GuideLines)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t,i,n=this,e=n.jsPlumb,s=n.jsPlumbUtil,r=n.Katavorio,o=n.Biltong,a=function(t,i){var n="_katavorio_"+(i=i||"main"),s=t[n],a=t.getEventManager();return s||((s=new r({bind:a.on,unbind:a.off,getSize:e.getSize,getConstrainingRectangle:function(t){return[t.parentNode.scrollWidth,t.parentNode.scrollHeight]},getPosition:function(i,n){var e=t.getOffset(i,n,i._katavorioDrag?i.offsetParent:null);return[e.left,e.top]},setPosition:function(t,i){t.style.left=i[0]+"px",t.style.top=i[1]+"px"},addClass:e.addClass,removeClass:e.removeClass,intersects:o.intersects,indexOf:function(t,i){return t.indexOf(i)},scope:t.getDefaultScope(),css:{noSelect:t.dragSelectClass,droppable:"jtk-droppable",draggable:"jtk-draggable",drag:"jtk-drag",selected:"jtk-drag-selected",active:"jtk-drag-active",hover:"jtk-drag-hover",ghostProxy:"jtk-ghost-proxy"}})).setZoom(t.getZoom()),t[n]=s,t.bind("zoom",s.setZoom)),s},h=function(t){var i=t.el._jsPlumbDragOptions,n=!0;return i.canDrag&&(n=i.canDrag()),n&&(this.setHoverSuspended(!0),this.select({source:t.el}).addClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,!0),this.select({target:t.el}).addClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,!0),this.setConnectionBeingDragged(!0)),n},u=function(t){var i=this.getUIPosition(arguments,this.getZoom());if(null!=i){var n=t.el._jsPlumbDragOptions;this.draw(t.el,i,null,!0),n._dragging&&this.addClass(t.el,"jtk-dragged"),n._dragging=!0}},c=function(t){for(var i,n=t.selection,e=function(n){var e;null!=n[1]&&(i=this.getUIPosition([{el:n[2].el,pos:[n[1].left,n[1].top]}]),e=this.draw(n[2].el,i)),null!=n[0]._jsPlumbDragOptions&&delete n[0]._jsPlumbDragOptions._dragging,this.removeClass(n[0],"jtk-dragged"),this.select({source:n[2].el}).removeClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,!0),this.select({target:n[2].el}).removeClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,!0),t.e._drawResult=t.e._drawResult||{c:[],e:[],a:[]},Array.prototype.push.apply(t.e._drawResult.c,e.c),Array.prototype.push.apply(t.e._drawResult.e,e.e),Array.prototype.push.apply(t.e._drawResult.a,e.a),this.getDragManager().dragEnded(n[2].el)}.bind(this),s=0;s<n.length;s++)e(n[s]);this.setHoverSuspended(!1),this.setConnectionBeingDragged(!1)},l=function(t,i){if(null==i)return[0,0];var n=m(i),e=p(n,0);return[e[t+"X"],e[t+"Y"]]},f=l.bind(this,"page"),v=l.bind(this,"screen"),d=l.bind(this,"client"),p=function(t,i){return t.item?t.item(i):t[i]},m=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},g=function(t){var i={},n=[],e={},s={},r={};this.register=function(o){var a,h=t.getId(o);i[h]||(i[h]=o,n.push(o),e[h]={});var u=function(i){if(i)for(var n=0;n<i.childNodes.length;n++)if(3!==i.childNodes[n].nodeType&&8!==i.childNodes[n].nodeType){var c=jsPlumb.getElement(i.childNodes[n]),l=t.getId(i.childNodes[n],null,!0);if(l&&s[l]&&s[l]>0){a||(a=t.getOffset(o));var f=t.getOffset(c);e[h][l]={id:l,offset:{left:f.left-a.left,top:f.top-a.top}},r[l]=h}u(i.childNodes[n])}};u(o)},this.updateOffsets=function(i,n){if(null!=i){n=n||{};var s,o=jsPlumb.getElement(i),a=t.getId(o),h=e[a];if(h)for(var u in h)if(h.hasOwnProperty(u)){var c=jsPlumb.getElement(u),l=n[u]||t.getOffset(c);if(null==c.offsetParent&&null!=e[a][u])continue;s||(s=t.getOffset(o)),e[a][u]={id:u,offset:{left:l.left-s.left,top:l.top-s.top}},r[u]=a}}},this.endpointAdded=function(n,o){o=o||t.getId(n);var a=document.body,h=n.parentNode;for(s[o]=s[o]?s[o]+1:1;null!=h&&h!==a;){var u=t.getId(h,null,!0);if(u&&i[u]){var c=t.getOffset(h);if(null==e[u][o]){var l=t.getOffset(n);e[u][o]={id:o,offset:{left:l.left-c.left,top:l.top-c.top}},r[o]=u}break}h=h.parentNode}},this.endpointDeleted=function(t){if(s[t.elementId]&&(s[t.elementId]--,s[t.elementId]<=0))for(var i in e)e.hasOwnProperty(i)&&e[i]&&(delete e[i][t.elementId],delete r[t.elementId])},this.changeId=function(t,i){e[i]=e[t],e[t]={},r[i]=r[t],r[t]=null},this.getElementsForDraggable=function(t){return e[t]},this.elementRemoved=function(t){var i=r[t];i&&(e[i]&&delete e[i][t],delete r[t])},this.reset=function(){i={},n=[],e={},s={}},this.dragEnded=function(i){if(null!=i.offsetParent){var n=t.getId(i),e=r[n];e&&this.updateOffsets(e)}},this.setParent=function(i,n,s,o,a){var h=r[n];e[o]||(e[o]={});var u=t.getOffset(s),c=a||t.getOffset(i);h&&e[h]&&delete e[h][n],e[o][n]={id:n,offset:{left:c.left-u.left,top:c.top-u.top}},r[n]=o},this.clearParent=function(t,i){var n=r[i];n&&(delete e[n][i],delete r[i])},this.revalidateParent=function(i,n,e){var s=r[n];if(s){var o={};o[n]=e,this.updateOffsets(s,o),t.revalidate(s)}},this.getDragAncestor=function(i){var n=jsPlumb.getElement(i),e=t.getId(n),s=r[e];return s?jsPlumb.getElement(s):null}},y=function(t,i,n){i=s.fastTrim(i),void 0!==t.className.baseVal?t.className.baseVal=i:t.className=i;try{var e=t.classList;if(null!=e){for(;e.length>0;)e.remove(e.item(0));for(var r=0;r<n.length;r++)n[r]&&e.add(n[r])}}catch(o){s.log("JSPLUMB: cannot set class list",o)}},b=function(t){return void 0===t.className.baseVal?t.className:t.className.baseVal},x=function(t,i,n){i=null==i?[]:s.isArray(i)?i:i.split(/\s+/),n=null==n?[]:s.isArray(n)?n:n.split(/\s+/);var e=b(t).split(/\s+/),r=function(t,i){for(var n=0;n<i.length;n++)if(t)-1===e.indexOf(i[n])&&e.push(i[n]);else{var s=e.indexOf(i[n]);-1!==s&&e.splice(s,1)}};r(!0,i),r(!1,n),y(t,e.join(" "),e)};n.jsPlumb.extend(n.jsPlumbInstance.prototype,{headless:!1,pageLocation:f,screenLocation:v,clientLocation:d,getDragManager:function(){return null==this.dragManager&&(this.dragManager=new g(this)),this.dragManager},recalculateOffsets:function(t){this.getDragManager().updateOffsets(t)},createElement:function(t,i,n,e){return this.createElementNS(null,t,i,n,e)},createElementNS:function(t,i,n,e,s){var r,o=null==t?document.createElement(i):document.createElementNS(t,i);for(r in n=n||{})o.style[r]=n[r];for(r in e&&(o.className=e),s=s||{})o.setAttribute(r,""+s[r]);return o},getAttribute:function(t,i){return null!=t.getAttribute?t.getAttribute(i):null},setAttribute:function(t,i,n){null!=t.setAttribute&&t.setAttribute(i,n)},setAttributes:function(t,i){for(var n in i)i.hasOwnProperty(n)&&t.setAttribute(n,i[n])},appendToRoot:function(t){document.body.appendChild(t)},getRenderModes:function(){return["svg"]},getClass:b,addClass:function(t,i){jsPlumb.each(t,(function(t){x(t,i)}))},hasClass:function(t,i){return(t=jsPlumb.getElement(t)).classList?t.classList.contains(i):-1!==b(t).indexOf(i)},removeClass:function(t,i){jsPlumb.each(t,(function(t){x(t,null,i)}))},toggleClass:function(t,i){jsPlumb.hasClass(t,i)?jsPlumb.removeClass(t,i):jsPlumb.addClass(t,i)},updateClasses:function(t,i,n){jsPlumb.each(t,(function(t){x(t,i,n)}))},setClass:function(t,i){null!=i&&jsPlumb.each(t,(function(t){y(t,i,i.split(/\s+/))}))},setPosition:function(t,i){t.style.left=i.left+"px",t.style.top=i.top+"px"},getPosition:function(t){var i=function(i){var n=t.style[i];return n?n.substring(0,n.length-2):0};return{left:i("left"),top:i("top")}},getStyle:function(t,i){return void 0!==window.getComputedStyle?getComputedStyle(t,null).getPropertyValue(i):t.currentStyle[i]},getSelector:function(t,i){return 1===arguments.length?null!=t.nodeType?t:document.querySelectorAll(t):t.querySelectorAll(i)},getOffset:function(t,i,n){t=jsPlumb.getElement(t),n=n||this.getContainer();for(var e={left:t.offsetLeft,top:t.offsetTop},s=i||null!=n&&t!==n&&t.offsetParent!==n?t.offsetParent:null,r=function(t){null!=t&&t!==document.body&&(t.scrollTop>0||t.scrollLeft>0)&&(e.left-=t.scrollLeft,e.top-=t.scrollTop)}.bind(this);null!=s;)e.left+=s.offsetLeft,e.top+=s.offsetTop,r(s),s=i?s.offsetParent:s.offsetParent===n?null:s.offsetParent;if(null!=n&&!i&&(n.scrollTop>0||n.scrollLeft>0)){var o=null!=t.offsetParent?this.getStyle(t.offsetParent,"position"):"static",a=this.getStyle(t,"position");"absolute"!==a&&"fixed"!==a&&"absolute"!==o&&"fixed"!==o&&(e.left-=n.scrollLeft,e.top-=n.scrollTop)}return e},getPositionOnElement:function(t,i,n){var e=void 0!==i.getBoundingClientRect?i.getBoundingClientRect():{left:0,top:0,width:0,height:0},s=document.body,r=document.documentElement,o=window.pageYOffset||r.scrollTop||s.scrollTop,a=window.pageXOffset||r.scrollLeft||s.scrollLeft,h=e.top+o-(r.clientTop||s.clientTop||0)+0*n,u=e.left+a-(r.clientLeft||s.clientLeft||0)+0*n,c=jsPlumb.pageLocation(t);return[(c[0]-u)/(e.width||i.offsetWidth*n),(c[1]-h)/(e.height||i.offsetHeight*n)]},getAbsolutePosition:function(t){var i=function(i){var n=t.style[i];if(n)return parseFloat(n.substring(0,n.length-2))};return[i("left"),i("top")]},setAbsolutePosition:function(t,i,n,e){n?this.animate(t,{left:"+="+(i[0]-n[0]),top:"+="+(i[1]-n[1])},e):(t.style.left=i[0]+"px",t.style.top=i[1]+"px")},getSize:function(t){return[t.offsetWidth,t.offsetHeight]},getWidth:function(t){return t.offsetWidth},getHeight:function(t){return t.offsetHeight},getRenderMode:function(){return"svg"},draggable:function(t,i){var n;return t=s.isArray(t)||null!=t.length&&!s.isString(t)?t:[t],Array.prototype.slice.call(t).forEach(function(t){(n=this.info(t)).el&&this._initDraggableIfNecessary(n.el,!0,i,n.id,!0)}.bind(this)),this},snapToGrid:function(t,i,n){var e=[],s=function(t){var s=this.info(t);if(null!=s.el&&s.el._katavorioDrag){var r=s.el._katavorioDrag.snap(i,n);this.revalidate(s.el),e.push([s.el,r])}}.bind(this);if(1===arguments.length||3===arguments.length)s(t,i,n);else{var r=this.getManagedElements();for(var o in r)s(o,arguments[0],arguments[1])}return e},initDraggable:function(t,i,n){a(this,n).draggable(t,i),t._jsPlumbDragOptions=i},destroyDraggable:function(t,i){a(this,i).destroyDraggable(t),t._jsPlumbDragOptions=null,t._jsPlumbRelatedElement=null},unbindDraggable:function(t,i,n,e){a(this,e).destroyDraggable(t,i,n)},setDraggable:function(t,i){return jsPlumb.each(t,function(t){this.isDragSupported(t)&&(this._draggableStates[this.getAttribute(t,"id")]=i,this.setElementDraggable(t,i))}.bind(this))},_draggableStates:{},toggleDraggable:function(t){var i;return jsPlumb.each(t,function(t){var n=this.getAttribute(t,"id");return this._draggableStates[n]=i=!(i=null!=this._draggableStates[n]&&this._draggableStates[n]),this.setDraggable(t,i),i}.bind(this)),i},_initDraggableIfNecessary:function(t,i,n,e,r){if(!jsPlumb.headless&&null!=i&&i&&jsPlumb.isDragSupported(t,this)){var o=n||this.Defaults.DragOptions;if(o=jsPlumb.extend({},o),jsPlumb.isAlreadyDraggable(t,this))n.force&&this.initDraggable(t,o);else{var a=jsPlumb.dragEvents.drag,l=jsPlumb.dragEvents.stop,f=jsPlumb.dragEvents.start;this.manage(e,t),o[f]=s.wrap(o[f],h.bind(this)),o[a]=s.wrap(o[a],u.bind(this)),o[l]=s.wrap(o[l],c.bind(this));var v=this.getId(t);this._draggableStates[v]=!0;var d=this._draggableStates[v];o.disabled=null!=d&&!d,this.initDraggable(t,o),this.getDragManager().register(t),r&&this.fire("elementDraggable",{el:t,options:o})}}},animationSupported:!0,getElement:function(t){return null==t?null:"string"==typeof(t="string"==typeof t?t:null==t.tagName&&null!=t.length&&null==t.enctype?t[0]:t)?document.getElementById(t):t},removeElement:function(t){a(this).elementRemoved(t),this.getEventManager().remove(t)},doAnimate:function(t,i,n){n=n||{};var r=this.getOffset(t),o=function(t,i){var n=function(n){if(null!=i[n]){if(s.isString(i[n])){var e=i[n].match(/-=/)?-1:1,r=i[n].substring(2);return t[n]+e*r}return i[n]}return t[n]};return[n("left"),n("top")]}(r,i),a=n.duration||250,h=a/15,u=15/a*(o[0]-r.left),c=15/a*(o[1]-r.top),l=0,f=setInterval((function(){e.setPosition(t,{left:r.left+u*(l+1),top:r.top+c*(l+1)}),null!=n.step&&n.step(l,Math.ceil(h)),++l>=h&&(window.clearInterval(f),null!=n.complete&&n.complete())}),15)},destroyDroppable:function(t,i){a(this,i).destroyDroppable(t)},unbindDroppable:function(t,i,n,e){a(this,e).destroyDroppable(t,i,n)},droppable:function(t,i){var n;return t=s.isArray(t)||null!=t.length&&!s.isString(t)?t:[t],(i=i||{}).allowLoopback=!1,Array.prototype.slice.call(t).forEach(function(t){(n=this.info(t)).el&&this.initDroppable(n.el,i)}.bind(this)),this},initDroppable:function(t,i,n){a(this,n).droppable(t,i)},isAlreadyDraggable:function(t){return null!=t._katavorioDrag},isDragSupported:function(){return!0},isDropSupported:function(){return!0},isElementDraggable:function(t){return(t=e.getElement(t))._katavorioDrag&&t._katavorioDrag.isEnabled()},getDragObject:function(t){return t[0].drag.getDragElement()},getDragScope:function(t){return t._katavorioDrag&&t._katavorioDrag.scopes.join(" ")||""},getDropEvent:function(t){return t[0].e},getUIPosition:function(t){var i=t[0].el;if(null==i.offsetParent)return null;var n=t[0].finalPos||t[0].pos,e={left:n[0],top:n[1]};if(i._katavorioDrag&&i.offsetParent!==this.getContainer()){var s=this.getOffset(i.offsetParent);e.left+=s.left,e.top+=s.top}return e},setDragFilter:function(t,i,n){t._katavorioDrag&&t._katavorioDrag.setFilter(i,n)},setElementDraggable:function(t,i){(t=e.getElement(t))._katavorioDrag&&t._katavorioDrag.setEnabled(i)},setDragScope:function(t,i){t._katavorioDrag&&t._katavorioDrag.k.setDragScope(t,i)},setDropScope:function(t,i){t._katavorioDrop&&t._katavorioDrop.length>0&&t._katavorioDrop[0].k.setDropScope(t,i)},addToPosse:function(t,i){var n=Array.prototype.slice.call(arguments,1),s=a(this);e.each(t,(function(t){(t=[e.getElement(t)]).push.apply(t,n),s.addToPosse.apply(s,t)}))},setPosse:function(t,i){var n=Array.prototype.slice.call(arguments,1),s=a(this);e.each(t,(function(t){(t=[e.getElement(t)]).push.apply(t,n),s.setPosse.apply(s,t)}))},removeFromPosse:function(t,i){var n=Array.prototype.slice.call(arguments,1),s=a(this);e.each(t,(function(t){(t=[e.getElement(t)]).push.apply(t,n),s.removeFromPosse.apply(s,t)}))},removeFromAllPosses:function(t){var i=a(this);e.each(t,(function(t){i.removeFromAllPosses(e.getElement(t))}))},setPosseState:function(t,i,n){var s=a(this);e.each(t,(function(t){s.setPosseState(e.getElement(t),i,n)}))},dragEvents:{start:"start",stop:"stop",drag:"drag",step:"step",over:"over",out:"out",drop:"drop",complete:"complete",beforeStart:"beforeStart"},animEvents:{step:"step",complete:"complete"},stopDrag:function(t){t._katavorioDrag&&t._katavorioDrag.abort()},addToDragSelection:function(t){var i=this.getElement(t);null==i||!i._isJsPlumbGroup&&null!=i._jsPlumbGroup||a(this).select(t)},removeFromDragSelection:function(t){a(this).deselect(t)},getDragSelection:function(){return a(this).getSelection()},clearDragSelection:function(){a(this).deselectAll()},trigger:function(t,i,n,e){this.getEventManager().trigger(t,i,n,e)},doReset:function(){for(var t in this)0===t.indexOf("_katavorio_")&&this[t].reset()},getEventManager:function(){return(t=this._mottle)||(t=this._mottle=new n.Mottle),t;var t},on:function(t,i,n){return this.getEventManager().on.apply(this,arguments),this},off:function(t,i,n){return this.getEventManager().off.apply(this,arguments),this}}),t=e.init,(i=function(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?t():setTimeout(i,9)})()}.call("undefined"!=typeof window?window:commonjsGlobal)})),jsplumb_6=jsplumb.jsPlumb,rng;class JsPlumbUtils{}JsPlumbUtils.createInstance=(t,i)=>jsplumb_6.getInstance({ConnectionsDetachable:!i,DragOptions:{cursor:"pointer",zIndex:2e3},ConnectionOverlays:[["Arrow",{location:1,visible:!0,width:11,length:11}],["Label",{location:.5,id:"label",cssClass:"connection-label"}]],Container:t}),JsPlumbUtils.createEndpointUuid=(t,i)=>`activity-${t}-${i}`,JsPlumbUtils.getSourceEndpointOptions=(t,i,n)=>{const e=n?"#6faa44":"#999999";return{type:"Dot",anchor:"Continuous",paintStyle:{stroke:"#7da7f2",fill:"#7da7f2",strokeWidth:2},isSource:!0,connector:["Flowchart",{stub:[40,60],gap:0,cornerRadius:5,alwaysRespectStubs:!0}],connectorStyle:{strokeWidth:2,stroke:e},connectorHoverStyle:{strokeWidth:2,stroke:e},connectorOverlays:[["Label",{location:[3,-1.5],cssClass:"endpointSourceLabel"}]],hoverPaintStyle:{fill:"#7da7f2",stroke:"#7da7f2"},dragOptions:{},uuid:JsPlumbUtils.createEndpointUuid(t,i),parameters:{outcome:i},scope:null,reattachConnections:!0,maxConnections:1}};var crypto=void 0!==commonjsGlobal&&(commonjsGlobal.crypto||commonjsGlobal.msCrypto);if(crypto&&crypto.getRandomValues){var rnds8=new Uint8Array(16);rng=function(){return crypto.getRandomValues(rnds8),rnds8}}if(!rng){var rnds=new Array(16);rng=function(){for(var t,i=0;i<16;i++)0==(3&i)&&(t=4294967296*Math.random()),rnds[i]=t>>>((3&i)<<3)&255;return rnds}}for(var rngBrowser=rng,byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);function bytesToUuid(t,i){var n=i||0;return byteToHex[t[n++]]+byteToHex[t[n++]]+byteToHex[t[n++]]+byteToHex[t[n++]]+"-"+byteToHex[t[n++]]+byteToHex[t[n++]]+"-"+byteToHex[t[n++]]+byteToHex[t[n++]]+"-"+byteToHex[t[n++]]+byteToHex[t[n++]]+"-"+byteToHex[t[n++]]+byteToHex[t[n++]]+byteToHex[t[n++]]+byteToHex[t[n++]]+byteToHex[t[n++]]+byteToHex[t[n++]]}var bytesToUuid_1=bytesToUuid;function v4(t,i,n){var e=i&&n||0;"string"==typeof t&&(i="binary"==t?new Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||rngBrowser)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,i)for(var r=0;r<16;++r)i[e+r]=s[r];return i||bytesToUuid_1(s)}var v4_1=v4;function deepClone(t){const i=JSON.stringify(t);return JSON.parse(i)}const designerCss='.jtk-connector{overflow:visible}.jtk-node{position:absolute}.jtk-group{position:absolute;overflow:visible}[jtk-group-content]{position:relative}.jtk-node.jtk-drag{}.katavorio-clone-drag{pointer-events:none}.jtk-surface{overflow:hidden !important;position:relative;cursor:move;cursor:-moz-grab;cursor:-webkit-grab;-ms-touch-action:none;touch-action:none;}.jtk-surface-panning{cursor:-moz-grabbing;cursor:-webkit-grabbing;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.jtk-surface-canvas{overflow:visible !important}.jtk-surface-droppable-node{-ms-touch-action:none;touch-action:none}.jtk-surface-nopan{overflow:scroll !important;cursor:default}.jtk-surface-tile{border:none;outline:none;margin:0;-webkit-transition:opacity .3s ease .15s;-moz-transition:opacity .3s ease .15s;-o-transition:opacity .3s ease .15s;-ms-transition:opacity .3s ease .15s;transition:opacity .3s ease .15s}.jtk-lasso{border:2px solid rgb(49, 119, 184);background-color:WhiteSmoke;opacity:0.5;display:none;z-index:20000;position:absolute}.jtk-lasso-select-defeat *{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.jtk-lasso-mask{position:fixed;z-index:20000;display:none;opacity:0.5;background-color:#07234E;top:0;bottom:0;left:0;right:0}.jtk-surface-selected-element{border:2px dashed #f76258 !important}.jtk-surface-pan{background-color:Azure;opacity:0.4;text-align:center;cursor:pointer;z-index:2;-webkit-transition:background-color 0.15s ease-in;-moz-transition:background-color 0.15s ease-in;-o-transition:background-color 0.15s ease-in;transition:background-color 0.15s ease-in}.jtk-surface-pan-top,.jtk-surface-pan-bottom{width:100%;height:20px}.jtk-surface-pan-top:hover,.jtk-surface-pan-bottom:hover,.jtk-surface-pan-left:hover,.jtk-surface-pan-right:hover{opacity:0.6;background-color:rgb(49, 119, 184);color:white;font-weight:bold}.jtk-surface-pan-left,.jtk-surface-pan-right{width:20px;height:100%;line-height:40}.jtk-surface-pan-active,.jtk-surface-pan-active:hover{background-color:#f76258}.jtk-miniview{overflow:hidden !important;width:125px;height:125px;position:relative;background-color:#B2C9CD;border:1px solid #E2E6CD;border-radius:4px;opacity:0.8}.jtk-miniview-panner{border:5px dotted WhiteSmoke;opacity:0.4;background-color:rgb(79, 111, 126);cursor:move;cursor:-moz-grab;cursor:-webkit-grab}.jtk-miniview-panning{cursor:-moz-grabbing;cursor:-webkit-grabbing}.jtk-miniview-element{background-color:rgb(96, 122, 134);position:absolute}.jtk-miniview-group-element{background:transparent;border:2px solid rgb(96,122,134)}.jtk-miniview-collapse{color:whiteSmoke;position:absolute;font-size:18px;top:-1px;right:3px;cursor:pointer;font-weight:bold}.jtk-miniview-collapse:before{content:"\\2012"}.jtk-miniview-collapsed{background-color:#449ea6;border-radius:4px;height:22px;margin-right:0;padding:4px;width:21px}.jtk-miniview-collapsed .jtk-miniview-element,.jtk-miniview-collapsed .jtk-miniview-panner{visibility:hidden}.jtk-miniview-collapsed .jtk-miniview-collapse:before{content:"+"}.jtk-miniview-collapse:hover{color:#E4F013}.jtk-dialog-underlay{left:0;right:0;top:0;bottom:0;position:fixed;z-index:100000;opacity:0.8;background-color:#CCC;display:none}.jtk-dialog-overlay{position:fixed;z-index:100001;display:none;background-color:white;font-family:"Open Sans", sans-serif;padding:7px;-webkit-box-shadow:0 0 5px gray;box-shadow:0 0 5px gray;overflow:hidden}.jtk-dialog-overlay-x{max-height:0;transition:max-height 0.5s ease-in;-moz-transition:max-height 0.5s ease-in;-ms-transition:max-height 0.5s ease-in;-o-transition:max-height 0.5s ease-in;-webkit-transition:max-height 0.5s ease-in}.jtk-dialog-overlay-y{max-width:0;transition:max-width 0.5s ease-in;-moz-transition:max-width 0.5s ease-in;-ms-transition:max-width 0.5s ease-in;-o-transition:max-width 0.5s ease-in;-webkit-transition:max-width 0.5s ease-in}.jtk-dialog-overlay-top{top:20px}.jtk-dialog-overlay-bottom{bottom:20px}.jtk-dialog-overlay-left{left:20px}.jtk-dialog-overlay-right{right:20px}.jtk-dialog-overlay-x.jtk-dialog-overlay-visible{max-height:1000px}.jtk-dialog-overlay-y.jtk-dialog-overlay-visible{max-width:1000px}.jtk-dialog-buttons{text-align:right;margin-top:5px}.jtk-dialog-button{border:none;cursor:pointer;margin-right:5px;min-width:56px;background-color:white;outline:1px solid #ccc}.jtk-dialog-button:hover{color:white;background-color:#234b5e}.jtk-dialog-title{text-align:left;font-size:14px;margin-bottom:9px}.jtk-dialog-content{font-size:12px;text-align:left;min-width:250px;margin:0 14px}.jtk-dialog-content ul{width:100%;padding-left:0}.jtk-dialog-content label{cursor:pointer;font-weight:inherit}.jtk-dialog-overlay input,.jtk-dialog-overlay textarea{background-color:#FFF;border:1px solid #CCC;color:#333;font-size:14px;font-style:normal;outline:none;padding:6px 4px;margin-right:6px}.jtk-dialog-overlay input:focus,.jtk-dialog-overlay textarea:focus{background-color:#cbeae1;border:1px solid #83b8a8;color:#333;font-size:14px;font-style:normal;outline:none}.jtk-draw-skeleton{position:absolute;left:0;right:0;top:0;bottom:0;outline:2px solid #84acb3;opacity:0.8}.jtk-draw-handle{position:absolute;width:7px;height:7px;background-color:#84acb3}.jtk-draw-handle-tl{left:0;top:0;cursor:nw-resize}.jtk-draw-handle-tr{right:0;top:0;cursor:ne-resize}.jtk-draw-handle-bl{left:0;bottom:0;cursor:sw-resize}.jtk-draw-handle-br{bottom:0;right:0;cursor:se-resize}.jtk-draw-drag{display:none;position:absolute;left:50%;top:50%;margin-left:-10px;margin-top:-10px;width:20px;height:20px;background-color:#84acb3;cursor:move}.jtk-drag-select-defeat *{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.workflow-canvas{position:relative;display:block;-ms-touch-action:none;touch-action:none;width:auto;height:100vh}.workflow-canvas .noselect{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}.workflow-canvas .activity{display:block;border:1px solid #cccccc;-webkit-box-shadow:2px 2px 19px #aaa;box-shadow:2px 2px 19px #aaa;border-radius:0.5em;opacity:0.8;min-width:80px;min-height:80px;max-width:250px;text-align:left;z-index:20;position:absolute;background-color:#f1f1f1;color:#3d3d3d;font-family:helvetica, sans-serif;padding:1em;font-size:0.7em;cursor:default;-webkit-transition:-webkit-box-shadow 0.15s ease-in;transition:-webkit-box-shadow 0.15s ease-in;transition:box-shadow 0.15s ease-in;transition:box-shadow 0.15s ease-in, -webkit-box-shadow 0.15s ease-in}.workflow-canvas .activity .activity-status{position:absolute;right:4px;bottom:4px;cursor:pointer}.workflow-canvas .activity .activity-status i{font-size:2em}.workflow-canvas .activity.activity-definition{border:1px solid #5a8fee}.workflow-canvas .activity.activity-executed{border:1px solid #6faa44;background-color:#6faa44;color:#ffffff}.workflow-canvas .activity.activity-executed h5,.workflow-canvas .activity.activity-executed h5 i{color:#ffffff}.workflow-canvas .activity.activity-blocking{border:1px solid #5a8fee;background-color:#5a8fee;color:#ffffff}.workflow-canvas .activity.activity-blocking h5,.workflow-canvas .activity.activity-blocking h5 i{color:#ffffff}.workflow-canvas .activity.activity-faulted{border:1px solid #d23c3c;background-color:#d23c3c;color:#ffffff}.workflow-canvas .activity.activity-faulted h5,.workflow-canvas .activity.activity-faulted h5 i{color:#ffffff}.jtk-connector{z-index:4}.jtk-endpoint,.endpointTargetLabel,.endpointSourceLabel{z-index:21;cursor:pointer}.endpointTargetLabel,.endpointSourceLabel{font-size:8px}.jtk-overlay{background-color:transparent}.connection-label{z-index:31;border:1px solid #cccccc;padding:0 0.5em;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;background-color:white}',Designer=class{constructor(t){registerInstance(this,t),this.editActivityEvent=createEvent(this,"edit-activity",7),this.addActivityEvent=createEvent(this,"add-activity",7),this.workflowChanged=createEvent(this,"workflowChanged",7),this.activityDefinitions=[],this.workflow={activities:[],connections:[]},this.lastClickedLocation=null,this.elem=()=>this.el,this.renderContextMenu=()=>this.readonly?null:[h("wf-context-menu",{target:this.elem()},h("wf-context-menu-item",{text:"Add Activity",onClick:this.onAddActivityClick})),h("wf-context-menu",{ref:t=>this.activityContextMenu=t},h("wf-context-menu-item",{text:"Edit",onClick:this.onEditActivityClick}),h("wf-context-menu-item",{text:"Delete",onClick:this.onDeleteActivityClick}))],this.deleteActivity=async t=>{const i=this.workflow.activities.filter(i=>i.id!==t.id),n=this.workflow.connections.filter(i=>i.sourceActivityId!=t.id&&i.destinationActivityId!=t.id);this.workflow=Object.assign(Object.assign({},this.workflow),{activities:i,connections:n})},this.setupJsPlumb=()=>{this.jsPlumb.reset(),this.setupJsPlumbEventHandlers(),this.jsPlumb.batch(()=>{this.getActivityElements().forEach(this.setupActivityElement),this.setupConnections()}),this.jsPlumb.repaintEverything()},this.setupPopovers=()=>{$('[data-toggle="popover"]').popover({})},this.setupActivityElement=t=>{this.readonly||this.setupDragDrop(t),this.setupTargets(t),this.setupOutcomes(t),this.jsPlumb.revalidate(t)},this.setupDragDrop=t=>{let i=null,n=!1;this.jsPlumb.draggable(t,{containment:"true",start:t=>{i={left:t.e.screenX,top:t.e.screenY}},stop:async e=>{if(n=i.left!==e.e.screenX||i.top!==e.e.screenY,!n)return;const s=Object.assign({},this.findActivityByElement(t));s.left=e.pos[0],s.top=e.pos[1],await this.updateActivityInternal(s)}})},this.setupConnections=()=>{for(let t of this.workflow.connections){const i=JsPlumbUtils.createEndpointUuid(t.sourceActivityId,t.outcome),n=this.jsPlumb.getEndpoint(i);this.jsPlumb.connect({source:n,target:"wf-activity-"+t.destinationActivityId})}},this.findActivityByElement=t=>{const i=Designer.getActivityId(t);return this.findActivityById(i)},this.findActivityById=t=>this.workflow.activities.find(i=>i.id===t),this.updateActivityInternal=async t=>{const i=[...this.workflow.activities],n=i.findIndex(i=>i.id==t.id);i[n]=Object.assign({},t),this.workflow=Object.assign(Object.assign({},this.workflow),{activities:i})},this.setupJsPlumbEventHandlers=()=>{this.jsPlumb.bind("connection",this.connectionCreated),this.jsPlumb.bind("connectionDetached",this.connectionDetached)},this.connectionCreated=async t=>{const i=t.connection,n=t.sourceEndpoint.getParameter("outcome");i.getOverlay("label").setLabel(n);const e=this.findActivityByElement(t.source),s=this.findActivityByElement(t.target);if(!this.workflow.connections.find(t=>t.sourceActivityId===e.id&&t.destinationActivityId==s.id)){const t=[...this.workflow.connections,{sourceActivityId:e.id,destinationActivityId:s.id,outcome:n}];this.workflow=Object.assign(Object.assign({},this.workflow),{connections:t})}},this.connectionDetached=async t=>{const i=t.sourceEndpoint.getParameter("outcome"),n=this.findActivityByElement(t.source),e=this.findActivityByElement(t.target),s=this.workflow.connections.filter(t=>!(t.sourceActivityId===n.id&&t.destinationActivityId===e.id&&t.outcome===i));this.workflow=Object.assign(Object.assign({},this.workflow),{connections:s})},this.onAddActivityClick=t=>{const i=this.elem();this.lastClickedLocation={left:t.pageX-i.offsetLeft,top:t.pageY-i.offsetTop},this.addActivityEvent.emit()},this.onDeleteActivityClick=async()=>{await this.deleteActivity(this.selectedActivity)},this.onEditActivityClick=()=>{this.onEditActivity(this.selectedActivity)}}onWorkflowChanged(t){this.workflowChanged.emit(deepClone(t))}async newWorkflow(){this.workflow={activities:[],connections:[]}}async getWorkflow(){return deepClone(this.workflow)}async addActivity(t){const i=this.lastClickedLocation?this.lastClickedLocation.left:150,n=this.lastClickedLocation?this.lastClickedLocation.top:150,e={id:v4_1(),top:n,left:i,type:t.type,state:{}};this.lastClickedLocation=null;const s=[...this.workflow.activities,e];this.workflow=Object.assign(Object.assign({},this.workflow),{activities:s})}async updateActivity(t){await this.updateActivityInternal(t)}componentWillLoad(){this.jsPlumb=JsPlumbUtils.createInstance(".workflow-canvas",this.readonly)}componentDidRender(){this.setupJsPlumb(),this.setupPopovers()}render(){const t=this.createActivityModels();return h("host",{class:"workflow-canvas",ref:t=>this.canvas=t,style:{height:this.canvasHeight}},t.map(t=>{const i=t.activity,n={left:i.left+"px",top:i.top+"px"},e={activity:!0,"activity-blocking":!!i.blocking,"activity-executed":!!i.executed,"activity-faulted":i.faulted};if(this.readonly){e.noselect=!0;const s={};return i.message&&(s["data-toggle"]="popover",s["data-trigger"]="hover",s.title=i.message.title,s["data-content"]=i.message.content),h("div",Object.assign({id:"wf-activity-"+i.id,"data-activity-id":i.id,class:e,style:n},s),h("wf-activity-renderer",{activity:i,activityDefinition:t.definition,displayMode:ActivityDisplayMode.Design}))}return h("div",{id:"wf-activity-"+i.id,"data-activity-id":i.id,class:e,style:n,onDblClick:()=>this.onEditActivity(i),onContextMenu:t=>this.onActivityContextMenu(t,i)},h("wf-activity-renderer",{activity:i,activityDefinition:t.definition,displayMode:ActivityDisplayMode.Design}))}),this.renderContextMenu())}createActivityModels(){const t=this.activityDefinitions||[];return(this.workflow||{activities:[],connections:[]}).activities.map(i=>{const n=t.find(t=>t.type==i.type);return{activity:i,definition:n}})}setupTargets(t){this.jsPlumb.makeTarget(t,{dropOptions:{hoverClass:"hover"},anchor:"Continuous",endpoint:["Blank",{radius:4}]})}setupOutcomes(t){const i=this.findActivityByElement(t),n=this.activityDefinitions.find(t=>t.type==i.type),e=ActivityManager$1.getOutcomes(i,n),s=i.executed;for(let r of e){const n=JsPlumbUtils.getSourceEndpointOptions(i.id,r,s);this.jsPlumb.addEndpoint(t,{connectorOverlays:[["Label",{label:r,cssClass:"connection-label"}]]},n)}}getActivityElements(){return this.elem().querySelectorAll(".activity")}static getActivityId(t){return t.attributes["data-activity-id"].value}onEditActivity(t){const i=deepClone(t);this.editActivityEvent.emit(i)}async onActivityContextMenu(t,i){this.selectedActivity=i,await this.activityContextMenu.handleContextMenuEvent(t)}get el(){return getElement(this)}static get watchers(){return{workflow:["onWorkflowChanged"]}}};Designer.style=designerCss;var dragscroll=createCommonjsModule((function(t,i){!function(t){var i,n,e=window,s=document,r="mousemove",o="mouseup",a="mousedown",h="EventListener",u="add"+h,c="remove"+h,l=[],f=function(t,h){for(t=0;t<l.length;)(h=(h=l[t++]).container||h)[c](a,h.md,0),e[c](o,h.mu,0),e[c](r,h.mm,0);for(l=[].slice.call(s.getElementsByClassName("dragscroll")),t=0;t<l.length;)!function(t,h,c,l,f,v){(v=t.container||t)[u](a,v.md=function(i){t.hasAttribute("nochilddrag")&&s.elementFromPoint(i.pageX,i.pageY)!=v||(l=1,h=i.clientX,c=i.clientY,i.preventDefault())},0),e[u](o,v.mu=function(){l=0},0),e[u](r,v.mm=function(e){l&&((f=t.scroller||t).scrollLeft-=i=-h+(h=e.clientX),f.scrollTop-=n=-c+(c=e.clientY),t==s.body&&((f=s.documentElement).scrollLeft-=i,f.scrollTop-=n))},0)}(l[t++])};"complete"==s.readyState?f():e[u]("load",f,0),t.reset=f}(i)}));class BooleanFieldDriver{constructor(){this.displayEditor=(t,i)=>{const n=i.name;return`<wf-boolean-field name="${n}" label="${i.label}" hint="${i.hint}" checked="${"true"===t.state[n]}"></wf-boolean-field>`},this.updateEditor=(t,i,n)=>{t.state[i.name]=n.get(i.name)}}}class ExpressionFieldDriver{constructor(){this.displayEditor=(t,i)=>{const n=i.name,e=i.label,s=t.state[n]||{expression:"",syntax:"Literal"},r=(i.options||{}).multiline||!1,o=s.expression.replace(/"/g,"&quot;");return`<wf-expression-field name="${n}" label="${e}" hint="${i.hint}" value="${o}" syntax="${s.syntax}" multiline="${r}"></wf-expression-field>`},this.updateEditor=(t,i,n)=>{const e=i.name+".syntax",s=n.get(i.name+".expression").toString().trim(),r=n.get(e).toString();t.state[i.name]={expression:s,syntax:r}}}}class ListFieldDriver{constructor(){this.displayEditor=(t,i)=>{const n=i.name,e=i.label,s=(t.state[n]||[]).join(", ");return`<wf-list-field name="${n}" label="${e}" hint="${i.hint}" items="${s}"></wf-list-field>`},this.updateEditor=(t,i,n)=>{const e=n.get(i.name).toString();t.state[i.name]=e.split(",").map(t=>t.trim())}}}class TextFieldDriver{constructor(){this.displayEditor=(t,i)=>{const n=i.name;return`<wf-text-field name="${n}" label="${i.label}" hint="${i.hint}" value="${t.state[n]||""}"></wf-text-field>`},this.updateEditor=(t,i,n)=>{t.state[i.name]=n.get(i.name).toString().trim()}}}class SelectFieldDriver{constructor(){this.displayEditor=(t,i)=>{const n=i.name,e=i.label,s=t.state[n]||"",r=encodeURI(JSON.stringify(i.options.items||[]));return`<wf-select-field name="${n}" label="${e}" hint="${i.hint}" data-items="${r}" value="${s}"></wf-select-field>`},this.updateEditor=(t,i,n)=>{const e=n.get(i.name).toString();t.state[i.name]=e.trim()}}}class WorkflowPluginStore{constructor(){this.plugins=[],this.add=t=>{this.plugins=[...this.plugins,t]},this.list=()=>[...this.plugins]}}const pluginStore=new WorkflowPluginStore,win=window,elsa=win.elsa||{};var OutcomeNames;elsa.pluginStore=pluginStore,win.elsa=elsa,function(t){t.Done="Done",t.True="True",t.False="False"}(OutcomeNames||(OutcomeNames={}));class ConsoleActivities{constructor(){this.getName=()=>"ConsoleActivities",this.getActivityDefinitions=()=>[this.readLine(),this.writeLine()],this.readLine=()=>({type:"ReadLine",displayName:"Read Line",description:"Read text from standard in.",runtimeDescription:"a => !!a.state.variableName ? `Read text from standard in and store into <strong>${ a.state.variableName }</strong>.` : 'Read text from standard in.'",outcomes:[OutcomeNames.Done],category:ConsoleActivities.Category,icon:"fas fa-terminal",properties:[{name:"variableName",type:"text",label:"Variable Name",hint:"The name of the variable to store the value into."}]}),this.writeLine=()=>({type:"WriteLine",displayName:"Write Line",description:"Write text to standard out.",category:ConsoleActivities.Category,icon:"fas fa-terminal",runtimeDescription:"x => !!x.state.textExpression ? `Write <strong>${ x.state.textExpression.expression }</strong> to standard out.` : x.definition.description",outcomes:[OutcomeNames.Done],properties:[{name:"textExpression",type:"expression",label:"Text",hint:"The text to write."}]})}}ConsoleActivities.Category="Console",pluginStore.add(new ConsoleActivities);class ControlFlowActivities{constructor(){this.getName=()=>"ControlFlowActivities",this.getActivityDefinitions=()=>[this.fork(),this.ifElse(),this.join(),this.switch()],this.fork=()=>({type:"Fork",displayName:"Fork",description:"Fork workflow execution into multiple branches.",category:ControlFlowActivities.Category,icon:"fas fa-code-branch fa-rotate-180",outcomes:"x => x.state.branches",properties:[{name:"branches",type:"list",label:"Branches",hint:"Enter one or more names representing branches, separated with a comma. Example: Branch 1, Branch 2"}]}),this.ifElse=()=>({type:"IfElse",displayName:"If/Else",description:"Evaluate a Boolean expression and continue execution depending on the result.",category:ControlFlowActivities.Category,runtimeDescription:"x => !!x.state.expression ? `Evaluate <strong>${ x.state.expression.expression }</strong> and continue execution depending on the result.` : x.definition.description",outcomes:[OutcomeNames.True,OutcomeNames.False],properties:[{name:"expression",type:"expression",label:"Expression",hint:"The expression to evaluate. The evaluated value will be used to switch on."}]}),this.join=()=>({type:"Join",displayName:"Join",description:"Merge workflow execution back into a single branch.",category:ControlFlowActivities.Category,icon:"fas fa-code-branch",runtimeDescription:"x => !!x.state.joinMode ? `Merge workflow execution back into a single branch using mode <strong>${ x.state.joinMode }</strong>` : x.definition.description",outcomes:[OutcomeNames.Done],properties:[{name:"joinMode",type:"text",label:"Join Mode",hint:"Either 'WaitAll' or 'WaitAny'"}]}),this.switch=()=>({type:"Switch",displayName:"Switch",description:"Switch execution based on a given expression.",category:ControlFlowActivities.Category,icon:"far fa-list-alt",runtimeDescription:"x => !!x.state.expression ? `Switch execution based on <strong>${ x.state.expression.expression }</strong>.` : x.definition.description",outcomes:"x => x.state.cases.map(c => c.toString())",properties:[{name:"expression",type:"expression",label:"Expression",hint:"The expression to evaluate. The evaluated value will be used to switch on."},{name:"cases",type:"list",label:"Cases",hint:"A comma-separated list of possible outcomes of the expression."}]})}}ControlFlowActivities.Category="Control Flow",pluginStore.add(new ControlFlowActivities);class EmailActivities{constructor(){this.getName=()=>"EmailActivities",this.getActivityDefinitions=()=>[this.sendEmail()],this.sendEmail=()=>({type:"SendEmail",displayName:"Send Email",description:"Send an email message.",category:EmailActivities.Category,icon:"far fa-envelope",outcomes:[OutcomeNames.Done],properties:[{name:"from",type:"expression",label:"From",hint:"The sender's email address"},{name:"to",type:"expression",label:"To",hint:"The recipient's email address"},{name:"subject",type:"expression",label:"Subject",hint:"The subject of the email message."},{name:"body",type:"expression",label:"Body",hint:"The body of the email message.",options:{multiline:!0}}]})}}EmailActivities.Category="Email",pluginStore.add(new EmailActivities);class HttpActivities{constructor(){this.getName=()=>"HttpActivities",this.getActivityDefinitions=()=>[this.sendHttpRequest(),this.sendHttpResponse(),this.handleHttpRequest()],this.sendHttpRequest=()=>({type:"HttpRequestAction",displayName:"Send HTTP Request",description:"Send an HTTP request.",category:HttpActivities.Category,icon:"fas fa-cloud",properties:[{name:"url",type:"text",label:"URL",hint:"The URL to send the HTTP request to."},{name:"method",type:"select",label:"Method",hint:"The HTTP method to use when making the request.",options:{items:["GET","POST","PUT","DELETE","OPTIONS","HEAD"]}},{name:"content",type:"expression",label:"Content",hint:"The HTTP content to send along with the request."},{name:"statusCodes",type:"list",label:"Status Codes",hint:"A list of possible HTTP status codes to handle, comma-separated. Example: 200, 400, 404"}],outcomes:"x => !!x.state.statusCodes ? x.state.statusCodes : []"}),this.handleHttpRequest=()=>({type:"HttpRequestEvent",displayName:"Handle HTTP Request",description:"Handle an incoming HTTP request.",category:HttpActivities.Category,icon:"fas fa-cloud",properties:[{name:"path",type:"text",label:"Path",hint:"The relative path that triggers this activity."},{name:"method",type:"select",label:"Method",hint:"The HTTP method that triggers this activity.",options:{items:["GET","POST","PUT","DELETE","OPTIONS","HEAD"]}},{name:"readContent",type:"boolean",label:"Read Content",hint:"Check if the HTTP request content body should be read and stored as part of the HTTP request model. The stored format depends on the content-type header."}],runtimeDescription:"x => !!x.state.path ? `Handle <strong>${ x.state.method } ${ x.state.path }</strong>.` : x.definition.description",outcomes:[OutcomeNames.Done]}),this.sendHttpResponse=()=>({type:"HttpResponseAction",displayName:"Send HTTP Response",description:"Send an HTTP response.",category:HttpActivities.Category,icon:"fas fa-cloud",properties:[{name:"statusCode",type:"select",label:"Status Code",hint:"The HTTP status code to write.",options:{items:[{label:"2xx",options:[200,201,202,203,204]},{label:"3xx",options:[301,302,304,307,308]},{label:"4xx",options:[400,401,402,403,404,405,409,410,412,413,415,417,418,420,428,429]}]}},{name:"content",type:"expression",label:"Content",hint:"The HTTP content to write.",options:{multiline:!0}},{name:"contentType",type:"select",label:"Content Type",hint:"The HTTP content type header to write.",options:{items:["text/plain","text/html","application/json","application/xml"]}},{name:"responseHeaders",type:"expression",label:"Response Headers",hint:"The headers to send along with the response. One 'header: value' pair per line.",options:{multiline:!0}}],runtimeDescription:"x => !!x.state.statusCode ? `Send an HTTP <strong>${ x.state.statusCode }</strong><br/><br/> ${ x.state.contentType }</strong><br/>${ !!x.state.content ? x.state.content.expression ? x.state.content.expression.substr(0,100) + '...' : '' : '' }` : x.definition.description",outcomes:[OutcomeNames.Done]})}}HttpActivities.Category="HTTP",pluginStore.add(new HttpActivities);class MassTransitActivities{constructor(){this.getName=()=>"MassTransitActivities",this.getActivityDefinitions=()=>[this.receiveMassTransitMessage(),this.sendMassTransitMessage()],this.receiveMassTransitMessage=()=>({type:"ReceiveMassTransitMessage",displayName:"Receive MassTransit Message",description:"Receive a message via MassTransit.",category:MassTransitActivities.Category,icon:"fas fa-envelope-open-text",properties:[{name:"messageType",type:"text",label:"Message Type",hint:"The assembly-qualified type name of the message to receive."}],outcomes:[OutcomeNames.Done]}),this.sendMassTransitMessage=()=>({type:"SendMassTransitMessage",displayName:"Send MassTransit Message",description:"Send a message via MassTransit.",category:MassTransitActivities.Category,icon:"fas fa-envelope",properties:[{name:"messageType",type:"text",label:"Message Type",hint:"The assembly-qualified type name of the message to send."},{name:"message",type:"expression",label:"Message",hint:"An expression that evaluates to the message to send."}],outcomes:[OutcomeNames.Done]})}}MassTransitActivities.Category="MassTransit",pluginStore.add(new MassTransitActivities);class PrimitiveActivities{constructor(){this.getName=()=>"PrimitiveActivities",this.getActivityDefinitions=()=>[this.log(),this.setVariable()],this.log=()=>({type:"Log",displayName:"Log",description:"Log a message.",category:PrimitiveActivities.Category,icon:"fas fa-feather-alt",properties:[{name:"message",type:"text",label:"Message",hint:"The text to log."},{name:"logLevel",type:"text",label:"Log Level",hint:"The log level to use."}],runtimeDescription:"x => !!x.state.message ? `Log <strong>${x.state.logLevel}: ${x.state.message}</strong>` : x.definition.description",outcomes:[OutcomeNames.Done]}),this.setVariable=()=>({type:"SetVariable",displayName:"Set Variable",description:"Set a variable on the workflow.",category:PrimitiveActivities.Category,properties:[{name:"variableName",type:"text",label:"Variable Name",hint:"The name of the variable to store the value into."},{name:"expression",type:"expression",label:"Variable Expression",hint:"An expression that evaluates to the value to store in the variable."}],runtimeDescription:"x => !!x.state.variableName ? `${x.state.expression.syntax}: <strong>${x.state.variableName}</strong> = <strong>${x.state.expression.expression}</strong>` : x.definition.description",outcomes:[OutcomeNames.Done]})}}PrimitiveActivities.Category="Primitives",pluginStore.add(new PrimitiveActivities);class TimerActivities{constructor(){this.getName=()=>"TimerActivities",this.getActivityDefinitions=()=>[this.timerEvent()],this.timerEvent=()=>({type:"TimerEvent",displayName:"Timer Event",description:"Triggers after a specified amount of time.",category:TimerActivities.Category,icon:"fas fa-hourglass-start",properties:[{name:"expression",type:"expression",label:"Timeout Expression",hint:"The amount of time to wait before this timer event is triggered. Format: 'd.HH:mm:ss'."},{name:"name",type:"text",label:"Name",hint:"Optionally provide a name for this activity. You can reference named activities from expressions."},{name:"title",type:"text",label:"Title",hint:"Optionally provide a custom title for this activity."},{name:"description",type:"text",label:"Description",hint:"Optionally provide a custom description for this activity."}],runtimeDescription:"x => !!x.state.expression ? `Triggers after <strong>${ x.state.expression.expression }</strong>` : x.definition.description",outcomes:[OutcomeNames.Done]})}}TimerActivities.Category="Timers",pluginStore.add(new TimerActivities);const designerHostCss=".workflow-designer-wrapper{height:80vh;overflow-y:auto}",DesignerHost=class{constructor(t){registerInstance(this,t),this.workflowChanged=createEvent(this,"workflowChanged",7),this.activityDefinitions=[],this.loadActivityDefinitions=()=>{const t=(this.pluginsData||"").split(/[ ,]+/).map(t=>t.trim());return pluginStore.list().filter(i=>t.indexOf(i.getName())>-1).filter(t=>!!t.getActivityDefinitions).map(t=>t.getActivityDefinitions()).reduce((t,i)=>t.concat(i),[])},this.onWorkflowChanged=t=>{this.workflowChanged.emit(t.detail)},this.initActivityDefinitions=()=>{if(this.activityDefinitions=this.loadActivityDefinitions(),this.activityDefinitionsData){const t=JSON.parse(this.activityDefinitionsData);this.activityDefinitions=[...this.activityDefinitions,...t]}},this.initFieldDrivers=()=>{DisplayManager$1.addDriver("text",new TextFieldDriver),DisplayManager$1.addDriver("expression",new ExpressionFieldDriver),DisplayManager$1.addDriver("list",new ListFieldDriver),DisplayManager$1.addDriver("boolean",new BooleanFieldDriver),DisplayManager$1.addDriver("select",new SelectFieldDriver)},this.initWorkflow=()=>{if(this.workflowData){const t=JSON.parse(this.workflowData);t.activities||(t.activities=[]),t.connections||(t.connections=[]),this.designer.workflow=t}}}async newWorkflow(){await this.designer.newWorkflow()}async getWorkflow(){return await this.designer.getWorkflow()}async showActivityPicker(){await this.activityPicker.show()}async export(t){await this.importExport.export(this.designer,t)}async import(){await this.importExport.import()}async onActivityPicked(t){await this.designer.addActivity(t.detail)}async onEditActivity(t){this.activityEditor.activity=t.detail,this.activityEditor.show=!0}async onAddActivity(){await this.showActivityPicker()}async onUpdateActivity(t){await this.designer.updateActivity(t.detail)}async onExportWorkflow(t){this.importExport&&await this.importExport.export(this.designer,t.detail)}async onImportWorkflow(t){this.designer.workflow=deepClone(t.detail)}componentWillLoad(){this.initActivityDefinitions(),this.initFieldDrivers()}componentDidLoad(){this.initWorkflow()}render(){const t=this.activityDefinitions;return h("host",null,h("wf-activity-picker",{activityDefinitions:t,ref:t=>this.activityPicker=t}),h("wf-activity-editor",{activityDefinitions:t,ref:t=>this.activityEditor=t}),h("wf-import-export",{ref:t=>this.importExport=t}),h("div",{class:"workflow-designer-wrapper dragscroll"},h("wf-designer",{activityDefinitions:t,ref:t=>this.designer=t,canvasHeight:this.canvasHeight,workflow:this.workflow,readonly:this.readonly,onWorkflowChanged:this.onWorkflowChanged})))}get el(){return getElement(this)}};DesignerHost.style=designerHostCss;const ExportButton=class{constructor(t){registerInstance(this,t),this.exportClickedEvent=createEvent(this,"export",7),this.workflowFormats={json:{format:"json",fileExtension:".json",mimeType:"application/json",displayName:"JSON"},yaml:{format:"yaml",fileExtension:".yaml",mimeType:"application/x-yaml",displayName:"YAML"},xml:{format:"xml",fileExtension:".xml",mimeType:"application/xml",displayName:"XML"},object:{format:"object",fileExtension:".bin",mimeType:"application/binary",displayName:"Binary"}},this.getWorkflowHost=()=>this.designerHostId?document.querySelector("#"+this.designerHostId):null,this.handleExportClick=async(t,i)=>{t.preventDefault(),this.exportClickedEvent.emit(i);const n=this.getWorkflowHost();n&&await n.export(i)}}render(){const t=this.workflowFormats;return h("div",{class:"dropdown"},h("button",{class:"btn btn-secondary dropdown-toggle",type:"button",id:"exportButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"Export"),h("div",{class:"dropdown-menu","aria-labelledby":"exportButton"},Object.keys(t).map(i=>{const n=t[i];return h("a",{class:"dropdown-item",href:"#",onClick:t=>this.handleExportClick(t,n)},n.displayName)})))}get el(){return getElement(this)}};var remedial=createCommonjsModule((function(t){!function(){var i,n,e=Function("return this")(),s="Boolean Number String Function Array Date RegExp Object".split(" "),r={};for(i in s)s.hasOwnProperty(i)&&(r["[object "+(n=s[i])+"]"]=n.toLowerCase());function o(t){return null==t?String(t):r[Object.prototype.toString.call(t)]||"object"}function a(t){var i,n;if("object"===o(t))for(i in t)if(void 0!==(n=t[i])&&"function"!==o(n))return!1;return!0}String.prototype.entityify||(String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}),String.prototype.quote||(String.prototype.quote=function(){var t,i,n=this.length,e='"';for(i=0;i<n;i+=1)if((t=this.charAt(i))>=" ")"\\"!==t&&'"'!==t||(e+="\\"),e+=t;else switch(t){case"\b":e+="\\b";break;case"\f":e+="\\f";break;case"\n":e+="\\n";break;case"\r":e+="\\r";break;case"\t":e+="\\t";break;default:t=t.charCodeAt(),e+="\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)}return e+'"'}),String.prototype.supplant||(String.prototype.supplant=function(t){return this.replace(/{([^{}]*)}/g,(function(i,n){var e=t[n];return"string"==typeof e||"number"==typeof e?e:i}))}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s*(\S*(?:\s+\S+)*)\s*$/,"$1")}),t.exports={typeOf:o,isEmpty:a},e.typeOf=e.typeOf||o,e.isEmpty=e.isEmpty||a}()})),json2yaml=createCommonjsModule((function(t){var i;i=remedial.typeOf,t.exports.stringify=function(t){var n,e="";return"---"+(n={undefined:function(){return"null"},null:function(){return"null"},number:function(t){return t},boolean:function(t){return t?"true":"false"},string:function(t){return JSON.stringify(t)},array:function(t){var s="";return 0===t.length?s+="[]":(e=e.replace(/$/,"  "),t.forEach((function(t){var r=n[i(t)];if(!r)throw new Error("what the crap: "+i(t));s+="\n"+e+"- "+r(t)})),e=e.replace(/  /,""),s)},object:function(t){var s="";return 0===Object.keys(t).length?s+="{}":(e=e.replace(/$/,"  "),Object.keys(t).forEach((function(r){var o=t[r],a=n[i(o)];if(void 0!==o){if(!a)throw new Error("what the crap: "+i(o));s+="\n"+e+r+": "+a(o)}})),e=e.replace(/  /,""),s)},function:function(){return"[object Function]"}})[i(t)](t)+"\n"}}));const importExportCss=".import-button{display:none}",ImportExport=class{constructor(t){registerInstance(this,t),this.importEvent=createEvent(this,"import-workflow",7),this.importWorkflow=()=>{const t=this.fileInput.files[0],i=new FileReader;i.onload=async()=>{const t={data:i.result,format:"json"};await this.import(t)},i.readAsText(t)},this.serialize=(t,i)=>{switch(i){case"json":return JSON.stringify(t);case"yaml":return json2yaml.stringify(t);case"xml":return JSON.stringify(t);default:return t}}}async export(t,i){let n=this.blobUrl;n&&window.URL.revokeObjectURL(n);const e=this.serialize(t.workflow,i.format),s=new Blob([e],{type:i.mimeType});this.blobUrl=n=window.URL.createObjectURL(s);const r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download","workflow."+i.fileExtension),document.body.appendChild(r),r.click(),document.body.removeChild(r)}async import(t){if(t){const i=JSON.parse(t.data);this.importEvent.emit(i)}else this.fileInput.click()}render(){return h("host",null,h("input",{type:"file",class:"import-button",onChange:this.importWorkflow,ref:t=>this.fileInput=t}))}get el(){return getElement(this)}};ImportExport.style=importExportCss;export{ActivityEditor as wf_activity_editor,ActivityPicker as wf_activity_picker,ActivityRenderer as wf_activity_renderer,ContextMenu as wf_context_menu,ContextMenuItem as wf_context_menu_item,Designer as wf_designer,DesignerHost as wf_designer_host,ExportButton as wf_export_button,ImportExport as wf_import_export}