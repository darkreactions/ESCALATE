var __awaiter=this&&this.__awaiter||function(t,e,n,i){function r(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{l(i.next(t))}catch(e){o(e)}}function a(t){try{l(i["throw"](t))}catch(e){o(e)}}function l(t){t.done?n(t.value):r(t.value).then(s,a)}l((i=i.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(t){return function(e){return l([t,e])}}function l(s){if(i)throw new TypeError("Generator is already executing.");while(n)try{if(i=1,r&&(o=s[0]&2?r["return"]:s[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;if(r=0,o)s=[s[0]&2,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;r=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1];o=s;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(s);break}if(o[2])n.ops.pop();n.trys.pop();continue}s=e.call(t,n)}catch(a){s=[6,a];r=0}finally{i=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var i=Array(t),r=0,e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i};System.register(["./p-a5a09fce.system.js"],(function(exports){"use strict";var registerInstance,createEvent,h,getElement,Host;return{setters:[function(t){registerInstance=t.r;createEvent=t.c;h=t.h;getElement=t.g;Host=t.H}],execute:function(){var ActivityDisplayMode;(function(t){t["Design"]="Design";t["Edit"]="Edit"})(ActivityDisplayMode||(ActivityDisplayMode={}));var activityEditorCss="";var ActivityEditor=exports("wf_activity_editor",function(){function t(t){registerInstance(this,t);this.submit=createEvent(this,"update-activity",7);this.activityDefinitions=[]}t.prototype.onSubmit=function(t){return __awaiter(this,void 0,void 0,(function(){var e,n,i;return __generator(this,(function(r){switch(r.label){case 0:t.preventDefault();e=t.target;n=new FormData(e);return[4,this.renderer.updateEditor(n)];case 1:i=r.sent();this.submit.emit(i);this.show=false;return[2]}}))}))};t.prototype.componentDidRender=function(){var t=$(this.el.querySelector(".modal"));var e=this.show?"show":"hide";t.modal(e)};t.prototype.render=function(){var t=this;var e=this.activity;if(!e){return null}var n=this.activityDefinitions.find((function(t){return t.type==e.type}));if(!n){console.error("No activity of type "+this.activity.type+" exists in the library.");return}var i=n.displayName;return h("div",null,h("div",{class:"modal",tabindex:"-1",role:"dialog"},h("div",{class:"modal-dialog modal-xl",role:"document"},h("div",{class:"modal-content"},h("form",{onSubmit:function(e){return t.onSubmit(e)}},h("div",{class:"modal-header"},h("h5",{class:"modal-title"},"Edit ",i),h("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},h("span",{"aria-hidden":"true"},"×"))),h("div",{class:"modal-body"},h("wf-activity-renderer",{activity:e,activityDefinition:n,displayMode:ActivityDisplayMode.Edit,ref:function(e){return t.renderer=e}})),h("div",{class:"modal-footer"},h("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancel"),h("button",{type:"submit",class:"btn btn-primary"},"Save")))))))};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});return t}());ActivityEditor.style=activityEditorCss;var activityPickerCss="";var ActivityPicker=exports("wf_activity_picker",function(){function t(t){var e=this;registerInstance(this,t);this.activitySelected=createEvent(this,"activity-picked",7);this.activityDefinitions=[];this.filterText="";this.selectedCategory=null;this.onFilterTextChanged=function(t){var n=t.target;e.filterText=n.value};this.selectCategory=function(t){e.selectedCategory=t};this.renderActivity=function(t){var n=t.icon||"fas fa-cog";var i=n+" mr-1";return h("div",{class:"card activity"},h("div",{class:"card-body"},h("h4",{class:"card-title"},h("i",{class:i}),t.displayName),h("p",null,t.description),h("a",{href:"#",onClick:function(n){n.preventDefault();e.selectCategory(t.category)}},h("span",{class:"badge badge-light"},t.category))),h("div",{class:"card-footer text-muted text-xs-right"},h("a",{class:"btn btn-primary btn-sm",href:"#",onClick:function(n){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:n.preventDefault();return[4,this.onActivitySelected(t)];case 1:e.sent();return[2]}}))}))}},"Select")))}}t.prototype.show=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.isVisible=true;$(this.modal).modal("show");return[2]}))}))};t.prototype.hide=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){$(this.modal).modal("hide");this.isVisible=false;return[2]}))}))};t.prototype.onActivitySelected=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:this.activitySelected.emit(t);return[4,this.hide()];case 1:e.sent();return[2]}}))}))};t.prototype.render=function(){var t=this;var e=this.activityDefinitions;var n=__spreadArrays([null],new Set(e.map((function(t){return t.category}))));var i=this.filterText;var r=this.selectedCategory;var o=e;if(!!r)o=o.filter((function(t){return t.category.toLowerCase()===r.toLowerCase()}));if(!!i)o=o.filter((function(t){return t.displayName.toLowerCase().includes(i.toLowerCase())}));return h("div",null,h("div",{class:"modal",tabindex:"-1",role:"dialog",ref:function(e){return t.modal=e}},h("div",{class:"modal-dialog modal-lg ",role:"document"},h("div",{class:"modal-content"},h("div",{class:"modal-header"},h("h5",{class:"modal-title"},"Available Activities"),h("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},h("span",{"aria-hidden":"true"},"×"))),h("div",{class:"modal-body"},h("div",{class:"row"},h("div",{class:"col-sm-3 col-md-3 col-lg-2"},h("div",{class:"form-group"},h("input",{class:"form-control",type:"search",placeholder:"Filter","aria-label":"Filter",autofocus:true,onKeyUp:this.onFilterTextChanged})),h("ul",{class:"nav nav-pills flex-column activity-picker-categories"},n.map((function(e){var n=e||"All";var i=e===t.selectedCategory;var r={"nav-link":true,active:i};return h("li",{class:"nav-item"},h("a",{class:r,href:"#","data-toggle":"pill",onClick:function(n){n.preventDefault();t.selectCategory(e)}},n))})))),h("div",{class:"col-sm-9 col-md-9 col-lg-10"},h("div",{class:"card-columns tab-content"},o.map(this.renderActivity))))),h("div",{class:"modal-footer"},h("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancel"))))))};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});return t}());ActivityPicker.style=activityPickerCss;var FormUpdater=function(){function t(){}t.updateEditor=function(t,e){var n=Object.assign({},t.state);e.forEach((function(t,e){n[e]=t}));return Object.assign(Object.assign({},t),{state:n})};return t}();var DefaultActivityHandler=function(){function DefaultActivityHandler(){this.renderDesigner=function(activity,definition){var description=null;if(activity.state.description)description=activity.state.description;else if(!!definition.runtimeDescription)description=definition.runtimeDescription;else description=definition.description;try{var fun=eval(description);description=fun({activity:activity,definition:definition,state:activity.state})}catch(_a){}return{title:activity.state.title||definition.displayName,description:description,icon:definition.icon||"fas fa-cog"}};this.updateEditor=function(t,e){return FormUpdater.updateEditor(t,e)};this.getOutcomes=function(activity,definition){var outcomes=[];if(!!definition){var lambda=definition.outcomes;if(lambda instanceof Array){outcomes=lambda}else{var value=eval(lambda);if(value instanceof Array)outcomes=value;else if(value instanceof Function){try{outcomes=value({activity:activity,definition:definition,state:activity.state})}catch(e){console.warn(e);outcomes=[]}}}}return!!outcomes?outcomes:[]}}return DefaultActivityHandler}();var ActivityManager=function(){function t(){var t=this;this.addHandler=function(e,n){t.handlers[e]=Object.assign({},n)};this.renderDesigner=function(e,n){var i=t.getHandler(e.type);if(!i.renderDesigner)return{title:e.state.title||n.displayName,description:e.state.description||n.description,icon:n.icon||"fas fa-cog"};return i.renderDesigner(e,n)};this.updateEditor=function(e,n){var i=t.getHandler(e.type);var r=i.updateEditor||FormUpdater.updateEditor;return r(e,n)};this.getOutcomes=function(e,n){var i=t.getHandler(e.type);if(!i.getOutcomes)return[];return i.getOutcomes(e,n)};this.getHandler=function(e){return t.handlers[e]||new DefaultActivityHandler};this.handlers={}}return t}();var ActivityManager$1=new ActivityManager;var DisplayManager=function(){function t(){var t=this;this.addDriver=function(e,n){t.drivers[e]=Object.assign({},n)};this.displayEditor=function(e,n){var i=t.drivers[n.type];if(!i)return null;return i.displayEditor(e,n)};this.updateEditor=function(e,n,i){var r=t.drivers[n.type];if(!r)return;r.updateEditor(e,n,i)};this.drivers={}}return t}();var DisplayManager$1=new DisplayManager;var activityRendererCss="";var ActivityRenderer=exports("wf_activity_renderer",function(){function t(t){registerInstance(this,t);this.displayMode=ActivityDisplayMode.Design}t.prototype.render=function(){if(!this.activity||!this.activityDefinition)return null;switch(this.displayMode){case ActivityDisplayMode.Design:return this.renderDesigner();case ActivityDisplayMode.Edit:return this.renderEditor()}};t.prototype.renderDesigner=function(){var t=this.activity;var e=this.activityDefinition;var n=ActivityManager$1.renderDesigner(t,e);var i=n.icon+" mr-1";return h("div",null,h("h5",null,h("i",{class:i}),n.title),h("h6",{innerHTML:n.description}))};t.prototype.renderEditor=function(){var t=this.activity;var e=this.activityDefinition;var n=e.properties;return h(Host,null,n.map((function(e){var n=DisplayManager$1.displayEditor(t,e);return h("div",{class:"form-group",innerHTML:n})})))};t.prototype.updateEditor=function(t){return __awaiter(this,void 0,void 0,(function(){var e,n,i,r,o,s;return __generator(this,(function(a){e=Object.assign({},this.activity);n=this.activityDefinition;i=n.properties;for(r=0,o=i;r<o.length;r++){s=o[r];DisplayManager$1.updateEditor(e,s,t)}return[2,e]}))}))};return t}());ActivityRenderer.style=activityRendererCss;var contextMenuCss="";var ContextMenu=exports("wf_context_menu",function(){function t(t){var e=this;registerInstance(this,t);this.contextMenuEvent=createEvent(this,"context-menu",7);this.isHidden=true;this.position={left:0,top:0};this.onContextMenu=function(t){if(t.defaultPrevented)return;t.preventDefault();e.contextMenuEvent.emit();e.position={left:t.pageX,top:t.pageY};e.isHidden=false};this.onContextMenuClick=function(){e.isHidden=true}}t.prototype.targetChangeHandler=function(t,e){if(!!e){e.removeEventListener("contextmenu",this.onContextMenu)}this.setupTarget(t)};t.prototype.targetSelectorChangeHandler=function(t){this.target=document.querySelector(t)};t.prototype.handleBodyClick=function(){this.isHidden=true};t.prototype.handleContextMenu=function(){this.isHidden=true};t.prototype.handleContextMenuEvent=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.onContextMenu(t);return[2]}))}))};t.prototype.componentDidLoad=function(){this.setupTarget(this.target)};t.prototype.render=function(){var t={left:this.position.left+"px",top:this.position.top+"px",display:this.isHidden?"none":"block"};return h(Host,{class:"dropdown-menu context-menu canvas-context-menu position-fixed",style:t,onClick:this.onContextMenuClick},h("slot",null))};t.prototype.setupTarget=function(t){if(!!t){t.addEventListener("contextmenu",this.onContextMenu,{capture:false})}};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{target:["targetChangeHandler"],targetSelector:["targetSelectorChangeHandler"]}},enumerable:false,configurable:true});return t}());ContextMenu.style=contextMenuCss;var contextMenuItemCss="";var ContextMenuItem=exports("wf_context_menu_item",function(){function t(t){registerInstance(this,t)}t.prototype.render=function(){var t=this.text;return h("a",{class:"dropdown-item",href:"#",onClick:function(t){return t.preventDefault()}},t)};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});return t}());ContextMenuItem.style=contextMenuItemCss;var commonjsGlobal=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function createCommonjsModule(t,e,n){return n={path:e,exports:{},require:function(t,e){return commonjsRequire()}},t(n,n.exports),n.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var jsplumb=createCommonjsModule((function(t,e){(function(){if(typeof Math.sgn=="undefined"){Math.sgn=function(t){return t==0?0:t>0?1:-1}}var t={subtract:function(t,e){return{x:t.x-e.x,y:t.y-e.y}},dotProduct:function(t,e){return t.x*e.x+t.y*e.y},square:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},scale:function(t,e){return{x:t.x*e,y:t.y*e}}},n=64,i=Math.pow(2,-n-1);var r=function(e,n){var i=[],r=s(e,n),o=n.length-1,l=2*o-1,u=a(r,l,i,0),c=t.subtract(e,n[0]),f=t.square(c),d=0;for(var p=0;p<u;p++){c=t.subtract(e,h(n,o,i[p],null,null));var v=t.square(c);if(v<f){f=v;d=i[p]}}c=t.subtract(e,n[o]);v=t.square(c);if(v<f){f=v;d=1}return{location:d,distance:f}};var o=function(t,e){var n=r(t,e);return{point:h(e,e.length-1,n.location,null,null),location:n.location}};var s=function(e,n){var i=n.length-1,r=2*i-1,o=[],s=[],a=[],l=[],u=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]];for(var c=0;c<=i;c++)o[c]=t.subtract(n[c],e);for(var c=0;c<=i-1;c++){s[c]=t.subtract(n[c+1],n[c]);s[c]=t.scale(s[c],3)}for(var h=0;h<=i-1;h++){for(var f=0;f<=i;f++){if(!a[h])a[h]=[];a[h][f]=t.dotProduct(s[h],o[f])}}for(c=0;c<=r;c++){if(!l[c])l[c]=[];l[c].y=0;l[c].x=parseFloat(c)/r}var d=i,p=i-1;for(var v=0;v<=d+p;v++){var g=Math.max(0,v-p),m=Math.min(v,d);for(c=g;c<=m;c++){var y=v-c;l[c+y].y+=a[y][c]*u[y][c]}}return l};var a=function(t,e,i,r){var o=[],s=[],f,d,p=[],v=[];switch(l(t,e)){case 0:{return 0}case 1:{if(r>=n){i[0]=(t[0].x+t[e].x)/2;return 1}if(u(t,e)){i[0]=c(t,e);return 1}break}}h(t,e,.5,o,s);f=a(o,e,p,r+1);d=a(s,e,v,r+1);for(var g=0;g<f;g++)i[g]=p[g];for(var g=0;g<d;g++)i[g+f]=v[g];return f+d};var l=function(t,e){var n=0,i,r;i=r=Math.sgn(t[0].y);for(var o=1;o<=e;o++){i=Math.sgn(t[o].y);if(i!=r)n++;r=i}return n};var u=function(t,e){var n,r,o,s,a,l,u,c,h,f,d,p,v,g,m,y;l=t[0].y-t[e].y;u=t[e].x-t[0].x;c=t[0].x*t[e].y-t[e].x*t[0].y;var b,x;b=x=0;for(var P=1;P<e;P++){var _=l*t[P].x+u*t[P].y+c;if(_>b)b=_;else if(_<x)x=_}d=0;p=1;v=0;g=l;m=u;y=c-b;h=d*m-g*p;f=1/h;r=(p*y-m*v)*f;g=l;m=u;y=c-x;h=d*m-g*p;f=1/h;o=(p*y-m*v)*f;s=Math.min(r,o);a=Math.max(r,o);n=a-s;return n<i?1:0};var c=function(t,e){var n=1,i=0,r=t[e].x-t[0].x,o=t[e].y-t[0].y,s=t[0].x-0,a=t[0].y-0,l=r*i-o*n,u=1/l,c=(r*a-o*s)*u;return 0+n*c};var h=function(t,e,n,i,r){var o=[[]];for(var s=0;s<=e;s++)o[0][s]=t[s];for(var a=1;a<=e;a++){for(var s=0;s<=e-a;s++){if(!o[a])o[a]=[];if(!o[a][s])o[a][s]={};o[a][s].x=(1-n)*o[a-1][s].x+n*o[a-1][s+1].x;o[a][s].y=(1-n)*o[a-1][s].y+n*o[a-1][s+1].y}}if(i!=null)for(s=0;s<=e;s++)i[s]=o[s][0];if(r!=null)for(s=0;s<=e;s++)r[s]=o[e-s][s];return o[e][0]};var f={};var d=function(t){var e=f[t];if(!e){e=[];var n=function(){return function(e){return Math.pow(e,t)}},i=function(){return function(e){return Math.pow(1-e,t)}},r=function(t){return function(e){return t}},o=function(){return function(t){return t}},s=function(){return function(t){return 1-t}},a=function(t){return function(e){var n=1;for(var i=0;i<t.length;i++)n=n*t[i](e);return n}};e.push(new n);for(var l=1;l<t;l++){var u=[new r(t)];for(var c=0;c<t-l;c++)u.push(new o);for(var c=0;c<l;c++)u.push(new s);e.push(new a(u))}e.push(new i);f[t]=e}return e};var p=function(t,e){var n=d(t.length-1),i=0,r=0;for(var o=0;o<t.length;o++){i=i+t[o].x*n[o](e);r=r+t[o].y*n[o](e)}return{x:i,y:r}};var v=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))};var g=function(t){return t[0].x===t[1].x&&t[0].y===t[1].y};var m=function(t,e,n){if(g(t)){return{point:t[0],location:e}}var i=p(t,e),r=0,o=e,s=n>0?1:-1,a=null;while(r<Math.abs(n)){o+=.005*s;a=p(t,o);r+=v(a,i);i=a}return{point:a,location:o}};var y=function(t){var e=(new Date).getTime();if(g(t))return 0;var n=p(t,0),i=0,r=0,o=1,s=null;while(r<1){r+=.005*o;s=p(t,r);i+=v(s,n);n=s}console.log("length",(new Date).getTime()-e);return i};var b=function(t,e,n){return m(t,e,n).point};var x=function(t,e,n){return m(t,e,n).location};var P=function(t,e){var n=p(t,e),i=p(t.slice(0,t.length-1),e),r=i.y-n.y,o=i.x-n.x;return r===0?Infinity:Math.atan(r/o)};var _=function(t,e,n){var i=m(t,e,n);if(i.location>1)i.location=1;if(i.location<0)i.location=0;return P(t,i.location)};var C=function(t,e,n,i){i=i==null?0:i;var r=m(t,e,i),o=P(t,r.location),s=Math.atan(-1/o),a=n/2*Math.sin(s),l=n/2*Math.cos(s);return[{x:r.point.x+l,y:r.point.y+a},{x:r.point.x-l,y:r.point.y-a}]};var w=function(t,e,n,i,r){var o=i-e,s=t-n,a=t*(e-i)+e*(n-t),l=S(r),u=[o*l[0][0]+s*l[1][0],o*l[0][1]+s*l[1][1],o*l[0][2]+s*l[1][2],o*l[0][3]+s*l[1][3]+a],c=A.apply(null,u),h=[];if(c!=null){for(var f=0;f<3;f++){var d=c[f],p=Math.pow(d,2),v=Math.pow(d,3),g=[l[0][0]*v+l[0][1]*p+l[0][2]*d+l[0][3],l[1][0]*v+l[1][1]*p+l[1][2]*d+l[1][3]];var m;if(n-t!==0){m=(g[0]-t)/(n-t)}else{m=(g[1]-e)/(i-e)}if(d>=0&&d<=1&&m>=0&&m<=1){h.push(g)}}}return h};var j=function(t,e,n,i,r){var o=[];o.push.apply(o,w(t,e,t+n,e,r));o.push.apply(o,w(t+n,e,t+n,e+i,r));o.push.apply(o,w(t+n,e+i,t,e+i,r));o.push.apply(o,w(t,e+i,t,e,r));return o};var E=function(t,e){var n=[];n.push.apply(n,w(t.x,t.y,t.x+t.w,t.y,e));n.push.apply(n,w(t.x+t.w,t.y,t.x+t.w,t.y+t.h,e));n.push.apply(n,w(t.x+t.w,t.y+t.h,t.x,t.y+t.h,e));n.push.apply(n,w(t.x,t.y+t.h,t.x,t.y,e));return n};function D(t,e){return[-t[0][e]+3*t[1][e]+-3*t[2][e]+t[3][e],3*t[0][e]-6*t[1][e]+3*t[2][e],-3*t[0][e]+3*t[1][e],t[0][e]]}function S(t){return[D(t,"x"),D(t,"y")]}function k(t){return t<0?-1:t>0?1:0}function A(t,e,n,i){var r=e/t,o=n/t,s=i/t,a=(3*o-Math.pow(r,2))/9,l=(9*r*o-27*s-2*Math.pow(r,3))/54,u=Math.pow(a,3)+Math.pow(l,2),c,h,f=[];if(u>=0){c=k(l+Math.sqrt(u))*Math.pow(Math.abs(l+Math.sqrt(u)),1/3);h=k(l-Math.sqrt(u))*Math.pow(Math.abs(l-Math.sqrt(u)),1/3);f[0]=-r/3+(c+h);f[1]=-r/3-(c+h)/2;f[2]=-r/3-(c+h)/2;if(Math.abs(Math.sqrt(3)*(c-h)/2)!==0){f[1]=-1;f[2]=-1}}else{var d=Math.acos(l/Math.sqrt(-Math.pow(a,3)));f[0]=2*Math.sqrt(-a)*Math.cos(d/3)-r/3;f[1]=2*Math.sqrt(-a)*Math.cos((d+2*Math.PI)/3)-r/3;f[2]=2*Math.sqrt(-a)*Math.cos((d+4*Math.PI)/3)-r/3}for(var p=0;p<3;p++){if(f[p]<0||f[p]>1){f[p]=-1}}return f}var I=this.jsBezier={distanceFromCurve:r,gradientAtPoint:P,gradientAtPointAlongCurveFrom:_,nearestPointOnCurve:o,pointOnCurve:p,pointAlongCurveFrom:b,perpendicularToCurveAt:C,locationAlongCurveFrom:x,getLength:y,lineIntersection:w,boxIntersection:j,boundingBoxIntersection:E,version:"0.9.0"};{e.jsBezier=I}}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this;var n=t.Biltong={version:"0.4.0"};{e.Biltong=n}var i=function(t){return Object.prototype.toString.call(t)==="[object Array]"},r=function(t,e,n){t=i(t)?t:[t.x,t.y];e=i(e)?e:[e.x,e.y];return n(t,e)},o=n.gradient=function(t,e){return r(t,e,(function(t,e){if(e[0]==t[0])return e[1]>t[1]?Infinity:-Infinity;else if(e[1]==t[1])return e[0]>t[0]?0:-0;else return(e[1]-t[1])/(e[0]-t[0])}))},s=n.normal=function(t,e){return-1/o(t,e)},a=n.lineLength=function(t,e){return r(t,e,(function(t,e){return Math.sqrt(Math.pow(e[1]-t[1],2)+Math.pow(e[0]-t[0],2))}))},l=n.quadrant=function(t,e){return r(t,e,(function(t,e){if(e[0]>t[0]){return e[1]>t[1]?2:1}else if(e[0]==t[0]){return e[1]>t[1]?2:1}else{return e[1]>t[1]?3:4}}))},u=n.theta=function(t,e){return r(t,e,(function(t,e){var n=o(t,e),i=Math.atan(n),r=l(t,e);if(r==4||r==3)i+=Math.PI;if(i<0)i+=2*Math.PI;return i}))},c=n.intersects=function(t,e){var n=t.x,i=t.x+t.w,r=t.y,o=t.y+t.h,s=e.x,a=e.x+e.w,l=e.y,u=e.y+e.h;return n<=s&&s<=i&&(r<=l&&l<=o)||n<=a&&a<=i&&(r<=l&&l<=o)||n<=s&&s<=i&&(r<=u&&u<=o)||n<=a&&s<=i&&(r<=u&&u<=o)||s<=n&&n<=a&&(l<=r&&r<=u)||s<=i&&i<=a&&(l<=r&&r<=u)||s<=n&&n<=a&&(l<=o&&o<=u)||s<=i&&n<=a&&(l<=o&&o<=u)},h=n.encloses=function(t,e,n){var i=t.x,r=t.x+t.w,o=t.y,s=t.y+t.h,a=e.x,l=e.x+e.w,u=e.y,c=e.y+e.h,h=function(t,e,i,r){return n?t<=e&&i>=r:t<e&&i>r};return h(i,a,r,l)&&h(o,u,s,c)},f=[null,[1,-1],[1,1],[-1,1],[-1,-1]],d=[null,[-1,-1],[-1,1],[1,1],[1,-1]],p=n.pointOnLine=function(t,e,n){var i=o(t,e),r=l(t,e),s=n>0?f[r]:d[r],a=Math.atan(i),u=Math.abs(n*Math.sin(a))*s[1],c=Math.abs(n*Math.cos(a))*s[0];return{x:t.x+c,y:t.y+u}},v=n.perpendicularLineTo=function(t,e,n){var i=o(t,e),r=Math.atan(-1/i),s=n/2*Math.sin(r),a=n/2*Math.cos(r);return[{x:e.x+a,y:e.y+s},{x:e.x-a,y:e.y-s}]}}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){function t(t,e,n,i,r,o,s,a){return new Touch({target:e,identifier:F(),pageX:n,pageY:i,screenX:r,screenY:o,clientX:s||r,clientY:a||o})}function n(){var t=[];Array.prototype.push.apply(t,arguments);t.item=function(t){return this[t]};return t}function i(e,i,r,o,s,a,l,u){return n(t.apply(null,arguments))}var r=this,o=function(t,e,n){n=n||t.parentNode;var i=n.querySelectorAll(e);for(var r=0;r<i.length;r++){if(i[r]===t){return true}}return false},s=function(t){return typeof t=="string"||t.constructor===String?document.getElementById(t):t},a=function(t){return t.srcElement||t.target},l=function(t,e,n,i){if(!i)return{path:[e],end:1};else if(typeof t.path!=="undefined"&&t.path.indexOf){return{path:t.path,end:t.path.indexOf(n)}}else{var r={path:[],end:-1},o=function(t){r.path.push(t);if(t===n){r.end=r.path.length-1}else if(t.parentNode!=null){o(t.parentNode)}};o(e);return r}},u=function(t,e){for(var n=0,i=t.length;n<i;n++){if(t[n]==e)break}if(n<t.length)t.splice(n,1)},c=1,h=function(t,e,n){var i=c++;t.__ta=t.__ta||{};t.__ta[e]=t.__ta[e]||{};t.__ta[e][i]=n;n.__tauid=i;return i},f=function(t,e,n){t.__ta&&t.__ta[e]&&delete t.__ta[e][n.__tauid];if(n.__taExtra){for(var i=0;i<n.__taExtra.length;i++){M(t,n.__taExtra[i][0],n.__taExtra[i][1])}n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()},d=function(t,e,n,i){if(t==null)return n;else{var r=t.split(","),s=function(i){s.__tauid=n.__tauid;var u=a(i),c=u;var h=l(i,u,e,t!=null);if(h.end!=-1){for(var f=0;f<h.end;f++){c=h.path[f];for(var d=0;d<r.length;d++){if(o(c,r[d],e)){n.apply(c,arguments)}}}}};p(n,i,s);return s}},p=function(t,e,n){t.__taExtra=t.__taExtra||[];t.__taExtra.push([e,n])},v=function(t,e,n,i){if(P&&C[e]){var r=d(i,t,n,C[e]);O(t,C[e],r,n)}if(e==="focus"&&t.getAttribute("tabindex")==null){t.setAttribute("tabindex","1")}O(t,e,d(i,t,n,e),n)},g=function(t,e,n,i){if(t.__taSmartClicks==null){var r=function(e){t.__tad=D(e)},o=function(e){t.__tau=D(e)},s=function(e){if(t.__tad&&t.__tau&&t.__tad[0]===t.__tau[0]&&t.__tad[1]===t.__tau[1]){for(var n=0;n<t.__taSmartClicks.length;n++)t.__taSmartClicks[n].apply(a(e),[e])}};v(t,"mousedown",r,i);v(t,"mouseup",o,i);v(t,"click",s,i);t.__taSmartClicks=[]}t.__taSmartClicks.push(n);n.__taUnstore=function(){u(t.__taSmartClicks,n)}},m={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}},y=function(t,e){return function(n,i,r,s){if(i=="contextmenu"&&_)v(n,i,r,s);else{if(n.__taTapHandler==null){var c=n.__taTapHandler={tap:[],dbltap:[],contextmenu:[],down:false,taps:0,downSelectors:[]};var h=function(i){var r=a(i),u=l(i,r,n,s!=null),h=false;for(var f=0;f<u.end;f++){if(h)return;r=u.path[f];for(var v=0;v<c.downSelectors.length;v++){if(c.downSelectors[v]==null||o(r,c.downSelectors[v],n)){c.down=true;setTimeout(d,t);setTimeout(p,e);h=true;break}}}},f=function(t){if(c.down){var e=a(t),i,r;c.taps++;var s=T(t);for(var u in m){if(m.hasOwnProperty(u)){var h=m[u];if(h.touches===s&&(h.taps===1||h.taps===c.taps)){for(var f=0;f<c[u].length;f++){r=l(t,e,n,c[u][f][1]!=null);for(var d=0;d<r.end;d++){i=r.path[d];if(c[u][f][1]==null||o(i,c[u][f][1],n)){c[u][f][0].apply(i,[t]);break}}}}}}}},d=function(){c.down=false},p=function(){c.taps=0};v(n,"mousedown",h);v(n,"mouseup",f)}n.__taTapHandler.downSelectors.push(s);n.__taTapHandler[i].push([r,s]);r.__taUnstore=function(){u(n.__taTapHandler[i],r)}}}},b=function(t,e,n,i){for(var r in n.__tamee[t]){if(n.__tamee[t].hasOwnProperty(r)){n.__tamee[t][r].apply(i,[e])}}},x=function(){var t=[];return function(e,n,i,r){if(!e.__tamee){e.__tamee={over:false,mouseenter:[],mouseexit:[]};var s=function(n){var i=a(n);if(r==null&&(i==e&&!e.__tamee.over)||o(i,r,e)&&(i.__tamee==null||!i.__tamee.over)){b("mouseenter",n,e,i);i.__tamee=i.__tamee||{};i.__tamee.over=true;t.push(i)}},l=function(n){var i=a(n);for(var r=0;r<t.length;r++){if(i==t[r]&&!o(n.relatedTarget||n.toElement,"*",i)){i.__tamee.over=false;t.splice(r,1);b("mouseexit",n,e,i)}}};O(e,"mouseover",d(r,e,s,"mouseover"),s);O(e,"mouseout",d(r,e,l,"mouseout"),l)}i.__taUnstore=function(){delete e.__tamee[n][i.__tauid]};h(e,n,i);e.__tamee[n][i.__tauid]=i}},P="ontouchstart"in document.documentElement||navigator.maxTouchPoints,_="onmousedown"in document.documentElement,C={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},w=function(){var t=-1;if(navigator.appName=="Microsoft Internet Explorer"){var e=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(n.exec(e)!=null)t=parseFloat(RegExp.$1)}return t}(),j=w>-1&&w<9,E=function(t,e){if(t==null)return[0,0];var n=I(t),i=A(n,0);return[i[e+"X"],i[e+"Y"]]},D=function(t){if(t==null)return[0,0];if(j){return[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop]}else{return E(t,"page")}},S=function(t){return E(t,"screen")},k=function(t){return E(t,"client")},A=function(t,e){return t.item?t.item(e):t[e]},I=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},T=function(t){return I(t).length},O=function(t,e,n,i){h(t,e,n);i.__tauid=n.__tauid;if(t.addEventListener)t.addEventListener(e,n,false);else if(t.attachEvent){var r=e+n.__tauid;t["e"+r]=n;t[r]=function(){t["e"+r]&&t["e"+r](window.event)};t.attachEvent("on"+e,t[r])}},M=function(t,e,n){if(n==null)return;L(t,(function(){var i=s(this);f(i,e,n);if(n.__tauid!=null){if(i.removeEventListener){i.removeEventListener(e,n,false);if(P&&C[e])i.removeEventListener(C[e],n,false)}else if(this.detachEvent){var r=e+n.__tauid;i[r]&&i.detachEvent("on"+e,i[r]);i[r]=null;i["e"+r]=null}}if(n.__taTouchProxy){M(t,n.__taTouchProxy[1],n.__taTouchProxy[0])}}))},L=function(t,e){if(t==null)return;t=typeof Window!=="undefined"&&(typeof t.top!=="unknown"&&t==t.top)?[t]:typeof t!=="string"&&(t.tagName==null&&t.length!=null)?t:typeof t==="string"?document.querySelectorAll(t):[t];for(var n=0;n<t.length;n++)e.apply(t[n])},F=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=Math.random()*16|0,n=t=="x"?e:e&3|8;return n.toString(16)}))};r.Mottle=function(t){t=t||{};var e=t.clickThreshold||250,n=t.dblClickThreshold||450,r=new x,o=new y(e,n),a=t.smartClicks,l=function(t,e,n,i){if(n==null)return;L(t,(function(){var t=s(this);if(a&&e==="click")g(t,e,n,i);else if(e==="tap"||e==="dbltap"||e==="contextmenu"){o(t,e,n,i)}else if(e==="mouseenter"||e=="mouseexit")r(t,e,n,i);else v(t,e,n,i)}))};this.remove=function(t){L(t,(function(){var t=s(this);if(t.__ta){for(var e in t.__ta){if(t.__ta.hasOwnProperty(e)){for(var n in t.__ta[e]){if(t.__ta[e].hasOwnProperty(n))M(t,e,t.__ta[e][n])}}}}t.parentNode&&t.parentNode.removeChild(t)}));return this};this.on=function(t,e,n,i){var r=arguments[0],o=arguments.length==4?arguments[2]:null,s=arguments[1],a=arguments[arguments.length-1];l(r,s,a,o);return this};this.off=function(t,e,n){M(t,e,n);return this};this.trigger=function(t,e,n,r){var o=_&&(typeof MouseEvent==="undefined"||n==null||n.constructor===MouseEvent);var a=P&&!_&&C[e]?C[e]:e,l=!(P&&!_&&C[e]);var u=D(n),c=S(n),h=k(n);L(t,(function(){var t=s(this),f;n=n||{screenX:c[0],screenY:c[1],clientX:h[0],clientY:h[1]};var d=function(t){if(r)t.payload=r};var p={TouchEvent:function(e){var n=i(window,t,0,u[0],u[1],c[0],c[1],h[0],h[1]),r=e.initTouchEvent||e.initEvent;r(a,true,true,window,null,c[0],c[1],h[0],h[1],false,false,false,false,n,n,n,1,0)},MouseEvents:function(e){e.initMouseEvent(a,true,true,window,0,c[0],c[1],h[0],h[1],false,false,false,false,1,t)}};if(document.createEvent){var v=!l&&!o&&(P&&C[e]),g=v?"TouchEvent":"MouseEvents";f=document.createEvent(g);p[g](f);d(f);t.dispatchEvent(f)}else if(document.createEventObject){f=document.createEventObject();f.eventType=f.eventName=a;f.screenX=c[0];f.screenY=c[1];f.clientX=h[0];f.clientY=h[1];d(f);t.fireEvent("on"+a,f)}}));return this}};r.Mottle.consume=function(t,e){if(t.stopPropagation)t.stopPropagation();else t.returnValue=false;if(!e&&t.preventDefault)t.preventDefault()};r.Mottle.pageLocation=D;r.Mottle.setForceTouchEvents=function(t){P=t};r.Mottle.setForceMouseEvents=function(t){_=t};r.Mottle.version="0.8.0";{e.Mottle=r.Mottle}}).call(typeof window==="undefined"?commonjsGlobal:window);(function(){var t=this;var n=function(t,e,n){if(t.indexOf(e)===-1){n?t.unshift(e):t.push(e);return true}return false};var i=function(t,e){var n=t.indexOf(e);if(n!==-1)t.splice(n,1)};var r=function(t,e){var n=[];for(var i=0;i<t.length;i++){if(e.indexOf(t[i])===-1)n.push(t[i])}return n};var o=function(t){return t==null?false:typeof t==="string"||t.constructor===String};var s=function(t){var e=t.getBoundingClientRect(),n=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||n.scrollTop,o=window.pageXOffset||i.scrollLeft||n.scrollLeft,s=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,l=e.top+r-s,u=e.left+o-a;return{top:Math.round(l),left:Math.round(u)}};var a=function(t,e,n){n=n||t.parentNode;var i=n.querySelectorAll(e);for(var r=0;r<i.length;r++){if(i[r]===t)return true}return false};var l=function(t,e,n){if(a(e,n,t)){return e}else{var i=e.parentNode;while(i!=null&&i!==t){if(a(i,n,t)){return i}else{i=i.parentNode}}}};var u=function(t,e,n){var i=null;var r=e.getAttribute("katavorio-draggable"),o=r!=null?"[katavorio-draggable='"+r+"'] ":"";for(var s=0;s<t.length;s++){i=l(e,n,o+t[s].selector);if(i!=null){if(t[s].filter){var u=a(n,t[s].filter,i),c=t[s].filterExclude===true;if(c&&!u||u){return null}}return[t[s],i]}}return null};var c=function(){var t=-1;if(navigator.appName==="Microsoft Internet Explorer"){var e=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(n.exec(e)!=null)t=parseFloat(RegExp.$1)}return t}(),h=10,f=10,d=c>-1&&c<9,p=c===9,v=function(t){if(d){return[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop]}else{var e=m(t),n=g(e,0);return p?[n.pageX||n.clientX,n.pageY||n.clientY]:[n.pageX,n.pageY]}},g=function(t,e){return t.item?t.item(e):t[e]},m=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},y={delegatedDraggable:"katavorio-delegated-draggable",draggable:"katavorio-draggable",droppable:"katavorio-droppable",drag:"katavorio-drag",selected:"katavorio-drag-selected",active:"katavorio-drag-active",hover:"katavorio-drag-hover",noSelect:"katavorio-drag-no-select",ghostProxy:"katavorio-ghost-proxy",clonedDrag:"katavorio-clone-drag"},b="katavorio-drag-scope",x=["stop","start","drag","drop","over","out","beforeStart"],P=function(){},_=function(){return true},C=function(t,e,n){for(var i=0;i<t.length;i++){if(t[i]!=n)e(t[i])}},w=function(t,e,n,i){C(t,(function(t){t.setActive(e);if(e)t.updatePosition();if(n)t.setHover(i,e)}))},j=function(t,e){if(t==null)return;t=!o(t)&&(t.tagName==null&&t.length!=null)?t:[t];for(var n=0;n<t.length;n++)e.apply(t[n],[t[n]])},E=function(t){if(t.stopPropagation){t.stopPropagation();t.preventDefault()}else{t.returnValue=false}},D="input,textarea,select,button,option",S=function(t,e,n){var i=t.srcElement||t.target;return!a(i,n.getInputFilterSelector(),e)};var k=function(t,e,n,i){this.params=e||{};this.el=t;this.params.addClass(this.el,this._class);this.uuid=M();var r=true;this.setEnabled=function(t){r=t};this.isEnabled=function(){return r};this.toggleEnabled=function(){r=!r};this.setScope=function(t){this.scopes=t?t.split(/\s+/):[i]};this.addScope=function(t){var e={};j(this.scopes,(function(t){e[t]=true}));j(t?t.split(/\s+/):[],(function(t){e[t]=true}));this.scopes=[];for(var n in e)this.scopes.push(n)};this.removeScope=function(t){var e={};j(this.scopes,(function(t){e[t]=true}));j(t?t.split(/\s+/):[],(function(t){delete e[t]}));this.scopes=[];for(var n in e)this.scopes.push(n)};this.toggleScope=function(t){var e={};j(this.scopes,(function(t){e[t]=true}));j(t?t.split(/\s+/):[],(function(t){if(e[t])delete e[t];else e[t]=true}));this.scopes=[];for(var n in e)this.scopes.push(n)};this.setScope(e.scope);this.k=e.katavorio;return e.katavorio};var A=function(){return true};var I=function(){return false};var T=function(t,e,n,i){this._class=n.draggable;var r=k.apply(this,arguments);this.rightButtonCanDrag=this.params.rightButtonCanDrag;var l=[0,0],c=null,d=null,p=[0,0],g=false,m=[0,0],b=this.params.consumeStartEvent!==false,x=this.el,P=this.params.clone,C=e.multipleDrop!==false,j=false,D,T,O=null,F=[],N=null,H=e.ghostProxyParent,R,G,U,B;if(e.ghostProxy===true){D=A}else{if(e.ghostProxy&&typeof e.ghostProxy==="function"){D=e.ghostProxy}else{D=function(t,e){if(N&&N.useGhostProxy){return N.useGhostProxy(t,e)}else{return false}}}}if(e.makeGhostProxy){T=e.makeGhostProxy}else{T=function(t){if(N&&N.makeGhostProxy){return N.makeGhostProxy(t)}else{return t.cloneNode(true)}}}if(e.selector){var W=t.getAttribute("katavorio-draggable");if(W==null){W=""+(new Date).getTime();t.setAttribute("katavorio-draggable",W)}F.push(e)}var Y=e.snapThreshold,X=function(t,e,n,i,r){var o=Math.floor(t[0]/e),s=e*o,a=s+e,l=Math.abs(t[0]-s)<=i?s:Math.abs(a-t[0])<=i?a:t[0];var u=Math.floor(t[1]/n),c=n*u,h=c+n,f=Math.abs(t[1]-c)<=r?c:Math.abs(h-t[1])<=r?h:t[1];return[l,f]};this.posses=[];this.posseRoles={};this.toGrid=function(t){if(this.params.grid==null){return t}else{var e=this.params.grid?this.params.grid[0]/2:Y?Y:h/2,n=this.params.grid?this.params.grid[1]/2:Y?Y:f/2;return X(t,this.params.grid[0],this.params.grid[1],e,n)}};this.snap=function(t,e){if(x==null)return;t=t||(this.params.grid?this.params.grid[0]:h);e=e||(this.params.grid?this.params.grid[1]:f);var n=this.params.getPosition(x),i=this.params.grid?this.params.grid[0]/2:Y,r=this.params.grid?this.params.grid[1]/2:Y,o=X(n,t,e,i,r);this.params.setPosition(x,o);return o};this.setUseGhostProxy=function(t){D=t?A:I};var z;var q=function(t){return e.allowNegative===false?[Math.max(0,t[0]),Math.max(0,t[1])]:t};var V=function(t){z=typeof t==="function"?t:t?function(t,e,n,i){return q([Math.max(0,Math.min(n.w-i[0],t[0])),Math.max(0,Math.min(n.h-i[1],t[1]))])}.bind(this):function(t){return q(t)}}.bind(this);V(typeof this.params.constrain==="function"?this.params.constrain:this.params.constrain||this.params.containment);this.setConstrain=function(t){V(t)};var J=function(t,e,n,i){if(N!=null&&N.constrain&&typeof N.constrain==="function"){return N.constrain(t,e,n,i)}else{return z(t,e,n,i)}};var $;this.setRevert=function(t){$=t};if(this.params.revert){$=this.params.revert}var Z=function(t){if(typeof t==="function"){t._katavorioId=M();return t._katavorioId}else{return t}},K={},Q=function(t){for(var e in K){var n=K[e];var i=n[0](t);if(n[1])i=!i;if(!i)return false}return true},tt=this.setFilter=function(e,n){if(e){var i=Z(e);K[i]=[function(n){var i=n.srcElement||n.target,r;if(o(e)){r=a(i,e,t)}else if(typeof e==="function"){r=e(n,t)}return r},n!==false]}},et=this.addFilter=tt,nt=this.removeFilter=function(t){var e=typeof t==="function"?t._katavorioId:t;delete K[e]};this.clearAllFilters=function(){K={}};this.canDrag=this.params.canDrag||_;var it,rt=[],ot=[];this.addSelector=function(t){if(t.selector){F.push(t)}};this.downListener=function(t){if(t.defaultPrevented){return}var e=this.rightButtonCanDrag||t.which!==3&&t.button!==2;if(e&&this.isEnabled()&&this.canDrag()){var i=Q(t)&&S(t,this.el,this.k);if(i){N=null;O=null;if(F.length>0){var o=u(F,this.el,t.target||t.srcElement);if(o!=null){N=o[0];O=o[1]}if(O==null){return}}else{O=this.el}if(P){x=O.cloneNode(true);this.params.addClass(x,y.clonedDrag);x.setAttribute("id",null);x.style.position="absolute";if(this.params.parent!=null){var a=this.params.getPosition(this.el);x.style.left=a[0]+"px";x.style.top=a[1]+"px";this.params.parent.appendChild(x)}else{var h=s(O);x.style.left=h.left+"px";x.style.top=h.top+"px";document.body.appendChild(x)}}else{x=O}b&&E(t);l=v(t);if(x&&x.parentNode){m=[x.parentNode.scrollLeft,x.parentNode.scrollTop]}this.params.bind(document,"mousemove",this.moveListener);this.params.bind(document,"mouseup",this.upListener);r.markSelection(this);r.markPosses(this);this.params.addClass(document.body,n.noSelect);at("beforeStart",{el:this.el,pos:c,e:t,drag:this})}else if(this.params.consumeFilteredEvents){E(t)}}}.bind(this);this.moveListener=function(t){if(l){if(!g){var e=at("start",{el:this.el,pos:c,e:t,drag:this});if(e!==false){if(!l){return}this.mark(true);g=true}else{this.abort()}}if(l){ot.length=0;var n=v(t),i=n[0]-l[0],o=n[1]-l[1],s=this.params.ignoreZoom?1:r.getZoom();if(x&&x.parentNode){i+=x.parentNode.scrollLeft-m[0];o+=x.parentNode.scrollTop-m[1]}i/=s;o/=s;this.moveBy(i,o,t);r.updateSelection(i,o,this);r.updatePosses(i,o,this)}}}.bind(this);this.upListener=function(t){if(l){l=null;this.params.unbind(document,"mousemove",this.moveListener);this.params.unbind(document,"mouseup",this.upListener);this.params.removeClass(document.body,n.noSelect);this.unmark(t);r.unmarkSelection(this,t);r.unmarkPosses(this,t);this.stop(t);r.notifyPosseDragStop(this,t);g=false;ot.length=0;if(P){x&&x.parentNode&&x.parentNode.removeChild(x);x=null}else{if($&&$(x,this.params.getPosition(x))===true){this.params.setPosition(x,c);at("revert",x)}}}}.bind(this);this.getFilters=function(){return K};this.abort=function(){if(l!=null){this.upListener()}};this.getDragElement=function(t){return t?O||this.el:x||this.el};var st={start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]};if(e.events.start)st.start.push(e.events.start);if(e.events.beforeStart)st.beforeStart.push(e.events.beforeStart);if(e.events.stop)st.stop.push(e.events.stop);if(e.events.drag)st.drag.push(e.events.drag);if(e.events.revert)st.revert.push(e.events.revert);this.on=function(t,e){if(st[t])st[t].push(e)};this.off=function(t,e){if(st[t]){var n=[];for(var i=0;i<st[t].length;i++){if(st[t][i]!==e)n.push(st[t][i])}st[t]=n}};var at=function(t,e){var n=null;if(N&&N[t]){n=N[t](e)}else if(st[t]){for(var i=0;i<st[t].length;i++){try{var r=st[t][i](e);if(r!=null){n=r}}catch(o){}}}return n};this.notifyStart=function(t){at("start",{el:this.el,pos:this.params.getPosition(x),e:t,drag:this})};this.stop=function(t,e){if(e||g){var n=[],i=r.getSelection(),o=this.params.getPosition(x);if(i.length>0){for(var s=0;s<i.length;s++){var a=this.params.getPosition(i[s].el);n.push([i[s].el,{left:a[0],top:a[1]},i[s]])}}else{n.push([x,{left:o[0],top:o[1]},this])}at("stop",{el:x,pos:lt||o,finalPos:o,e:t,drag:this,selection:n})}};this.mark=function(t){c=this.params.getPosition(x);d=this.params.getPosition(x,true);p=[d[0]-c[0],d[1]-c[1]];this.size=this.params.getSize(x);rt=r.getMatchingDroppables(this);w(rt,true,false,this);this.params.addClass(x,this.params.dragClass||n.drag);var e;if(this.params.getConstrainingRectangle){e=this.params.getConstrainingRectangle(x)}else{e=this.params.getSize(x.parentNode)}it={w:e[0],h:e[1]};U=0;B=0;if(t){r.notifySelectionDragStart(this)}};var lt;this.unmark=function(t,i){w(rt,false,true,this);if(j&&D(O,x)){lt=[x.offsetLeft-U,x.offsetTop-B];x.parentNode.removeChild(x);x=O}else{lt=null}this.params.removeClass(x,this.params.dragClass||n.drag);rt.length=0;j=false;if(!i){if(ot.length>0&&lt){e.setPosition(O,lt)}ot.sort(L);for(var r=0;r<ot.length;r++){var o=ot[r].drop(this,t);if(o===true)break}}};this.moveBy=function(t,n,i){ot.length=0;var r=this.toGrid([c[0]+t,c[1]+n]),o=J(r,x,it,this.size);if(D(this.el,x)){if(r[0]!==o[0]||r[1]!==o[1]){if(!j){var s=T(O);e.addClass(s,y.ghostProxy);if(H){H.appendChild(s);R=e.getPosition(O.parentNode,true);G=e.getPosition(e.ghostProxyParent,true);U=R[0]-G[0];B=R[1]-G[1]}else{O.parentNode.appendChild(s)}x=s;j=true}o=r}else{if(j){x.parentNode.removeChild(x);x=O;j=false;R=null;G=null;U=0;B=0}}}var a={x:o[0],y:o[1],w:this.size[0],h:this.size[1]},l={x:a.x+p[0],y:a.y+p[1],w:a.w,h:a.h},u=null;this.params.setPosition(x,[o[0]+U,o[1]+B]);for(var h=0;h<rt.length;h++){var f={x:rt[h].pagePosition[0],y:rt[h].pagePosition[1],w:rt[h].size[0],h:rt[h].size[1]};if(this.params.intersects(l,f)&&(C||u==null||u===rt[h].el)&&rt[h].canDrop(this)){if(!u)u=rt[h].el;ot.push(rt[h]);rt[h].setHover(this,true,i)}else if(rt[h].isHover()){rt[h].setHover(this,false,i)}}at("drag",{el:this.el,pos:o,e:i,drag:this})};this.destroy=function(){this.params.unbind(this.el,"mousedown",this.downListener);this.params.unbind(document,"mousemove",this.moveListener);this.params.unbind(document,"mouseup",this.upListener);this.downListener=null;this.upListener=null;this.moveListener=null};this.params.bind(this.el,"mousedown",this.downListener);if(this.params.handle)tt(this.params.handle,false);else tt(this.params.filter,this.params.filterExclude)};var O=function(t,e,n,i){this._class=n.droppable;this.params=e||{};this.rank=e.rank||0;this._activeClass=this.params.activeClass||n.active;this._hoverClass=this.params.hoverClass||n.hover;k.apply(this,arguments);var r=false;this.allowLoopback=this.params.allowLoopback!==false;this.setActive=function(t){this.params[t?"addClass":"removeClass"](this.el,this._activeClass)};this.updatePosition=function(){this.position=this.params.getPosition(this.el);this.pagePosition=this.params.getPosition(this.el,true);this.size=this.params.getSize(this.el)};this.canDrop=this.params.canDrop||function(t){return true};this.isHover=function(){return r};this.setHover=function(t,e,n){if(e||this.el._katavorioDragHover==null||this.el._katavorioDragHover===t.el._katavorio){this.params[e?"addClass":"removeClass"](this.el,this._hoverClass);this.el._katavorioDragHover=e?t.el._katavorio:null;if(r!==e){this.params.events[e?"over":"out"]({el:this.el,e:n,drag:t,drop:this})}r=e}};this.drop=function(t,e){return this.params.events["drop"]({drag:t,e:e,drop:this})};this.destroy=function(){this._class=null;this._activeClass=null;this._hoverClass=null;r=null}};var M=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=Math.random()*16|0,n=t==="x"?e:e&3|8;return n.toString(16)}))};var L=function(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:0};var F=function(t){if(t==null)return null;t=typeof t==="string"||t.constructor===String?document.getElementById(t):t;if(t==null)return null;t._katavorio=t._katavorio||M();return t};t.Katavorio=function(t){var e=[],s={};this._dragsByScope={};this._dropsByScope={};var a=1,l=function(t,e){j(t,(function(t){for(var n=0;n<t.scopes.length;n++){e[t.scopes[n]]=e[t.scopes[n]]||[];e[t.scopes[n]].push(t)}}))},u=function(e,n){var i=0;j(e,(function(e){for(var r=0;r<e.scopes.length;r++){if(n[e.scopes[r]]){var o=t.indexOf(n[e.scopes[r]],e);if(o!==-1){n[e.scopes[r]].splice(o,1);i++}}}}));return i>0},c=this.getMatchingDroppables=function(t){var e=[],n={};for(var i=0;i<t.scopes.length;i++){var r=this._dropsByScope[t.scopes[i]];if(r){for(var o=0;o<r.length;o++){if(r[o].canDrop(t)&&!n[r[o].uuid]&&(r[o].allowLoopback||r[o].el!==t.el)){n[r[o].uuid]=true;e.push(r[o])}}}}e.sort(L);return e},h=function(e){e=e||{};var n={events:{}},i;for(i in t)n[i]=t[i];for(i in e)n[i]=e[i];for(i=0;i<x.length;i++){n.events[x[i]]=e[x[i]]||P}n.katavorio=this;return n}.bind(this),f=function(t,e){for(var n=0;n<x.length;n++){if(e[x[n]]){t.on(x[n],e[x[n]])}}}.bind(this),d={},p=t.css||{},v=t.scope||b;for(var g in y)d[g]=y[g];for(var g in p)d[g]=p[g];var m=t.inputFilterSelector||D;this.getInputFilterSelector=function(){return m};this.setInputFilterSelector=function(t){m=t;return this};this.draggable=function(e,n){var i=[];j(e,function(e){e=F(e);if(e!=null){if(e._katavorioDrag==null){var r=h(n);e._katavorioDrag=new T(e,r,d,v);l(e._katavorioDrag,this._dragsByScope);i.push(e._katavorioDrag);t.addClass(e,r.selector?d.delegatedDraggable:d.draggable)}else{f(e._katavorioDrag,n)}}}.bind(this));return i};this.droppable=function(e,n){var i=[];j(e,function(e){e=F(e);if(e!=null){var r=new O(e,h(n),d,v);e._katavorioDrop=e._katavorioDrop||[];e._katavorioDrop.push(r);l(r,this._dropsByScope);i.push(r);t.addClass(e,d.droppable)}}.bind(this));return i};this.select=function(n){j(n,(function(){var n=F(this);if(n&&n._katavorioDrag){if(!s[n._katavorio]){e.push(n._katavorioDrag);s[n._katavorio]=[n,e.length-1];t.addClass(n,d.selected)}}}));return this};this.deselect=function(n){j(n,(function(){var n=F(this);if(n&&n._katavorio){var i=s[n._katavorio];if(i){var r=[];for(var o=0;o<e.length;o++)if(e[o].el!==n)r.push(e[o]);e=r;delete s[n._katavorio];t.removeClass(n,d.selected)}}}));return this};this.deselectAll=function(){for(var n in s){var i=s[n];t.removeClass(i[0],d.selected)}e.length=0;s={}};this.markSelection=function(t){C(e,(function(t){t.mark()}),t)};this.markPosses=function(t){if(t.posses){j(t.posses,(function(e){if(t.posseRoles[e]&&k[e]){C(k[e].members,(function(t){t.mark()}),t)}}))}};this.unmarkSelection=function(t,n){C(e,(function(t){t.unmark(n)}),t)};this.unmarkPosses=function(t,e){if(t.posses){j(t.posses,(function(n){if(t.posseRoles[n]&&k[n]){C(k[n].members,(function(t){t.unmark(e,true)}),t)}}))}};this.getSelection=function(){return e.slice(0)};this.updateSelection=function(t,n,i){C(e,(function(e){e.moveBy(t,n)}),i)};var _=function(t,e){if(e.posses){j(e.posses,(function(n){if(e.posseRoles[n]&&k[n]){C(k[n].members,(function(e){t(e)}),e)}}))}};this.updatePosses=function(t,e,n){_((function(n){n.moveBy(t,e)}),n)};this.notifyPosseDragStop=function(t,e){_((function(t){t.stop(e,true)}),t)};this.notifySelectionDragStop=function(t,n){C(e,(function(t){t.stop(n,true)}),t)};this.notifySelectionDragStart=function(t,n){C(e,(function(t){t.notifyStart(n)}),t)};this.setZoom=function(t){a=t};this.getZoom=function(){return a};var w=function(t,e,n,i){j(t,(function(t){u(t,n);t[i](e);l(t,n)}))};j(["set","add","remove","toggle"],function(t){this[t+"Scope"]=function(e,n){w(e._katavorioDrag,n,this._dragsByScope,t+"Scope");w(e._katavorioDrop,n,this._dropsByScope,t+"Scope")}.bind(this);this[t+"DragScope"]=function(e,n){w(e.constructor===T?e:e._katavorioDrag,n,this._dragsByScope,t+"Scope")}.bind(this);this[t+"DropScope"]=function(e,n){w(e.constructor===O?e:e._katavorioDrop,n,this._dropsByScope,t+"Scope")}.bind(this)}.bind(this));this.snapToGrid=function(t,e){for(var n in this._dragsByScope){C(this._dragsByScope[n],(function(n){n.snap(t,e)}))}};this.getDragsForScope=function(t){return this._dragsByScope[t]};this.getDropsForScope=function(t){return this._dropsByScope[t]};var E=function(t,n,i){t=F(t);if(t[n]){var r=e.indexOf(t[n]);if(r>=0){e.splice(r,1)}if(u(t[n],i)){j(t[n],(function(t){t.destroy()}))}delete t[n]}};var S=function(t,e,n,i){t=F(t);if(t[e]){t[e].off(n,i)}};this.elementRemoved=function(t){if(t["_katavorioDrag"]){this.destroyDraggable(t)}if(t["_katavorioDrop"]){this.destroyDroppable(t)}};this.destroyDraggable=function(t,e,n){if(arguments.length===1){E(t,"_katavorioDrag",this._dragsByScope)}else{S(t,"_katavorioDrag",e,n)}};this.destroyDroppable=function(t,e,n){if(arguments.length===1){E(t,"_katavorioDrop",this._dropsByScope)}else{S(t,"_katavorioDrop",e,n)}};this.reset=function(){this._dragsByScope={};this._dropsByScope={};e=[];s={};k={}};var k={};var A=function(t,e,i){var r=o(e)?e:e.id;var s=o(e)?true:e.active!==false;var a=k[r]||function(){var t={name:r,members:[]};k[r]=t;return t}();j(t,(function(t){if(t._katavorioDrag){if(i&&t._katavorioDrag.posseRoles[a.name]!=null)return;n(a.members,t._katavorioDrag);n(t._katavorioDrag.posses,a.name);t._katavorioDrag.posseRoles[a.name]=s}}));return a};this.addToPosse=function(t,e){var n=[];for(var i=1;i<arguments.length;i++){n.push(A(t,arguments[i]))}return n.length===1?n[0]:n};this.setPosse=function(t,e){var n=[];for(var i=1;i<arguments.length;i++){n.push(A(t,arguments[i],true).name)}j(t,function(t){if(t._katavorioDrag){var e=r(t._katavorioDrag.posses,n);var i=[];Array.prototype.push.apply(i,t._katavorioDrag.posses);for(var o=0;o<e.length;o++){this.removeFromPosse(t,e[o])}}}.bind(this));return n.length===1?n[0]:n};this.removeFromPosse=function(t,e){if(arguments.length<2)throw new TypeError("No posse id provided for remove operation");for(var n=1;n<arguments.length;n++){e=arguments[n];j(t,(function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var n=t._katavorioDrag;j(e,(function(t){i(k[t].members,n);i(n.posses,t);delete n.posseRoles[t]}))}}))}};this.removeFromAllPosses=function(t){j(t,(function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var e=t._katavorioDrag;j(e.posses,(function(t){i(k[t].members,e)}));e.posses.length=0;e.posseRoles={}}}))};this.setPosseState=function(t,e,n){var i=k[e];if(i){j(t,(function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){t._katavorioDrag.posseRoles[i.name]=n}}))}}};t.Katavorio.version="1.0.0";{e.Katavorio=t.Katavorio}}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this;t.jsPlumbUtil=t.jsPlumbUtil||{};var n=t.jsPlumbUtil;{e.jsPlumbUtil=n}function i(t){return Object.prototype.toString.call(t)==="[object Array]"}n.isArray=i;function r(t){return Object.prototype.toString.call(t)==="[object Number]"}n.isNumber=r;function o(t){return typeof t==="string"}n.isString=o;function s(t){return typeof t==="boolean"}n.isBoolean=s;function a(t){return t==null}n.isNull=a;function l(t){return t==null?false:Object.prototype.toString.call(t)==="[object Object]"}n.isObject=l;function u(t){return Object.prototype.toString.call(t)==="[object Date]"}n.isDate=u;function c(t){return Object.prototype.toString.call(t)==="[object Function]"}n.isFunction=c;function h(t){return c(t)&&t.name!=null&&t.name.length>0}n.isNamedFunction=h;function f(t){for(var e in t){if(t.hasOwnProperty(e)){return false}}return true}n.isEmpty=f;function d(t){if(o(t)){return""+t}else if(s(t)){return!!t}else if(u(t)){return new Date(t.getTime())}else if(c(t)){return t}else if(i(t)){var e=[];for(var n=0;n<t.length;n++){e.push(d(t[n]))}return e}else if(l(t)){var r={};for(var a in t){r[a]=d(t[a])}return r}else{return t}}n.clone=d;function p(t,e,n,r){var a={},u,c,h={};n=n||[];r=r||[];for(c=0;c<n.length;c++){a[n[c]]=true}for(c=0;c<r.length;c++){h[r[c]]=true}var f=d(t);for(c in e){if(f[c]==null||h[c]){f[c]=e[c]}else if(o(e[c])||s(e[c])){if(!a[c]){f[c]=e[c]}else{u=[];u.push.apply(u,i(f[c])?f[c]:[f[c]]);u.push.apply(u,s(e[c])?e[c]:[e[c]]);f[c]=u}}else{if(i(e[c])){u=[];if(i(f[c])){u.push.apply(u,f[c])}u.push.apply(u,e[c]);f[c]=u}else if(l(e[c])){if(!l(f[c])){f[c]={}}for(var p in e[c]){f[c][p]=e[c][p]}}}}return f}n.merge=p;function v(t,e,n){if(t==null){return}var i=t,r=i;e.replace(/([^\.])+/g,(function(t,e,i,o){var s=t.match(/([^\[0-9]+){1}(\[)([0-9+])/),a=i+t.length>=o.length,l=function(){return r[s[1]]||function(){r[s[1]]=[];return r[s[1]]}()};if(a){if(s){l()[s[3]]=n}else{r[t]=n}}else{if(s){var u=l();r=u[s[3]]||function(){u[s[3]]={};return u[s[3]]}()}else{r=r[t]||function(){r[t]={};return r[t]}()}}return""}));return t}n.replace=v;function g(t,e,n){for(var i=0;i<n.length;i++){var r=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(r===e){return r}}return t}n.functionChain=g;function m(t,e,n,r){var s=function(t){var n=t.match(/(\${.*?})/g);if(n!=null){for(var i=0;i<n.length;i++){var r=e[n[i].substring(2,n[i].length-1)]||"";if(r!=null){t=t.replace(n[i],r)}}}return t};var a=function(t){if(t!=null){if(o(t)){return s(t)}else if(c(t)&&!r&&(n==null||(t.name||"").indexOf(n)===0)){return t(e)}else if(i(t)){var u=[];for(var h=0;h<t.length;h++){u.push(a(t[h]))}return u}else if(l(t)){var f={};for(var d in t){f[d]=a(t[d])}return f}else{return t}}};return a(t)}n.populate=m;function y(t,e){if(t){for(var n=0;n<t.length;n++){if(e(t[n])){return n}}}return-1}n.findWithFunction=y;function b(t,e){var n=y(t,e);if(n>-1){t.splice(n,1)}return n!==-1}n.removeWithFunction=b;function x(t,e){var n=t.indexOf(e);if(n>-1){t.splice(n,1)}return n!==-1}n.remove=x;function P(t,e,n){if(y(t,n)===-1){t.push(e)}}n.addWithFunction=P;function _(t,e,n,i){var r=t[e];if(r==null){r=[];t[e]=r}r[i?"unshift":"push"](n);return r}n.addToList=_;function C(t,e,n){if(t.indexOf(e)===-1){if(n){t.unshift(e)}else{t.push(e)}return true}return false}n.suggest=C;function w(t,e,n){var r;e=i(e)?e:[e];var o=function(e){var n=e.__proto__;while(n!=null){if(n.prototype!=null){for(var i in n.prototype){if(n.prototype.hasOwnProperty(i)&&!t.prototype.hasOwnProperty(i)){t.prototype[i]=n.prototype[i]}}n=n.prototype.__proto__}else{n=null}}};for(r=0;r<e.length;r++){for(var s in e[r].prototype){if(e[r].prototype.hasOwnProperty(s)&&!t.prototype.hasOwnProperty(s)){t.prototype[s]=e[r].prototype[s]}}o(e[r])}var a=function(t,n){return function(){for(r=0;r<e.length;r++){if(e[r].prototype[t]){e[r].prototype[t].apply(this,arguments)}}return n.apply(this,arguments)}};var l=function(e){for(var n in e){t.prototype[n]=a(n,e[n])}};if(arguments.length>2){for(r=2;r<arguments.length;r++){l(arguments[r])}}return t}n.extend=w;var j=[];for(var E=0;E<256;E++){j[E]=(E<16?"0":"")+E.toString(16)}function D(){var t=Math.random()*4294967295|0;var e=Math.random()*4294967295|0;var n=Math.random()*4294967295|0;var i=Math.random()*4294967295|0;return j[t&255]+j[t>>8&255]+j[t>>16&255]+j[t>>24&255]+"-"+j[e&255]+j[e>>8&255]+"-"+j[e>>16&15|64]+j[e>>24&255]+"-"+j[n&63|128]+j[n>>8&255]+"-"+j[n>>16&255]+j[n>>24&255]+j[i&255]+j[i>>8&255]+j[i>>16&255]+j[i>>24&255]}n.uuid=D;function S(t){if(t==null){return null}var e=t.replace(/^\s\s*/,""),n=/\s/,i=e.length;while(n.test(e.charAt(--i))){}return e.slice(0,i+1)}n.fastTrim=S;function k(t,e){t=t.length==null||typeof t==="string"?[t]:t;for(var n=0;n<t.length;n++){e(t[n])}}n.each=k;function A(t,e){var n=[];for(var i=0;i<t.length;i++){n.push(e(t[i]))}return n}n.map=A;function I(t,e,n){n=n||"parent";var i=function(t){return t?e[t]:null};var r=function(t){return t?i(t[n]):null};var o=function(t,e){if(t==null){return e}else{var n=["anchor","anchors","cssClass","connector","paintStyle","hoverPaintStyle","endpoint","endpoints"];if(e.mergeStrategy==="override"){Array.prototype.push.apply(n,["events","overlays"])}var i=p(t,e,[],n);return o(r(t),i)}};var s=function(t){if(t==null){return{}}if(typeof t==="string"){return i(t)}else if(t.length){var e=false,n=0,r=void 0;while(!e&&n<t.length){r=s(t[n]);if(r){e=true}else{n++}}return r}};var a=s(t);if(a){return o(r(a),a)}else{return{}}}n.mergeWithParents=I;n.logEnabled=true;function T(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}if(n.logEnabled&&typeof console!=="undefined"){try{var i=arguments[arguments.length-1];console.log(i)}catch(r){}}}n.log=T;function O(t,e,n){return function(){var i=null;try{if(e!=null){i=e.apply(this,arguments)}}catch(r){T("jsPlumb function failed : "+r)}if(t!=null&&(n==null||i!==n)){try{i=t.apply(this,arguments)}catch(r){T("wrapped function failed : "+r)}}return i}}n.wrap=O;var M=function(){function t(){var t=this;this._listeners={};this.eventsSuspended=false;this.tick=false;this.eventsToDieOn={ready:true};this.queue=[];this.bind=function(e,n,i){var r=function(e){_(t._listeners,e,n,i);n.__jsPlumb=n.__jsPlumb||{};n.__jsPlumb[D()]=e};if(typeof e==="string"){r(e)}else if(e.length!=null){for(var o=0;o<e.length;o++){r(e[o])}}return t};this.fire=function(t,e,n){if(!this.tick){this.tick=true;if(!this.eventsSuspended&&this._listeners[t]){var i=this._listeners[t].length,r=0,o=false,s=null;if(!this.shouldFireEvent||this.shouldFireEvent(t,e,n)){while(!o&&r<i&&s!==false){if(this.eventsToDieOn[t]){this._listeners[t][r].apply(this,[e,n])}else{try{s=this._listeners[t][r].apply(this,[e,n])}catch(a){T("jsPlumb: fire failed for event "+t+" : "+a)}}r++;if(this._listeners==null||this._listeners[t]==null){o=true}}}}this.tick=false;this._drain()}else{this.queue.unshift(arguments)}return this};this._drain=function(){var e=t.queue.pop();if(e){t.fire.apply(t,e)}};this.unbind=function(t,e){if(arguments.length===0){this._listeners={}}else if(arguments.length===1){if(typeof t==="string"){delete this._listeners[t]}else if(t.__jsPlumb){var n=void 0;for(var i in t.__jsPlumb){n=t.__jsPlumb[i];x(this._listeners[n]||[],t)}}}else if(arguments.length===2){x(this._listeners[t]||[],e)}return this};this.getListener=function(e){return t._listeners[e]};this.setSuspendEvents=function(e){t.eventsSuspended=e};this.isSuspendEvents=function(){return t.eventsSuspended};this.silently=function(e){t.setSuspendEvents(true);try{e()}catch(n){T("Cannot execute silent function "+n)}t.setSuspendEvents(false)};this.cleanupListeners=function(){for(var e in t._listeners){t._listeners[e]=null}}}return t}();n.EventGenerator=M;function L(t,e,n){var i=[t[0]-e[0],t[1]-e[1]],r=Math.cos(n/360*Math.PI*2),o=Math.sin(n/360*Math.PI*2);return[i[0]*r-i[1]*o+e[0],i[1]*r+i[0]*o+e[1],r,o]}n.rotatePoint=L;function F(t,e){var n=L(t,[0,0],e);return[Math.round(n[0]),Math.round(n[1])]}n.rotateAnchorOrientation=F}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this;t.jsPlumbUtil.matchesSelector=function(t,e,n){n=n||t.parentNode;var i=n.querySelectorAll(e);for(var r=0;r<i.length;r++){if(i[r]===t){return true}}return false};t.jsPlumbUtil.consume=function(t,e){if(t.stopPropagation){t.stopPropagation()}else{t.returnValue=false}if(!e&&t.preventDefault){t.preventDefault()}};t.jsPlumbUtil.sizeElement=function(t,e,n,i,r){if(t){t.style.height=r+"px";t.height=r;t.style.width=i+"px";t.width=i;t.style.left=e+"px";t.style.top=n+"px"}}}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t={deriveAnchor:function(t,e,n,i){return{top:["TopRight","TopLeft"],bottom:["BottomRight","BottomLeft"]}[t][e]}};var e=this;var n=function(t,e){this.count=0;this.instance=t;this.lists={};this.options=e||{};this.instance.addList=function(t,e){return this.listManager.addList(t,e)};this.instance.removeList=function(t){this.listManager.removeList(t)};this.instance.bind("manageElement",function(t){var e=this.instance.getSelector(t.el,"[jtk-scrollable-list]");for(var n=0;n<e.length;n++){this.addList(e[n])}}.bind(this));this.instance.bind("unmanageElement",(function(t){this.removeList(t.el)}));this.instance.bind("connection",function(t,e){if(e==null){this._maybeUpdateParentList(t.source);this._maybeUpdateParentList(t.target)}}.bind(this))};e.jsPlumbListManager=n;n.prototype={addList:function(e,n){var r=this.instance.extend({},t);this.instance.extend(r,this.options);n=this.instance.extend(r,n||{});var o=[this.instance.getInstanceIndex(),this.count++].join("_");this.lists[o]=new i(this.instance,e,n,o)},removeList:function(t){var e=this.lists[t._jsPlumbList];if(e){e.destroy();delete this.lists[t._jsPlumbList]}},_maybeUpdateParentList:function(t){var e=t.parentNode,n=this.instance.getContainer();while(e!=null&&e!==n){if(e._jsPlumbList!=null&&this.lists[e._jsPlumbList]!=null){e._jsPlumbScrollHandler();return}e=e.parentNode}}};var i=function(t,e,n,i){e["_jsPlumbList"]=i;function r(t,e,i,r){return n.anchor?n.anchor:n.deriveAnchor(t,e,i,r)}function o(t,e,i,r){return n.deriveEndpoint?n.deriveEndpoint(t,e,i,r):n.endpoint?n.endpoint:i.type}function s(e){var n=e.parentNode,i=t.getContainer();while(n!=null&&n!==i){if(t.hasClass(n,"jtk-managed")){t.recalculateOffsets(n);return}n=n.parentNode}}var a=function(n){var i=t.getSelector(e,".jtk-managed");var a=t.getId(e);for(var l=0;l<i.length;l++){if(i[l].offsetTop<e.scrollTop){if(!i[l]._jsPlumbProxies){i[l]._jsPlumbProxies=i[l]._jsPlumbProxies||[];t.select({source:i[l]}).each((function(n){t.proxyConnection(n,0,e,a,(function(){return o("top",0,n.endpoints[0],n)}),(function(){return r("top",0,n.endpoints[0],n)}));i[l]._jsPlumbProxies.push([n,0])}));t.select({target:i[l]}).each((function(n){t.proxyConnection(n,1,e,a,(function(){return o("top",1,n.endpoints[1],n)}),(function(){return r("top",1,n.endpoints[1],n)}));i[l]._jsPlumbProxies.push([n,1])}))}}else if(i[l].offsetTop+i[l].offsetHeight>e.scrollTop+e.offsetHeight){if(!i[l]._jsPlumbProxies){i[l]._jsPlumbProxies=i[l]._jsPlumbProxies||[];t.select({source:i[l]}).each((function(n){t.proxyConnection(n,0,e,a,(function(){return o("bottom",0,n.endpoints[0],n)}),(function(){return r("bottom",0,n.endpoints[0],n)}));i[l]._jsPlumbProxies.push([n,0])}));t.select({target:i[l]}).each((function(n){t.proxyConnection(n,1,e,a,(function(){return o("bottom",1,n.endpoints[1],n)}),(function(){return r("bottom",1,n.endpoints[1],n)}));i[l]._jsPlumbProxies.push([n,1])}))}}else if(i[l]._jsPlumbProxies){for(var u=0;u<i[l]._jsPlumbProxies.length;u++){t.unproxyConnection(i[l]._jsPlumbProxies[u][0],i[l]._jsPlumbProxies[u][1],a)}delete i[l]._jsPlumbProxies}t.revalidate(i[l])}s(e)};t.setAttribute(e,"jtk-scrollable-list","true");e._jsPlumbScrollHandler=a;t.on(e,"scroll",a);a();this.destroy=function(){t.off(e,"scroll",a);delete e._jsPlumbScrollHandler;var n=t.getSelector(e,".jtk-managed");var i=t.getId(e);for(var r=0;r<n.length;r++){if(n[r]._jsPlumbProxies){for(var o=0;o<n[r]._jsPlumbProxies.length;o++){t.unproxyConnection(n[r]._jsPlumbProxies[o][0],n[r]._jsPlumbProxies[o][1],i)}delete n[r]._jsPlumbProxies}}}}}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this;var n=t.jsPlumbUtil,i=function(t){if(t._jsPlumb.paintStyle&&t._jsPlumb.hoverPaintStyle){var e={};p.extend(e,t._jsPlumb.paintStyle);p.extend(e,t._jsPlumb.hoverPaintStyle);delete t._jsPlumb.hoverPaintStyle;if(e.gradient&&t._jsPlumb.paintStyle.fill){delete e.gradient}t._jsPlumb.hoverPaintStyle=e}},r=["tap","dbltap","click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu"],o=function(t,e,n,i){var r=t.getAttachedElements();if(r){for(var o=0,s=r.length;o<s;o++){if(!i||i!==r[o]){r[o].setHover(e,true,n)}}}},s=function(t){return t==null?null:t.split(" ")},a=function(t,e,n){for(var i in e){t[i]=n}},l=function(t,e,i){if(t.getDefaultType){var r=t.getTypeDescriptor(),o={};var s=t.getDefaultType();var l=n.merge({},s);a(o,s,"__default");for(var u=0,c=t._jsPlumb.types.length;u<c;u++){var h=t._jsPlumb.types[u];if(h!=="__default"){var f=t._jsPlumb.instance.getType(h,r);if(f!=null){var d=["anchor","anchors","connector","paintStyle","hoverPaintStyle","endpoint","endpoints","connectorOverlays","connectorStyle","connectorHoverStyle","endpointStyle","endpointHoverStyle"];var p=[];if(f.mergeStrategy==="override"){Array.prototype.push.apply(d,["events","overlays","cssClass"])}else{p.push("cssClass")}l=n.merge(l,f,p,d);a(o,f,h)}}}if(e){l=n.populate(l,e,"_")}t.applyType(l,i,o);if(!i){t.repaint()}}},u=t.jsPlumbUIComponent=function(t){n.EventGenerator.apply(this,arguments);var e=this,i=arguments,r=e.idPrefix,o=r+(new Date).getTime();this._jsPlumb={instance:t._jsPlumb,parameters:t.parameters||{},paintStyle:null,hoverPaintStyle:null,paintStyleInUse:null,hover:false,beforeDetach:t.beforeDetach,beforeDrop:t.beforeDrop,overlayPlacements:[],hoverClass:t.hoverClass||t._jsPlumb.Defaults.HoverClass,types:[],typeCache:{}};this.cacheTypeItem=function(t,e,n){this._jsPlumb.typeCache[n]=this._jsPlumb.typeCache[n]||{};this._jsPlumb.typeCache[n][t]=e};this.getCachedTypeItem=function(t,e){return this._jsPlumb.typeCache[e]?this._jsPlumb.typeCache[e][t]:null};this.getId=function(){return o};var s=t.overlays||[],a={};if(this.defaultOverlayKeys){for(var l=0;l<this.defaultOverlayKeys.length;l++){Array.prototype.push.apply(s,this._jsPlumb.instance.Defaults[this.defaultOverlayKeys[l]]||[])}for(l=0;l<s.length;l++){var u=p.convertToFullOverlaySpec(s[l]);a[u[1].id]=u}}var c={overlays:a,parameters:t.parameters||{},scope:t.scope||this._jsPlumb.instance.getDefaultScope()};this.getDefaultType=function(){return c};this.appendToDefaultType=function(t){for(var e in t){c[e]=t[e]}};if(t.events){for(var h in t.events){e.bind(h,t.events[h])}}this.clone=function(){var t=Object.create(this.constructor.prototype);this.constructor.apply(t,i);return t}.bind(this);this.isDetachAllowed=function(t){var e=true;if(this._jsPlumb.beforeDetach){try{e=this._jsPlumb.beforeDetach(t)}catch(i){n.log("jsPlumb: beforeDetach callback failed",i)}}return e};this.isDropAllowed=function(t,e,i,r,o,s,a){var l=this._jsPlumb.instance.checkCondition("beforeDrop",{sourceId:t,targetId:e,scope:i,connection:r,dropEndpoint:o,source:s,target:a});if(this._jsPlumb.beforeDrop){try{l=this._jsPlumb.beforeDrop({sourceId:t,targetId:e,scope:i,connection:r,dropEndpoint:o,source:s,target:a})}catch(u){n.log("jsPlumb: beforeDrop callback failed",u)}}return l};var f=[];this.setListenerComponent=function(t){for(var e=0;e<f.length;e++){f[e][3]=t}}};var c=function(t,e){var n=t._jsPlumb.types[e],i=t._jsPlumb.instance.getType(n,t.getTypeDescriptor());if(i!=null&&i.cssClass&&t.canvas){t._jsPlumb.instance.removeClass(t.canvas,i.cssClass)}};n.extend(t.jsPlumbUIComponent,n.EventGenerator,{getParameter:function(t){return this._jsPlumb.parameters[t]},setParameter:function(t,e){this._jsPlumb.parameters[t]=e},getParameters:function(){return this._jsPlumb.parameters},setParameters:function(t){this._jsPlumb.parameters=t},getClass:function(){return p.getClass(this.canvas)},hasClass:function(t){return p.hasClass(this.canvas,t)},addClass:function(t){p.addClass(this.canvas,t)},removeClass:function(t){p.removeClass(this.canvas,t)},updateClasses:function(t,e){p.updateClasses(this.canvas,t,e)},setType:function(t,e,n){this.clearTypes();this._jsPlumb.types=s(t)||[];l(this,e,n)},getType:function(){return this._jsPlumb.types},reapplyTypes:function(t,e){l(this,t,e)},hasType:function(t){return this._jsPlumb.types.indexOf(t)!==-1},addType:function(t,e,n){var i=s(t),r=false;if(i!=null){for(var o=0,a=i.length;o<a;o++){if(!this.hasType(i[o])){this._jsPlumb.types.push(i[o]);r=true}}if(r){l(this,e,n)}}},removeType:function(t,e,n){var i=s(t),r=false,o=function(t){var e=this._jsPlumb.types.indexOf(t);if(e!==-1){c(this,e);this._jsPlumb.types.splice(e,1);return true}return false}.bind(this);if(i!=null){for(var a=0,u=i.length;a<u;a++){r=o(i[a])||r}if(r){l(this,e,n)}}},clearTypes:function(t,e){var n=this._jsPlumb.types.length;for(var i=0;i<n;i++){c(this,0);this._jsPlumb.types.splice(0,1)}l(this,t,e)},toggleType:function(t,e,n){var i=s(t);if(i!=null){for(var r=0,o=i.length;r<o;r++){var a=this._jsPlumb.types.indexOf(i[r]);if(a!==-1){c(this,a);this._jsPlumb.types.splice(a,1)}else{this._jsPlumb.types.push(i[r])}}l(this,e,n)}},applyType:function(t,e){this.setPaintStyle(t.paintStyle,e);this.setHoverPaintStyle(t.hoverPaintStyle,e);if(t.parameters){for(var n in t.parameters){this.setParameter(n,t.parameters[n])}}this._jsPlumb.paintStyleInUse=this.getPaintStyle()},setPaintStyle:function(t,e){this._jsPlumb.paintStyle=t;this._jsPlumb.paintStyleInUse=this._jsPlumb.paintStyle;i(this);if(!e){this.repaint()}},getPaintStyle:function(){return this._jsPlumb.paintStyle},setHoverPaintStyle:function(t,e){this._jsPlumb.hoverPaintStyle=t;i(this);if(!e){this.repaint()}},getHoverPaintStyle:function(){return this._jsPlumb.hoverPaintStyle},destroy:function(t){if(t||this.typeId==null){this.cleanupListeners();this.clone=null;this._jsPlumb=null}},isHover:function(){return this._jsPlumb.hover},setHover:function(t,e,n){if(this._jsPlumb&&!this._jsPlumb.instance.currentlyDragging&&!this._jsPlumb.instance.isHoverSuspended()){this._jsPlumb.hover=t;var i=t?"addClass":"removeClass";if(this.canvas!=null){if(this._jsPlumb.instance.hoverClass!=null){this._jsPlumb.instance[i](this.canvas,this._jsPlumb.instance.hoverClass)}if(this._jsPlumb.hoverClass!=null){this._jsPlumb.instance[i](this.canvas,this._jsPlumb.hoverClass)}}if(this._jsPlumb.hoverPaintStyle!=null){this._jsPlumb.paintStyleInUse=t?this._jsPlumb.hoverPaintStyle:this._jsPlumb.paintStyle;if(!this._jsPlumb.instance.isSuspendDrawing()){n=n||jsPlumbUtil.uuid();this.repaint({timestamp:n,recalc:false})}}if(this.getAttachedElements&&!e){o(this,t,jsPlumbUtil.uuid(),this)}}}});var h=0,f=function(){var t=h+1;h++;return t};var d=t.jsPlumbInstance=function(e){this.version="2.15.5";this.Defaults={Anchor:"Bottom",Anchors:[null,null],ConnectionsDetachable:true,ConnectionOverlays:[],Connector:"Bezier",Container:null,DoNotThrowErrors:false,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fill:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},ListStyle:{},LogEnabled:false,Overlays:[],MaxConnections:1,PaintStyle:{"stroke-width":4,stroke:"#456"},ReattachConnections:false,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"};if(e){p.extend(this.Defaults,e)}this.logEnabled=this.Defaults.LogEnabled;this._connectionTypes={};this._endpointTypes={};n.EventGenerator.apply(this);var i=this,o=f(),s=i.bind,a={},l=1,c=function(t){if(t==null){return null}else if(t.nodeType===3||t.nodeType===8){return{el:t,text:true}}else{var e=i.getElement(t);return{el:e,id:n.isString(t)&&e==null?t:Y(e)}}};this.getInstanceIndex=function(){return o};this.setZoom=function(t,e){l=t;i.fire("zoom",l);if(e){i.repaintEverything()}return true};this.getZoom=function(){return l};for(var h in this.Defaults){a[h]=this.Defaults[h]}var d,v=[];this.unbindContainer=function(){if(d!=null&&v.length>0){for(var t=0;t<v.length;t++){i.off(d,v[t][0],v[t][1])}}};this.setContainer=function(t){this.unbindContainer();t=this.getElement(t);this.select().each((function(e){e.moveParent(t)}));this.selectEndpoints().each((function(e){e.moveParent(t)}));var e=d;d=t;v.length=0;var n={endpointclick:"endpointClick",endpointdblclick:"endpointDblClick"};var o=function(t,e,r){var o=e.srcElement||e.target,s=(o&&o.parentNode?o.parentNode._jsPlumb:null)||(o?o._jsPlumb:null)||(o&&o.parentNode&&o.parentNode.parentNode?o.parentNode.parentNode._jsPlumb:null);if(s){s.fire(t,s,e);var a=r?n[r+t]||t:t;i.fire(a,s.component||s,e)}};var s=function(t,e,n){v.push([t,n]);i.on(d,t,e,n)};var a=function(t){s(t,".jtk-connector",(function(e){o(t,e)}));s(t,".jtk-endpoint",(function(e){o(t,e,"endpoint")}));s(t,".jtk-overlay",(function(e){o(t,e)}))};for(var l=0;l<r.length;l++){a(r[l])}for(var u in P){var c=P[u].el;if(c.parentNode===e){e.removeChild(c);d.appendChild(c)}}};this.getContainer=function(){return d};this.bind=function(t,e){if("ready"===t&&m){e()}else{s.apply(i,[t,e])}};i.importDefaults=function(t){for(var e in t){i.Defaults[e]=t[e]}if(t.Container){i.setContainer(t.Container)}return i};i.restoreDefaults=function(){i.Defaults=p.extend({},a);return i};var g=null,m=false,y=[],b={},x={},P={},_={},C={},w=false,j=[],E=false,D=null,S=this.Defaults.Scope,k=1,A=function(){return""+k++},I=function(t,e){if(d){d.appendChild(t)}else if(!e){this.appendToRoot(t)}else{this.getElement(e).appendChild(t)}}.bind(this),T=function(t,e,n,r){var o={c:[],e:[]};if(!E){t=i.getElement(t);if(t!=null){var s=Y(t),a=t.querySelectorAll(".jtk-managed");if(n==null){n=jsPlumbUtil.uuid()}var l=dt({elId:s,offset:e,recalc:false,timestamp:n});for(var u=0;u<a.length;u++){dt({elId:a[u].getAttribute("id"),recalc:true,timestamp:n})}var c=i.router.redraw(s,e,n,null,r);Array.prototype.push.apply(o.c,c.c);Array.prototype.push.apply(o.e,c.e);if(a){for(var h=0;h<a.length;h++){c=i.router.redraw(a[h].getAttribute("id"),null,n,null,r,true);Array.prototype.push.apply(o.c,c.c);Array.prototype.push.apply(o.e,c.e)}}}}return o},O=function(t){return x[t]},M=function(t,e){var n=t.scope.split(/\s/),i=e.scope.split(/\s/);for(var r=0;r<n.length;r++){for(var o=0;o<i.length;o++){if(i[o]===n[r]){return true}}}return false},L=function(t,e){var n=p.extend({},t);for(var i in e){if(e[i]){n[i]=e[i]}}return n},F=function(t,e){var r=p.extend({},t);if(e){p.extend(r,e)}if(r.source){if(r.source.endpoint){r.sourceEndpoint=r.source}else{r.source=i.getElement(r.source)}}if(r.target){if(r.target.endpoint){r.targetEndpoint=r.target}else{r.target=i.getElement(r.target)}}if(t.uuids){r.sourceEndpoint=O(t.uuids[0]);r.targetEndpoint=O(t.uuids[1])}if(r.sourceEndpoint&&r.sourceEndpoint.isFull()){n.log(i,"could not add connection; source endpoint is full");return}if(r.targetEndpoint&&r.targetEndpoint.isFull()){n.log(i,"could not add connection; target endpoint is full");return}if(!r.type&&r.sourceEndpoint){r.type=r.sourceEndpoint.connectionType}if(r.sourceEndpoint&&r.sourceEndpoint.connectorOverlays){r.overlays=r.overlays||[];for(var o=0,s=r.sourceEndpoint.connectorOverlays.length;o<s;o++){r.overlays.push(r.sourceEndpoint.connectorOverlays[o])}}if(r.sourceEndpoint&&r.sourceEndpoint.scope){r.scope=r.sourceEndpoint.scope}if(!r["pointer-events"]&&r.sourceEndpoint&&r.sourceEndpoint.connectorPointerEvents){r["pointer-events"]=r.sourceEndpoint.connectorPointerEvents}var a=function(t,e,n){var o=L(e,{anchor:r.anchors?r.anchors[n]:r.anchor,endpoint:r.endpoints?r.endpoints[n]:r.endpoint,paintStyle:r.endpointStyles?r.endpointStyles[n]:r.endpointStyle,hoverPaintStyle:r.endpointHoverStyles?r.endpointHoverStyles[n]:r.endpointHoverStyle});return i.addEndpoint(t,o)};var l=function(t,e,n,i){if(r[t]&&!r[t].endpoint&&!r[t+"Endpoint"]&&!r.newConnection){var o=Y(r[t]),s=n[o];s=s?s[i]:null;if(s){if(!s.enabled){return false}var l=p.extend({},s.def);delete l.label;var u=s.endpoint!=null&&s.endpoint._jsPlumb?s.endpoint:a(r[t],l,e);if(u.isFull()){return false}r[t+"Endpoint"]=u;if(!r.scope&&l.scope){r.scope=l.scope}if(s.uniqueEndpoint){if(!s.endpoint){s.endpoint=u;u.setDeleteOnEmpty(false)}else{u.finalEndpoint=s.endpoint}}else{u.setDeleteOnEmpty(true)}if(e===0&&s.def.connectorOverlays){r.overlays=r.overlays||[];Array.prototype.push.apply(r.overlays,s.def.connectorOverlays)}}}};if(l("source",0,this.sourceEndpointDefinitions,r.type||"default")===false){return}if(l("target",1,this.targetEndpointDefinitions,r.type||"default")===false){return}if(r.sourceEndpoint&&r.targetEndpoint){if(!M(r.sourceEndpoint,r.targetEndpoint)){r=null}}return r}.bind(i),N=function(t){var e=i.Defaults.ConnectionType||i.getDefaultConnectionType();t._jsPlumb=i;t.newConnection=N;t.newEndpoint=R;t.endpointsByUUID=x;t.endpointsByElement=b;t.finaliseConnection=H;t.id="con_"+A();var n=new e(t);if(n.isDetachable()){n.endpoints[0].initDraggable("_jsPlumbSource");n.endpoints[1].initDraggable("_jsPlumbTarget")}return n},H=i.finaliseConnection=function(t,e,n,r){e=e||{};if(!t.suspendedEndpoint){y.push(t)}t.pending=null;t.endpoints[0].isTemporarySource=false;if(r!==false){i.router.newConnection(t)}T(t.source);if(!e.doNotFireConnectionEvent&&e.fireEvent!==false){var o={connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]};i.fire("connection",o,n)}},R=function(t,e){var n=i.Defaults.EndpointType||p.Endpoint;var r=p.extend({},t);r._jsPlumb=i;r.newConnection=N;r.newEndpoint=R;r.endpointsByUUID=x;r.endpointsByElement=b;r.fireDetachEvent=q;r.elementId=e||Y(r.source);var o=new n(r);o.id="ep_"+A();ft(r.elementId,r.source);if(!p.headless){i.getDragManager().endpointAdded(r.source,e)}return o},G=function(t,e,n){var i=b[t];if(i&&i.length){for(var r=0,o=i.length;r<o;r++){for(var s=0,a=i[r].connections.length;s<a;s++){var l=e(i[r].connections[s]);if(l){return}}if(n){n(i[r])}}}},U=function(t,e,n){e=e==="block";var i=null;if(n){i=function(t){t.setVisible(e,true,true)}}var r=c(t);G(r.id,(function(t){if(e&&n){var i=t.sourceId===r.id?1:0;if(t.endpoints[i].isVisible()){t.setVisible(true)}}else{t.setVisible(e)}}),i)},B=function(t,e){var n=null;if(e){n=function(t){var e=t.isVisible();t.setVisible(!e)}}G(t,(function(t){var e=t.isVisible();t.setVisible(!e)}),n)},W=function(t){var e=_[t];if(!e){return dt({elId:t})}else{return{o:e,s:j[t]}}},Y=function(t,e,r){if(n.isString(t)){return t}if(t==null){return null}var s=i.getAttribute(t,"id");if(!s||s==="undefined"){if(arguments.length===2&&arguments[1]!==undefined){s=e}else if(arguments.length===1||arguments.length===3&&!arguments[2]){s="jsPlumb_"+o+"_"+A()}if(!r){i.setAttribute(t,"id",s)}}return s};this.setConnectionBeingDragged=function(t){w=t};this.isConnectionBeingDragged=function(){return w};this.getManagedElements=function(){return P};this.connectorClass="jtk-connector";this.connectorOutlineClass="jtk-connector-outline";this.connectedClass="jtk-connected";this.hoverClass="jtk-hover";this.endpointClass="jtk-endpoint";this.endpointConnectedClass="jtk-endpoint-connected";this.endpointFullClass="jtk-endpoint-full";this.endpointDropAllowedClass="jtk-endpoint-drop-allowed";this.endpointDropForbiddenClass="jtk-endpoint-drop-forbidden";this.overlayClass="jtk-overlay";this.draggingClass="jtk-dragging";this.elementDraggingClass="jtk-element-dragging";this.sourceElementDraggingClass="jtk-source-element-dragging";this.targetElementDraggingClass="jtk-target-element-dragging";this.endpointAnchorClassPrefix="jtk-endpoint-anchor";this.hoverSourceClass="jtk-source-hover";this.hoverTargetClass="jtk-target-hover";this.dragSelectClass="jtk-drag-select";this.Anchors={};this.Connectors={svg:{}};this.Endpoints={svg:{}};this.Overlays={svg:{}};this.ConnectorRenderers={};this.SVG="svg";this.addEndpoint=function(t,e,r){r=r||{};var o=p.extend({},r);p.extend(o,e);o.endpoint=o.endpoint||i.Defaults.Endpoint;o.paintStyle=o.paintStyle||i.Defaults.EndpointStyle;var s=[],a=n.isArray(t)||t.length!=null&&!n.isString(t)?t:[t];for(var l=0,u=a.length;l<u;l++){o.source=i.getElement(a[l]);ct(o.source);var c=Y(o.source),h=R(o,c);var f=ft(c,o.source,null,!E).info.o;n.addToList(b,c,h);if(!E){h.paint({anchorLoc:h.anchor.compute({xy:[f.left,f.top],wh:j[c],element:h,timestamp:D,rotation:this.getRotation(c)}),timestamp:D})}s.push(h)}return s.length===1?s[0]:s};this.addEndpoints=function(t,e,r){var o=[];for(var s=0,a=e.length;s<a;s++){var l=i.addEndpoint(t,e[s],r);if(n.isArray(l)){Array.prototype.push.apply(o,l)}else{o.push(l)}}return o};this.animate=function(t,e,r){if(!this.animationSupported){return false}r=r||{};var o=i.getElement(t),s=Y(o),a=p.animEvents.step,l=p.animEvents.complete;r[a]=n.wrap(r[a],(function(){i.revalidate(s)}));r[l]=n.wrap(r[l],(function(){i.revalidate(s)}));i.doAnimate(o,e,r)};this.checkCondition=function(t,e){var r=i.getListener(t),o=true;if(r&&r.length>0){var s=Array.prototype.slice.call(arguments,1);try{for(var a=0,l=r.length;a<l;a++){o=o&&r[a].apply(r[a],s)}}catch(u){n.log(i,"cannot check condition ["+t+"]"+u)}}return o};this.connect=function(t,e){var i=F(t,e),r;if(i){if(i.source==null&&i.sourceEndpoint==null){n.log("Cannot establish connection - source does not exist");return}if(i.target==null&&i.targetEndpoint==null){n.log("Cannot establish connection - target does not exist");return}ct(i.source);r=N(i);H(r,i)}return r};var X=[{el:"source",elId:"sourceId",epDefs:"sourceEndpointDefinitions"},{el:"target",elId:"targetId",epDefs:"targetEndpointDefinitions"}];var z=function(t,e,n,i){var r,o=X[n],s=t[o.elId],a,l,u=t.endpoints[n];var c={index:n,originalSourceId:n===0?s:t.sourceId,newSourceId:t.sourceId,originalTargetId:n===1?s:t.targetId,newTargetId:t.targetId,connection:t};if(e.constructor===p.Endpoint){r=e;r.addConnection(t);e=r.element}else{a=Y(e);l=this[o.epDefs][a];if(a===t[o.elId]){r=null}else if(l){for(var h in l){if(!l[h].enabled){return}r=l[h].endpoint!=null&&l[h].endpoint._jsPlumb?l[h].endpoint:this.addEndpoint(e,l[h].def);if(l[h].uniqueEndpoint){l[h].endpoint=r}r.addConnection(t)}}else{r=t.makeEndpoint(n===0,e,a)}}if(r!=null){u.detachFromConnection(t);t.endpoints[n]=r;t[o.el]=r.element;t[o.elId]=r.elementId;c[n===0?"newSourceId":"newTargetId"]=r.elementId;V(c);if(!i){t.repaint()}}c.element=e;return c}.bind(this);this.setSource=function(t,e,n){var i=z(t,e,0,n);this.router.sourceOrTargetChanged(i.originalSourceId,i.newSourceId,t,i.el,0)};this.setTarget=function(t,e,n){var i=z(t,e,1,n);this.router.sourceOrTargetChanged(i.originalTargetId,i.newTargetId,t,i.el,1)};this.deleteEndpoint=function(t,e,n){var r=typeof t==="string"?x[t]:t;if(r){i.deleteObject({endpoint:r,dontUpdateHover:e,deleteAttachedObjects:n})}return i};this.deleteEveryEndpoint=function(){var t=i.setSuspendDrawing(true);for(var e in b){var n=b[e];if(n&&n.length){for(var r=0,o=n.length;r<o;r++){i.deleteEndpoint(n[r],true)}}}b={};P={};x={};_={};C={};i.router.reset();var s=i.getDragManager();if(s){s.reset()}if(!t){i.setSuspendDrawing(false)}return i};var q=function(t,e,n){var r=i.Defaults.ConnectionType||i.getDefaultConnectionType(),o=t.constructor===r,s=o?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;if(e){i.fire("connectionDetached",s,n)}i.fire("internal.connectionDetached",s,n);i.router.connectionDetached(s)};var V=i.fireMoveEvent=function(t,e){i.fire("connectionMoved",t,e)};this.unregisterEndpoint=function(t){if(t._jsPlumb.uuid){x[t._jsPlumb.uuid]=null}i.router.deleteEndpoint(t);for(var e in b){var n=b[e];if(n){var r=[];for(var o=0,s=n.length;o<s;o++){if(n[o]!==t){r.push(n[o])}}b[e]=r}if(b[e].length<1){delete b[e]}}};var J="isDetachAllowed";var $="beforeDetach";var Z="checkCondition";this.deleteConnection=function(t,e){if(t!=null){e=e||{};if(e.force||n.functionChain(true,false,[[t.endpoints[0],J,[t]],[t.endpoints[1],J,[t]],[t,J,[t]],[i,Z,[$,t]]])){t.setHover(false);q(t,!t.pending&&e.fireEvent!==false,e.originalEvent);t.endpoints[0].detachFromConnection(t);t.endpoints[1].detachFromConnection(t);n.removeWithFunction(y,(function(e){return t.id===e.id}));t.cleanup();t.destroy();return true}}return false};this.deleteEveryConnection=function(t){t=t||{};var e=y.length,n=0;i.batch((function(){for(var r=0;r<e;r++){n+=i.deleteConnection(y[0],t)?1:0}}));return n};this.deleteConnectionsForElement=function(t,e){e=e||{};t=i.getElement(t);var n=Y(t),r=b[n];if(r&&r.length){for(var o=0,s=r.length;o<s;o++){r[o].deleteEveryConnection(e)}}return i};this.deleteObject=function(t){var e={endpoints:{},connections:{},endpointCount:0,connectionCount:0},r=t.deleteAttachedObjects!==false;var o=function(n){if(n!=null&&e.connections[n.id]==null){if(!t.dontUpdateHover&&n._jsPlumb!=null){n.setHover(false)}e.connections[n.id]=n;e.connectionCount++}};var s=function(n){if(n!=null&&e.endpoints[n.id]==null){if(!t.dontUpdateHover&&n._jsPlumb!=null){n.setHover(false)}e.endpoints[n.id]=n;e.endpointCount++;if(r){for(var i=0;i<n.connections.length;i++){var s=n.connections[i];o(s)}}}};if(t.connection){o(t.connection)}else{s(t.endpoint)}for(var a in e.connections){var l=e.connections[a];if(l._jsPlumb){n.removeWithFunction(y,(function(t){return l.id===t.id}));q(l,t.fireEvent===false?false:!l.pending,t.originalEvent);var u=t.deleteAttachedObjects==null?null:!t.deleteAttachedObjects;l.endpoints[0].detachFromConnection(l,null,u);l.endpoints[1].detachFromConnection(l,null,u);l.cleanup(true);l.destroy(true)}}for(var c in e.endpoints){var h=e.endpoints[c];if(h._jsPlumb){i.unregisterEndpoint(h);h.cleanup(true);h.destroy(true)}}return e};var K=function(t,e,n,i){for(var r=0,o=t.length;r<o;r++){t[r][e].apply(t[r],n)}return i(t)},Q=function(t,e,n){var i=[];for(var r=0,o=t.length;r<o;r++){i.push([t[r][e].apply(t[r],n),t[r]])}return i},tt=function(t,e,n){return function(){return K(t,e,arguments,n)}},et=function(t,e){return function(){return Q(t,e,arguments)}},nt=function(t,e){var n=[];if(t){if(typeof t==="string"){if(t==="*"){return t}n.push(t)}else{if(e){n=t}else{if(t.length){for(var i=0,r=t.length;i<r;i++){n.push(c(t[i]).id)}}else{n.push(c(t).id)}}}}return n},it=function(t,e,n){if(t==="*"){return true}return t.length>0?t.indexOf(e)!==-1:!n};this.getConnections=function(t,e){if(!t){t={}}else if(t.constructor===String){t={scope:t}}var n=t.scope||i.getDefaultScope(),r=nt(n,true),o=nt(t.source),s=nt(t.target),a=!e&&r.length>1?{}:[],l=function(t,n){if(!e&&r.length>1){var i=a[t];if(i==null){i=a[t]=[]}i.push(n)}else{a.push(n)}};for(var u=0,c=y.length;u<c;u++){var h=y[u],f=h.proxies&&h.proxies[0]?h.proxies[0].originalEp.elementId:h.sourceId,d=h.proxies&&h.proxies[1]?h.proxies[1].originalEp.elementId:h.targetId;if(it(r,h.scope)&&it(o,f)&&it(s,d)){l(h.scope,h)}}return a};var rt=function(t,e){return function(n){for(var i=0,r=t.length;i<r;i++){n(t[i])}return e(t)}},ot=function(t){return function(e){return t[e]}};var st=function(t,e){var n={length:t.length,each:rt(t,e),get:ot(t)},i=["setHover","removeAllOverlays","setLabel","addClass","addOverlay","removeOverlay","removeOverlays","showOverlay","hideOverlay","showOverlays","hideOverlays","setPaintStyle","setHoverPaintStyle","setSuspendEvents","setParameter","setParameters","setVisible","repaint","addType","toggleType","removeType","removeClass","setType","bind","unbind"],r=["getLabel","getOverlay","isHover","getParameter","getParameters","getPaintStyle","getHoverPaintStyle","isVisible","hasType","getType","isSuspendEvents"],o,s;for(o=0,s=i.length;o<s;o++){n[i[o]]=tt(t,i[o],e)}for(o=0,s=r.length;o<s;o++){n[r[o]]=et(t,r[o])}return n};var at=function(t){var e=st(t,at);return p.extend(e,{setDetachable:tt(t,"setDetachable",at),setReattach:tt(t,"setReattach",at),setConnector:tt(t,"setConnector",at),delete:function(){for(var e=0,n=t.length;e<n;e++){i.deleteConnection(t[e])}},isDetachable:et(t,"isDetachable"),isReattach:et(t,"isReattach")})};var lt=function(t){var e=st(t,lt);return p.extend(e,{setEnabled:tt(t,"setEnabled",lt),setAnchor:tt(t,"setAnchor",lt),isEnabled:et(t,"isEnabled"),deleteEveryConnection:function(){for(var e=0,n=t.length;e<n;e++){t[e].deleteEveryConnection()}},delete:function(){for(var e=0,n=t.length;e<n;e++){i.deleteEndpoint(t[e])}}})};this.select=function(t){t=t||{};t.scope=t.scope||"*";return at(t.connections||i.getConnections(t,true))};this.selectEndpoints=function(t){t=t||{};t.scope=t.scope||"*";var e=!t.element&&!t.source&&!t.target,n=e?"*":nt(t.element),i=e?"*":nt(t.source),r=e?"*":nt(t.target),o=nt(t.scope,true);var s=[];for(var a in b){var l=it(n,a,true),u=it(i,a,true),c=i!=="*",h=it(r,a,true),f=r!=="*";if(l||u||h){t:for(var d=0,p=b[a].length;d<p;d++){var v=b[a][d];if(it(o,v.scope,true)){var g=c&&i.length>0&&!v.isSource,m=f&&r.length>0&&!v.isTarget;if(g||m){continue t}s.push(v)}}}}return lt(s)};this.getAllConnections=function(){return y};this.getDefaultScope=function(){return S};this.getEndpoint=O;this.getEndpoints=function(t){return b[c(t).id]||[]};this.getDefaultEndpointType=function(){return p.Endpoint};this.getDefaultConnectionType=function(){return p.Connection};this.getId=Y;this.draw=T;this.info=c;this.appendElement=I;var ut=false;this.isHoverSuspended=function(){return ut};this.setHoverSuspended=function(t){ut=t};this.hide=function(t,e){U(t,"none",e);return i};this.idstamp=A;var ct=function(t){if(!d&&t){var e=i.getElement(t);if(e.offsetParent){i.setContainer(e.offsetParent)}}};var ht=function(){if(i.Defaults.Container){i.setContainer(i.Defaults.Container)}};var ft=i.manage=function(t,e,n,r){if(!P[t]){P[t]={el:e,endpoints:[],connections:[],rotation:0};P[t].info=dt({elId:t,timestamp:D});i.addClass(e,"jtk-managed");if(!n){i.fire("manageElement",{id:t,info:P[t].info,el:e})}}else{if(r){P[t].info=dt({elId:t,timestamp:D,recalc:true})}}return P[t]};this.unmanage=function(t){if(P[t]){var e=P[t].el;i.removeClass(e,"jtk-managed");delete P[t];i.fire("unmanageElement",{id:t,el:e})}};this.rotate=function(t,e,n){if(P[t]){P[t].rotation=e;P[t].el.style.transform="rotate("+e+"deg)";P[t].el.style.transformOrigin="center center";if(n!==true){return this.revalidate(t)}}return{c:[],e:[]}};this.getRotation=function(t){return P[t]?P[t].rotation||0:0};var dt=function(t){var e=t.timestamp,n=t.recalc,r=t.offset,o=t.elId,s;if(E&&!e){e=D}if(!n){if(e&&e===C[o]){return{o:t.offset||_[o],s:j[o]}}}if(n||!r&&_[o]==null){s=P[o]?P[o].el:null;if(s!=null){j[o]=i.getSize(s);_[o]=i.getOffset(s);C[o]=e}}else{_[o]=r||_[o];if(j[o]==null){s=P[o].el;if(s!=null){j[o]=i.getSize(s)}}C[o]=e}if(_[o]&&!_[o].right){_[o].right=_[o].left+j[o][0];_[o].bottom=_[o].top+j[o][1];_[o].width=j[o][0];_[o].height=j[o][1];_[o].centerx=_[o].left+_[o].width/2;_[o].centery=_[o].top+_[o].height/2}return{o:_[o],s:j[o]}};this.updateOffset=dt;this.init=function(){if(!m){ht();i.router=new t.jsPlumb.DefaultRouter(i);i.anchorManager=i.router.anchorManager;m=true;i.fire("ready",i)}}.bind(this);this.log=g;this.jsPlumbUIComponent=u;this.makeAnchor=function(){var e,r=function(e,n){if(t.jsPlumb.Anchors[e]){return new t.jsPlumb.Anchors[e](n)}if(!i.Defaults.DoNotThrowErrors){throw{msg:"jsPlumb: unknown anchor type '"+e+"'"}}};if(arguments.length===0){return null}var o=arguments[0],s=arguments[1],a=null;if(o.compute&&o.getOrientation){return o}else if(typeof o==="string"){a=r(arguments[0],{elementId:s,jsPlumbInstance:i})}else if(n.isArray(o)){if(n.isArray(o[0])||n.isString(o[0])){if(o.length===2&&n.isObject(o[1])){if(n.isString(o[0])){e=t.jsPlumb.extend({elementId:s,jsPlumbInstance:i},o[1]);a=r(o[0],e)}else{e=t.jsPlumb.extend({elementId:s,jsPlumbInstance:i,anchors:o[0]},o[1]);a=new t.jsPlumb.DynamicAnchor(e)}}else{a=new p.DynamicAnchor({anchors:o,selector:null,elementId:s,jsPlumbInstance:i})}}else{var l={x:o[0],y:o[1],orientation:o.length>=4?[o[2],o[3]]:[0,0],offsets:o.length>=6?[o[4],o[5]]:[0,0],elementId:s,jsPlumbInstance:i,cssClass:o.length===7?o[6]:null};a=new t.jsPlumb.Anchor(l);a.clone=function(){return new t.jsPlumb.Anchor(l)}}}if(!a.id){a.id="anchor_"+A()}return a};this.makeAnchors=function(e,r,o){var s=[];for(var a=0,l=e.length;a<l;a++){if(typeof e[a]==="string"){s.push(t.jsPlumb.Anchors[e[a]]({elementId:r,jsPlumbInstance:o}))}else if(n.isArray(e[a])){s.push(i.makeAnchor(e[a],r,o))}}return s};this.makeDynamicAnchor=function(e,n){return new t.jsPlumb.DynamicAnchor({anchors:e,selector:n,elementId:null,jsPlumbInstance:i})};this.targetEndpointDefinitions={};this.sourceEndpointDefinitions={};var pt=function(t,e,n,i,r){var o=t.target||t.srcElement,s=false,a=i.getSelector(e,n);for(var l=0;l<a.length;l++){if(a[l]===o){s=true;break}}return r?!s:s};var vt=function(e,r,o,s,a){var l=new u(r);var c=r._jsPlumb.EndpointDropHandler({jsPlumb:i,enabled:function(){return e.def.enabled},isFull:function(){var t=i.select({target:e.id}).length;return e.def.maxConnections>0&&t>=e.def.maxConnections},element:e.el,elementId:e.id,isSource:s,isTarget:a,addClass:function(t){i.addClass(e.el,t)},removeClass:function(t){i.removeClass(e.el,t)},onDrop:function(t){var e=t.endpoints[0];e.anchor.locked=false},isDropAllowed:function(){return l.isDropAllowed.apply(l,arguments)},isRedrop:function(t){return t.suspendedElement!=null&&t.suspendedEndpoint!=null&&t.suspendedEndpoint.element===e.el},getEndpoint:function(n){var o=e.def.endpoint;if(o==null||o._jsPlumb==null){var s=i.deriveEndpointAndAnchorSpec(n.getType().join(" "),true);var a=s.endpoints?t.jsPlumb.extend(r,{endpoint:e.def.def.endpoint||s.endpoints[1]}):r;if(s.anchors){a=t.jsPlumb.extend(a,{anchor:e.def.def.anchor||s.anchors[1]})}o=i.addEndpoint(e.el,a);o._mtNew=true}if(r.uniqueEndpoint){e.def.endpoint=o}o.setDeleteOnEmpty(true);if(n.isDetachable()){o.initDraggable()}if(o.anchor.positionFinder!=null){var l=i.getUIPosition(arguments,i.getZoom()),u=i.getOffset(e.el),c=i.getSize(e.el),h=l==null?[0,0]:o.anchor.positionFinder(l,u,c,o.anchor.constructorParams);o.anchor.x=h[0];o.anchor.y=h[1]}return o},maybeCleanup:function(t){if(t._mtNew&&t.connections.length===0){i.deleteObject({endpoint:t})}else{delete t._mtNew}}});var h=t.jsPlumb.dragEvents.drop;o.scope=o.scope||(r.scope||i.Defaults.Scope);o[h]=n.wrap(o[h],c,true);o.rank=r.rank||0;if(a){o[t.jsPlumb.dragEvents.over]=function(){return true}}if(r.allowLoopback===false){o.canDrop=function(t){var n=t.getDragElement()._jsPlumbRelatedElement;return n!==e.el}}i.initDroppable(e.el,o,"internal");return c};this.makeTarget=function(e,n,r){var o=t.jsPlumb.extend({_jsPlumb:this},r);t.jsPlumb.extend(o,n);var s=o.maxConnections||-1,a=function(e){var n=c(e),r=n.id,a=t.jsPlumb.extend({},o.dropOptions||{}),l=o.connectionType||"default";this.targetEndpointDefinitions[r]=this.targetEndpointDefinitions[r]||{};ct(r);if(n.el._isJsPlumbGroup&&a.rank==null){a.rank=-1}var u={def:t.jsPlumb.extend({},o),uniqueEndpoint:o.uniqueEndpoint,maxConnections:s,enabled:true};if(o.createEndpoint){u.uniqueEndpoint=true;u.endpoint=i.addEndpoint(e,u.def);u.endpoint.setDeleteOnEmpty(false)}n.def=u;this.targetEndpointDefinitions[r][l]=u;vt(n,o,a,o.isSource===true,true);n.el._katavorioDrop[n.el._katavorioDrop.length-1].targetDef=u}.bind(this);var l=e.length&&e.constructor!==String?e:[e];for(var u=0,h=l.length;u<h;u++){a(l[u])}return this};this.unmakeTarget=function(t,e){var n=c(t);i.destroyDroppable(n.el,"internal");if(!e){delete this.targetEndpointDefinitions[n.id]}return this};this.makeSource=function(e,r,o){var s=t.jsPlumb.extend({_jsPlumb:this},o);t.jsPlumb.extend(s,r);var a=s.connectionType||"default";var u=i.deriveEndpointAndAnchorSpec(a);s.endpoint=s.endpoint||u.endpoints[0];s.anchor=s.anchor||u.anchors[0];var h=s.maxConnections||-1,f=s.onMaxConnections,d=function(r){var o=r.id,u=this.getElement(r.el);this.sourceEndpointDefinitions[o]=this.sourceEndpointDefinitions[o]||{};ct(o);var c={def:t.jsPlumb.extend({},s),uniqueEndpoint:s.uniqueEndpoint,maxConnections:h,enabled:true};if(s.createEndpoint){c.uniqueEndpoint=true;c.endpoint=i.addEndpoint(e,c.def);c.endpoint.setDeleteOnEmpty(false)}this.sourceEndpointDefinitions[o][a]=c;r.def=c;var d=t.jsPlumb.dragEvents.stop,p=t.jsPlumb.dragEvents.drag,v=t.jsPlumb.extend({},s.dragOptions||{}),g=v.drag,m=v.stop,y=null,b=false;v.scope=v.scope||s.scope;v[p]=n.wrap(v[p],(function(){if(g){g.apply(this,arguments)}b=false}));v[d]=n.wrap(v[d],function(){if(m){m.apply(this,arguments)}this.currentlyDragging=false;if(y._jsPlumb!=null){var t=s.anchor||this.Defaults.Anchor,e=y.anchor,n=y.connections[0];var r=this.makeAnchor(t,o,this),a=y.element;if(r.positionFinder!=null){var l=i.getOffset(a),u=this.getSize(a),c={left:l.left+e.x*u[0],top:l.top+e.y*u[1]},h=r.positionFinder(c,l,u,r.constructorParams);r.x=h[0];r.y=h[1]}y.setAnchor(r,true);y.repaint();this.repaint(y.elementId);if(n!=null){this.repaint(n.targetId)}}}.bind(this));var x=function(e){if(e.which===3||e.button===2){return}o=this.getId(this.getElement(r.el));var c=this.sourceEndpointDefinitions[o][a];if(!c.enabled){return}if(s.filter){var d=n.isString(s.filter)?pt(e,r.el,s.filter,this,s.filterExclude):s.filter(e,r.el);if(d===false){return}}var p=this.select({source:o}).length;if(c.maxConnections>=0&&p>=c.maxConnections){if(f){f({element:r.el,maxConnections:h},e)}return false}var g=t.jsPlumb.getPositionOnElement(e,u,l);var m={};t.jsPlumb.extend(m,c.def);m.isTemporarySource=true;m.anchor=[g[0],g[1],0,0];m.dragOptions=v;if(c.def.scope){m.scope=c.def.scope}y=this.addEndpoint(o,m);b=true;y.setDeleteOnEmpty(true);if(c.uniqueEndpoint){if(!c.endpoint){c.endpoint=y;y.setDeleteOnEmpty(false)}else{y.finalEndpoint=c.endpoint}}var x=function(){i.off(y.canvas,"mouseup",x);i.off(r.el,"mouseup",x);if(b){b=false;i.deleteEndpoint(y)}};i.on(y.canvas,"mouseup",x);i.on(r.el,"mouseup",x);var P={};if(c.def.extract){for(var _ in c.def.extract){var C=(e.srcElement||e.target).getAttribute(_);if(C){P[c.def.extract[_]]=C}}}i.trigger(y.canvas,"mousedown",e,P);n.consume(e)}.bind(this);this.on(r.el,"mousedown",x);c.trigger=x;if(s.filter&&(n.isString(s.filter)||n.isFunction(s.filter))){i.setDragFilter(r.el,s.filter)}var P=t.jsPlumb.extend({},s.dropOptions||{});vt(r,s,P,true,s.isTarget===true)}.bind(this);var p=e.length&&e.constructor!==String?e:[e];for(var v=0,g=p.length;v<g;v++){d(c(p[v]))}return this};this.unmakeSource=function(t,e,n){var r=c(t);i.destroyDroppable(r.el,"internal");var o=this.sourceEndpointDefinitions[r.id];if(o){for(var s in o){if(e==null||e===s){var a=o[s].trigger;if(a){i.off(r.el,"mousedown",a)}if(!n){delete this.sourceEndpointDefinitions[r.id][s]}}}}return this};this.unmakeEverySource=function(){for(var t in this.sourceEndpointDefinitions){i.unmakeSource(t,null,true)}this.sourceEndpointDefinitions={};return this};var gt=function(t,e,i){e=n.isArray(e)?e:[e];var r=Y(t);i=i||"default";for(var o=0;o<e.length;o++){var s=this[e[o]][r];if(s&&s[i]){return s[i].def.scope||this.Defaults.Scope}}}.bind(this);var mt=function(t,e,i,r){i=n.isArray(i)?i:[i];var o=Y(t);r=r||"default";for(var s=0;s<i.length;s++){var a=this[i[s]][o];if(a&&a[r]){a[r].def.scope=e}}}.bind(this);this.getScope=function(t,e){return gt(t,["sourceEndpointDefinitions","targetEndpointDefinitions"])};this.getSourceScope=function(t){return gt(t,"sourceEndpointDefinitions")};this.getTargetScope=function(t){return gt(t,"targetEndpointDefinitions")};this.setScope=function(t,e,n){this.setSourceScope(t,e,n);this.setTargetScope(t,e,n)};this.setSourceScope=function(t,e,n){mt(t,e,"sourceEndpointDefinitions",n);this.setDragScope(t,e)};this.setTargetScope=function(t,e,n){mt(t,e,"targetEndpointDefinitions",n);this.setDropScope(t,e)};this.unmakeEveryTarget=function(){for(var t in this.targetEndpointDefinitions){i.unmakeTarget(t,true)}this.targetEndpointDefinitions={};return this};var yt=function(t,e,r,o,s){var a=t==="source"?this.sourceEndpointDefinitions:this.targetEndpointDefinitions,l,u,h;s=s||"default";if(e.length&&!n.isString(e)){l=[];for(var f=0,d=e.length;f<d;f++){u=c(e[f]);if(a[u.id]&&a[u.id][s]){l[f]=a[u.id][s].enabled;h=o?!l[f]:r;a[u.id][s].enabled=h;i[h?"removeClass":"addClass"](u.el,"jtk-"+t+"-disabled")}}}else{u=c(e);var p=u.id;if(a[p]&&a[p][s]){l=a[p][s].enabled;h=o?!l:r;a[p][s].enabled=h;i[h?"removeClass":"addClass"](u.el,"jtk-"+t+"-disabled")}}return l}.bind(this);var bt=function(t,e){if(t!=null){if(n.isString(t)||!t.length){return e.apply(this,[t])}else if(t.length){return e.apply(this,[t[0]])}}}.bind(this);this.toggleSourceEnabled=function(t,e){yt("source",t,null,true,e);return this.isSourceEnabled(t,e)};this.setSourceEnabled=function(t,e,n){return yt("source",t,e,null,n)};this.isSource=function(t,e){e=e||"default";return bt(t,function(t){var n=this.sourceEndpointDefinitions[c(t).id];return n!=null&&n[e]!=null}.bind(this))};this.isSourceEnabled=function(t,e){e=e||"default";return bt(t,function(t){var n=this.sourceEndpointDefinitions[c(t).id];return n&&n[e]&&n[e].enabled===true}.bind(this))};this.toggleTargetEnabled=function(t,e){yt("target",t,null,true,e);return this.isTargetEnabled(t,e)};this.isTarget=function(t,e){e=e||"default";return bt(t,function(t){var n=this.targetEndpointDefinitions[c(t).id];return n!=null&&n[e]!=null}.bind(this))};this.isTargetEnabled=function(t,e){e=e||"default";return bt(t,function(t){var n=this.targetEndpointDefinitions[c(t).id];return n&&n[e]&&n[e].enabled===true}.bind(this))};this.setTargetEnabled=function(t,e,n){return yt("target",t,e,null,n)};this.ready=function(t){i.bind("ready",t)};var xt=function(t,e){if(typeof t==="object"&&t.length){for(var n=0,r=t.length;n<r;n++){e(t[n])}}else{e(t)}return i};this.repaint=function(t,e,n){return xt(t,(function(t){T(t,e,n)}))};this.revalidate=function(t,e,n){var r=n?t:i.getId(t);i.updateOffset({elId:r,recalc:true,timestamp:e});var o=i.getDragManager();if(o){o.updateOffsets(r)}return T(t,null,e)};this.repaintEverything=function(){var t=jsPlumbUtil.uuid(),e;for(e in b){i.updateOffset({elId:e,recalc:true,timestamp:t})}for(e in b){T(e,null,t)}return this};this.removeAllEndpoints=function(t,e,n){n=n||[];var r=function(t){var o=c(t),s=b[o.id],a,l;if(s){n.push(o);for(a=0,l=s.length;a<l;a++){i.deleteEndpoint(s[a],false)}}delete b[o.id];if(e){if(o.el&&o.el.nodeType!==3&&o.el.nodeType!==8){for(a=0,l=o.el.childNodes.length;a<l;a++){r(o.el.childNodes[a])}}}};r(t);return this};var Pt=function(t,e){i.removeAllEndpoints(t.id,true,e);var n=i.getDragManager();var r=function(t){if(n){n.elementRemoved(t.id)}i.router.elementRemoved(t.id);if(i.isSource(t.el)){i.unmakeSource(t.el)}if(i.isTarget(t.el)){i.unmakeTarget(t.el)}i.destroyDraggable(t.el);i.destroyDroppable(t.el);delete i.floatingConnections[t.id];delete P[t.id];delete _[t.id];if(t.el){i.removeElement(t.el);t.el._jsPlumb=null}};for(var o=1;o<e.length;o++){r(e[o])}r(t)};this.remove=function(t,e){var n=c(t),r=[];if(n.text&&n.el.parentNode){n.el.parentNode.removeChild(n.el)}else if(n.id){i.batch((function(){Pt(n,r)}),e===true)}return i};this.empty=function(t,e){var n=[];var r=function(t,e){var i=c(t);if(i.text){i.el.parentNode.removeChild(i.el)}else if(i.el){while(i.el.childNodes.length>0){r(i.el.childNodes[0])}if(!e){Pt(i,n)}}};i.batch((function(){r(t,true)}),e===false);return i};this.reset=function(t){i.silently(function(){ut=false;i.removeAllGroups();i.removeGroupManager();i.deleteEveryEndpoint();if(!t){i.unbind()}this.targetEndpointDefinitions={};this.sourceEndpointDefinitions={};y.length=0;if(this.doReset){this.doReset()}}.bind(this))};this.destroy=function(){this.reset();d=null;v=null};var _t=function(t){if(t.canvas&&t.canvas.parentNode){t.canvas.parentNode.removeChild(t.canvas)}t.cleanup();t.destroy()};this.clear=function(){i.select().each(_t);i.selectEndpoints().each(_t);b={};x={}};this.setDefaultScope=function(t){S=t;return i};this.deriveEndpointAndAnchorSpec=function(t,e){var n=((e?"":"default ")+t).split(/[\s]/),r=null,o=null,s=null,a=null;for(var l=0;l<n.length;l++){var u=i.getType(n[l],"connection");if(u){if(u.endpoints){r=u.endpoints}if(u.endpoint){o=u.endpoint}if(u.anchors){a=u.anchors}if(u.anchor){s=u.anchor}}}return{endpoints:r?r:[o,o],anchors:a?a:[s,s]}};this.setId=function(t,e,i){var r;if(n.isString(t)){r=t}else{t=this.getElement(t);r=this.getId(t)}var o=this.getConnections({source:r,scope:"*"},true),s=this.getConnections({target:r,scope:"*"},true);e=""+e;if(!i){t=this.getElement(r);this.setAttribute(t,"id",e)}else{t=this.getElement(e)}b[e]=b[r]||[];for(var a=0,l=b[e].length;a<l;a++){b[e][a].setElementId(e);b[e][a].setReferenceElement(t)}delete b[r];this.sourceEndpointDefinitions[e]=this.sourceEndpointDefinitions[r];delete this.sourceEndpointDefinitions[r];this.targetEndpointDefinitions[e]=this.targetEndpointDefinitions[r];delete this.targetEndpointDefinitions[r];this.router.changeId(r,e);var u=this.getDragManager();if(u){u.changeId(r,e)}P[e]=P[r];delete P[r];var c=function(n,i,r){for(var o=0,s=n.length;o<s;o++){n[o].endpoints[i].setElementId(e);n[o].endpoints[i].setReferenceElement(t);n[o][r+"Id"]=e;n[o][r]=t}};c(o,0,"source");c(s,1,"target");this.repaint(e)};this.setDebugLog=function(t){g=t};this.setSuspendDrawing=function(t,e){var n=E;E=t;if(t){D=(new Date).getTime()}else{D=null}if(e){this.repaintEverything()}return n};this.isSuspendDrawing=function(){return E};this.getSuspendedAt=function(){return D};this.batch=function(t,e){var i=this.isSuspendDrawing();if(!i){this.setSuspendDrawing(true)}try{t()}catch(r){n.log("Function run while suspended failed",r)}if(!i){this.setSuspendDrawing(false,!e)}};this.doWhileSuspended=this.batch;this.getCachedData=W;this.show=function(t,e){U(t,"block",e);return i};this.toggleVisible=B;this.addListener=this.bind;var Ct=[];this.registerFloatingConnection=function(t,e,i){Ct[t.id]=e;n.addToList(b,t.id,i)};this.getFloatingConnectionFor=function(t){return Ct[t]};this.listManager=new t.jsPlumbListManager(this,this.Defaults.ListStyle)};n.extend(t.jsPlumbInstance,n.EventGenerator,{setAttribute:function(t,e,n){this.setAttribute(t,e,n)},getAttribute:function(e,n){return this.getAttribute(t.jsPlumb.getElement(e),n)},convertToFullOverlaySpec:function(t){if(n.isString(t)){t=[t,{}]}t[1].id=t[1].id||n.uuid();return t},registerConnectionType:function(e,n){this._connectionTypes[e]=t.jsPlumb.extend({},n);if(n.overlays){var i={};for(var r=0;r<n.overlays.length;r++){var o=this.convertToFullOverlaySpec(n.overlays[r]);i[o[1].id]=o}this._connectionTypes[e].overlays=i}},registerConnectionTypes:function(t){for(var e in t){this.registerConnectionType(e,t[e])}},registerEndpointType:function(e,n){this._endpointTypes[e]=t.jsPlumb.extend({},n);if(n.overlays){var i={};for(var r=0;r<n.overlays.length;r++){var o=this.convertToFullOverlaySpec(n.overlays[r]);i[o[1].id]=o}this._endpointTypes[e].overlays=i}},registerEndpointTypes:function(t){for(var e in t){this.registerEndpointType(e,t[e])}},getType:function(t,e){return e==="connection"?this._connectionTypes[t]:this._endpointTypes[t]},setIdChanged:function(t,e){this.setId(t,e,true)},setParent:function(t,e){var n=this.getElement(t),i=this.getId(n),r=this.getElement(e),o=this.getId(r),s=this.getDragManager();n.parentNode.removeChild(n);r.appendChild(n);if(s){s.setParent(n,i,r,o)}},extend:function(t,e,n){var i;if(n){for(i=0;i<n.length;i++){t[n[i]]=e[n[i]]}}else{for(i in e){t[i]=e[i]}}return t},floatingConnections:{},getFloatingAnchorIndex:function(t){return t.endpoints[0].isFloating()?0:t.endpoints[1].isFloating()?1:-1},proxyConnection:function(t,e,n,i,r,o){var s,a=t.endpoints[e].elementId,l=t.endpoints[e];t.proxies=t.proxies||[];if(t.proxies[e]){s=t.proxies[e].ep}else{s=this.addEndpoint(n,{endpoint:r(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:true}})}s.setDeleteOnEmpty(true);t.proxies[e]={ep:s,originalEp:l};if(e===0){this.router.sourceOrTargetChanged(a,i,t,n,0)}else{this.router.sourceOrTargetChanged(a,i,t,n,1)}l.detachFromConnection(t,null,true);s.connections=[t];t.endpoints[e]=s;l.setVisible(false);t.setVisible(true);this.revalidate(n)},unproxyConnection:function(t,e,n){if(t._jsPlumb==null||t.proxies==null||t.proxies[e]==null){return}var i=t.proxies[e].originalEp.element,r=t.proxies[e].originalEp.elementId;t.endpoints[e]=t.proxies[e].originalEp;if(e===0){this.router.sourceOrTargetChanged(n,r,t,i,0)}else{this.router.sourceOrTargetChanged(n,r,t,i,1)}t.proxies[e].ep.detachFromConnection(t,null);t.proxies[e].originalEp.addConnection(t);if(t.isVisible()){t.proxies[e].originalEp.setVisible(true)}delete t.proxies[e]}});var p=new d;t.jsPlumb=p;p.getInstance=function(t,e){var n=new d(t);if(e){for(var i in e){n[i]=e[i]}}n.init();return n};p.each=function(t,e){if(t==null){return}if(typeof t==="string"){e(p.getElement(t))}else if(t.length!=null){for(var n=0;n<t.length;n++){e(p.getElement(t[n]))}}else{e(t)}};{e.jsPlumb=p}}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumb,n=t.jsPlumbUtil;var i="__label",r=function(t,n){var r={cssClass:n.cssClass,labelStyle:t.labelStyle,id:i,component:t,_jsPlumb:t._jsPlumb.instance},o=e.extend(r,n);return new(e.Overlays[t._jsPlumb.instance.getRenderMode()].Label)(o)},o=function(t,i){var r=null;if(n.isArray(i)){var o=i[0],s=e.extend({component:t,_jsPlumb:t._jsPlumb.instance},i[1]);if(i.length===3){e.extend(s,i[2])}r=new(e.Overlays[t._jsPlumb.instance.getRenderMode()][o])(s)}else if(i.constructor===String){r=new(e.Overlays[t._jsPlumb.instance.getRenderMode()][i])({component:t,_jsPlumb:t._jsPlumb.instance})}else{r=i}r.id=r.id||n.uuid();t.cacheTypeItem("overlay",r,r.id);t._jsPlumb.overlays[r.id]=r;return r};e.OverlayCapableJsPlumbUIComponent=function(e){t.jsPlumbUIComponent.apply(this,arguments);this._jsPlumb.overlays={};this._jsPlumb.overlayPositions={};if(e.label){this.getDefaultType().overlays[i]=["Label",{label:e.label,location:e.labelLocation||this.defaultLabelLocation||.5,labelStyle:e.labelStyle||this._jsPlumb.instance.Defaults.LabelStyle,id:i}]}this.setListenerComponent=function(t){if(this._jsPlumb){for(var e in this._jsPlumb.overlays){this._jsPlumb.overlays[e].setListenerComponent(t)}}}};e.OverlayCapableJsPlumbUIComponent.applyType=function(t,e){if(e.overlays){var n={},i;for(i in e.overlays){var r=t._jsPlumb.overlays[e.overlays[i][1].id];if(r){r.updateFrom(e.overlays[i][1]);n[e.overlays[i][1].id]=true;r.reattach(t._jsPlumb.instance,t)}else{var o=t.getCachedTypeItem("overlay",e.overlays[i][1].id);if(o!=null){o.reattach(t._jsPlumb.instance,t);o.setVisible(true);o.updateFrom(e.overlays[i][1]);t._jsPlumb.overlays[o.id]=o}else{o=t.addOverlay(e.overlays[i],true)}n[o.id]=true}}for(i in t._jsPlumb.overlays){if(n[t._jsPlumb.overlays[i].id]==null){t.removeOverlay(t._jsPlumb.overlays[i].id,true)}}}};n.extend(e.OverlayCapableJsPlumbUIComponent,t.jsPlumbUIComponent,{setHover:function(t,e){if(this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()){for(var n in this._jsPlumb.overlays){this._jsPlumb.overlays[n][t?"addClass":"removeClass"](this._jsPlumb.instance.hoverClass)}}},addOverlay:function(t,e){var i=o(this,t);if(this.getData&&i.type==="Label"&&n.isArray(t)){var r=this.getData(),s=t[1];if(r){var a=s.labelLocationAttribute||"labelLocation";var l=r?r[a]:null;if(l){i.loc=l}}}if(!e){this.repaint()}return i},getOverlay:function(t){return this._jsPlumb.overlays[t]},getOverlays:function(){return this._jsPlumb.overlays},hideOverlay:function(t){var e=this.getOverlay(t);if(e){e.hide()}},hideOverlays:function(){for(var t in this._jsPlumb.overlays){this._jsPlumb.overlays[t].hide()}},showOverlay:function(t){var e=this.getOverlay(t);if(e){e.show()}},showOverlays:function(){for(var t in this._jsPlumb.overlays){this._jsPlumb.overlays[t].show()}},removeAllOverlays:function(t){for(var e in this._jsPlumb.overlays){if(this._jsPlumb.overlays[e].cleanup){this._jsPlumb.overlays[e].cleanup()}}this._jsPlumb.overlays={};this._jsPlumb.overlayPositions=null;this._jsPlumb.overlayPlacements={};if(!t){this.repaint()}},removeOverlay:function(t,e){var n=this._jsPlumb.overlays[t];if(n){n.setVisible(false);if(!e&&n.cleanup){n.cleanup()}delete this._jsPlumb.overlays[t];if(this._jsPlumb.overlayPositions){delete this._jsPlumb.overlayPositions[t]}if(this._jsPlumb.overlayPlacements){delete this._jsPlumb.overlayPlacements[t]}}},removeOverlays:function(){for(var t=0,e=arguments.length;t<e;t++){this.removeOverlay(arguments[t])}},moveParent:function(t){if(this.bgCanvas){this.bgCanvas.parentNode.removeChild(this.bgCanvas);t.appendChild(this.bgCanvas)}if(this.canvas&&this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas);t.appendChild(this.canvas);for(var e in this._jsPlumb.overlays){if(this._jsPlumb.overlays[e].isAppendedAtTopLevel){var n=this._jsPlumb.overlays[e].getElement();n.parentNode.removeChild(n);t.appendChild(n)}}}},getLabel:function(){var t=this.getOverlay(i);return t!=null?t.getLabel():null},getLabelOverlay:function(){return this.getOverlay(i)},setLabel:function(t){var e=this.getOverlay(i);if(!e){var n=t.constructor===String||t.constructor===Function?{label:t}:t;e=r(this,n);this._jsPlumb.overlays[i]=e}else{if(t.constructor===String||t.constructor===Function){e.setLabel(t)}else{if(t.label){e.setLabel(t.label)}if(t.location){e.setLocation(t.location)}}}if(!this._jsPlumb.instance.isSuspendDrawing()){this.repaint()}},cleanup:function(t){for(var e in this._jsPlumb.overlays){this._jsPlumb.overlays[e].cleanup(t);this._jsPlumb.overlays[e].destroy(t)}if(t){this._jsPlumb.overlays={};this._jsPlumb.overlayPositions=null}},setVisible:function(t){this[t?"showOverlays":"hideOverlays"]()},setAbsoluteOverlayPosition:function(t,e){this._jsPlumb.overlayPositions[t.id]=e},getAbsoluteOverlayPosition:function(t){return this._jsPlumb.overlayPositions?this._jsPlumb.overlayPositions[t.id]:null},_clazzManip:function(t,e,n){if(!n){for(var i in this._jsPlumb.overlays){this._jsPlumb.overlays[i][t+"Class"](e)}}},addClass:function(t,e){this._clazzManip("add",t,e)},removeClass:function(t,e){this._clazzManip("remove",t,e)}})}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumb,n=t.jsPlumbUtil;var i=function(t,e,n){var i=false;return{drag:function(){if(i){i=false;return true}if(e.element){var r=n.getUIPosition(arguments,n.getZoom());if(r!=null){n.setPosition(e.element,r)}n.repaint(e.element,r);t.paint({anchorPoint:t.anchor.getCurrentLocation({element:t})})}},stopDrag:function(){i=true}}};var r=function(t,e,n,i){var r=e.createElement("div",{position:"absolute"});e.appendElement(r);var o=e.getId(r);e.setPosition(r,n);r.style.width=i[0]+"px";r.style.height=i[1]+"px";e.manage(o,r,true);t.id=o;t.element=r};var o=function(t,n,i,r,o,s,a,l){var u=new e.FloatingAnchor({reference:n,referenceCanvas:r,jsPlumbInstance:s});return a({paintStyle:t,endpoint:i,anchor:u,source:o,scope:l})};var s=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"];var a=function(t,e){var n=0;if(e!=null){for(var i=0;i<t.connections.length;i++){if(t.connections[i].sourceId===e||t.connections[i].targetId===e){n=i;break}}}return t.connections[n]};e.Endpoint=function(t){var l=t._jsPlumb,u=t.newConnection,c=t.newEndpoint;this.idPrefix="_jsplumb_e_";this.defaultLabelLocation=[.5,.5];this.defaultOverlayKeys=["Overlays","EndpointOverlays"];e.OverlayCapableJsPlumbUIComponent.apply(this,arguments);this.appendToDefaultType({connectionType:t.connectionType,maxConnections:t.maxConnections==null?this._jsPlumb.instance.Defaults.MaxConnections:t.maxConnections,paintStyle:t.endpointStyle||t.paintStyle||t.style||this._jsPlumb.instance.Defaults.EndpointStyle||e.Defaults.EndpointStyle,hoverPaintStyle:t.endpointHoverStyle||t.hoverPaintStyle||this._jsPlumb.instance.Defaults.EndpointHoverStyle||e.Defaults.EndpointHoverStyle,connectorStyle:t.connectorStyle,connectorHoverStyle:t.connectorHoverStyle,connectorClass:t.connectorClass,connectorHoverClass:t.connectorHoverClass,connectorOverlays:t.connectorOverlays,connector:t.connector,connectorTooltip:t.connectorTooltip});this._jsPlumb.enabled=!(t.enabled===false);this._jsPlumb.visible=true;this.element=e.getElement(t.source);this._jsPlumb.uuid=t.uuid;this._jsPlumb.floatingEndpoint=null;if(this._jsPlumb.uuid){t.endpointsByUUID[this._jsPlumb.uuid]=this}this.elementId=t.elementId;this.dragProxy=t.dragProxy;this._jsPlumb.connectionCost=t.connectionCost;this._jsPlumb.connectionsDirected=t.connectionsDirected;this._jsPlumb.currentAnchorClass="";this._jsPlumb.events={};var h=t.deleteOnEmpty===true;this.setDeleteOnEmpty=function(t){h=t};var f=function(){var t=l.endpointAnchorClassPrefix+"-"+this._jsPlumb.currentAnchorClass;this._jsPlumb.currentAnchorClass=this.anchor.getCssClass();var n=l.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"");this.removeClass(t);this.addClass(n);e.updateClasses(this.element,n,t)}.bind(this);this.prepareAnchor=function(t){var e=this._jsPlumb.instance.makeAnchor(t,this.elementId,l);e.bind("anchorChanged",function(t){this.fire("anchorChanged",{endpoint:this,anchor:t});f()}.bind(this));return e};this.setPreparedAnchor=function(t,e){this._jsPlumb.instance.continuousAnchorFactory.clear(this.elementId);this.anchor=t;f();if(!e){this._jsPlumb.instance.repaint(this.elementId)}return this};this.setAnchor=function(t,e){var n=this.prepareAnchor(t);this.setPreparedAnchor(n,e);return this};var d=function(t){if(this.connections.length>0){for(var e=0;e<this.connections.length;e++){this.connections[e].setHover(t,false)}}else{this.setHover(t)}}.bind(this);this.bind("mouseover",(function(){d(true)}));this.bind("mouseout",(function(){d(false)}));if(!t._transient){this._jsPlumb.instance.router.addEndpoint(this,this.elementId)}this.prepareEndpoint=function(i,r){var o=function(t,n){var i=l.getRenderMode();if(e.Endpoints[i][t]){return new e.Endpoints[i][t](n)}if(!l.Defaults.DoNotThrowErrors){throw{msg:"jsPlumb: unknown endpoint type '"+t+"'"}}};var s={_jsPlumb:this._jsPlumb.instance,cssClass:t.cssClass,container:t.container,tooltip:t.tooltip,connectorTooltip:t.connectorTooltip,endpoint:this};var a;if(n.isString(i)){a=o(i,s)}else if(n.isArray(i)){s=n.merge(i[1],s);a=o(i[0],s)}else{a=i.clone()}a.clone=function(){if(n.isString(i)){return o(i,s)}else if(n.isArray(i)){s=n.merge(i[1],s);return o(i[0],s)}}.bind(this);a.typeId=r;return a};this.setEndpoint=function(t,e){var n=this.prepareEndpoint(t);this.setPreparedEndpoint(n,true)};this.setPreparedEndpoint=function(t,e){if(this.endpoint!=null){this.endpoint.cleanup();this.endpoint.destroy()}this.endpoint=t;this.type=this.endpoint.type;this.canvas=this.endpoint.canvas};e.extend(this,t,s);this.isSource=t.isSource||false;this.isTemporarySource=t.isTemporarySource||false;this.isTarget=t.isTarget||false;this.connections=t.connections||[];this.connectorPointerEvents=t["connector-pointer-events"];this.scope=t.scope||l.getDefaultScope();this.timestamp=null;this.reattachConnections=t.reattach||l.Defaults.ReattachConnections;this.connectionsDetachable=l.Defaults.ConnectionsDetachable;if(t.connectionsDetachable===false||t.detachable===false){this.connectionsDetachable=false}this.dragAllowedWhenFull=t.dragAllowedWhenFull!==false;if(t.onMaxConnections){this.bind("maxConnections",t.onMaxConnections)}this.addConnection=function(t){this.connections.push(t);this[(this.connections.length>0?"add":"remove")+"Class"](l.endpointConnectedClass);this[(this.isFull()?"add":"remove")+"Class"](l.endpointFullClass)};this.detachFromConnection=function(t,e,n){e=e==null?this.connections.indexOf(t):e;if(e>=0){this.connections.splice(e,1);this[(this.connections.length>0?"add":"remove")+"Class"](l.endpointConnectedClass);this[(this.isFull()?"add":"remove")+"Class"](l.endpointFullClass)}if(!n&&h&&this.connections.length===0){l.deleteObject({endpoint:this,fireEvent:false,deleteAttachedObjects:n!==true})}};this.deleteEveryConnection=function(t){var e=this.connections.length;for(var n=0;n<e;n++){l.deleteConnection(this.connections[0],t)}};this.detachFrom=function(t,e,n){var i=[];for(var r=0;r<this.connections.length;r++){if(this.connections[r].endpoints[1]===t||this.connections[r].endpoints[0]===t){i.push(this.connections[r])}}for(var o=0,s=i.length;o<s;o++){l.deleteConnection(i[0])}return this};this.getElement=function(){return this.element};this.setElement=function(i){var r=this._jsPlumb.instance.getId(i),o=this.elementId;n.removeWithFunction(t.endpointsByElement[this.elementId],function(t){return t.id===this.id}.bind(this));this.element=e.getElement(i);this.elementId=l.getId(this.element);l.router.rehomeEndpoint(this,o,this.element);l.dragManager.endpointAdded(this.element);n.addToList(t.endpointsByElement,r,this);return this};this.makeInPlaceCopy=function(){var e=this.anchor.getCurrentLocation({element:this}),n=this.anchor.getOrientation(this),i=this.anchor.getCssClass(),r={bind:function(){},compute:function(){return[e[0],e[1]]},getCurrentLocation:function(){return[e[0],e[1]]},getOrientation:function(){return n},getCssClass:function(){return i}};return c({dropOptions:t.dropOptions,anchor:r,source:this.element,paintStyle:this.getPaintStyle(),endpoint:t.hideOnDrag?"Blank":this.endpoint,_transient:true,scope:this.scope,reference:this})};this.connectorSelector=function(){return this.connections[0]};this.setStyle=this.setPaintStyle;this.paint=function(t){t=t||{};var e=t.timestamp,n=!(t.recalc===false);if(!e||this.timestamp!==e){var i=l.updateOffset({elId:this.elementId,timestamp:e});var r=t.offset?t.offset.o:i.o;if(r!=null){var o=t.anchorPoint,s=t.connectorPaintStyle;if(o==null){var u=t.dimensions||i.s,c={xy:[r.left,r.top],wh:u,element:this,timestamp:e};if(n&&this.anchor.isDynamic&&this.connections.length>0){var h=a(this,t.elementWithPrecedence),f=h.endpoints[0]===this?1:0,d=f===0?h.sourceId:h.targetId,p=l.getCachedData(d),v=p.o,g=p.s;c.index=f===0?1:0;c.connection=h;c.txy=[v.left,v.top];c.twh=g;c.tElement=h.endpoints[f];c.tRotation=l.getRotation(d)}else if(this.connections.length>0){c.connection=this.connections[0]}c.rotation=l.getRotation(this.elementId);o=this.anchor.compute(c)}this.endpoint.compute(o,this.anchor.getOrientation(this),this._jsPlumb.paintStyleInUse,s||this.paintStyleInUse);this.endpoint.paint(this._jsPlumb.paintStyleInUse,this.anchor);this.timestamp=e;for(var m in this._jsPlumb.overlays){if(this._jsPlumb.overlays.hasOwnProperty(m)){var y=this._jsPlumb.overlays[m];if(y.isVisible()){this._jsPlumb.overlayPlacements[m]=y.draw(this.endpoint,this._jsPlumb.paintStyleInUse);y.paint(this._jsPlumb.overlayPlacements[m])}}}}}};this.getTypeDescriptor=function(){return"endpoint"};this.isVisible=function(){return this._jsPlumb.visible};this.repaint=this.paint;var p=false;this.initDraggable=function(){if(!p&&e.isDragSupported(this.element)){var s={id:null,element:null},a=null,h=false,f=null,d=i(this,s,l),v=t.dragOptions||{},g={},m=e.dragEvents.start,y=e.dragEvents.stop,b=e.dragEvents.drag,x=e.dragEvents.beforeStart,P;var _=function(t){P=t.e.payload||{}};var C=function(n){a=this.connectorSelector();var i=true;if(!this.isEnabled()){i=false}if(a==null&&!this.isSource&&!this.isTemporarySource){i=false}if(this.isSource&&this.isFull()&&!(a!=null&&this.dragAllowedWhenFull)){i=false}if(a!=null&&!a.isDetachable(this)){if(this.isFull()){i=false}else{a=null}}var p=l.checkCondition(a==null?"beforeDrag":"beforeStartDetach",{endpoint:this,source:this.element,sourceId:this.elementId,connection:a});if(p===false){i=false}else if(typeof p==="object"){e.extend(p,P||{})}else{p=P||{}}if(i===false){if(l.stopDrag){l.stopDrag(this.canvas)}d.stopDrag();return false}for(var v=0;v<this.connections.length;v++){this.connections[v].setHover(false)}this.addClass("endpointDrag");l.setConnectionBeingDragged(true);if(a&&!this.isFull()&&this.isSource){a=null}l.updateOffset({elId:this.elementId});var g=this._jsPlumb.instance.getOffset(this.canvas),m=this.canvas,y=this._jsPlumb.instance.getSize(this.canvas);r(s,l,g,y);l.setAttributes(this.canvas,{dragId:s.id,elId:this.elementId});var b=this.dragProxy||this.endpoint;if(this.dragProxy==null&&this.connectionType!=null){var x=this._jsPlumb.instance.deriveEndpointAndAnchorSpec(this.connectionType);if(x.endpoints[1]){b=x.endpoints[1]}}var _=this._jsPlumb.instance.makeAnchor("Center");_.isFloating=true;this._jsPlumb.floatingEndpoint=o(this.getPaintStyle(),_,b,this.canvas,s.element,l,c,this.scope);var C=this._jsPlumb.floatingEndpoint.anchor;if(a==null){this.setHover(false,false);a=u({sourceEndpoint:this,targetEndpoint:this._jsPlumb.floatingEndpoint,source:this.element,target:s.element,anchors:[this.anchor,this._jsPlumb.floatingEndpoint.anchor],paintStyle:t.connectorStyle,hoverPaintStyle:t.connectorHoverStyle,connector:t.connector,overlays:t.connectorOverlays,type:this.connectionType,cssClass:this.connectorClass,hoverClass:this.connectorHoverClass,scope:t.scope,data:p});a.pending=true;a.addClass(l.draggingClass);this._jsPlumb.floatingEndpoint.addClass(l.draggingClass);this._jsPlumb.floatingEndpoint.anchor=C;l.fire("connectionDrag",a);l.router.newConnection(a)}else{h=true;a.setHover(false);var w=a.endpoints[0].id===this.id?0:1;this.detachFromConnection(a,null,true);var j=l.getDragScope(m);l.setAttribute(this.canvas,"originalScope",j);l.fire("connectionDrag",a);if(w===0){f=[a.source,a.sourceId,m,j];l.router.sourceOrTargetChanged(a.endpoints[w].elementId,s.id,a,s.element,0)}else{f=[a.target,a.targetId,m,j];l.router.sourceOrTargetChanged(a.endpoints[w].elementId,s.id,a,s.element,1)}a.suspendedEndpoint=a.endpoints[w];a.suspendedElement=a.endpoints[w].getElement();a.suspendedElementId=a.endpoints[w].elementId;a.suspendedElementType=w===0?"source":"target";a.suspendedEndpoint.setHover(false);this._jsPlumb.floatingEndpoint.referenceEndpoint=a.suspendedEndpoint;a.endpoints[w]=this._jsPlumb.floatingEndpoint;a.addClass(l.draggingClass);this._jsPlumb.floatingEndpoint.addClass(l.draggingClass)}l.registerFloatingConnection(s,a,this._jsPlumb.floatingEndpoint);l.currentlyDragging=true}.bind(this);var w=function(){l.setConnectionBeingDragged(false);if(a&&a.endpoints!=null){var t=l.getDropEvent(arguments);var e=l.getFloatingAnchorIndex(a);a.endpoints[e===0?1:0].anchor.locked=false;a.removeClass(l.draggingClass);if(this._jsPlumb&&(a.deleteConnectionNow||a.endpoints[e]===this._jsPlumb.floatingEndpoint)){if(h&&a.suspendedEndpoint){if(e===0){a.floatingElement=a.source;a.floatingId=a.sourceId;a.floatingEndpoint=a.endpoints[0];a.floatingIndex=0;a.source=f[0];a.sourceId=f[1]}else{a.floatingElement=a.target;a.floatingId=a.targetId;a.floatingEndpoint=a.endpoints[1];a.floatingIndex=1;a.target=f[0];a.targetId=f[1]}var n=this._jsPlumb.floatingEndpoint;l.setDragScope(f[2],f[3]);a.endpoints[e]=a.suspendedEndpoint;if(a.isReattach()||a._forceReattach||a._forceDetach||!l.deleteConnection(a,{originalEvent:t})){a.setHover(false);a._forceDetach=null;a._forceReattach=null;this._jsPlumb.floatingEndpoint.detachFromConnection(a);a.suspendedEndpoint.addConnection(a);if(e===1){l.router.sourceOrTargetChanged(a.floatingId,a.targetId,a,a.target,e)}else{l.router.sourceOrTargetChanged(a.floatingId,a.sourceId,a,a.source,e)}l.repaint(f[1])}else{l.deleteObject({endpoint:n})}}}if(this.deleteAfterDragStop){l.deleteObject({endpoint:this})}else{if(this._jsPlumb){this.paint({recalc:false})}}l.fire("connectionDragStop",a,t);if(a.pending){l.fire("connectionAborted",a,t)}l.currentlyDragging=false;a.suspendedElement=null;a.suspendedEndpoint=null;a=null}if(s&&s.element){l.remove(s.element,false,false)}if(this._jsPlumb){this.canvas.style.visibility="visible";this.anchor.locked=false;this._jsPlumb.floatingEndpoint=null}}.bind(this);v=e.extend(g,v);v.scope=this.scope||v.scope;v[x]=n.wrap(v[x],_,false);v[m]=n.wrap(v[m],C,false);v[b]=n.wrap(v[b],d.drag);v[y]=n.wrap(v[y],w);v.multipleDrop=false;v.canDrag=function(){return this.isSource||this.isTemporarySource||this.connections.length>0&&this.connectionsDetachable!==false}.bind(this);l.initDraggable(this.canvas,v,"internal");this.canvas._jsPlumbRelatedElement=this.element;p=true}};var v=t.endpoint||this._jsPlumb.instance.Defaults.Endpoint||e.Defaults.Endpoint;this.setEndpoint(v,true);var g=t.anchor?t.anchor:t.anchors?t.anchors:l.Defaults.Anchor||"Top";this.setAnchor(g,true);var m=["default",t.type||""].join(" ");this.addType(m,t.data,true);this.canvas=this.endpoint.canvas;this.canvas._jsPlumb=this;this.initDraggable();var y=function(i,r,o,s){if(e.isDropSupported(this.element)){var a=t.dropOptions||l.Defaults.DropOptions||e.Defaults.DropOptions;a=e.extend({},a);a.scope=a.scope||this.scope;var u=e.dragEvents.drop,c=e.dragEvents.over,h=e.dragEvents.out,f=this,d=l.EndpointDropHandler({getEndpoint:function(){return f},jsPlumb:l,enabled:function(){return o!=null?o.isEnabled():true},isFull:function(){return o.isFull()},element:this.element,elementId:this.elementId,isSource:this.isSource,isTarget:this.isTarget,addClass:function(t){f.addClass(t)},removeClass:function(t){f.removeClass(t)},isDropAllowed:function(){return f.isDropAllowed.apply(f,arguments)},reference:s,isRedrop:function(t,e){return t.suspendedEndpoint&&e.reference&&t.suspendedEndpoint.id===e.reference.id}});a[u]=n.wrap(a[u],d,true);a[c]=n.wrap(a[c],function(){var t=e.getDragObject(arguments),n=l.getAttribute(e.getElement(t),"dragId"),i=l.getFloatingConnectionFor(n);if(i!=null){var r=l.getFloatingAnchorIndex(i);var o=this.isTarget&&r!==0||i.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===i.suspendedEndpoint.id;if(o){var s=l.checkCondition("checkDropAllowed",{sourceEndpoint:i.endpoints[r],targetEndpoint:this,connection:i});this[(s?"add":"remove")+"Class"](l.endpointDropAllowedClass);this[(s?"remove":"add")+"Class"](l.endpointDropForbiddenClass);i.endpoints[r].anchor.over(this.anchor,this)}}}.bind(this));a[h]=n.wrap(a[h],function(){var t=e.getDragObject(arguments),n=t==null?null:l.getAttribute(e.getElement(t),"dragId"),i=n?l.getFloatingConnectionFor(n):null;if(i!=null){var r=l.getFloatingAnchorIndex(i);var o=this.isTarget&&r!==0||i.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===i.suspendedEndpoint.id;if(o){this.removeClass(l.endpointDropAllowedClass);this.removeClass(l.endpointDropForbiddenClass);i.endpoints[r].anchor.out()}}}.bind(this));l.initDroppable(i,a,"internal",r)}}.bind(this);if(!this.anchor.isFloating){y(this.canvas,!(t._transient||this.anchor.isFloating),this,t.reference)}return this};n.extend(e.Endpoint,e.OverlayCapableJsPlumbUIComponent,{setVisible:function(t,e,n){this._jsPlumb.visible=t;if(this.canvas){this.canvas.style.display=t?"block":"none"}this[t?"showOverlays":"hideOverlays"]();if(!e){for(var i=0;i<this.connections.length;i++){this.connections[i].setVisible(t);if(!n){var r=this===this.connections[i].endpoints[0]?1:0;if(this.connections[i].endpoints[r].connections.length===1){this.connections[i].endpoints[r].setVisible(t,true,true)}}}}},getAttachedElements:function(){return this.connections},applyType:function(t,n){this.setPaintStyle(t.endpointStyle||t.paintStyle,n);this.setHoverPaintStyle(t.endpointHoverStyle||t.hoverPaintStyle,n);if(t.maxConnections!=null){this._jsPlumb.maxConnections=t.maxConnections}if(t.scope){this.scope=t.scope}e.extend(this,t,s);if(t.cssClass!=null&&this.canvas){this._jsPlumb.instance.addClass(this.canvas,t.cssClass)}e.OverlayCapableJsPlumbUIComponent.applyType(this,t)},isEnabled:function(){return this._jsPlumb.enabled},setEnabled:function(t){this._jsPlumb.enabled=t},cleanup:function(){var t=this._jsPlumb.instance.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"");e.removeClass(this.element,t);this.anchor=null;this.endpoint.cleanup(true);this.endpoint.destroy();this.endpoint=null;this._jsPlumb.instance.destroyDraggable(this.canvas,"internal");this._jsPlumb.instance.destroyDroppable(this.canvas,"internal")},setHover:function(t){if(this.endpoint&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()){this.endpoint.setHover(t)}},isFull:function(){return this._jsPlumb.maxConnections===0?true:!(this.isFloating()||this._jsPlumb.maxConnections<0||this.connections.length<this._jsPlumb.maxConnections)},isFloating:function(){return this.anchor!=null&&this.anchor.isFloating},isConnectedTo:function(t){var e=false;if(t){for(var n=0;n<this.connections.length;n++){if(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t){e=true;break}}}return e},getConnectionCost:function(){return this._jsPlumb.connectionCost},setConnectionCost:function(t){this._jsPlumb.connectionCost=t},areConnectionsDirected:function(){return this._jsPlumb.connectionsDirected},setConnectionsDirected:function(t){this._jsPlumb.connectionsDirected=t},setElementId:function(t){this.elementId=t;this.anchor.elementId=t},setReferenceElement:function(t){this.element=e.getElement(t)},setDragAllowedWhenFull:function(t){this.dragAllowedWhenFull=t},equals:function(t){return this.anchor.equals(t.anchor)},getUuid:function(){return this._jsPlumb.uuid},computeAnchor:function(t){return this.anchor.compute(t)}});t.jsPlumbInstance.prototype.EndpointDropHandler=function(t){return function(e){var i=t.jsPlumb;t.removeClass(i.endpointDropAllowedClass);t.removeClass(i.endpointDropForbiddenClass);var r=i.getDropEvent(arguments),o=i.getDragObject(arguments),s=i.getAttribute(o,"dragId"),a=i.getAttribute(o,"elId"),l=i.getAttribute(o,"originalScope"),u=i.getFloatingConnectionFor(s);if(u==null){return}var c=u.suspendedEndpoint!=null;if(c&&u.suspendedEndpoint._jsPlumb==null){return}var h=t.getEndpoint(u);if(h==null){return}if(t.isRedrop(u,t)){u._forceReattach=true;u.setHover(false);if(t.maybeCleanup){t.maybeCleanup(h)}return}var f=i.getFloatingAnchorIndex(u);if(f===0&&!t.isSource||f===1&&!t.isTarget){if(t.maybeCleanup){t.maybeCleanup(h)}return}if(t.onDrop){t.onDrop(u)}if(l){i.setDragScope(o,l)}var d=t.isFull(e);if(d){h.fire("maxConnections",{endpoint:this,connection:u,maxConnections:h._jsPlumb.maxConnections},r)}if(!d&&t.enabled()){var p=true;if(f===0){u.floatingElement=u.source;u.floatingId=u.sourceId;u.floatingEndpoint=u.endpoints[0];u.floatingIndex=0;u.source=t.element;u.sourceId=i.getId(t.element)}else{u.floatingElement=u.target;u.floatingId=u.targetId;u.floatingEndpoint=u.endpoints[1];u.floatingIndex=1;u.target=t.element;u.targetId=i.getId(t.element)}if(c&&u.suspendedEndpoint.id!==h.id){if(!u.isDetachAllowed(u)||!u.endpoints[f].isDetachAllowed(u)||!u.suspendedEndpoint.isDetachAllowed(u)||!i.checkCondition("beforeDetach",u)){p=false}}var v=function(e){u.endpoints[f].detachFromConnection(u);if(u.suspendedEndpoint){u.suspendedEndpoint.detachFromConnection(u)}u.endpoints[f]=h;h.addConnection(u);var o=h.getParameters();for(var s in o){u.setParameter(s,o[s])}if(!c){if(o.draggable){i.initDraggable(this.element,t.dragOptions,"internal",i)}}else{var a=u.suspendedEndpoint.elementId;i.fireMoveEvent({index:f,originalSourceId:f===0?a:u.sourceId,newSourceId:f===0?h.elementId:u.sourceId,originalTargetId:f===1?a:u.targetId,newTargetId:f===1?h.elementId:u.targetId,originalSourceEndpoint:f===0?u.suspendedEndpoint:u.endpoints[0],newSourceEndpoint:f===0?h:u.endpoints[0],originalTargetEndpoint:f===1?u.suspendedEndpoint:u.endpoints[1],newTargetEndpoint:f===1?h:u.endpoints[1],connection:u},r)}if(f===1){i.router.sourceOrTargetChanged(u.floatingId,u.targetId,u,u.target,1)}else{i.router.sourceOrTargetChanged(u.floatingId,u.sourceId,u,u.source,0)}if(u.endpoints[0].finalEndpoint){var l=u.endpoints[0];l.detachFromConnection(u);u.endpoints[0]=u.endpoints[0].finalEndpoint;u.endpoints[0].addConnection(u)}if(n.isObject(e)){u.mergeData(e)}i.finaliseConnection(u,null,r,false);u.setHover(false);i.revalidate(u.endpoints[0].element)}.bind(this);var g=function(){if(u.suspendedEndpoint){u.endpoints[f]=u.suspendedEndpoint;u.setHover(false);u._forceDetach=true;if(f===0){u.source=u.suspendedEndpoint.element;u.sourceId=u.suspendedEndpoint.elementId}else{u.target=u.suspendedEndpoint.element;u.targetId=u.suspendedEndpoint.elementId}u.suspendedEndpoint.addConnection(u);if(f===1){i.router.sourceOrTargetChanged(u.floatingId,u.targetId,u,u.target,1)}else{i.router.sourceOrTargetChanged(u.floatingId,u.sourceId,u,u.source,0)}i.repaint(u.sourceId);u._forceDetach=false}};p=p&&t.isDropAllowed(u.sourceId,u.targetId,u.scope,u,h);if(p){v(p);return true}else{g()}}if(t.maybeCleanup){t.maybeCleanup(h)}i.currentlyDragging=false}}}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumb,n=t.jsPlumbUtil;var i=function(t,i,r,o,s){e.Connectors[i]=e.Connectors[i]||{};if(e.Connectors[i][r]==null){if(e.Connectors[r]==null){if(!t.Defaults.DoNotThrowErrors){throw new TypeError("jsPlumb: unknown connector type '"+r+"'")}else{return null}}e.Connectors[i][r]=function(){e.Connectors[r].apply(this,arguments);e.ConnectorRenderers[i].apply(this,arguments)};n.extend(e.Connectors[i][r],[e.Connectors[r],e.ConnectorRenderers[i]])}return new e.Connectors[i][r](o,s)},r=function(t,e,n){return t?n.makeAnchor(t,e,n):null},o=function(t,e,i,r){if(e!=null){e._jsPlumbConnections=e._jsPlumbConnections||{};if(r){delete e._jsPlumbConnections[t.id]}else{e._jsPlumbConnections[t.id]=true}if(n.isEmpty(e._jsPlumbConnections)){i.removeClass(e,i.connectedClass)}else{i.addClass(e,i.connectedClass)}}};e.Connection=function(t){var i=t.newEndpoint;this.id=t.id;this.connector=null;this.idPrefix="_jsplumb_c_";this.defaultLabelLocation=.5;this.defaultOverlayKeys=["Overlays","ConnectionOverlays"];this.previousConnection=t.previousConnection;this.source=e.getElement(t.source);this.target=e.getElement(t.target);e.OverlayCapableJsPlumbUIComponent.apply(this,arguments);if(t.sourceEndpoint){this.source=t.sourceEndpoint.getElement();this.sourceId=t.sourceEndpoint.elementId}else{this.sourceId=this._jsPlumb.instance.getId(this.source)}if(t.targetEndpoint){this.target=t.targetEndpoint.getElement();this.targetId=t.targetEndpoint.elementId}else{this.targetId=this._jsPlumb.instance.getId(this.target)}this.scope=t.scope;this.endpoints=[];this.endpointStyles=[];var r=this._jsPlumb.instance;r.manage(this.sourceId,this.source);r.manage(this.targetId,this.target);this._jsPlumb.visible=true;this._jsPlumb.params={cssClass:t.cssClass,container:t.container,"pointer-events":t["pointer-events"],editorParams:t.editorParams,overlays:t.overlays};this._jsPlumb.lastPaintedAt=null;this.bind("mouseover",function(){this.setHover(true)}.bind(this));this.bind("mouseout",function(){this.setHover(false)}.bind(this));this.makeEndpoint=function(e,n,o,s,a){o=o||this._jsPlumb.instance.getId(n);return this.prepareEndpoint(r,i,this,s,e?0:1,t,n,o,a)};if(t.type){t.endpoints=t.endpoints||this._jsPlumb.instance.deriveEndpointAndAnchorSpec(t.type).endpoints}var o=this.makeEndpoint(true,this.source,this.sourceId,t.sourceEndpoint),s=this.makeEndpoint(false,this.target,this.targetId,t.targetEndpoint);if(o){n.addToList(t.endpointsByElement,this.sourceId,o)}if(s){n.addToList(t.endpointsByElement,this.targetId,s)}if(!this.scope){this.scope=this.endpoints[0].scope}if(t.deleteEndpointsOnEmpty!=null){this.endpoints[0].setDeleteOnEmpty(t.deleteEndpointsOnEmpty);this.endpoints[1].setDeleteOnEmpty(t.deleteEndpointsOnEmpty)}var a=r.Defaults.ConnectionsDetachable;if(t.detachable===false){a=false}if(this.endpoints[0].connectionsDetachable===false){a=false}if(this.endpoints[1].connectionsDetachable===false){a=false}var l=t.reattach||this.endpoints[0].reattachConnections||this.endpoints[1].reattachConnections||r.Defaults.ReattachConnections;this.appendToDefaultType({detachable:a,reattach:l,paintStyle:this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||t.paintStyle||r.Defaults.PaintStyle||e.Defaults.PaintStyle,hoverPaintStyle:this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||t.hoverPaintStyle||r.Defaults.HoverPaintStyle||e.Defaults.HoverPaintStyle});var u=r.getSuspendedAt();if(!r.isSuspendDrawing()){var c=r.getCachedData(this.sourceId),h=c.o,f=c.s,d=r.getCachedData(this.targetId),p=d.o,v=d.s,g=u||jsPlumbUtil.uuid(),m=this.endpoints[0].anchor.compute({xy:[h.left,h.top],wh:f,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[p.left,p.top],twh:v,tElement:this.endpoints[1],timestamp:g,rotation:r.getRotation(this.endpoints[0].elementId)});this.endpoints[0].paint({anchorLoc:m,timestamp:g});m=this.endpoints[1].anchor.compute({xy:[p.left,p.top],wh:v,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[h.left,h.top],twh:f,tElement:this.endpoints[0],timestamp:g,rotation:r.getRotation(this.endpoints[1].elementId)});this.endpoints[1].paint({anchorLoc:m,timestamp:g})}this.getTypeDescriptor=function(){return"connection"};this.getAttachedElements=function(){return this.endpoints};this.isDetachable=function(t){return this._jsPlumb.detachable===false?false:t!=null?t.connectionsDetachable===true:this._jsPlumb.detachable===true};this.setDetachable=function(t){this._jsPlumb.detachable=t===true};this.isReattach=function(){return this._jsPlumb.reattach===true||this.endpoints[0].reattachConnections===true||this.endpoints[1].reattachConnections===true};this.setReattach=function(t){this._jsPlumb.reattach=t===true};this._jsPlumb.cost=t.cost||this.endpoints[0].getConnectionCost();this._jsPlumb.directed=t.directed;if(t.directed==null){this._jsPlumb.directed=this.endpoints[0].areConnectionsDirected()}var y=e.extend({},this.endpoints[1].getParameters());e.extend(y,this.endpoints[0].getParameters());e.extend(y,this.getParameters());this.setParameters(y);this.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||t.connector||r.Defaults.Connector||e.Defaults.Connector,true);var b=t.data==null||!n.isObject(t.data)?{}:t.data;this.getData=function(){return b};this.setData=function(t){b=t||{}};this.mergeData=function(t){b=e.extend(b,t)};var x=["default",this.endpoints[0].connectionType,this.endpoints[1].connectionType,t.type].join(" ");if(/[^\s]/.test(x)){this.addType(x,t.data,true)}this.updateConnectedClass()};n.extend(e.Connection,e.OverlayCapableJsPlumbUIComponent,{applyType:function(t,n,i){var r=null;if(t.connector!=null){r=this.getCachedTypeItem("connector",i.connector);if(r==null){r=this.prepareConnector(t.connector,i.connector);this.cacheTypeItem("connector",r,i.connector)}this.setPreparedConnector(r)}if(t.detachable!=null){this.setDetachable(t.detachable)}if(t.reattach!=null){this.setReattach(t.reattach)}if(t.scope){this.scope=t.scope}if(t.cssClass!=null&&this.canvas){this._jsPlumb.instance.addClass(this.canvas,t.cssClass)}var o=null;if(t.anchor){o=this.getCachedTypeItem("anchors",i.anchor);if(o==null){o=[this._jsPlumb.instance.makeAnchor(t.anchor),this._jsPlumb.instance.makeAnchor(t.anchor)];this.cacheTypeItem("anchors",o,i.anchor)}}else if(t.anchors){o=this.getCachedTypeItem("anchors",i.anchors);if(o==null){o=[this._jsPlumb.instance.makeAnchor(t.anchors[0]),this._jsPlumb.instance.makeAnchor(t.anchors[1])];this.cacheTypeItem("anchors",o,i.anchors)}}if(o!=null){this.endpoints[0].anchor=o[0];this.endpoints[1].anchor=o[1];if(this.endpoints[1].anchor.isDynamic){this._jsPlumb.instance.repaint(this.endpoints[1].elementId)}}e.OverlayCapableJsPlumbUIComponent.applyType(this,t)},addClass:function(t,e){if(e){this.endpoints[0].addClass(t);this.endpoints[1].addClass(t);if(this.suspendedEndpoint){this.suspendedEndpoint.addClass(t)}}if(this.connector){this.connector.addClass(t)}},removeClass:function(t,e){if(e){this.endpoints[0].removeClass(t);this.endpoints[1].removeClass(t);if(this.suspendedEndpoint){this.suspendedEndpoint.removeClass(t)}}if(this.connector){this.connector.removeClass(t)}},isVisible:function(){return this._jsPlumb.visible},setVisible:function(t){this._jsPlumb.visible=t;if(this.connector){this.connector.setVisible(t)}this.repaint()},cleanup:function(){this.updateConnectedClass(true);this.endpoints=null;this.source=null;this.target=null;if(this.connector!=null){this.connector.cleanup(true);this.connector.destroy(true)}this.connector=null},updateConnectedClass:function(t){if(this._jsPlumb){o(this,this.source,this._jsPlumb.instance,t);o(this,this.target,this._jsPlumb.instance,t)}},setHover:function(e){if(this.connector&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()){this.connector.setHover(e);t.jsPlumb[e?"addClass":"removeClass"](this.source,this._jsPlumb.instance.hoverSourceClass);t.jsPlumb[e?"addClass":"removeClass"](this.target,this._jsPlumb.instance.hoverTargetClass)}},getUuids:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]},getCost:function(){return this._jsPlumb?this._jsPlumb.cost:-Infinity},setCost:function(t){this._jsPlumb.cost=t},isDirected:function(){return this._jsPlumb.directed},getConnector:function(){return this.connector},prepareConnector:function(t,e){var r={_jsPlumb:this._jsPlumb.instance,cssClass:this._jsPlumb.params.cssClass,container:this._jsPlumb.params.container,"pointer-events":this._jsPlumb.params["pointer-events"]},o=this._jsPlumb.instance.getRenderMode(),s;if(n.isString(t)){s=i(this._jsPlumb.instance,o,t,r,this)}else if(n.isArray(t)){if(t.length===1){s=i(this._jsPlumb.instance,o,t[0],r,this)}else{s=i(this._jsPlumb.instance,o,t[0],n.merge(t[1],r),this)}}if(e!=null){s.typeId=e}return s},setPreparedConnector:function(t,e,n,i){if(this.connector!==t){var r,o="";if(this.connector!=null){r=this.connector;o=r.getClass();this.connector.cleanup();this.connector.destroy()}this.connector=t;if(i){this.cacheTypeItem("connector",t,i)}this.canvas=this.connector.canvas;this.bgCanvas=this.connector.bgCanvas;this.connector.reattach(this._jsPlumb.instance);this.addClass(o);if(this.canvas){this.canvas._jsPlumb=this}if(this.bgCanvas){this.bgCanvas._jsPlumb=this}if(r!=null){var s=this.getOverlays();for(var a=0;a<s.length;a++){if(s[a].transfer){s[a].transfer(this.connector)}}}if(!n){this.setListenerComponent(this.connector)}if(!e){this.repaint()}}},setConnector:function(t,e,n,i){var r=this.prepareConnector(t,i);this.setPreparedConnector(r,e,n,i)},paint:function(t){if(!this._jsPlumb.instance.isSuspendDrawing()&&this._jsPlumb.visible){t=t||{};var e=t.timestamp,n=false,i=n?this.sourceId:this.targetId,r=n?this.targetId:this.sourceId,o=n?0:1,s=n?1:0;if(e==null||e!==this._jsPlumb.lastPaintedAt){var a=this._jsPlumb.instance.updateOffset({elId:r}).o,l=this._jsPlumb.instance.updateOffset({elId:i}).o,u=this.endpoints[s],c=this.endpoints[o];var h=u.anchor.getCurrentLocation({xy:[a.left,a.top],wh:[a.width,a.height],element:u,timestamp:e,rotation:this._jsPlumb.instance.getRotation(this.sourceId)}),f=c.anchor.getCurrentLocation({xy:[l.left,l.top],wh:[l.width,l.height],element:c,timestamp:e,rotation:this._jsPlumb.instance.getRotation(this.targetId)});this.connector.resetBounds();this.connector.compute({sourcePos:h,targetPos:f,sourceOrientation:u.anchor.getOrientation(u),targetOrientation:c.anchor.getOrientation(c),sourceEndpoint:this.endpoints[s],targetEndpoint:this.endpoints[o],"stroke-width":this._jsPlumb.paintStyleInUse.strokeWidth,sourceInfo:a,targetInfo:l});var d={minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};for(var p in this._jsPlumb.overlays){if(this._jsPlumb.overlays.hasOwnProperty(p)){var v=this._jsPlumb.overlays[p];if(v.isVisible()){this._jsPlumb.overlayPlacements[p]=v.draw(this.connector,this._jsPlumb.paintStyleInUse,this.getAbsoluteOverlayPosition(v));d.minX=Math.min(d.minX,this._jsPlumb.overlayPlacements[p].minX);d.maxX=Math.max(d.maxX,this._jsPlumb.overlayPlacements[p].maxX);d.minY=Math.min(d.minY,this._jsPlumb.overlayPlacements[p].minY);d.maxY=Math.max(d.maxY,this._jsPlumb.overlayPlacements[p].maxY)}}}var g=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||1)/2,m=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||0),y={xmin:Math.min(this.connector.bounds.minX-(g+m),d.minX),ymin:Math.min(this.connector.bounds.minY-(g+m),d.minY),xmax:Math.max(this.connector.bounds.maxX+(g+m),d.maxX),ymax:Math.max(this.connector.bounds.maxY+(g+m),d.maxY)};this.connector.paintExtents=y;this.connector.paint(this._jsPlumb.paintStyleInUse,null,y);for(var b in this._jsPlumb.overlays){if(this._jsPlumb.overlays.hasOwnProperty(b)){var x=this._jsPlumb.overlays[b];if(x.isVisible()){x.paint(this._jsPlumb.overlayPlacements[b],y)}}}}this._jsPlumb.lastPaintedAt=e}},repaint:function(t){var e=jsPlumb.extend(t||{},{});e.elId=this.sourceId;this.paint(e)},prepareEndpoint:function(t,n,i,o,s,a,l,u,c){var h;if(o){i.endpoints[s]=o;o.addConnection(i)}else{if(!a.endpoints){a.endpoints=[null,null]}var f=c||a.endpoints[s]||a.endpoint||t.Defaults.Endpoints[s]||e.Defaults.Endpoints[s]||t.Defaults.Endpoint||e.Defaults.Endpoint;if(!a.endpointStyles){a.endpointStyles=[null,null]}if(!a.endpointHoverStyles){a.endpointHoverStyles=[null,null]}var d=a.endpointStyles[s]||a.endpointStyle||t.Defaults.EndpointStyles[s]||e.Defaults.EndpointStyles[s]||t.Defaults.EndpointStyle||e.Defaults.EndpointStyle;if(d.fill==null&&a.paintStyle!=null){d.fill=a.paintStyle.stroke}if(d.outlineStroke==null&&a.paintStyle!=null){d.outlineStroke=a.paintStyle.outlineStroke}if(d.outlineWidth==null&&a.paintStyle!=null){d.outlineWidth=a.paintStyle.outlineWidth}var p=a.endpointHoverStyles[s]||a.endpointHoverStyle||t.Defaults.EndpointHoverStyles[s]||e.Defaults.EndpointHoverStyles[s]||t.Defaults.EndpointHoverStyle||e.Defaults.EndpointHoverStyle;if(a.hoverPaintStyle!=null){if(p==null){p={}}if(p.fill==null){p.fill=a.hoverPaintStyle.stroke}}var v=a.anchors?a.anchors[s]:a.anchor?a.anchor:r(t.Defaults.Anchors[s],u,t)||r(e.Defaults.Anchors[s],u,t)||r(t.Defaults.Anchor,u,t)||r(e.Defaults.Anchor,u,t),g=a.uuids?a.uuids[s]:null;h=n({paintStyle:d,hoverPaintStyle:p,endpoint:f,connections:[i],uuid:g,anchor:v,source:l,scope:a.scope,reattach:a.reattach||t.Defaults.ReattachConnections,detachable:a.detachable||t.Defaults.ConnectionsDetachable});if(o==null){h.setDeleteOnEmpty(true)}i.endpoints[s]=h;if(a.drawEndpoints===false){h.setVisible(false,true,true)}}return h},replaceEndpoint:function(t,e){var n=this.endpoints[t],i=n.elementId,r=this._jsPlumb.instance.getEndpoints(i),o=r.indexOf(n),s=this.makeEndpoint(t===0,n.element,i,null,e);this.endpoints[t]=s;r.splice(o,1,s);this._jsPlumb.instance.deleteObject({endpoint:n,deleteAttachedObjects:false});this._jsPlumb.instance.fire("endpointReplaced",{previous:n,current:s});this._jsPlumb.instance.router.sourceOrTargetChanged(this.endpoints[1].elementId,this.endpoints[1].elementId,this,this.endpoints[1].element,1)}})}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumbUtil,n=t.jsPlumb;n.AnchorManager=function(t){var i={},r={},o={},s={},a=this,l={},u=t.jsPlumbInstance,c={},h=function(t,e,n,i,r,o,s,a){var l=[],u=e[r?0:1]/(i.length+1);for(var c=0;c<i.length;c++){var h=(c+1)*u,f=o*e[r?1:0];if(s){h=e[r?0:1]-h}var d=r?h:f,p=n.left+d,v=d/e[0],g=r?f:h,m=n.top+g,y=g/e[1];if(a!==0){var b=jsPlumbUtil.rotatePoint([p,m],[n.centerx,n.centery],a);p=b[0];m=b[1]}l.push([p,m,v,y,i[c][1],i[c][2]])}return l},f=function(t,e){return e[0][0]-t[0][0]},d=function(t,e){var n=t[0][0]<0?-Math.PI-t[0][0]:Math.PI-t[0][0],i=e[0][0]<0?-Math.PI-e[0][0]:Math.PI-e[0][0];return n-i},p={top:d,right:f,bottom:f,left:d},v=function(t,e){return t.sort(e)},g=function(t,e){var n=u.getCachedData(t),i=n.s,s=n.o,a=function(e,n,i,s,a,l,c){if(s.length>0){var f=v(s,p[e]),d=e==="right"||e==="top",g=u.getRotation(t),m=h(e,n,i,f,a,l,d,g);var y=function(t,e){r[t.id]=[e[0],e[1],e[2],e[3]];o[t.id]=c};for(var b=0;b<m.length;b++){var x=m[b][4],P=x.endpoints[0].elementId===t,_=x.endpoints[1].elementId===t;if(P){y(x.endpoints[0],m[b])}if(_){y(x.endpoints[1],m[b])}}}};a("bottom",i,s,e.bottom,true,1,[0,1]);a("top",i,s,e.top,true,0,[0,-1]);a("left",i,s,e.left,false,0,[-1,0]);a("right",i,s,e.right,false,1,[1,0])};this.reset=function(){i={};s={};l={}};this.addFloatingConnection=function(t,e){c[t]=e};this.newConnection=function(t){var i=t.sourceId,r=t.targetId,o=t.endpoints,a=true,l=function(l,u,c,h,f){if(i===r&&c.isContinuous){t._jsPlumb.instance.removeElement(o[1].canvas);a=false}e.addToList(s,h,[f,u,c.constructor===n.DynamicAnchor])};l(0,o[0],o[0].anchor,r,t);if(a){l(1,o[1],o[1].anchor,i,t)}};var m=function(t){(function(t,n){if(t){var i=function(t){return t[4]===n};e.removeWithFunction(t.top,i);e.removeWithFunction(t.left,i);e.removeWithFunction(t.bottom,i);e.removeWithFunction(t.right,i)}})(l[t.elementId],t.id)};this.connectionDetached=function(t,n){var i=t.connection||t,r=t.sourceId,o=t.targetId,l=i.endpoints,u=function(t,n,i,r,o){e.removeWithFunction(s[r],(function(t){return t[0].id===o.id}))};u(1,l[1],l[1].anchor,r,i);u(0,l[0],l[0].anchor,o,i);if(i.floatingId){u(i.floatingIndex,i.floatingEndpoint,i.floatingEndpoint.anchor,i.floatingId,i);m(i.floatingEndpoint)}m(i.endpoints[0]);m(i.endpoints[1]);if(!n){a.redraw(i.sourceId);if(i.targetId!==i.sourceId){a.redraw(i.targetId)}}};this.addEndpoint=function(t,n){e.addToList(i,n,t)};this.changeId=function(t,e){s[e]=s[t];i[e]=i[t];delete s[t];delete i[t]};this.getConnectionsFor=function(t){return s[t]||[]};this.getEndpointsFor=function(t){return i[t]||[]};this.deleteEndpoint=function(t){e.removeWithFunction(i[t.elementId],(function(e){return e.id===t.id}));m(t)};this.elementRemoved=function(t){delete c[t];delete i[t];i[t]=[]};var y=function(n,i,r,o,s,a,l,u,c,h,f,d){var p=-1,v=o.endpoints[l],g=v.id,m=[1,0][l],y=[[i,r],o,s,a,g],b=n[c],x=v._continuousAnchorEdge?n[v._continuousAnchorEdge]:null,P,_;if(x){var C=e.findWithFunction(x,(function(t){return t[4]===g}));if(C!==-1){x.splice(C,1);for(P=0;P<x.length;P++){_=x[P][1];e.addWithFunction(f,_,(function(t){return t.id===_.id}));e.addWithFunction(d,x[P][1].endpoints[l],(function(t){return t.id===_.endpoints[l].id}));e.addWithFunction(d,x[P][1].endpoints[m],(function(t){return t.id===_.endpoints[m].id}))}}}for(P=0;P<b.length;P++){_=b[P][1];if(t.idx===1&&b[P][3]===a&&p===-1){p=P}e.addWithFunction(f,_,(function(t){return t.id===_.id}));e.addWithFunction(d,b[P][1].endpoints[l],(function(t){return t.id===_.endpoints[l].id}));e.addWithFunction(d,b[P][1].endpoints[m],(function(t){return t.id===_.endpoints[m].id}))}{var w=u?p!==-1?p:0:b.length;b.splice(w,0,y)}v._continuousAnchorEdge=c};this.sourceOrTargetChanged=function(t,i,r,o,a){if(a===0){if(t!==i){r.sourceId=i;r.source=o;e.removeWithFunction(s[t],(function(t){return t[0].id===r.id}));var l=e.findWithFunction(s[r.targetId],(function(t){return t[0].id===r.id}));if(l>-1){s[r.targetId][l][0]=r;s[r.targetId][l][1]=r.endpoints[0];s[r.targetId][l][2]=r.endpoints[0].anchor.constructor===n.DynamicAnchor}e.addToList(s,i,[r,r.endpoints[1],r.endpoints[1].anchor.constructor===n.DynamicAnchor]);if(r.endpoints[1].anchor.isContinuous){if(r.source===r.target){r._jsPlumb.instance.removeElement(r.endpoints[1].canvas)}else{if(r.endpoints[1].canvas.parentNode==null){r._jsPlumb.instance.appendElement(r.endpoints[1].canvas)}}}r.updateConnectedClass()}}else if(a===1){var u=r.endpoints[0].elementId;r.target=o;r.targetId=i;var c=e.findWithFunction(s[u],(function(t){return t[0].id===r.id})),h=e.findWithFunction(s[t],(function(t){return t[0].id===r.id}));if(c!==-1){s[u][c][0]=r;s[u][c][1]=r.endpoints[1];s[u][c][2]=r.endpoints[1].anchor.constructor===n.DynamicAnchor}if(h>-1){s[t].splice(h,1);e.addToList(s,i,[r,r.endpoints[0],r.endpoints[0].anchor.constructor===n.DynamicAnchor])}r.updateConnectedClass()}};this.rehomeEndpoint=function(t,e,n){var r=i[e]||[],o=u.getId(n);if(o!==e){var s=r.indexOf(t);if(s>-1){var l=r.splice(s,1)[0];a.add(l,o)}}for(var c=0;c<t.connections.length;c++){if(t.connections[c].sourceId===e){a.sourceOrTargetChanged(e,t.elementId,t.connections[c],t.element,0)}else if(t.connections[c].targetId===e){a.sourceOrTargetChanged(e,t.elementId,t.connections[c],t.element,1)}}};this.redraw=function(t,r,o,a,h,f){var d=[],p=[],v=[];if(!u.isSuspendDrawing()){var m=i[t]||[],b=s[t]||[];o=o||jsPlumbUtil.uuid();a=a||{left:0,top:0};if(r){r={left:r.left+a.left,top:r.top+a.top}}var x=u.updateOffset({elId:t,offset:r,recalc:false,timestamp:o}),P={};for(var _=0;_<b.length;_++){var C=b[_][0],w=C.sourceId,j=C.targetId,E=C.endpoints[0].anchor.isContinuous,D=C.endpoints[1].anchor.isContinuous;if(E||D){var S=w+"_"+j,k=P[S],A=C.sourceId===t?1:0,I=u.getRotation(j),T=u.getRotation(w);if(E&&!l[w]){l[w]={top:[],right:[],bottom:[],left:[]}}if(D&&!l[j]){l[j]={top:[],right:[],bottom:[],left:[]}}if(t!==j){u.updateOffset({elId:j,timestamp:o})}if(t!==w){u.updateOffset({elId:w,timestamp:o})}var O=u.getCachedData(j),M=u.getCachedData(w);if(j===w&&(E||D)){y(l[w],-Math.PI/2,0,C,false,j,0,false,"top",w,d,p);y(l[j],-Math.PI/2,0,C,false,w,1,false,"top",j,d,p)}else{if(!k){k=this.calculateOrientation(w,j,M.o,O.o,C.endpoints[0].anchor,C.endpoints[1].anchor,C,T,I);P[S]=k}if(E){y(l[w],k.theta,0,C,false,j,0,false,k.a[0],w,d,p)}if(D){y(l[j],k.theta2,-1,C,true,w,1,true,k.a[1],j,d,p)}}if(E){e.addWithFunction(v,w,(function(t){return t===w}))}if(D){e.addWithFunction(v,j,(function(t){return t===j}))}e.addWithFunction(d,C,(function(t){return t.id===C.id}));if(E&&A===0||D&&A===1){e.addWithFunction(p,C.endpoints[A],(function(t){return t.id===C.endpoints[A].id}))}}}for(_=0;_<m.length;_++){if(m[_].connections.length===0&&m[_].anchor.isContinuous){if(!l[t]){l[t]={top:[],right:[],bottom:[],left:[]}}y(l[t],-Math.PI/2,0,{endpoints:[m[_],m[_]],paint:function(){}},false,t,0,false,m[_].anchor.getDefaultFace(),t,d,p);e.addWithFunction(v,t,(function(e){return e===t}))}}for(_=0;_<v.length;_++){g(v[_],l[v[_]])}for(_=0;_<m.length;_++){m[_].paint({timestamp:o,offset:x,dimensions:x.s,recalc:f!==true})}for(_=0;_<p.length;_++){var L=u.getCachedData(p[_].elementId);p[_].paint({timestamp:null,offset:L,dimensions:L.s})}for(_=0;_<b.length;_++){var F=b[_][1];if(F.anchor.constructor===n.DynamicAnchor){F.paint({elementWithPrecedence:t,timestamp:o});e.addWithFunction(d,b[_][0],(function(t){return t.id===b[_][0].id}));for(var N=0;N<F.connections.length;N++){if(F.connections[N]!==b[_][0]){e.addWithFunction(d,F.connections[N],(function(t){return t.id===F.connections[N].id}))}}}else{e.addWithFunction(d,b[_][0],(function(t){return t.id===b[_][0].id}))}}var H=c[t];if(H){H.paint({timestamp:o,recalc:false,elId:t})}for(_=0;_<d.length;_++){d[_].paint({elId:t,timestamp:null,recalc:false,clearEdits:h})}}return{c:d,e:p}};var b=function(t){e.EventGenerator.apply(this);this.type="Continuous";this.isDynamic=true;this.isContinuous=true;var n=t.faces||["top","right","bottom","left"],i=!(t.clockwise===false),s={},a={top:"bottom",right:"left",left:"right",bottom:"top"},l={top:"right",right:"bottom",left:"top",bottom:"left"},u={top:"left",right:"top",left:"bottom",bottom:"right"},c=i?l:u,h=i?u:l,f=t.cssClass||"",d=null,p=null,v=["left","right"],g=["top","bottom"],m=null;for(var y=0;y<n.length;y++){s[n[y]]=true}this.getDefaultFace=function(){return n.length===0?"top":n[0]};this.isRelocatable=function(){return true};this.isSnapOnRelocate=function(){return true};this.verifyEdge=function(t){if(s[t]){return t}else if(s[a[t]]){return a[t]}else if(s[c[t]]){return c[t]}else if(s[h[t]]){return h[t]}return t};this.isEdgeSupported=function(t){return m==null?p==null?s[t]===true:p===t:m.indexOf(t)!==-1};this.setCurrentFace=function(t,e){d=t;if(e&&p!=null){p=d}};this.getCurrentFace=function(){return d};this.getSupportedFaces=function(){var t=[];for(var e in s){if(s[e]){t.push(e)}}return t};this.lock=function(){p=d};this.unlock=function(){p=null};this.isLocked=function(){return p!=null};this.lockCurrentAxis=function(){if(d!=null){m=d==="left"||d==="right"?v:g}};this.unlockCurrentAxis=function(){m=null};this.compute=function(t){return r[t.element.id]||[0,0]};this.getCurrentLocation=function(t){return r[t.element.id]||[0,0]};this.getOrientation=function(t){return o[t.id]||[0,0]};this.getCssClass=function(){return f}};u.continuousAnchorFactory={get:function(t){return new b(t)},clear:function(t){delete r[t]}}};n.AnchorManager.prototype.calculateOrientation=function(t,e,n,i,r,o,s,a,l){var u={HORIZONTAL:"horizontal",VERTICAL:"vertical",DIAGONAL:"diagonal",IDENTITY:"identity"},c=["left","top","right","bottom"];if(t===e){return{orientation:u.IDENTITY,a:["top","top"]}}var h=Math.atan2(i.centery-n.centery,i.centerx-n.centerx),f=Math.atan2(n.centery-i.centery,n.centerx-i.centerx);var d=[],p={};(function(t,e){for(var n=0;n<t.length;n++){p[t[n]]={left:[e[n][0].left,e[n][0].centery],right:[e[n][0].right,e[n][0].centery],top:[e[n][0].centerx,e[n][0].top],bottom:[e[n][0].centerx,e[n][0].bottom]};if(e[n][1]!==0){for(var i in p[t[n]]){p[t[n]][i]=jsPlumbUtil.rotatePoint(p[t[n]][i],[e[n][0].centerx,e[n][0].centery],e[n][1])}}}})(["source","target"],[[n,a],[i,l]]);for(var v=0;v<c.length;v++){for(var g=0;g<c.length;g++){d.push({source:c[v],target:c[g],dist:Biltong.lineLength(p.source[c[v]],p.target[c[g]])})}}d.sort((function(t,e){return t.dist<e.dist?-1:t.dist>e.dist?1:0}));var m=d[0].source,y=d[0].target;for(var b=0;b<d.length;b++){if(r.isContinuous&&r.locked){m=r.getCurrentFace()}else if(!r.isContinuous||r.isEdgeSupported(d[b].source)){m=d[b].source}else{m=null}if(o.isContinuous&&o.locked){y=o.getCurrentFace()}else if(!o.isContinuous||o.isEdgeSupported(d[b].target)){y=d[b].target}else{y=null}if(m!=null&&y!=null){break}}if(r.isContinuous){r.setCurrentFace(m)}if(o.isContinuous){o.setCurrentFace(y)}return{a:[m,y],theta:h,theta2:f}};n.Anchor=function(t){this.x=t.x||0;this.y=t.y||0;this.elementId=t.elementId;this.cssClass=t.cssClass||"";this.orientation=t.orientation||[0,0];this.lastReturnValue=null;this.offsets=t.offsets||[0,0];this.timestamp=null;this._unrotatedOrientation=[this.orientation[0],this.orientation[1]];this.relocatable=t.relocatable!==false;this.snapOnRelocate=t.snapOnRelocate!==false;this.locked=false;e.EventGenerator.apply(this);this.compute=function(t){var e=t.xy,n=t.wh,i=t.timestamp;if(i&&i===this.timestamp){return this.lastReturnValue}var r=[e[0]+this.x*n[0]+this.offsets[0],e[1]+this.y*n[1]+this.offsets[1],this.x,this.y];var o=t.rotation;if(o!=null&&o!==0){var s=jsPlumbUtil.rotatePoint(r,[e[0]+n[0]/2,e[1]+n[1]/2],o);this.orientation[0]=Math.round(this._unrotatedOrientation[0]*s[2]-this._unrotatedOrientation[1]*s[3]);this.orientation[1]=Math.round(this._unrotatedOrientation[1]*s[2]+this._unrotatedOrientation[0]*s[3]);this.lastReturnValue=[s[0],s[1],this.x,this.y]}else{this.orientation[0]=this._unrotatedOrientation[0];this.orientation[1]=this._unrotatedOrientation[1];this.lastReturnValue=r}this.timestamp=i;return this.lastReturnValue};this.getCurrentLocation=function(t){t=t||{};return this.lastReturnValue==null||t.timestamp!=null&&this.timestamp!==t.timestamp?this.compute(t):this.lastReturnValue};this.setPosition=function(t,e,n,i,r){if(!this.locked||r){this.x=t;this.y=e;this.orientation=[n,i];this.lastReturnValue=null}}};e.extend(n.Anchor,e.EventGenerator,{equals:function(t){if(!t){return false}var e=t.getOrientation(),n=this.getOrientation();return this.x===t.x&&this.y===t.y&&this.offsets[0]===t.offsets[0]&&this.offsets[1]===t.offsets[1]&&n[0]===e[0]&&n[1]===e[1]},getOrientation:function(){return this.orientation},getCssClass:function(){return this.cssClass}});n.FloatingAnchor=function(t){n.Anchor.apply(this,arguments);var e=t.reference,i=t.referenceCanvas,r=n.getSize(i),o=0,s=0,a=null,l=null;this.orientation=null;this.x=0;this.y=0;this.isFloating=true;this.compute=function(t){var e=t.xy,n=[e[0]+r[0]/2,e[1]+r[1]/2];l=n;return n};this.getOrientation=function(t){if(a){return a}else{var n=e.getOrientation(t);return[Math.abs(n[0])*o*-1,Math.abs(n[1])*s*-1]}};this.over=function(t,e){a=t.getOrientation(e)};this.out=function(){a=null};this.getCurrentLocation=function(t){return l==null?this.compute(t):l}};e.extend(n.FloatingAnchor,n.Anchor);var i=function(t,e,i){return t.constructor===n.Anchor?t:e.makeAnchor(t,i,e)};n.DynamicAnchor=function(t){n.Anchor.apply(this,arguments);this.isDynamic=true;this.anchors=[];this.elementId=t.elementId;this.jsPlumbInstance=t.jsPlumbInstance;for(var e=0;e<t.anchors.length;e++){this.anchors[e]=i(t.anchors[e],this.jsPlumbInstance,this.elementId)}this.getAnchors=function(){return this.anchors};var r=this.anchors.length>0?this.anchors[0]:null,o=r,s=function(t,e,n,i,r,o,s){var a=i[0]+t.x*r[0],l=i[1]+t.y*r[1],u=i[0]+r[0]/2,c=i[1]+r[1]/2;if(o!=null&&o!==0){var h=jsPlumbUtil.rotatePoint([a,l],[u,c],o);a=h[0];l=h[1]}return Math.sqrt(Math.pow(e-a,2)+Math.pow(n-l,2))+Math.sqrt(Math.pow(u-a,2)+Math.pow(c-l,2))},a=t.selector||function(t,e,n,i,r,o,a){var l=n[0]+i[0]/2,u=n[1]+i[1]/2;var c=-1,h=Infinity;for(var f=0;f<a.length;f++){var d=s(a[f],l,u,t,e,r);if(d<h){c=f+0;h=d}}return a[c]};this.compute=function(t){var e=t.xy,n=t.wh,i=t.txy,s=t.twh,l=t.rotation,u=t.tRotation;this.timestamp=t.timestamp;if(this.locked||i==null||s==null){this.lastReturnValue=r.compute(t);return this.lastReturnValue}else{t.timestamp=null}r=a(e,n,i,s,l,u,this.anchors);this.x=r.x;this.y=r.y;if(r!==o){this.fire("anchorChanged",r)}o=r;this.lastReturnValue=r.compute(t);return this.lastReturnValue};this.getCurrentLocation=function(t){return r!=null?r.getCurrentLocation(t):null};this.getOrientation=function(t){return r!=null?r.getOrientation(t):[0,0]};this.over=function(t,e){if(r!=null){r.over(t,e)}};this.out=function(){if(r!=null){r.out()}};this.setAnchor=function(t){r=t};this.getCssClass=function(){return r&&r.getCssClass()||""};this.setAnchorCoordinates=function(t){var e=jsPlumbUtil.findWithFunction(this.anchors,(function(e){return e.x===t[0]&&e.y===t[1]}));if(e!==-1){this.setAnchor(this.anchors[e]);return true}else{return false}}};e.extend(n.DynamicAnchor,n.Anchor);var r=function(t,e,i,r,o,s){n.Anchors[o]=function(n){var a=n.jsPlumbInstance.makeAnchor([t,e,i,r,0,0],n.elementId,n.jsPlumbInstance);a.type=o;if(s){s(a,n)}return a}};r(.5,0,0,-1,"TopCenter");r(.5,1,0,1,"BottomCenter");r(0,.5,-1,0,"LeftMiddle");r(1,.5,1,0,"RightMiddle");r(.5,0,0,-1,"Top");r(.5,1,0,1,"Bottom");r(0,.5,-1,0,"Left");r(1,.5,1,0,"Right");r(.5,.5,0,0,"Center");r(1,0,0,-1,"TopRight");r(1,1,0,1,"BottomRight");r(0,0,0,-1,"TopLeft");r(0,1,0,1,"BottomLeft");n.Defaults.DynamicAnchors=function(t){return t.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],t.elementId,t.jsPlumbInstance)};n.Anchors.AutoDefault=function(t){var e=t.jsPlumbInstance.makeDynamicAnchor(n.Defaults.DynamicAnchors(t));e.type="AutoDefault";return e};var o=function(t,e){n.Anchors[t]=function(n){var i=n.jsPlumbInstance.makeAnchor(["Continuous",{faces:e}],n.elementId,n.jsPlumbInstance);i.type=t;return i}};n.Anchors.Continuous=function(t){return t.jsPlumbInstance.continuousAnchorFactory.get(t)};o("ContinuousLeft",["left"]);o("ContinuousTop",["top"]);o("ContinuousBottom",["bottom"]);o("ContinuousRight",["right"]);r(0,0,0,0,"Assign",(function(t,e){var n=e.position||"Fixed";t.positionFinder=n.constructor===String?e.jsPlumbInstance.AnchorPositionFinders[n]:n;t.constructorParams=e}));t.jsPlumbInstance.prototype.AnchorPositionFinders={Fixed:function(t,e,n){return[(t.left-e.left)/n[0],(t.top-e.top)/n[1]]},Grid:function(t,e,n,i){var r=t.left-e.left,o=t.top-e.top,s=n[0]/i.grid[0],a=n[1]/i.grid[1],l=Math.floor(r/s),u=Math.floor(o/a);return[(l*s+s/2)/n[0],(u*a+a/2)/n[1]]}};n.Anchors.Perimeter=function(t){t=t||{};var e=t.anchorCount||60,n=t.shape;if(!n){throw new Error("no shape supplied to Perimeter Anchor type")}var i=function(){var t=.5,n=Math.PI*2/e,i=0,r=[];for(var o=0;o<e;o++){var s=t+t*Math.sin(i),a=t+t*Math.cos(i);r.push([s,a,0,0]);i+=n}return r},r=function(t){var n=e/t.length,i=[],r=function(t,r,o,s,a,l,u){n=e*a;var c=(o-t)/n,h=(s-r)/n;for(var f=0;f<n;f++){i.push([t+c*f,r+h*f,l==null?0:l,u==null?0:u])}};for(var o=0;o<t.length;o++){r.apply(null,t[o])}return i},o=function(t){var e=[];for(var n=0;n<t.length;n++){e.push([t[n][0],t[n][1],t[n][2],t[n][3],1/t.length,t[n][4],t[n][5]])}return r(e)},s=function(){return o([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]])};var a={Circle:i,Ellipse:i,Diamond:function(){return o([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]])},Rectangle:s,Square:s,Triangle:function(){return o([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]])},Path:function(t){var e=t.points,n=[],i=0;for(var o=0;o<e.length-1;o++){var s=Math.sqrt(Math.pow(e[o][2]-e[o][0])+Math.pow(e[o][3]-e[o][1]));i+=s;n.push([e[o][0],e[o][1],e[o+1][0],e[o+1][1],s])}for(var a=0;a<n.length;a++){n[a][4]=n[a][4]/i}return r(n)}},l=function(t,e){var n=[],i=e/180*Math.PI;for(var r=0;r<t.length;r++){var o=t[r][0]-.5,s=t[r][1]-.5;n.push([.5+(o*Math.cos(i)-s*Math.sin(i)),.5+(o*Math.sin(i)+s*Math.cos(i)),t[r][2],t[r][3]])}return n};if(!a[n]){throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type")}var u=a[n](t);if(t.rotation){u=l(u,t.rotation)}var c=t.jsPlumbInstance.makeDynamicAnchor(u);c.type="Perimeter";return c}}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumb;e.DefaultRouter=function(t){this.jsPlumbInstance=t;this.anchorManager=new e.AnchorManager({jsPlumbInstance:t});this.sourceOrTargetChanged=function(t,e,n,i,r){this.anchorManager.sourceOrTargetChanged(t,e,n,i,r)};this.reset=function(){this.anchorManager.reset()};this.changeId=function(t,e){this.anchorManager.changeId(t,e)};this.elementRemoved=function(t){this.anchorManager.elementRemoved(t)};this.newConnection=function(t){this.anchorManager.newConnection(t)};this.connectionDetached=function(t,e){this.anchorManager.connectionDetached(t,e)};this.redraw=function(t,e,n,i,r,o){return this.anchorManager.redraw(t,e,n,i,r,o)};this.deleteEndpoint=function(t){this.anchorManager.deleteEndpoint(t)};this.rehomeEndpoint=function(t,e,n){this.anchorManager.rehomeEndpoint(t,e,n)};this.addEndpoint=function(t,e){this.anchorManager.addEndpoint(t,e)}}}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumb,n=t.jsPlumbUtil,i=t.Biltong;e.Segments={AbstractSegment:function(t){this.params=t;this.findClosestPointOnPath=function(t,e){return{d:Infinity,x:null,y:null,l:null}};this.getBounds=function(){return{minX:Math.min(t.x1,t.x2),minY:Math.min(t.y1,t.y2),maxX:Math.max(t.x1,t.x2),maxY:Math.max(t.y1,t.y2)}};this.lineIntersection=function(t,e,n,i){return[]};this.boxIntersection=function(t,e,n,i){var r=[];r.push.apply(r,this.lineIntersection(t,e,t+n,e));r.push.apply(r,this.lineIntersection(t+n,e,t+n,e+i));r.push.apply(r,this.lineIntersection(t+n,e+i,t,e+i));r.push.apply(r,this.lineIntersection(t,e+i,t,e));return r};this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.y)}},Straight:function(t){var n=e.Segments.AbstractSegment.apply(this,arguments),r,o,s,a,l,u,c,h=function(){r=Math.sqrt(Math.pow(l-a,2)+Math.pow(c-u,2));o=i.gradient({x:a,y:u},{x:l,y:c});s=-1/o};this.type="Straight";this.getLength=function(){return r};this.getGradient=function(){return o};this.getCoordinates=function(){return{x1:a,y1:u,x2:l,y2:c}};this.setCoordinates=function(t){a=t.x1;u=t.y1;l=t.x2;c=t.y2;h()};this.setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2});this.getBounds=function(){return{minX:Math.min(a,l),minY:Math.min(u,c),maxX:Math.max(a,l),maxY:Math.max(u,c)}};this.pointOnPath=function(t,e){if(t===0&&!e){return{x:a,y:u}}else if(t===1&&!e){return{x:l,y:c}}else{var n=e?t>0?t:r+t:t*r;return i.pointOnLine({x:a,y:u},{x:l,y:c},n)}};this.gradientAtPoint=function(t){return o};this.pointAlongPathFrom=function(t,e,n){var r=this.pointOnPath(t,n),o=e<=0?{x:a,y:u}:{x:l,y:c};if(e<=0&&Math.abs(e)>1){e*=-1}return i.pointOnLine(r,o,e)};var f=function(t,e,n){return n>=Math.min(t,e)&&n<=Math.max(t,e)};var d=function(t,e,n){return Math.abs(n-t)<Math.abs(n-e)?t:e};this.findClosestPointOnPath=function(t,e){var n={d:Infinity,x:null,y:null,l:null,x1:a,x2:l,y1:u,y2:c};if(o===0){n.y=u;n.x=f(a,l,t)?t:d(a,l,t)}else if(o===Infinity||o===-Infinity){n.x=a;n.y=f(u,c,e)?e:d(u,c,e)}else{var h=u-o*a,p=e-s*t,v=(p-h)/(o-s),g=o*v+h;n.x=f(a,l,v)?v:d(a,l,v);n.y=f(u,c,g)?g:d(u,c,g)}var m=i.lineLength([n.x,n.y],[a,u]);n.d=i.lineLength([t,e],[n.x,n.y]);n.l=m/r;return n};var p=function(t,e,n){return n>e?e<=t&&t<=n:e>=t&&t>=n},v=p;this.lineIntersection=function(t,e,n,r){var s=Math.abs(i.gradient({x:t,y:e},{x:n,y:r})),h=Math.abs(o),f=h===Infinity?a:u-h*a,d=[],p=s===Infinity?t:e-s*t;if(s!==h){if(s===Infinity&&h===0){if(v(t,a,l)&&v(u,e,r)){d=[t,u]}}else if(s===0&&h===Infinity){if(v(e,u,c)&&v(a,t,n)){d=[a,e]}}else{var g,m;if(s===Infinity){g=t;if(v(g,a,l)){m=h*t+f;if(v(m,e,r)){d=[g,m]}}}else if(s===0){m=e;if(v(m,u,c)){g=(e-f)/h;if(v(g,t,n)){d=[g,m]}}}else{g=(p-f)/(h-s);m=h*g+f;if(v(g,a,l)&&v(m,u,c)){d=[g,m]}}}}return d};this.boxIntersection=function(t,e,n,i){var r=[];r.push.apply(r,this.lineIntersection(t,e,t+n,e));r.push.apply(r,this.lineIntersection(t+n,e,t+n,e+i));r.push.apply(r,this.lineIntersection(t+n,e+i,t,e+i));r.push.apply(r,this.lineIntersection(t,e+i,t,e));return r};this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}},Arc:function(t){var n=e.Segments.AbstractSegment.apply(this,arguments),r=function(e,n){return i.theta([t.cx,t.cy],[e,n])},o=function(t,e){if(t.anticlockwise){var n=t.startAngle<t.endAngle?t.startAngle+s:t.startAngle,i=Math.abs(n-t.endAngle);return n-i*e}else{var r=t.endAngle<t.startAngle?t.endAngle+s:t.endAngle,o=Math.abs(r-t.startAngle);return t.startAngle+o*e}},s=2*Math.PI;this.radius=t.r;this.anticlockwise=t.ac;this.type="Arc";if(t.startAngle&&t.endAngle){this.startAngle=t.startAngle;this.endAngle=t.endAngle;this.x1=t.cx+this.radius*Math.cos(t.startAngle);this.y1=t.cy+this.radius*Math.sin(t.startAngle);this.x2=t.cx+this.radius*Math.cos(t.endAngle);this.y2=t.cy+this.radius*Math.sin(t.endAngle)}else{this.startAngle=r(t.x1,t.y1);this.endAngle=r(t.x2,t.y2);this.x1=t.x1;this.y1=t.y1;this.x2=t.x2;this.y2=t.y2}if(this.endAngle<0){this.endAngle+=s}if(this.startAngle<0){this.startAngle+=s}var a=this.endAngle<this.startAngle?this.endAngle+s:this.endAngle;this.sweep=Math.abs(a-this.startAngle);if(this.anticlockwise){this.sweep=s-this.sweep}var l=2*Math.PI*this.radius,u=this.sweep/s,c=l*u;this.getLength=function(){return c};this.getBounds=function(){return{minX:t.cx-t.r,maxX:t.cx+t.r,minY:t.cy-t.r,maxY:t.cy+t.r}};var h=1e-10,f=function(t){var e=Math.floor(t),n=Math.ceil(t);if(t-e<h){return e}else if(n-t<h){return n}return t};this.pointOnPath=function(e,n){if(e===0){return{x:this.x1,y:this.y1,theta:this.startAngle}}else if(e===1){return{x:this.x2,y:this.y2,theta:this.endAngle}}if(n){e=e/c}var i=o(this,e),r=t.cx+t.r*Math.cos(i),s=t.cy+t.r*Math.sin(i);return{x:f(r),y:f(s),theta:i}};this.gradientAtPoint=function(e,n){var r=this.pointOnPath(e,n);var o=i.normal([t.cx,t.cy],[r.x,r.y]);if(!this.anticlockwise&&(o===Infinity||o===-Infinity)){o*=-1}return o};this.pointAlongPathFrom=function(e,n,i){var r=this.pointOnPath(e,i),o=n/l*2*Math.PI,s=this.anticlockwise?-1:1,a=r.theta+s*o,u=t.cx+this.radius*Math.cos(a),c=t.cy+this.radius*Math.sin(a);return{x:u,y:c}}},Bezier:function(n){this.curve=[{x:n.x1,y:n.y1},{x:n.cp1x,y:n.cp1y},{x:n.cp2x,y:n.cp2y},{x:n.x2,y:n.y2}];var i=function(t){return t[0].x===t[1].x&&t[0].y===t[1].y};var r=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))};var o=function(t){var e={x:0,y:0};if(t===0){return this.curve[0]}var n=this.curve.length-1;if(t===1){return this.curve[n]}var i=this.curve;var r=1-t;if(n===0){return this.curve[0]}if(n===1){return{x:r*i[0].x+t*i[1].x,y:r*i[0].y+t*i[1].y}}if(n<4){var o=r*r,s=t*t,a=0,l,u,c;if(n===2){i=[i[0],i[1],i[2],e];l=o;u=2*(r*t);c=s}else if(n===3){l=o*r;u=3*(o*t);c=3*(r*s);a=t*s}return{x:l*i[0].x+u*i[1].x+c*i[2].x+a*i[3].x,y:l*i[0].y+u*i[1].y+c*i[2].y+a*i[3].y}}else{return e}}.bind(this);var s=function(t){var e=[];t--;for(var n=0;n<=t;n++){e.push(o(n/t))}return e};var a=function(){if(i(this.curve)){this.length=0}var t=16;var e=s(t);this.length=0;for(var n=0;n<t-1;n++){var o=e[n],a=e[n+1];this.length+=r(o,a)}}.bind(this);var l=e.Segments.AbstractSegment.apply(this,arguments);this.bounds={minX:Math.min(n.x1,n.x2,n.cp1x,n.cp2x),minY:Math.min(n.y1,n.y2,n.cp1y,n.cp2y),maxX:Math.max(n.x1,n.x2,n.cp1x,n.cp2x),maxY:Math.max(n.y1,n.y2,n.cp1y,n.cp2y)};this.type="Bezier";a();var u=function(e,n,i){if(i){n=t.jsBezier.locationAlongCurveFrom(e,n>0?0:1,n)}return n};this.pointOnPath=function(e,n){e=u(this.curve,e,n);return t.jsBezier.pointOnCurve(this.curve,e)};this.gradientAtPoint=function(e,n){e=u(this.curve,e,n);return t.jsBezier.gradientAtPoint(this.curve,e)};this.pointAlongPathFrom=function(e,n,i){e=u(this.curve,e,i);return t.jsBezier.pointAlongCurveFrom(this.curve,e,n)};this.getLength=function(){return this.length};this.getBounds=function(){return this.bounds};this.findClosestPointOnPath=function(e,n){var i=t.jsBezier.nearestPointOnCurve({x:e,y:n},this.curve);return{d:Math.sqrt(Math.pow(i.point.x-e,2)+Math.pow(i.point.y-n,2)),x:i.point.x,y:i.point.y,l:1-i.location,s:this}};this.lineIntersection=function(e,n,i,r){return t.jsBezier.lineIntersection(e,n,i,r,this.curve)}}};e.SegmentRenderer={getPath:function(t,e){return{Straight:function(e){var n=t.getCoordinates();return(e?"M "+n.x1+" "+n.y1+" ":"")+"L "+n.x2+" "+n.y2},Bezier:function(e){var n=t.params;return(e?"M "+n.x2+" "+n.y2+" ":"")+"C "+n.cp2x+" "+n.cp2y+" "+n.cp1x+" "+n.cp1y+" "+n.x1+" "+n.y1},Arc:function(e){var n=t.params,i=t.sweep>Math.PI?1:0,r=t.anticlockwise?0:1;return(e?"M"+t.x1+" "+t.y1+" ":"")+"A "+t.radius+" "+n.r+" 0 "+i+","+r+" "+t.x2+" "+t.y2}}[t.type](e)}};var r=function(){this.resetBounds=function(){this.bounds={minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}};this.resetBounds()};e.Connectors.AbstractConnector=function(t){r.apply(this,arguments);var o=[],s=0,a=[],l=[],u=t.stub||0,c=n.isArray(u)?u[0]:u,h=n.isArray(u)?u[1]:u,f=t.gap||0,d=n.isArray(f)?f[0]:f,p=n.isArray(f)?f[1]:f,v=null,g=null;this.getPathData=function(){var t="";for(var n=0;n<o.length;n++){t+=e.SegmentRenderer.getPath(o[n],n===0);t+=" "}return t};this.findSegmentForPoint=function(t,e){var n={d:Infinity,s:null,x:null,y:null,l:null};for(var i=0;i<o.length;i++){var r=o[i].findClosestPointOnPath(t,e);if(r.d<n.d){n.d=r.d;n.l=r.l;n.x=r.x;n.y=r.y;n.s=o[i];n.x1=r.x1;n.x2=r.x2;n.y1=r.y1;n.y2=r.y2;n.index=i;n.connectorLocation=a[i][0]+r.l*(a[i][1]-a[i][0])}}return n};this.lineIntersection=function(t,e,n,i){var r=[];for(var s=0;s<o.length;s++){r.push.apply(r,o[s].lineIntersection(t,e,n,i))}return r};this.boxIntersection=function(t,e,n,i){var r=[];for(var s=0;s<o.length;s++){r.push.apply(r,o[s].boxIntersection(t,e,n,i))}return r};this.boundingBoxIntersection=function(t){var e=[];for(var n=0;n<o.length;n++){e.push.apply(e,o[n].boundingBoxIntersection(t))}return e};var m=function(){var t=0;for(var e=0;e<o.length;e++){var n=o[e].getLength();l[e]=n/s;a[e]=[t,t+=n/s]}},y=function(t,e){var n,i,r;if(e){t=t>0?t/s:(s+t)/s}if(t===1){n=o.length-1;r=1}else if(t===0){r=0;n=0}else{if(t>=.5){n=0;r=0;for(i=a.length-1;i>-1;i--){if(a[i][1]>=t&&a[i][0]<=t){n=i;r=(t-a[i][0])/l[i];break}}}else{n=a.length-1;r=1;for(i=0;i<a.length;i++){if(a[i][1]>=t){n=i;r=(t-a[i][0])/l[i];break}}}}return{segment:o[n],proportion:r,index:n}},b=function(t,n,i){if(i.x1===i.x2&&i.y1===i.y2){return}var r=new e.Segments[n](i);o.push(r);s+=r.getLength();t.updateBounds(r)},x=function(){s=o.length=a.length=l.length=0};this.setSegments=function(t){v=[];s=0;for(var e=0;e<t.length;e++){v.push(t[e]);s+=t[e].getLength()}};this.getLength=function(){return s};var P=function(t){this.strokeWidth=t.strokeWidth;var e=i.quadrant(t.sourcePos,t.targetPos),n=t.targetPos[0]<t.sourcePos[0],r=t.targetPos[1]<t.sourcePos[1],o=t.strokeWidth||1,s=t.sourceEndpoint.anchor.getOrientation(t.sourceEndpoint),a=t.targetEndpoint.anchor.getOrientation(t.targetEndpoint),l=n?t.targetPos[0]:t.sourcePos[0],u=r?t.targetPos[1]:t.sourcePos[1],f=Math.abs(t.targetPos[0]-t.sourcePos[0]),v=Math.abs(t.targetPos[1]-t.sourcePos[1]);if(s[0]===0&&s[1]===0||a[0]===0&&a[1]===0){var g=f>v?0:1,m=[1,0][g];s=[];a=[];s[g]=t.sourcePos[g]>t.targetPos[g]?-1:1;a[g]=t.sourcePos[g]>t.targetPos[g]?1:-1;s[m]=0;a[m]=0}var y=n?f+d*s[0]:d*s[0],b=r?v+d*s[1]:d*s[1],x=n?p*a[0]:f+p*a[0],P=r?p*a[1]:v+p*a[1],_=s[0]*a[0]+s[1]*a[1];var C={sx:y,sy:b,tx:x,ty:P,lw:o,xSpan:Math.abs(x-y),ySpan:Math.abs(P-b),mx:(y+x)/2,my:(b+P)/2,so:s,to:a,x:l,y:u,w:f,h:v,segment:e,startStubX:y+s[0]*c,startStubY:b+s[1]*c,endStubX:x+a[0]*h,endStubY:P+a[1]*h,isXGreaterThanStubTimes2:Math.abs(y-x)>c+h,isYGreaterThanStubTimes2:Math.abs(b-P)>c+h,opposite:_===-1,perpendicular:_===0,orthogonal:_===1,sourceAxis:s[0]===0?"y":"x",points:[l,u,f,v,y,b,x,P],stubs:[c,h]};C.anchorOrientation=C.opposite?"opposite":C.orthogonal?"orthogonal":"perpendicular";return C};this.getSegments=function(){return o};this.updateBounds=function(t){var e=t.getBounds();this.bounds.minX=Math.min(this.bounds.minX,e.minX);this.bounds.maxX=Math.max(this.bounds.maxX,e.maxX);this.bounds.minY=Math.min(this.bounds.minY,e.minY);this.bounds.maxY=Math.max(this.bounds.maxY,e.maxY)};this.pointOnPath=function(t,e){var n=y(t,e);return n.segment&&n.segment.pointOnPath(n.proportion,false)||[0,0]};this.gradientAtPoint=function(t,e){var n=y(t,e);return n.segment&&n.segment.gradientAtPoint(n.proportion,false)||0};this.pointAlongPathFrom=function(t,e,n){var i=y(t,n);return i.segment&&i.segment.pointAlongPathFrom(i.proportion,e,false)||[0,0]};this.compute=function(t){g=P.call(this,t);x();this._compute(g,t);this.x=g.points[0];this.y=g.points[1];this.w=g.points[2];this.h=g.points[3];this.segment=g.segment;m()};return{addSegment:b,prepareCompute:P,sourceStub:c,targetStub:h,maxStub:Math.max(c,h),sourceGap:d,targetGap:p,maxGap:Math.max(d,p)}};n.extend(e.Connectors.AbstractConnector,r);e.Endpoints.AbstractEndpoint=function(t){r.apply(this,arguments);var e=this.compute=function(t,e,n,i){var r=this._compute.apply(this,arguments);this.x=r[0];this.y=r[1];this.w=r[2];this.h=r[3];this.bounds.minX=this.x;this.bounds.minY=this.y;this.bounds.maxX=this.x+this.w;this.bounds.maxY=this.y+this.h;return r};return{compute:e,cssClass:t.cssClass}};n.extend(e.Endpoints.AbstractEndpoint,r);e.Endpoints.Dot=function(t){this.type="Dot";var n=e.Endpoints.AbstractEndpoint.apply(this,arguments);t=t||{};this.radius=t.radius||10;this.defaultOffset=.5*this.radius;this.defaultInnerRadius=this.radius/3;this._compute=function(t,e,n,i){this.radius=n.radius||this.radius;var r=t[0]-this.radius,o=t[1]-this.radius,s=this.radius*2,a=this.radius*2;if(n.stroke){var l=n.strokeWidth||1;r-=l;o-=l;s+=l*2;a+=l*2}return[r,o,s,a,this.radius]}};n.extend(e.Endpoints.Dot,e.Endpoints.AbstractEndpoint);e.Endpoints.Rectangle=function(t){this.type="Rectangle";var n=e.Endpoints.AbstractEndpoint.apply(this,arguments);t=t||{};this.width=t.width||20;this.height=t.height||20;this._compute=function(t,e,n,i){var r=n.width||this.width,o=n.height||this.height,s=t[0]-r/2,a=t[1]-o/2;return[s,a,r,o]}};n.extend(e.Endpoints.Rectangle,e.Endpoints.AbstractEndpoint);var o=function(t){e.jsPlumbUIComponent.apply(this,arguments);this._jsPlumb.displayElements=[]};n.extend(o,e.jsPlumbUIComponent,{getDisplayElements:function(){return this._jsPlumb.displayElements},appendDisplayElement:function(t){this._jsPlumb.displayElements.push(t)}});e.Endpoints.Image=function(i){this.type="Image";o.apply(this,arguments);e.Endpoints.AbstractEndpoint.apply(this,arguments);var r=i.onload,s=i.src||i.url,a=i.cssClass?" "+i.cssClass:"";this._jsPlumb.img=new Image;this._jsPlumb.ready=false;this._jsPlumb.initialized=false;this._jsPlumb.deleted=false;this._jsPlumb.widthToUse=i.width;this._jsPlumb.heightToUse=i.height;this._jsPlumb.endpoint=i.endpoint;this._jsPlumb.img.onload=function(){if(this._jsPlumb!=null){this._jsPlumb.ready=true;this._jsPlumb.widthToUse=this._jsPlumb.widthToUse||this._jsPlumb.img.width;this._jsPlumb.heightToUse=this._jsPlumb.heightToUse||this._jsPlumb.img.height;if(r){r(this)}}}.bind(this);this._jsPlumb.endpoint.setImage=function(t,e){var n=t.constructor===String?t:t.src;r=e;this._jsPlumb.img.src=n;if(this.canvas!=null){this.canvas.setAttribute("src",this._jsPlumb.img.src)}}.bind(this);this._jsPlumb.endpoint.setImage(s,r);this._compute=function(t,e,n,i){this.anchorPoint=t;if(this._jsPlumb.ready){return[t[0]-this._jsPlumb.widthToUse/2,t[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse]}else{return[0,0,0,0]}};this.canvas=e.createElement("img",{position:"absolute",margin:0,padding:0,outline:0},this._jsPlumb.instance.endpointClass+a);if(this._jsPlumb.widthToUse){this.canvas.setAttribute("width",this._jsPlumb.widthToUse)}if(this._jsPlumb.heightToUse){this.canvas.setAttribute("height",this._jsPlumb.heightToUse)}this._jsPlumb.instance.appendElement(this.canvas);this.actuallyPaint=function(t,e,i){if(!this._jsPlumb.deleted){if(!this._jsPlumb.initialized){this.canvas.setAttribute("src",this._jsPlumb.img.src);this.appendDisplayElement(this.canvas);this._jsPlumb.initialized=true}var r=this.anchorPoint[0]-this._jsPlumb.widthToUse/2,o=this.anchorPoint[1]-this._jsPlumb.heightToUse/2;n.sizeElement(this.canvas,r,o,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse)}};this.paint=function(e,n){if(this._jsPlumb!=null){if(this._jsPlumb.ready){this.actuallyPaint(e,n)}else{t.setTimeout(function(){this.paint(e,n)}.bind(this),200)}}}};n.extend(e.Endpoints.Image,[o,e.Endpoints.AbstractEndpoint],{cleanup:function(t){if(t){this._jsPlumb.deleted=true;if(this.canvas){this.canvas.parentNode.removeChild(this.canvas)}this.canvas=null}}});e.Endpoints.Blank=function(t){var i=e.Endpoints.AbstractEndpoint.apply(this,arguments);this.type="Blank";o.apply(this,arguments);this._compute=function(t,e,n,i){return[t[0],t[1],10,0]};var r=t.cssClass?" "+t.cssClass:"";this.canvas=e.createElement("div",{display:"block",width:"1px",height:"1px",background:"transparent",position:"absolute"},this._jsPlumb.instance.endpointClass+r);this._jsPlumb.instance.appendElement(this.canvas);this.paint=function(t,e){n.sizeElement(this.canvas,this.x,this.y,this.w,this.h)}};n.extend(e.Endpoints.Blank,[e.Endpoints.AbstractEndpoint,o],{cleanup:function(){if(this.canvas&&this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas)}}});e.Endpoints.Triangle=function(t){this.type="Triangle";e.Endpoints.AbstractEndpoint.apply(this,arguments);var n=this;t=t||{};t.width=t.width||55;t.height=t.height||55;this.width=t.width;this.height=t.height;this._compute=function(t,e,i,r){var o=i.width||n.width,s=i.height||n.height,a=t[0]-o/2,l=t[1]-s/2;return[a,l,o,s]}};var s=e.Overlays.AbstractOverlay=function(t){this.visible=true;this.isAppendedAtTopLevel=true;this.component=t.component;this.loc=t.location==null?.5:t.location;this.endpointLoc=t.endpointLocation==null?[.5,.5]:t.endpointLocation;this.visible=t.visible!==false};s.prototype={cleanup:function(t){if(t){this.component=null;this.canvas=null;this.endpointLoc=null}},reattach:function(t,e){},setVisible:function(t){this.visible=t;this.component.repaint()},isVisible:function(){return this.visible},hide:function(){this.setVisible(false)},show:function(){this.setVisible(true)},incrementLocation:function(t){this.loc+=t;this.component.repaint()},setLocation:function(t){this.loc=t;this.component.repaint()},getLocation:function(){return this.loc},updateFrom:function(){}};e.Overlays.Arrow=function(t){this.type="Arrow";s.apply(this,arguments);this.isAppendedAtTopLevel=false;t=t||{};var r=this;this.length=t.length||20;this.width=t.width||20;this.id=t.id;this.direction=(t.direction||1)<0?-1:1;var o=t.paintStyle||{"stroke-width":1},a=t.foldback||.623;this.computeMaxSize=function(){return r.width*1.5};this.elementCreated=function(n,i){this.path=n;if(t.events){for(var r in t.events){e.on(n,r,t.events[r])}}};this.draw=function(t,e){var r,s,l,u,c;if(t.pointAlongPathFrom){if(n.isString(this.loc)||this.loc>1||this.loc<0){var h=parseInt(this.loc,10),f=this.loc<0?1:0;r=t.pointAlongPathFrom(f,h,false);s=t.pointAlongPathFrom(f,h-this.direction*this.length/2,false);l=i.pointOnLine(r,s,this.length)}else if(this.loc===1){r=t.pointOnPath(this.loc);s=t.pointAlongPathFrom(this.loc,-this.length);l=i.pointOnLine(r,s,this.length);if(this.direction===-1){var d=l;l=r;r=d}}else if(this.loc===0){l=t.pointOnPath(this.loc);s=t.pointAlongPathFrom(this.loc,this.length);r=i.pointOnLine(l,s,this.length);if(this.direction===-1){var p=l;l=r;r=p}}else{r=t.pointAlongPathFrom(this.loc,this.direction*this.length/2);s=t.pointOnPath(this.loc);l=i.pointOnLine(r,s,this.length)}u=i.perpendicularLineTo(r,l,this.width);c=i.pointOnLine(r,l,a*this.length);var v={hxy:r,tail:u,cxy:c},g=o.stroke||e.stroke,m=o.fill||e.stroke,y=o.strokeWidth||e.strokeWidth;return{component:t,d:v,"stroke-width":y,stroke:g,fill:m,minX:Math.min(r.x,u[0].x,u[1].x),maxX:Math.max(r.x,u[0].x,u[1].x),minY:Math.min(r.y,u[0].y,u[1].y),maxY:Math.max(r.y,u[0].y,u[1].y)}}else{return{component:t,minX:0,maxX:0,minY:0,maxY:0}}}};n.extend(e.Overlays.Arrow,s,{updateFrom:function(t){this.length=t.length||this.length;this.width=t.width||this.width;this.direction=t.direction!=null?t.direction:this.direction;this.foldback=t.foldback||this.foldback},cleanup:function(){if(this.path&&this.path.parentNode){this.path.parentNode.removeChild(this.path)}}});e.Overlays.PlainArrow=function(t){t=t||{};var n=e.extend(t,{foldback:1});e.Overlays.Arrow.call(this,n);this.type="PlainArrow"};n.extend(e.Overlays.PlainArrow,e.Overlays.Arrow);e.Overlays.Diamond=function(t){t=t||{};var n=t.length||40,i=e.extend(t,{length:n/2,foldback:2});e.Overlays.Arrow.call(this,i);this.type="Diamond"};n.extend(e.Overlays.Diamond,e.Overlays.Arrow);var a=function(t,e){if(t._jsPlumb.cachedDimensions==null||e){t._jsPlumb.cachedDimensions=t.getDimensions()}return t._jsPlumb.cachedDimensions};var l=function(t){e.jsPlumbUIComponent.apply(this,arguments);s.apply(this,arguments);var i=this.fire;this.fire=function(){i.apply(this,arguments);if(this.component){this.component.fire.apply(this.component,arguments)}};this.detached=false;this.id=t.id;this._jsPlumb.div=null;this._jsPlumb.initialised=false;this._jsPlumb.component=t.component;this._jsPlumb.cachedDimensions=null;this._jsPlumb.create=t.create;this._jsPlumb.initiallyInvisible=t.visible===false;this.getElement=function(){if(this._jsPlumb.div==null){var n=this._jsPlumb.div=e.getElement(this._jsPlumb.create(this._jsPlumb.component));n.style.position="absolute";jsPlumb.addClass(n,this._jsPlumb.instance.overlayClass+" "+(this.cssClass?this.cssClass:t.cssClass?t.cssClass:""));this._jsPlumb.instance.appendElement(n);this._jsPlumb.instance.getId(n);this.canvas=n;var i="translate(-50%, -50%)";n.style.webkitTransform=i;n.style.mozTransform=i;n.style.msTransform=i;n.style.oTransform=i;n.style.transform=i;n._jsPlumb=this;if(t.visible===false){n.style.display="none"}}return this._jsPlumb.div};this.draw=function(t,e,i){var r=a(this);if(r!=null&&r.length===2){var o={x:0,y:0};if(i){o={x:i[0],y:i[1]}}else if(t.pointOnPath){var s=this.loc,l=false;if(n.isString(this.loc)||this.loc<0||this.loc>1){s=parseInt(this.loc,10);l=true}o=t.pointOnPath(s,l)}else{var u=this.loc.constructor===Array?this.loc:this.endpointLoc;o={x:u[0]*t.w,y:u[1]*t.h}}var c=o.x-r[0]/2,h=o.y-r[1]/2;return{component:t,d:{minx:c,miny:h,td:r,cxy:o},minX:c,maxX:c+r[0],minY:h,maxY:h+r[1]}}else{return{minX:0,maxX:0,minY:0,maxY:0}}}};n.extend(l,[e.jsPlumbUIComponent,s],{getDimensions:function(){return[1,1]},setVisible:function(t){if(this._jsPlumb.div){this._jsPlumb.div.style.display=t?"block":"none";if(t&&this._jsPlumb.initiallyInvisible){a(this,true);this.component.repaint();this._jsPlumb.initiallyInvisible=false}}},clearCachedDimensions:function(){this._jsPlumb.cachedDimensions=null},cleanup:function(t){if(t){if(this._jsPlumb.div!=null){this._jsPlumb.div._jsPlumb=null;this._jsPlumb.instance.removeElement(this._jsPlumb.div)}}else{if(this._jsPlumb&&this._jsPlumb.div&&this._jsPlumb.div.parentNode){this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div)}this.detached=true}},reattach:function(t,e){if(this._jsPlumb.div!=null){t.getContainer().appendChild(this._jsPlumb.div)}this.detached=false},computeMaxSize:function(){var t=a(this);return Math.max(t[0],t[1])},paint:function(t,e){if(!this._jsPlumb.initialised){this.getElement();t.component.appendDisplayElement(this._jsPlumb.div);this._jsPlumb.initialised=true;if(this.detached){this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div)}}this._jsPlumb.div.style.left=t.component.x+t.d.minx+"px";this._jsPlumb.div.style.top=t.component.y+t.d.miny+"px"}});e.Overlays.Custom=function(t){this.type="Custom";l.apply(this,arguments)};n.extend(e.Overlays.Custom,l);e.Overlays.GuideLines=function(){var t=this;t.length=50;t.strokeWidth=5;this.type="GuideLines";s.apply(this,arguments);e.jsPlumbUIComponent.apply(this,arguments);this.draw=function(e,n){var r=e.pointAlongPathFrom(t.loc,t.length/2),o=e.pointOnPath(t.loc),s=i.pointOnLine(r,o,t.length),a=i.perpendicularLineTo(r,s,40),l=i.perpendicularLineTo(s,r,20);return{connector:e,head:r,tail:s,headLine:l,tailLine:a,minX:Math.min(r.x,s.x,l[0].x,l[1].x),minY:Math.min(r.y,s.y,l[0].y,l[1].y),maxX:Math.max(r.x,s.x,l[0].x,l[1].x),maxY:Math.max(r.y,s.y,l[0].y,l[1].y)}}};e.Overlays.Label=function(t){this.labelStyle=t.labelStyle;this.cssClass=this.labelStyle!=null?this.labelStyle.cssClass:null;var n=e.extend({create:function(){return e.createElement("div")}},t);e.Overlays.Custom.call(this,n);this.type="Label";this.label=t.label||"";this.labelText=null;if(this.labelStyle){var i=this.getElement();this.labelStyle.font=this.labelStyle.font||"12px sans-serif";i.style.font=this.labelStyle.font;i.style.color=this.labelStyle.color||"black";if(this.labelStyle.fill){i.style.background=this.labelStyle.fill}if(this.labelStyle.borderWidth>0){var r=this.labelStyle.borderStyle?this.labelStyle.borderStyle:"black";i.style.border=this.labelStyle.borderWidth+"px solid "+r}if(this.labelStyle.padding){i.style.padding=this.labelStyle.padding}}};n.extend(e.Overlays.Label,e.Overlays.Custom,{cleanup:function(t){if(t){this.div=null;this.label=null;this.labelText=null;this.cssClass=null;this.labelStyle=null}},getLabel:function(){return this.label},setLabel:function(t){this.label=t;this.labelText=null;this.clearCachedDimensions();this.update();this.component.repaint()},getDimensions:function(){this.update();return l.prototype.getDimensions.apply(this,arguments)},update:function(){if(typeof this.label==="function"){var t=this.label(this);this.getElement().innerHTML=t.replace(/\r\n/g,"<br/>")}else{if(this.labelText==null){this.labelText=this.label;this.getElement().innerHTML=this.labelText.replace(/\r\n/g,"<br/>")}}},updateFrom:function(t){if(t.label!=null){this.setLabel(t.label)}}})}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumbUtil,n=t.jsPlumbInstance;var i="jtk-group-collapsed";var r="jtk-group-expanded";var o="[jtk-group-content]";var s="elementDraggable";var a="stop";var l="revert";var u="_groupManager";var c="_jsPlumbGroup";var h="_jsPlumbGroupDrag";var f="group:addMember";var d="group:removeMember";var p="group:add";var v="group:remove";var g="group:expand";var m="group:collapse";var y="groupDragStop";var b="connectionMoved";var x="internal.connectionDetached";var P="removeAll";var _="orphanAll";var C="show";var w="hide";var j=function(t){var n={},o={},s={},a=this;function l(e,n){var i=t.getContainer();var r=false;while(!r){if(e==null||e===i){return false}else{if(e===n){return true}else{e=e.parentNode}}}}t.bind("connection",(function(n){var i=t.getGroupFor(n.source);var r=t.getGroupFor(n.target);if(i!=null&&r!=null&&i===r){o[n.connection.id]=i;s[n.connection.id]=i}else{if(i!=null){e.suggest(i.connections.source,n.connection);o[n.connection.id]=i}if(r!=null){e.suggest(r.connections.target,n.connection);s[n.connection.id]=r}}}));function u(t){delete t.proxies;var n=o[t.id],i;if(n!=null){i=function(e){return e.id===t.id};e.removeWithFunction(n.connections.source,i);e.removeWithFunction(n.connections.target,i);delete o[t.id]}n=s[t.id];if(n!=null){i=function(e){return e.id===t.id};e.removeWithFunction(n.connections.source,i);e.removeWithFunction(n.connections.target,i);delete s[t.id]}}t.bind(x,(function(t){u(t.connection)}));t.bind(b,(function(t){var e=t.index===0?o:s;var n=e[t.connection.id];if(n){var i=n.connections[t.index===0?"source":"target"];var r=i.indexOf(t.connection);if(r!==-1){i.splice(r,1)}}}));this.addGroup=function(e){t.addClass(e.getEl(),r);n[e.id]=e;e.manager=this;j(e);t.fire(p,{group:e})};this.addToGroup=function(e,n,i){e=this.getGroup(e);if(e){var r=e.getEl();if(n._isJsPlumbGroup){return}var o=n._jsPlumbGroup;if(o!==e){t.removeFromDragSelection(n);var s=t.getOffset(n,true);var l=e.collapsed?t.getOffset(r,true):t.getOffset(e.getDragArea(),true);if(o!=null){o.remove(n,false,i,false,e);a.updateConnectionsForGroup(o)}e.add(n,i);var u=function(t,n){var i=n===0?1:0;t.each((function(t){t.setVisible(false);if(t.endpoints[i].element._jsPlumbGroup===e){t.endpoints[i].setVisible(false);y(t,i,e)}else{t.endpoints[n].setVisible(false);d(t,n,e)}}))};if(e.collapsed){u(t.select({source:n}),0);u(t.select({target:n}),1)}var c=t.getId(n);t.dragManager.setParent(n,c,r,t.getId(r),s);var h={left:s.left-l.left,top:s.top-l.top};t.setPosition(n,h);t.dragManager.revalidateParent(n,c,s);a.updateConnectionsForGroup(e);t.revalidate(c);if(!i){var p={group:e,el:n,pos:h};if(o){p.sourceGroup=o}t.fire(f,p)}}}};this.removeFromGroup=function(t,e,n){t=this.getGroup(t);if(t){if(t.collapsed){var i=function(n,i){for(var r=0;r<n.length;r++){var o=n[r];if(o.proxies){for(var s=0;s<o.proxies.length;s++){if(o.proxies[s]!=null){var a=o.proxies[s].originalEp.element;if(a===e||l(a,e)){y(o,i,t)}}}}}};i(t.connections.source.slice(),0);i(t.connections.target.slice(),1)}t.remove(e,null,n)}};this.getGroup=function(t){var i=t;if(e.isString(t)){i=n[t];if(i==null){throw new TypeError("No such group ["+t+"]")}}return i};this.getGroups=function(){var t=[];for(var e in n){t.push(n[e])}return t};this.removeGroup=function(e,i,r,o){e=this.getGroup(e);this.expandGroup(e,true);var s=e[i?P:_](r,o);t.remove(e.getEl());delete n[e.id];delete t._groups[e.id];t.fire(v,{group:e});return s};this.removeAllGroups=function(t,e,i){for(var r in n){this.removeGroup(n[r],t,e,i)}};function h(e,n){var i=e.getEl().querySelectorAll(".jtk-managed");for(var r=0;r<i.length;r++){t[n?C:w](i[r],true)}}var d=function(e,n,i){var r=e.endpoints[n===0?1:0].element;if(r[c]&&(!r[c].shouldProxy()&&r[c].collapsed)){return}var o=i.getEl(),s=t.getId(o);t.proxyConnection(e,n,o,s,(function(t,e){return i.getEndpoint(t,e)}),(function(t,e){return i.getAnchor(t,e)}))};this.collapseGroup=function(e){e=this.getGroup(e);if(e==null||e.collapsed){return}var n=e.getEl();h(e,false);if(e.shouldProxy()){var o=function(t,n){for(var i=0;i<t.length;i++){var r=t[i];d(r,n,e)}};o(e.connections.source,0);o(e.connections.target,1)}e.collapsed=true;t.removeClass(n,r);t.addClass(n,i);t.revalidate(n);t.fire(m,{group:e})};var y=function(e,n,i){t.unproxyConnection(e,n,t.getId(i.getEl()))};this.expandGroup=function(e,n){e=this.getGroup(e);if(e==null||!e.collapsed){return}var o=e.getEl();h(e,true);if(e.shouldProxy()){var s=function(t,n){for(var i=0;i<t.length;i++){var r=t[i];y(r,n,e)}};s(e.connections.source,0);s(e.connections.target,1)}e.collapsed=false;t.addClass(o,r);t.removeClass(o,i);t.revalidate(o);this.repaintGroup(e);if(!n){t.fire(g,{group:e})}};this.repaintGroup=function(e){e=this.getGroup(e);var n=e.getMembers();for(var i=0;i<n.length;i++){t.revalidate(n[i])}};function j(e){var n=e.getMembers().slice();var i=[];for(var r=0;r<n.length;r++){Array.prototype.push.apply(i,n[r].querySelectorAll(".jtk-managed"))}Array.prototype.push.apply(n,i);var a=t.getConnections({source:n,scope:"*"},true);var l=t.getConnections({target:n,scope:"*"},true);var u={};e.connections.source.length=0;e.connections.target.length=0;var c=function(n){for(var i=0;i<n.length;i++){if(u[n[i].id]){continue}u[n[i].id]=true;var r=t.getGroupFor(n[i].source),a=t.getGroupFor(n[i].target);if(r===e){if(a!==e){e.connections.source.push(n[i])}o[n[i].id]=e}else if(a===e){e.connections.target.push(n[i]);s[n[i].id]=e}}};c(a);c(l)}this.updateConnectionsForGroup=j;this.refreshAllGroups=function(){for(var e in n){j(n[e]);t.dragManager.updateOffsets(t.getId(n[e].getEl()))}}};var E=function(n,i){var r=this;var u=i.el;this.getEl=function(){return u};this.id=i.id||e.uuid();u._isJsPlumbGroup=true;var f=this.getDragArea=function(){var t=n.getSelector(u,o);return t&&t.length>0?t[0]:u};var p=i.ghost===true;var v=p||i.constrain===true;var g=i.revert!==false;var m=i.orphan===true;var b=i.prune===true;var x=i.dropOverride===true;var P=i.proxied!==false;var _=[];this.connections={source:[],target:[],internal:[]};this.getAnchor=function(t,e){return i.anchor||"Continuous"};this.getEndpoint=function(t,e){return i.endpoint||["Dot",{radius:10}]};this.collapsed=false;if(i.draggable!==false){var C={drag:function(){for(var t=0;t<_.length;t++){n.draw(_[t])}},stop:function(t){n.fire(y,jsPlumb.extend(t,{group:r}))},scope:h};if(i.dragOptions){t.jsPlumb.extend(C,i.dragOptions)}n.draggable(i.el,C)}if(i.droppable!==false){n.droppable(i.el,{drop:function(t){var e=t.drag.el;if(e._isJsPlumbGroup){return}var i=e._jsPlumbGroup;if(i!==r){if(i!=null){if(i.overrideDrop(e,r)){return}}n.getGroupManager().addToGroup(r,e,false)}}})}var w=function(t,e){var n=t.nodeType==null?t:[t];for(var i=0;i<n.length;i++){e(n[i])}};this.overrideDrop=function(t,e){return x&&(g||b||m)};this.add=function(t,e){var i=f();w(t,(function(t){if(t._jsPlumbGroup!=null){if(t._jsPlumbGroup===r){return}else{t._jsPlumbGroup.remove(t,true,e,false)}}t._jsPlumbGroup=r;_.push(t);if(n.isAlreadyDraggable(t)){I(t)}if(t.parentNode!==i){i.appendChild(t)}}));n.getGroupManager().updateConnectionsForGroup(r)};this.remove=function(t,i,o,s,a){w(t,(function(t){if(t._jsPlumbGroup===r){delete t._jsPlumbGroup;e.removeWithFunction(_,(function(e){return e===t}));if(i){try{r.getDragArea().removeChild(t)}catch(l){jsPlumbUtil.log("Could not remove element from Group "+l)}}A(t);if(!o){var s={group:r,el:t};if(a){s.targetGroup=a}n.fire(d,s)}}}));if(!s){n.getGroupManager().updateConnectionsForGroup(r)}};this.removeAll=function(t,e){for(var i=0,o=_.length;i<o;i++){var s=_[0];r.remove(s,t,e,true);n.remove(s,true)}_.length=0;n.getGroupManager().updateConnectionsForGroup(r)};this.orphanAll=function(){var t={};for(var e=0;e<_.length;e++){var n=D(_[e]);t[n[0]]=n[1]}_.length=0;return t};this.getMembers=function(){return _};u[c]=this;n.bind(s,function(t){if(t.el._jsPlumbGroup===this){I(t.el)}}.bind(this));function j(t){return t.offsetParent}function E(t,e){var i=j(t),r=n.getSize(i),o=n.getSize(t),s=e[0],a=s+o[0],l=e[1],u=l+o[1];return a>0&&s<r[0]&&u>0&&l<r[1]}function D(t){var e=n.getId(t);var i=n.getOffset(t);t.parentNode.removeChild(t);n.getContainer().appendChild(t);n.setPosition(t,i);A(t);n.dragManager.clearParent(t,e);return[e,i]}function S(t){var e=[];function i(t,e,i){var r=null;if(!E(t,[e,i])){var o=t._jsPlumbGroup;if(b){n.remove(t)}else{r=D(t)}o.remove(t)}return r}for(var r=0;r<t.selection.length;r++){e.push(i(t.selection[r][0],t.selection[r][1].left,t.selection[r][1].top))}return e.length===1?e[0]:e}function k(t){var e=n.getId(t);n.revalidate(t);n.dragManager.revalidateParent(t,e)}function A(t){if(!t._katavorioDrag){return}if(b||m){t._katavorioDrag.off(a,S)}if(!b&&!m&&g){t._katavorioDrag.off(l,k);t._katavorioDrag.setRevert(null)}}function I(t){if(!t._katavorioDrag){return}if(b||m){t._katavorioDrag.on(a,S)}if(v){t._katavorioDrag.setConstrain(true)}if(p){t._katavorioDrag.setUseGhostProxy(true)}if(!b&&!m&&g){t._katavorioDrag.on(l,k);t._katavorioDrag.setRevert((function(t,e){return!E(t,e)}))}}this.shouldProxy=function(){return P};n.getGroupManager().addGroup(this)};n.prototype.addGroup=function(t){var e=this;e._groups=e._groups||{};if(e._groups[t.id]!=null){throw new TypeError("cannot create Group ["+t.id+"]; a Group with that ID exists")}if(t.el[c]!=null){throw new TypeError("cannot create Group ["+t.id+"]; the given element is already a Group")}var n=new E(e,t);e._groups[n.id]=n;if(t.collapsed){this.collapseGroup(n)}return n};n.prototype.addToGroup=function(t,e,n){var i=function(e){var i=this.getId(e);this.manage(i,e);this.getGroupManager().addToGroup(t,e,n)}.bind(this);if(Array.isArray(e)){for(var r=0;r<e.length;r++){i(e[r])}}else{i(e)}};n.prototype.removeFromGroup=function(t,e,n){this.getGroupManager().removeFromGroup(t,e,n);this.getContainer().appendChild(e)};n.prototype.removeGroup=function(t,e,n,i){return this.getGroupManager().removeGroup(t,e,n,i)};n.prototype.removeAllGroups=function(t,e,n){this.getGroupManager().removeAllGroups(t,e,n)};n.prototype.getGroup=function(t){return this.getGroupManager().getGroup(t)};n.prototype.getGroups=function(){return this.getGroupManager().getGroups()};n.prototype.expandGroup=function(t){this.getGroupManager().expandGroup(t)};n.prototype.collapseGroup=function(t){this.getGroupManager().collapseGroup(t)};n.prototype.repaintGroup=function(t){this.getGroupManager().repaintGroup(t)};n.prototype.toggleGroup=function(t){t=this.getGroupManager().getGroup(t);if(t!=null){this.getGroupManager()[t.collapsed?"expandGroup":"collapseGroup"](t)}};n.prototype.getGroupManager=function(){var t=this[u];if(t==null){t=this[u]=new j(this)}return t};n.prototype.removeGroupManager=function(){delete this[u]};n.prototype.getGroupFor=function(t){t=this.getElement(t);if(t){var e=this.getContainer();var n=false,i=null;while(!n){if(t==null||t===e){n=true}else{if(t[c]){i=t[c];n=true}else{t=t.parentNode}}}return i}}}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumb,n=t.jsPlumbUtil;var i="Straight";var r="Arc";var o=function(t){this.type="Flowchart";t=t||{};t.stub=t.stub==null?30:t.stub;var n,o=e.Connectors.AbstractConnector.apply(this,arguments),s=t.midpoint==null?.5:t.midpoint,a=t.alwaysRespectStubs===true,l=null,u=null,c=t.cornerRadius!=null?t.cornerRadius:0,h=function(t){return t<0?-1:t===0?0:1},f=function(t){return[h(t[2]-t[0]),h(t[3]-t[1])]},d=function(t,e,n,i){if(l===e&&u===n){return}var r=l==null?i.sx:l,o=u==null?i.sy:u,s=r===e?"v":"h";l=e;u=n;t.push([r,o,e,n,s])},p=function(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))},v=function(t){var e=[];e.push.apply(e,t);return e},g=function(t,e,n){var s=null,a,l,u;for(var h=0;h<e.length-1;h++){s=s||v(e[h]);a=v(e[h+1]);l=f(s);u=f(a);if(c>0&&s[4]!==a[4]){var d=Math.min(p(s),p(a));var g=Math.min(c,d/2);s[2]-=l[0]*g;s[3]-=l[1]*g;a[0]+=u[0]*g;a[1]+=u[1]*g;var m=l[1]===u[0]&&u[0]===1||l[1]===u[0]&&u[0]===0&&l[0]!==u[1]||l[1]===u[0]&&u[0]===-1,y=a[1]>s[3]?1:-1,b=a[0]>s[2]?1:-1,x=y===b,P=x&&m||!x&&!m?a[0]:s[2],_=x&&m||!x&&!m?s[3]:a[1];o.addSegment(t,i,{x1:s[0],y1:s[1],x2:s[2],y2:s[3]});o.addSegment(t,r,{r:g,x1:s[2],y1:s[3],x2:a[0],y2:a[1],cx:P,cy:_,ac:m})}else{var C=s[2]===s[0]?0:s[2]>s[0]?n.lw/2:-(n.lw/2),w=s[3]===s[1]?0:s[3]>s[1]?n.lw/2:-(n.lw/2);o.addSegment(t,i,{x1:s[0]-C,y1:s[1]-w,x2:s[2]+C,y2:s[3]+w})}s=a}if(a!=null){o.addSegment(t,i,{x1:a[0],y1:a[1],x2:a[2],y2:a[3]})}};this._compute=function(t,e){n=[];l=null;u=null;var i=function(){return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]},r={perpendicular:i,orthogonal:i,opposite:function(e){var n=t,i=e==="x"?0:1,r={x:function(){return n.so[i]===1&&(n.startStubX>n.endStubX&&n.tx>n.startStubX||n.sx>n.endStubX&&n.tx>n.sx)||n.so[i]===-1&&(n.startStubX<n.endStubX&&n.tx<n.startStubX||n.sx<n.endStubX&&n.tx<n.sx)},y:function(){return n.so[i]===1&&(n.startStubY>n.endStubY&&n.ty>n.startStubY||n.sy>n.endStubY&&n.ty>n.sy)||n.so[i]===-1&&(n.startStubY<n.endStubY&&n.ty<n.startStubY||n.sy<n.endStubY&&n.ty<n.sy)}};if(!a&&r[e]()){return{x:[(t.sx+t.tx)/2,t.startStubY,(t.sx+t.tx)/2,t.endStubY],y:[t.startStubX,(t.sy+t.ty)/2,t.endStubX,(t.sy+t.ty)/2]}[e]}else{return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}}};var c=r[t.anchorOrientation](t.sourceAxis),h=t.sourceAxis==="x"?0:1,f=t.sourceAxis==="x"?1:0,p=c[h],v=c[f],m=c[h+2],y=c[f+2];d(n,c[0],c[1],t);var b=t.startStubX+(t.endStubX-t.startStubX)*s,x=t.startStubY+(t.endStubY-t.startStubY)*s;var P={x:[0,1],y:[1,0]},_={perpendicular:function(e){var n=t,i={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]},r={x:[[n.startStubX,n.endStubX],null,[n.endStubX,n.startStubX]],y:[[n.startStubY,n.endStubY],null,[n.endStubY,n.startStubY]]},o={x:[[b,n.startStubY],[b,n.endStubY]],y:[[n.startStubX,x],[n.endStubX,x]]},s={x:[[n.endStubX,n.startStubY]],y:[[n.startStubX,n.endStubY]]},a={x:[[n.startStubX,n.endStubY],[n.endStubX,n.endStubY]],y:[[n.endStubX,n.startStubY],[n.endStubX,n.endStubY]]},l={x:[[n.startStubX,x],[n.endStubX,x],[n.endStubX,n.endStubY]],y:[[b,n.startStubY],[b,n.endStubY],[n.endStubX,n.endStubY]]},u={x:[n.startStubY,n.endStubY],y:[n.startStubX,n.endStubX]},c=P[e][0],h=P[e][1],f=n.so[c]+1,d=n.to[h]+1,p=n.to[h]===-1&&u[e][1]<u[e][0]||n.to[h]===1&&u[e][1]>u[e][0],v=r[e][f][0],g=r[e][f][1],m=i[e][f][d];if(n.segment===m[3]||n.segment===m[2]&&p){return o[e]}else if(n.segment===m[2]&&g<v){return s[e]}else if(n.segment===m[2]&&g>=v||n.segment===m[1]&&!p){return l[e]}else if(n.segment===m[0]||n.segment===m[1]&&p){return a[e]}},orthogonal:function(e,n,i,r,o){var s=t,a={x:s.so[0]===-1?Math.min(n,r):Math.max(n,r),y:s.so[1]===-1?Math.min(n,r):Math.max(n,r)}[e];return{x:[[a,i],[a,o],[r,o]],y:[[i,a],[o,a],[o,r]]}[e]},opposite:function(n,i,r,s){var a=t,l={x:"y",y:"x"}[n],u={x:"height",y:"width"}[n],c=a["is"+n.toUpperCase()+"GreaterThanStubTimes2"];if(e.sourceEndpoint.elementId===e.targetEndpoint.elementId){var f=r+(1-e.sourceEndpoint.anchor[l])*e.sourceInfo[u]+o.maxStub;return{x:[[i,f],[s,f]],y:[[f,i],[f,s]]}[n]}else if(!c||a.so[h]===1&&i>s||a.so[h]===-1&&i<s){return{x:[[i,x],[s,x]],y:[[b,i],[b,s]]}[n]}else if(a.so[h]===1&&i<s||a.so[h]===-1&&i>s){return{x:[[b,a.sy],[b,a.ty]],y:[[a.sx,x],[a.tx,x]]}[n]}}};var C=_[t.anchorOrientation](t.sourceAxis,p,v,m,y);if(C){for(var w=0;w<C.length;w++){d(n,C[w][0],C[w][1],t)}}d(n,c[2],c[3],t);d(n,t.tx,t.ty,t);g(this,n,t)}};e.Connectors.Flowchart=o;n.extend(e.Connectors.Flowchart,e.Connectors.AbstractConnector)}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumb,n=t.jsPlumbUtil;e.Connectors.AbstractBezierConnector=function(t){t=t||{};var n=t.showLoopback!==false,i=t.margin||5,r=t.orientation&&t.orientation==="clockwise",o=t.loopbackRadius||25,s;this._compute=function(t,e){var a=e.sourcePos,l=e.targetPos,u=Math.abs(a[0]-l[0]),c=Math.abs(a[1]-l[1]);if(!n||e.sourceEndpoint.elementId!==e.targetEndpoint.elementId){this._computeBezier(t,e,a,l,u,c)}else{var h=e.sourcePos[0],f=e.sourcePos[1]-i,d=h,p=f-o,v=d-o,g=p-o;u=2*o;c=2*o;t.points[0]=v;t.points[1]=g;t.points[2]=u;t.points[3]=c;s.addSegment(this,"Arc",{loopback:true,x1:h-v+4,y1:f-g,startAngle:0,endAngle:2*Math.PI,r:o,ac:!r,x2:h-v-4,y2:f-g,cx:d-v,cy:p-g})}};s=e.Connectors.AbstractConnector.apply(this,arguments);return s};n.extend(e.Connectors.AbstractBezierConnector,e.Connectors.AbstractConnector);var i=function(t){t=t||{};this.type="Bezier";var n=e.Connectors.AbstractBezierConnector.apply(this,arguments),i=t.curviness||150,r=10;this.getCurviness=function(){return i};this._findControlPoint=function(t,e,n,o,s,a,l){var u=a[0]!==l[0]||a[1]===l[1],c=[];if(!u){if(a[0]===0){c.push(e[0]<n[0]?t[0]+r:t[0]-r)}else{c.push(t[0]-i*a[0])}if(a[1]===0){c.push(e[1]<n[1]?t[1]+r:t[1]-r)}else{c.push(t[1]+i*l[1])}}else{if(l[0]===0){c.push(n[0]<e[0]?t[0]+r:t[0]-r)}else{c.push(t[0]+i*l[0])}if(l[1]===0){c.push(n[1]<e[1]?t[1]+r:t[1]-r)}else{c.push(t[1]+i*a[1])}}return c};this._computeBezier=function(t,e,i,r,o,s){var a,l,u=i[0]<r[0]?o:0,c=i[1]<r[1]?s:0,h=i[0]<r[0]?0:o,f=i[1]<r[1]?0:s;a=this._findControlPoint([u,c],i,r,e.sourceEndpoint,e.targetEndpoint,t.so,t.to);l=this._findControlPoint([h,f],r,i,e.targetEndpoint,e.sourceEndpoint,t.to,t.so);n.addSegment(this,"Bezier",{x1:u,y1:c,x2:h,y2:f,cp1x:a[0],cp1y:a[1],cp2x:l[0],cp2y:l[1]})}};e.Connectors.Bezier=i;n.extend(i,e.Connectors.AbstractBezierConnector)}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumb,n=t.jsPlumbUtil;var i=function(t,e,n,i){if(t<=n&&i<=e){return 1}else if(t<=n&&e<=i){return 2}else if(n<=t&&i>=e){return 3}return 4},r=function(t,e,n,i,r,o,s,a,l){if(a<=l){return[t,e]}if(n===1){if(i[3]<=0&&r[3]>=1){return[t+(i[2]<.5?-1*o:o),e]}else if(i[2]>=1&&r[2]<=0){return[t,e+(i[3]<.5?-1*s:s)]}else{return[t+-1*o,e+-1*s]}}else if(n===2){if(i[3]>=1&&r[3]<=0){return[t+(i[2]<.5?-1*o:o),e]}else if(i[2]>=1&&r[2]<=0){return[t,e+(i[3]<.5?-1*s:s)]}else{return[t+o,e+-1*s]}}else if(n===3){if(i[3]>=1&&r[3]<=0){return[t+(i[2]<.5?-1*o:o),e]}else if(i[2]<=0&&r[2]>=1){return[t,e+(i[3]<.5?-1*s:s)]}else{return[t+-1*o,e+-1*s]}}else if(n===4){if(i[3]<=0&&r[3]>=1){return[t+(i[2]<.5?-1*o:o),e]}else if(i[2]<=0&&r[2]>=1){return[t,e+(i[3]<.5?-1*s:s)]}else{return[t+o,e+-1*s]}}};var o=function(t){t=t||{};this.type="StateMachine";var n=e.Connectors.AbstractBezierConnector.apply(this,arguments),o=t.curviness||10,s=t.margin||5,a=t.proximityLimit||80,l;this._computeBezier=function(t,e,u,c,h,f){var d=e.sourcePos[0]<e.targetPos[0]?0:h,p=e.sourcePos[1]<e.targetPos[1]?0:f,v=e.sourcePos[0]<e.targetPos[0]?h:0,g=e.sourcePos[1]<e.targetPos[1]?f:0;if(e.sourcePos[2]===0){d-=s}if(e.sourcePos[2]===1){d+=s}if(e.sourcePos[3]===0){p-=s}if(e.sourcePos[3]===1){p+=s}if(e.targetPos[2]===0){v-=s}if(e.targetPos[2]===1){v+=s}if(e.targetPos[3]===0){g-=s}if(e.targetPos[3]===1){g+=s}var m=(d+v)/2,y=(p+g)/2,b=i(d,p,v,g),x=Math.sqrt(Math.pow(v-d,2)+Math.pow(g-p,2)),P,_,C,w;l=r(m,y,b,e.sourcePos,e.targetPos,o,o,x,a);P=l[0];_=l[0];C=l[1];w=l[1];n.addSegment(this,"Bezier",{x1:v,y1:g,x2:d,y2:p,cp1x:P,cp1y:C,cp2x:_,cp2y:w})}};e.Connectors.StateMachine=o;n.extend(o,e.Connectors.AbstractBezierConnector)}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumb,n=t.jsPlumbUtil;var i="Straight";var r=function(t){this.type=i;var n=e.Connectors.AbstractConnector.apply(this,arguments);this._compute=function(t,e){n.addSegment(this,i,{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY});n.addSegment(this,i,{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY});n.addSegment(this,i,{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty})}};e.Connectors.Straight=r;n.extend(r,e.Connectors.AbstractConnector)}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumb,n=t.jsPlumbUtil;var i={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},r="stroke-dasharray",o="dashstyle",s="linearGradient",a="radialGradient",l="defs",u="fill",c="stop",h="stroke",f="stroke-width",d="style",p="none",v="jsplumb_gradient_",g="strokeWidth",m={svg:"http://www.w3.org/2000/svg"},y=function(t,e){for(var n in e){t.setAttribute(n,""+e[n])}},b=function(t,n){n=n||{};n.version="1.1";n.xmlns=m.svg;return e.createElementNS(m.svg,t,null,null,n)},x=function(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"},P=function(t){var e=t.querySelectorAll(" defs,linearGradient,radialGradient");for(var n=0;n<e.length;n++){e[n].parentNode.removeChild(e[n])}},_=function(t,e,n,i,r){var o=v+r._jsPlumb.instance.idstamp();P(t);var f;if(!n.gradient.offset){f=b(s,{id:o,gradientUnits:"userSpaceOnUse"})}else{f=b(a,{id:o})}var d=b(l);t.appendChild(d);d.appendChild(f);for(var p=0;p<n.gradient.stops.length;p++){var g=r.segment===1||r.segment===2?p:n.gradient.stops.length-1-p,m=n.gradient.stops[g][1],y=b(c,{offset:Math.floor(n.gradient.stops[p][0]*100)+"%","stop-color":m});f.appendChild(y)}var x=n.stroke?h:u;e.setAttribute(x,"url(#"+o+")")},C=function(t,e,n,s,a){e.setAttribute(u,n.fill?n.fill:p);e.setAttribute(h,n.stroke?n.stroke:p);if(n.gradient){_(t,e,n,s,a)}else{P(t);e.setAttribute(d,"")}if(n.strokeWidth){e.setAttribute(f,n.strokeWidth)}if(n[o]&&n[g]&&!n[r]){var l=n[o].indexOf(",")===-1?" ":",",c=n[o].split(l),v="";c.forEach((function(t){v+=Math.floor(t*n.strokeWidth)+l}));e.setAttribute(r,v)}else if(n[r]){e.setAttribute(r,n[r])}for(var m in i){if(n[m]){e.setAttribute(i[m],n[m])}}},w=function(t,e,n){if(t.childNodes.length>n){t.insertBefore(e,t.childNodes[n])}else{t.appendChild(e)}};n.svg={node:b,attr:y,pos:x};var j=function(t){var i=t.pointerEventsSpec||"all",r={};e.jsPlumbUIComponent.apply(this,t.originalArgs);this.canvas=null;this.path=null;this.svg=null;this.bgCanvas=null;var o=t.cssClass+" "+(t.originalArgs[0].cssClass||""),s={style:"",width:0,height:0,"pointer-events":i,position:"absolute"};this.svg=b("svg",s);if(t.useDivWrapper){this.canvas=e.createElement("div",{position:"absolute"});n.sizeElement(this.canvas,0,0,1,1);this.canvas.className=o}else{y(this.svg,{class:o});this.canvas=this.svg}t._jsPlumb.appendElement(this.canvas,t.originalArgs[0].parent);if(t.useDivWrapper){this.canvas.appendChild(this.svg)}var a=[this.canvas];this.getDisplayElements=function(){return a};this.appendDisplayElement=function(t){a.push(t)};this.paint=function(e,i,o){if(e!=null){var s=[this.x,this.y],a=[this.w,this.h],l;if(o!=null){if(o.xmin<0){s[0]+=o.xmin}if(o.ymin<0){s[1]+=o.ymin}a[0]=o.xmax+(o.xmin<0?-o.xmin:0);a[1]=o.ymax+(o.ymin<0?-o.ymin:0)}if(t.useDivWrapper){n.sizeElement(this.canvas,s[0],s[1],a[0]>0?a[0]:1,a[1]>0?a[1]:1);s[0]=0;s[1]=0;l=x([0,0])}else{l=x([s[0],s[1]])}r.paint.apply(this,arguments);y(this.svg,{style:l,width:a[0]||1,height:a[1]||1})}};return{renderer:r}};n.extend(j,e.jsPlumbUIComponent,{cleanup:function(t){if(t||this.typeId==null){if(this.canvas){this.canvas._jsPlumb=null}if(this.svg){this.svg._jsPlumb=null}if(this.bgCanvas){this.bgCanvas._jsPlumb=null}if(this.canvas&&this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas)}if(this.bgCanvas&&this.bgCanvas.parentNode){this.canvas.parentNode.removeChild(this.canvas)}this.svg=null;this.canvas=null;this.path=null;this.group=null;this._jsPlumb=null}else{if(this.canvas&&this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas)}if(this.bgCanvas&&this.bgCanvas.parentNode){this.bgCanvas.parentNode.removeChild(this.bgCanvas)}}},reattach:function(t){var e=t.getContainer();if(this.canvas&&this.canvas.parentNode==null){e.appendChild(this.canvas)}if(this.bgCanvas&&this.bgCanvas.parentNode==null){e.appendChild(this.bgCanvas)}},setVisible:function(t){if(this.canvas){this.canvas.style.display=t?"block":"none"}}});e.ConnectorRenderers.svg=function(t){var n=this,i=j.apply(this,[{cssClass:t._jsPlumb.connectorClass,originalArgs:arguments,pointerEventsSpec:"none",_jsPlumb:t._jsPlumb}]);i.renderer.paint=function(i,r,o){var s=n.getSegments(),a="",l=[0,0];if(o.xmin<0){l[0]=-o.xmin}if(o.ymin<0){l[1]=-o.ymin}if(s.length>0){a=n.getPathData();var u={d:a,transform:"translate("+l[0]+","+l[1]+")","pointer-events":t["pointer-events"]||"visibleStroke"},c=null,h=[n.x,n.y,n.w,n.h];if(i.outlineStroke){var f=i.outlineWidth||1,d=i.strokeWidth+2*f;c=e.extend({},i);delete c.gradient;c.stroke=i.outlineStroke;c.strokeWidth=d;if(n.bgPath==null){n.bgPath=b("path",u);e.addClass(n.bgPath,e.connectorOutlineClass);w(n.svg,n.bgPath,0)}else{y(n.bgPath,u)}C(n.svg,n.bgPath,c,h,n)}if(n.path==null){n.path=b("path",u);w(n.svg,n.path,i.outlineStroke?1:0)}else{y(n.path,u)}C(n.svg,n.path,i,h,n)}}};n.extend(e.ConnectorRenderers.svg,j);var E=e.SvgEndpoint=function(t){var n=j.apply(this,[{cssClass:t._jsPlumb.endpointClass,originalArgs:arguments,pointerEventsSpec:"all",useDivWrapper:true,_jsPlumb:t._jsPlumb}]);n.renderer.paint=function(t){var n=e.extend({},t);if(n.outlineStroke){n.stroke=n.outlineStroke}if(this.node==null){this.node=this.makeNode(n);this.svg.appendChild(this.node)}else if(this.updateNode!=null){this.updateNode(this.node)}C(this.svg,this.node,n,[this.x,this.y,this.w,this.h],this)}.bind(this)};n.extend(E,j);e.Endpoints.svg.Dot=function(){e.Endpoints.Dot.apply(this,arguments);E.apply(this,arguments);this.makeNode=function(t){return b("circle",{cx:this.w/2,cy:this.h/2,r:this.radius})};this.updateNode=function(t){y(t,{cx:this.w/2,cy:this.h/2,r:this.radius})}};n.extend(e.Endpoints.svg.Dot,[e.Endpoints.Dot,E]);e.Endpoints.svg.Rectangle=function(){e.Endpoints.Rectangle.apply(this,arguments);E.apply(this,arguments);this.makeNode=function(t){return b("rect",{width:this.w,height:this.h})};this.updateNode=function(t){y(t,{width:this.w,height:this.h})}};n.extend(e.Endpoints.svg.Rectangle,[e.Endpoints.Rectangle,E]);e.Endpoints.svg.Image=e.Endpoints.Image;e.Endpoints.svg.Blank=e.Endpoints.Blank;e.Overlays.svg.Label=e.Overlays.Label;e.Overlays.svg.Custom=e.Overlays.Custom;var D=function(t,n){t.apply(this,n);e.jsPlumbUIComponent.apply(this,n);this.isAppendedAtTopLevel=false;this.path=null;this.paint=function(t,e){if(t.component.svg&&e){if(this.path==null){this.path=b("path",{"pointer-events":"all"});t.component.svg.appendChild(this.path);if(this.elementCreated){this.elementCreated(this.path,t.component)}this.canvas=t.component.svg}var r=n&&n.length===1?n[0].cssClass||"":"",o=[0,0];if(e.xmin<0){o[0]=-e.xmin}if(e.ymin<0){o[1]=-e.ymin}y(this.path,{d:i(t.d),class:r,stroke:t.stroke?t.stroke:null,fill:t.fill?t.fill:null,transform:"translate("+o[0]+","+o[1]+")"})}};var i=function(t){return isNaN(t.cxy.x)||isNaN(t.cxy.y)?"":"M"+t.hxy.x+","+t.hxy.y+" L"+t.tail[0].x+","+t.tail[0].y+" L"+t.cxy.x+","+t.cxy.y+" L"+t.tail[1].x+","+t.tail[1].y+" L"+t.hxy.x+","+t.hxy.y};this.transfer=function(t){if(t.canvas&&this.path&&this.path.parentNode){this.path.parentNode.removeChild(this.path);t.canvas.appendChild(this.path)}}};var S={cleanup:function(t){if(this.path!=null){if(t){this._jsPlumb.instance.removeElement(this.path)}else{if(this.path.parentNode){this.path.parentNode.removeChild(this.path)}}}},reattach:function(t,e){if(this.path&&e.canvas){e.canvas.appendChild(this.path)}},setVisible:function(t){if(this.path!=null){this.path.style.display=t?"block":"none"}}};n.extend(D,[e.jsPlumbUIComponent,e.Overlays.AbstractOverlay]);e.Overlays.svg.Arrow=function(){D.apply(this,[e.Overlays.Arrow,arguments])};n.extend(e.Overlays.svg.Arrow,[e.Overlays.Arrow,D],S);e.Overlays.svg.PlainArrow=function(){D.apply(this,[e.Overlays.PlainArrow,arguments])};n.extend(e.Overlays.svg.PlainArrow,[e.Overlays.PlainArrow,D],S);e.Overlays.svg.Diamond=function(){D.apply(this,[e.Overlays.Diamond,arguments])};n.extend(e.Overlays.svg.Diamond,[e.Overlays.Diamond,D],S);e.Overlays.svg.GuideLines=function(){var t=null,n=this,i,r;e.Overlays.GuideLines.apply(this,arguments);this.paint=function(e,s){if(t==null){t=b("path");e.connector.svg.appendChild(t);n.attachListeners(t,e.connector);n.attachListeners(t,n);i=b("path");e.connector.svg.appendChild(i);n.attachListeners(i,e.connector);n.attachListeners(i,n);r=b("path");e.connector.svg.appendChild(r);n.attachListeners(r,e.connector);n.attachListeners(r,n)}var a=[0,0];if(s.xmin<0){a[0]=-s.xmin}if(s.ymin<0){a[1]=-s.ymin}y(t,{d:o(e.head,e.tail),stroke:"red",fill:null,transform:"translate("+a[0]+","+a[1]+")"});y(i,{d:o(e.tailLine[0],e.tailLine[1]),stroke:"blue",fill:null,transform:"translate("+a[0]+","+a[1]+")"});y(r,{d:o(e.headLine[0],e.headLine[1]),stroke:"green",fill:null,transform:"translate("+a[0]+","+a[1]+")"})};var o=function(t,e){return"M "+t.x+","+t.y+" L"+e.x+","+e.y}};n.extend(e.Overlays.svg.GuideLines,e.Overlays.GuideLines)}).call(typeof window!=="undefined"?window:commonjsGlobal);(function(){var t=this,e=t.jsPlumb,n=t.jsPlumbUtil,i=t.Katavorio,r=t.Biltong;var o=function(e){var n=e._mottle;if(!n){n=e._mottle=new t.Mottle}return n};var s=function(t,n){n=n||"main";var o="_katavorio_"+n;var s=t[o],a=t.getEventManager();if(!s){s=new i({bind:a.on,unbind:a.off,getSize:e.getSize,getConstrainingRectangle:function(t){return[t.parentNode.scrollWidth,t.parentNode.scrollHeight]},getPosition:function(e,n){var i=t.getOffset(e,n,e._katavorioDrag?e.offsetParent:null);return[i.left,i.top]},setPosition:function(t,e){t.style.left=e[0]+"px";t.style.top=e[1]+"px"},addClass:e.addClass,removeClass:e.removeClass,intersects:r.intersects,indexOf:function(t,e){return t.indexOf(e)},scope:t.getDefaultScope(),css:{noSelect:t.dragSelectClass,droppable:"jtk-droppable",draggable:"jtk-draggable",drag:"jtk-drag",selected:"jtk-drag-selected",active:"jtk-drag-active",hover:"jtk-drag-hover",ghostProxy:"jtk-ghost-proxy"}});s.setZoom(t.getZoom());t[o]=s;t.bind("zoom",s.setZoom)}return s};var a=function(t){var e=t.el._jsPlumbDragOptions;var n=true;if(e.canDrag){n=e.canDrag()}if(n){this.setHoverSuspended(true);this.select({source:t.el}).addClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,true);this.select({target:t.el}).addClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,true);this.setConnectionBeingDragged(true)}return n};var l=function(t){var e=this.getUIPosition(arguments,this.getZoom());if(e!=null){var n=t.el._jsPlumbDragOptions;this.draw(t.el,e,null,true);if(n._dragging){this.addClass(t.el,"jtk-dragged")}n._dragging=true}};var u=function(t){var e=t.selection,n;var i=function(e){var i;if(e[1]!=null){n=this.getUIPosition([{el:e[2].el,pos:[e[1].left,e[1].top]}]);i=this.draw(e[2].el,n)}if(e[0]._jsPlumbDragOptions!=null){delete e[0]._jsPlumbDragOptions._dragging}this.removeClass(e[0],"jtk-dragged");this.select({source:e[2].el}).removeClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,true);this.select({target:e[2].el}).removeClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,true);t.e._drawResult=t.e._drawResult||{c:[],e:[],a:[]};Array.prototype.push.apply(t.e._drawResult.c,i.c);Array.prototype.push.apply(t.e._drawResult.e,i.e);Array.prototype.push.apply(t.e._drawResult.a,i.a);this.getDragManager().dragEnded(e[2].el)}.bind(this);for(var r=0;r<e.length;r++){i(e[r])}this.setHoverSuspended(false);this.setConnectionBeingDragged(false)};var c=function(t,e){var i=function(i){if(e[i]!=null){if(n.isString(e[i])){var r=e[i].match(/-=/)?-1:1,o=e[i].substring(2);return t[i]+r*o}else{return e[i]}}else{return t[i]}};return[i("left"),i("top")]};var h=function(t,e){if(e==null){return[0,0]}var n=g(e),i=v(n,0);return[i[t+"X"],i[t+"Y"]]},f=h.bind(this,"page"),d=h.bind(this,"screen"),p=h.bind(this,"client"),v=function(t,e){return t.item?t.item(e):t[e]},g=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]};var m=function(t){var e={},n=[],i={},r={},o={};this.register=function(s){var a=t.getId(s),l;if(!e[a]){e[a]=s;n.push(s);i[a]={}}var u=function(e){if(e){for(var n=0;n<e.childNodes.length;n++){if(e.childNodes[n].nodeType!==3&&e.childNodes[n].nodeType!==8){var c=jsPlumb.getElement(e.childNodes[n]),h=t.getId(e.childNodes[n],null,true);if(h&&r[h]&&r[h]>0){if(!l){l=t.getOffset(s)}var f=t.getOffset(c);i[a][h]={id:h,offset:{left:f.left-l.left,top:f.top-l.top}};o[h]=a}u(e.childNodes[n])}}}};u(s)};this.updateOffsets=function(e,n){if(e!=null){n=n||{};var r=jsPlumb.getElement(e),s=t.getId(r),a=i[s],l;if(a){for(var u in a){if(a.hasOwnProperty(u)){var c=jsPlumb.getElement(u),h=n[u]||t.getOffset(c);if(c.offsetParent==null&&i[s][u]!=null){continue}if(!l){l=t.getOffset(r)}i[s][u]={id:u,offset:{left:h.left-l.left,top:h.top-l.top}};o[u]=s}}}}};this.endpointAdded=function(n,s){s=s||t.getId(n);var a=document.body,l=n.parentNode;r[s]=r[s]?r[s]+1:1;while(l!=null&&l!==a){var u=t.getId(l,null,true);if(u&&e[u]){var c=t.getOffset(l);if(i[u][s]==null){var h=t.getOffset(n);i[u][s]={id:s,offset:{left:h.left-c.left,top:h.top-c.top}};o[s]=u}break}l=l.parentNode}};this.endpointDeleted=function(t){if(r[t.elementId]){r[t.elementId]--;if(r[t.elementId]<=0){for(var e in i){if(i.hasOwnProperty(e)&&i[e]){delete i[e][t.elementId];delete o[t.elementId]}}}}};this.changeId=function(t,e){i[e]=i[t];i[t]={};o[e]=o[t];o[t]=null};this.getElementsForDraggable=function(t){return i[t]};this.elementRemoved=function(t){var e=o[t];if(e){i[e]&&delete i[e][t];delete o[t]}};this.reset=function(){e={};n=[];i={};r={}};this.dragEnded=function(e){if(e.offsetParent!=null){var n=t.getId(e),i=o[n];if(i){this.updateOffsets(i)}}};this.setParent=function(e,n,r,s,a){var l=o[n];if(!i[s]){i[s]={}}var u=t.getOffset(r),c=a||t.getOffset(e);if(l&&i[l]){delete i[l][n]}i[s][n]={id:n,offset:{left:c.left-u.left,top:c.top-u.top}};o[n]=s};this.clearParent=function(t,e){var n=o[e];if(n){delete i[n][e];delete o[e]}};this.revalidateParent=function(e,n,i){var r=o[n];if(r){var s={};s[n]=i;this.updateOffsets(r,s);t.revalidate(r)}};this.getDragAncestor=function(e){var n=jsPlumb.getElement(e),i=t.getId(n),r=o[i];if(r){return jsPlumb.getElement(r)}else{return null}}};var y=function(t,e,i){e=n.fastTrim(e);if(typeof t.className.baseVal!=="undefined"){t.className.baseVal=e}else{t.className=e}try{var r=t.classList;if(r!=null){while(r.length>0){r.remove(r.item(0))}for(var o=0;o<i.length;o++){if(i[o]){r.add(i[o])}}}}catch(s){n.log("JSPLUMB: cannot set class list",s)}},b=function(t){return typeof t.className.baseVal==="undefined"?t.className:t.className.baseVal},x=function(t,e,i){e=e==null?[]:n.isArray(e)?e:e.split(/\s+/);i=i==null?[]:n.isArray(i)?i:i.split(/\s+/);var r=b(t),o=r.split(/\s+/);var s=function(t,e){for(var n=0;n<e.length;n++){if(t){if(o.indexOf(e[n])===-1){o.push(e[n])}}else{var i=o.indexOf(e[n]);if(i!==-1){o.splice(i,1)}}}};s(true,e);s(false,i);y(t,o.join(" "),o)};t.jsPlumb.extend(t.jsPlumbInstance.prototype,{headless:false,pageLocation:f,screenLocation:d,clientLocation:p,getDragManager:function(){if(this.dragManager==null){this.dragManager=new m(this)}return this.dragManager},recalculateOffsets:function(t){this.getDragManager().updateOffsets(t)},createElement:function(t,e,n,i){return this.createElementNS(null,t,e,n,i)},createElementNS:function(t,e,n,i,r){var o=t==null?document.createElement(e):document.createElementNS(t,e);var s;n=n||{};for(s in n){o.style[s]=n[s]}if(i){o.className=i}r=r||{};for(s in r){o.setAttribute(s,""+r[s])}return o},getAttribute:function(t,e){return t.getAttribute!=null?t.getAttribute(e):null},setAttribute:function(t,e,n){if(t.setAttribute!=null){t.setAttribute(e,n)}},setAttributes:function(t,e){for(var n in e){if(e.hasOwnProperty(n)){t.setAttribute(n,e[n])}}},appendToRoot:function(t){document.body.appendChild(t)},getRenderModes:function(){return["svg"]},getClass:b,addClass:function(t,e){jsPlumb.each(t,(function(t){x(t,e)}))},hasClass:function(t,e){t=jsPlumb.getElement(t);if(t.classList){return t.classList.contains(e)}else{return b(t).indexOf(e)!==-1}},removeClass:function(t,e){jsPlumb.each(t,(function(t){x(t,null,e)}))},toggleClass:function(t,e){if(jsPlumb.hasClass(t,e)){jsPlumb.removeClass(t,e)}else{jsPlumb.addClass(t,e)}},updateClasses:function(t,e,n){jsPlumb.each(t,(function(t){x(t,e,n)}))},setClass:function(t,e){if(e!=null){jsPlumb.each(t,(function(t){y(t,e,e.split(/\s+/))}))}},setPosition:function(t,e){t.style.left=e.left+"px";t.style.top=e.top+"px"},getPosition:function(t){var e=function(e){var n=t.style[e];return n?n.substring(0,n.length-2):0};return{left:e("left"),top:e("top")}},getStyle:function(t,e){if(typeof window.getComputedStyle!=="undefined"){return getComputedStyle(t,null).getPropertyValue(e)}else{return t.currentStyle[e]}},getSelector:function(t,e){var n=null;if(arguments.length===1){n=t.nodeType!=null?t:document.querySelectorAll(t)}else{n=t.querySelectorAll(e)}return n},getOffset:function(t,e,n){t=jsPlumb.getElement(t);n=n||this.getContainer();var i={left:t.offsetLeft,top:t.offsetTop},r=e||n!=null&&(t!==n&&t.offsetParent!==n)?t.offsetParent:null,o=function(t){if(t!=null&&t!==document.body&&(t.scrollTop>0||t.scrollLeft>0)){i.left-=t.scrollLeft;i.top-=t.scrollTop}}.bind(this);while(r!=null){i.left+=r.offsetLeft;i.top+=r.offsetTop;o(r);r=e?r.offsetParent:r.offsetParent===n?null:r.offsetParent}if(n!=null&&!e&&(n.scrollTop>0||n.scrollLeft>0)){var s=t.offsetParent!=null?this.getStyle(t.offsetParent,"position"):"static",a=this.getStyle(t,"position");if(a!=="absolute"&&a!=="fixed"&&s!=="absolute"&&s!=="fixed"){i.left-=n.scrollLeft;i.top-=n.scrollTop}}return i},getPositionOnElement:function(t,e,n){var i=typeof e.getBoundingClientRect!=="undefined"?e.getBoundingClientRect():{left:0,top:0,width:0,height:0},r=document.body,o=document.documentElement,s=window.pageYOffset||o.scrollTop||r.scrollTop,a=window.pageXOffset||o.scrollLeft||r.scrollLeft,l=o.clientTop||r.clientTop||0,u=o.clientLeft||r.clientLeft||0,c=0,h=0,f=i.top+s-l+c*n,d=i.left+a-u+h*n,p=jsPlumb.pageLocation(t),v=i.width||e.offsetWidth*n,g=i.height||e.offsetHeight*n,m=(p[0]-d)/v,y=(p[1]-f)/g;return[m,y]},getAbsolutePosition:function(t){var e=function(e){var n=t.style[e];if(n){return parseFloat(n.substring(0,n.length-2))}};return[e("left"),e("top")]},setAbsolutePosition:function(t,e,n,i){if(n){this.animate(t,{left:"+="+(e[0]-n[0]),top:"+="+(e[1]-n[1])},i)}else{t.style.left=e[0]+"px";t.style.top=e[1]+"px"}},getSize:function(t){return[t.offsetWidth,t.offsetHeight]},getWidth:function(t){return t.offsetWidth},getHeight:function(t){return t.offsetHeight},getRenderMode:function(){return"svg"},draggable:function(t,e){var i;t=n.isArray(t)||t.length!=null&&!n.isString(t)?t:[t];Array.prototype.slice.call(t).forEach(function(t){i=this.info(t);if(i.el){this._initDraggableIfNecessary(i.el,true,e,i.id,true)}}.bind(this));return this},snapToGrid:function(t,e,n){var i=[];var r=function(t){var r=this.info(t);if(r.el!=null&&r.el._katavorioDrag){var o=r.el._katavorioDrag.snap(e,n);this.revalidate(r.el);i.push([r.el,o])}}.bind(this);if(arguments.length===1||arguments.length===3){r(t,e,n)}else{var o=this.getManagedElements();for(var s in o){r(s,arguments[0],arguments[1])}}return i},initDraggable:function(t,e,n){s(this,n).draggable(t,e);t._jsPlumbDragOptions=e},destroyDraggable:function(t,e){s(this,e).destroyDraggable(t);t._jsPlumbDragOptions=null;t._jsPlumbRelatedElement=null},unbindDraggable:function(t,e,n,i){s(this,i).destroyDraggable(t,e,n)},setDraggable:function(t,e){return jsPlumb.each(t,function(t){if(this.isDragSupported(t)){this._draggableStates[this.getAttribute(t,"id")]=e;this.setElementDraggable(t,e)}}.bind(this))},_draggableStates:{},toggleDraggable:function(t){var e;jsPlumb.each(t,function(t){var n=this.getAttribute(t,"id");e=this._draggableStates[n]==null?false:this._draggableStates[n];e=!e;this._draggableStates[n]=e;this.setDraggable(t,e);return e}.bind(this));return e},_initDraggableIfNecessary:function(t,e,i,r,o){if(!jsPlumb.headless){var s=e==null?false:e;if(s){if(jsPlumb.isDragSupported(t,this)){var c=i||this.Defaults.DragOptions;c=jsPlumb.extend({},c);if(!jsPlumb.isAlreadyDraggable(t,this)){var h=jsPlumb.dragEvents.drag,f=jsPlumb.dragEvents.stop,d=jsPlumb.dragEvents.start;this.manage(r,t);c[d]=n.wrap(c[d],a.bind(this));c[h]=n.wrap(c[h],l.bind(this));c[f]=n.wrap(c[f],u.bind(this));var p=this.getId(t);this._draggableStates[p]=true;var v=this._draggableStates[p];c.disabled=v==null?false:!v;this.initDraggable(t,c);this.getDragManager().register(t);if(o){this.fire("elementDraggable",{el:t,options:c})}}else{if(i.force){this.initDraggable(t,c)}}}}}},animationSupported:true,getElement:function(t){if(t==null){return null}t=typeof t==="string"?t:t.tagName==null&&t.length!=null&&t.enctype==null?t[0]:t;return typeof t==="string"?document.getElementById(t):t},removeElement:function(t){s(this).elementRemoved(t);this.getEventManager().remove(t)},doAnimate:function(t,n,i){i=i||{};var r=this.getOffset(t),o=c(r,n),s=o[0]-r.left,a=o[1]-r.top,l=i.duration||250,u=15,h=l/u,f=u/l*s,d=u/l*a,p=0,v=setInterval((function(){e.setPosition(t,{left:r.left+f*(p+1),top:r.top+d*(p+1)});if(i.step!=null){i.step(p,Math.ceil(h))}p++;if(p>=h){window.clearInterval(v);if(i.complete!=null){i.complete()}}}),u)},destroyDroppable:function(t,e){s(this,e).destroyDroppable(t)},unbindDroppable:function(t,e,n,i){s(this,i).destroyDroppable(t,e,n)},droppable:function(t,e){t=n.isArray(t)||t.length!=null&&!n.isString(t)?t:[t];var i;e=e||{};e.allowLoopback=false;Array.prototype.slice.call(t).forEach(function(t){i=this.info(t);if(i.el){this.initDroppable(i.el,e)}}.bind(this));return this},initDroppable:function(t,e,n){s(this,n).droppable(t,e)},isAlreadyDraggable:function(t){return t._katavorioDrag!=null},isDragSupported:function(t,e){return true},isDropSupported:function(t,e){return true},isElementDraggable:function(t){t=e.getElement(t);return t._katavorioDrag&&t._katavorioDrag.isEnabled()},getDragObject:function(t){return t[0].drag.getDragElement()},getDragScope:function(t){return t._katavorioDrag&&t._katavorioDrag.scopes.join(" ")||""},getDropEvent:function(t){return t[0].e},getUIPosition:function(t,e){var n=t[0].el;if(n.offsetParent==null){return null}var i=t[0].finalPos||t[0].pos;var r={left:i[0],top:i[1]};if(n._katavorioDrag&&n.offsetParent!==this.getContainer()){var o=this.getOffset(n.offsetParent);r.left+=o.left;r.top+=o.top}return r},setDragFilter:function(t,e,n){if(t._katavorioDrag){t._katavorioDrag.setFilter(e,n)}},setElementDraggable:function(t,n){t=e.getElement(t);if(t._katavorioDrag){t._katavorioDrag.setEnabled(n)}},setDragScope:function(t,e){if(t._katavorioDrag){t._katavorioDrag.k.setDragScope(t,e)}},setDropScope:function(t,e){if(t._katavorioDrop&&t._katavorioDrop.length>0){t._katavorioDrop[0].k.setDropScope(t,e)}},addToPosse:function(t,n){var i=Array.prototype.slice.call(arguments,1);var r=s(this);e.each(t,(function(t){t=[e.getElement(t)];t.push.apply(t,i);r.addToPosse.apply(r,t)}))},setPosse:function(t,n){var i=Array.prototype.slice.call(arguments,1);var r=s(this);e.each(t,(function(t){t=[e.getElement(t)];t.push.apply(t,i);r.setPosse.apply(r,t)}))},removeFromPosse:function(t,n){var i=Array.prototype.slice.call(arguments,1);var r=s(this);e.each(t,(function(t){t=[e.getElement(t)];t.push.apply(t,i);r.removeFromPosse.apply(r,t)}))},removeFromAllPosses:function(t){var n=s(this);e.each(t,(function(t){n.removeFromAllPosses(e.getElement(t))}))},setPosseState:function(t,n,i){var r=s(this);e.each(t,(function(t){r.setPosseState(e.getElement(t),n,i)}))},dragEvents:{start:"start",stop:"stop",drag:"drag",step:"step",over:"over",out:"out",drop:"drop",complete:"complete",beforeStart:"beforeStart"},animEvents:{step:"step",complete:"complete"},stopDrag:function(t){if(t._katavorioDrag){t._katavorioDrag.abort()}},addToDragSelection:function(t){var e=this.getElement(t);if(e!=null&&(e._isJsPlumbGroup||e._jsPlumbGroup==null)){s(this).select(t)}},removeFromDragSelection:function(t){s(this).deselect(t)},getDragSelection:function(){return s(this).getSelection()},clearDragSelection:function(){s(this).deselectAll()},trigger:function(t,e,n,i){this.getEventManager().trigger(t,e,n,i)},doReset:function(){for(var t in this){if(t.indexOf("_katavorio_")===0){this[t].reset()}}},getEventManager:function(){return o(this)},on:function(t,e,n){this.getEventManager().on.apply(this,arguments);return this},off:function(t,e,n){this.getEventManager().off.apply(this,arguments);return this}});var P=function(t){var e=function(){if(/complete|loaded|interactive/.test(document.readyState)&&typeof document.body!=="undefined"&&document.body!=null){t()}else{setTimeout(e,9)}};e()};P(e.init)}).call(typeof window!=="undefined"?window:commonjsGlobal)}));var jsplumb_6=jsplumb.jsPlumb;var JsPlumbUtils=function(){function t(){}return t}();JsPlumbUtils.createInstance=function(t,e){return jsplumb_6.getInstance({ConnectionsDetachable:!e,DragOptions:{cursor:"pointer",zIndex:2e3},ConnectionOverlays:[["Arrow",{location:1,visible:true,width:11,length:11}],["Label",{location:.5,id:"label",cssClass:"connection-label"}]],Container:t})};JsPlumbUtils.createEndpointUuid=function(t,e){return"activity-"+t+"-"+e};JsPlumbUtils.getSourceEndpointOptions=function(t,e,n){var i="#7da7f2";var r=i;var o=n?"#6faa44":"#999999";return{type:"Dot",anchor:"Continuous",paintStyle:{stroke:r,fill:i,strokeWidth:2},isSource:true,connector:["Flowchart",{stub:[40,60],gap:0,cornerRadius:5,alwaysRespectStubs:true}],connectorStyle:{strokeWidth:2,stroke:o},connectorHoverStyle:{strokeWidth:2,stroke:o},connectorOverlays:[["Label",{location:[3,-1.5],cssClass:"endpointSourceLabel"}]],hoverPaintStyle:{fill:r,stroke:i},dragOptions:{},uuid:JsPlumbUtils.createEndpointUuid(t,e),parameters:{outcome:e},scope:null,reattachConnections:true,maxConnections:1}};var rng;var crypto=typeof commonjsGlobal!=="undefined"&&(commonjsGlobal.crypto||commonjsGlobal.msCrypto);if(crypto&&crypto.getRandomValues){var rnds8=new Uint8Array(16);rng=function t(){crypto.getRandomValues(rnds8);return rnds8}}if(!rng){var rnds=new Array(16);rng=function(){for(var t=0,e;t<16;t++){if((t&3)===0)e=Math.random()*4294967296;rnds[t]=e>>>((t&3)<<3)&255}return rnds}}var rngBrowser=rng;var byteToHex=[];for(var i=0;i<256;++i){byteToHex[i]=(i+256).toString(16).substr(1)}function bytesToUuid(t,e){var n=e||0;var i=byteToHex;return i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]}var bytesToUuid_1=bytesToUuid;function v4(t,e,n){var i=e&&n||0;if(typeof t=="string"){e=t=="binary"?new Array(16):null;t=null}t=t||{};var r=t.random||(t.rng||rngBrowser)();r[6]=r[6]&15|64;r[8]=r[8]&63|128;if(e){for(var o=0;o<16;++o){e[i+o]=r[o]}}return e||bytesToUuid_1(r)}var v4_1=v4;function deepClone(t){var e=JSON.stringify(t);return JSON.parse(e)}var designerCss='.jtk-connector{overflow:visible}.jtk-node{position:absolute}.jtk-group{position:absolute;overflow:visible}[jtk-group-content]{position:relative}.jtk-node.jtk-drag{}.katavorio-clone-drag{pointer-events:none}.jtk-surface{overflow:hidden !important;position:relative;cursor:move;cursor:-moz-grab;cursor:-webkit-grab;-ms-touch-action:none;touch-action:none;}.jtk-surface-panning{cursor:-moz-grabbing;cursor:-webkit-grabbing;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.jtk-surface-canvas{overflow:visible !important}.jtk-surface-droppable-node{-ms-touch-action:none;touch-action:none}.jtk-surface-nopan{overflow:scroll !important;cursor:default}.jtk-surface-tile{border:none;outline:none;margin:0;-webkit-transition:opacity .3s ease .15s;-moz-transition:opacity .3s ease .15s;-o-transition:opacity .3s ease .15s;-ms-transition:opacity .3s ease .15s;transition:opacity .3s ease .15s}.jtk-lasso{border:2px solid rgb(49, 119, 184);background-color:WhiteSmoke;opacity:0.5;display:none;z-index:20000;position:absolute}.jtk-lasso-select-defeat *{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.jtk-lasso-mask{position:fixed;z-index:20000;display:none;opacity:0.5;background-color:#07234E;top:0;bottom:0;left:0;right:0}.jtk-surface-selected-element{border:2px dashed #f76258 !important}.jtk-surface-pan{background-color:Azure;opacity:0.4;text-align:center;cursor:pointer;z-index:2;-webkit-transition:background-color 0.15s ease-in;-moz-transition:background-color 0.15s ease-in;-o-transition:background-color 0.15s ease-in;transition:background-color 0.15s ease-in}.jtk-surface-pan-top,.jtk-surface-pan-bottom{width:100%;height:20px}.jtk-surface-pan-top:hover,.jtk-surface-pan-bottom:hover,.jtk-surface-pan-left:hover,.jtk-surface-pan-right:hover{opacity:0.6;background-color:rgb(49, 119, 184);color:white;font-weight:bold}.jtk-surface-pan-left,.jtk-surface-pan-right{width:20px;height:100%;line-height:40}.jtk-surface-pan-active,.jtk-surface-pan-active:hover{background-color:#f76258}.jtk-miniview{overflow:hidden !important;width:125px;height:125px;position:relative;background-color:#B2C9CD;border:1px solid #E2E6CD;border-radius:4px;opacity:0.8}.jtk-miniview-panner{border:5px dotted WhiteSmoke;opacity:0.4;background-color:rgb(79, 111, 126);cursor:move;cursor:-moz-grab;cursor:-webkit-grab}.jtk-miniview-panning{cursor:-moz-grabbing;cursor:-webkit-grabbing}.jtk-miniview-element{background-color:rgb(96, 122, 134);position:absolute}.jtk-miniview-group-element{background:transparent;border:2px solid rgb(96,122,134)}.jtk-miniview-collapse{color:whiteSmoke;position:absolute;font-size:18px;top:-1px;right:3px;cursor:pointer;font-weight:bold}.jtk-miniview-collapse:before{content:"\\2012"}.jtk-miniview-collapsed{background-color:#449ea6;border-radius:4px;height:22px;margin-right:0;padding:4px;width:21px}.jtk-miniview-collapsed .jtk-miniview-element,.jtk-miniview-collapsed .jtk-miniview-panner{visibility:hidden}.jtk-miniview-collapsed .jtk-miniview-collapse:before{content:"+"}.jtk-miniview-collapse:hover{color:#E4F013}.jtk-dialog-underlay{left:0;right:0;top:0;bottom:0;position:fixed;z-index:100000;opacity:0.8;background-color:#CCC;display:none}.jtk-dialog-overlay{position:fixed;z-index:100001;display:none;background-color:white;font-family:"Open Sans", sans-serif;padding:7px;-webkit-box-shadow:0 0 5px gray;box-shadow:0 0 5px gray;overflow:hidden}.jtk-dialog-overlay-x{max-height:0;transition:max-height 0.5s ease-in;-moz-transition:max-height 0.5s ease-in;-ms-transition:max-height 0.5s ease-in;-o-transition:max-height 0.5s ease-in;-webkit-transition:max-height 0.5s ease-in}.jtk-dialog-overlay-y{max-width:0;transition:max-width 0.5s ease-in;-moz-transition:max-width 0.5s ease-in;-ms-transition:max-width 0.5s ease-in;-o-transition:max-width 0.5s ease-in;-webkit-transition:max-width 0.5s ease-in}.jtk-dialog-overlay-top{top:20px}.jtk-dialog-overlay-bottom{bottom:20px}.jtk-dialog-overlay-left{left:20px}.jtk-dialog-overlay-right{right:20px}.jtk-dialog-overlay-x.jtk-dialog-overlay-visible{max-height:1000px}.jtk-dialog-overlay-y.jtk-dialog-overlay-visible{max-width:1000px}.jtk-dialog-buttons{text-align:right;margin-top:5px}.jtk-dialog-button{border:none;cursor:pointer;margin-right:5px;min-width:56px;background-color:white;outline:1px solid #ccc}.jtk-dialog-button:hover{color:white;background-color:#234b5e}.jtk-dialog-title{text-align:left;font-size:14px;margin-bottom:9px}.jtk-dialog-content{font-size:12px;text-align:left;min-width:250px;margin:0 14px}.jtk-dialog-content ul{width:100%;padding-left:0}.jtk-dialog-content label{cursor:pointer;font-weight:inherit}.jtk-dialog-overlay input,.jtk-dialog-overlay textarea{background-color:#FFF;border:1px solid #CCC;color:#333;font-size:14px;font-style:normal;outline:none;padding:6px 4px;margin-right:6px}.jtk-dialog-overlay input:focus,.jtk-dialog-overlay textarea:focus{background-color:#cbeae1;border:1px solid #83b8a8;color:#333;font-size:14px;font-style:normal;outline:none}.jtk-draw-skeleton{position:absolute;left:0;right:0;top:0;bottom:0;outline:2px solid #84acb3;opacity:0.8}.jtk-draw-handle{position:absolute;width:7px;height:7px;background-color:#84acb3}.jtk-draw-handle-tl{left:0;top:0;cursor:nw-resize}.jtk-draw-handle-tr{right:0;top:0;cursor:ne-resize}.jtk-draw-handle-bl{left:0;bottom:0;cursor:sw-resize}.jtk-draw-handle-br{bottom:0;right:0;cursor:se-resize}.jtk-draw-drag{display:none;position:absolute;left:50%;top:50%;margin-left:-10px;margin-top:-10px;width:20px;height:20px;background-color:#84acb3;cursor:move}.jtk-drag-select-defeat *{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.workflow-canvas{position:relative;display:block;-ms-touch-action:none;touch-action:none;width:auto;height:100vh}.workflow-canvas .noselect{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}.workflow-canvas .activity{display:block;border:1px solid #cccccc;-webkit-box-shadow:2px 2px 19px #aaa;box-shadow:2px 2px 19px #aaa;border-radius:0.5em;opacity:0.8;min-width:80px;min-height:80px;max-width:250px;text-align:left;z-index:20;position:absolute;background-color:#f1f1f1;color:#3d3d3d;font-family:helvetica, sans-serif;padding:1em;font-size:0.7em;cursor:default;-webkit-transition:-webkit-box-shadow 0.15s ease-in;transition:-webkit-box-shadow 0.15s ease-in;transition:box-shadow 0.15s ease-in;transition:box-shadow 0.15s ease-in, -webkit-box-shadow 0.15s ease-in}.workflow-canvas .activity .activity-status{position:absolute;right:4px;bottom:4px;cursor:pointer}.workflow-canvas .activity .activity-status i{font-size:2em}.workflow-canvas .activity.activity-definition{border:1px solid #5a8fee}.workflow-canvas .activity.activity-executed{border:1px solid #6faa44;background-color:#6faa44;color:#ffffff}.workflow-canvas .activity.activity-executed h5,.workflow-canvas .activity.activity-executed h5 i{color:#ffffff}.workflow-canvas .activity.activity-blocking{border:1px solid #5a8fee;background-color:#5a8fee;color:#ffffff}.workflow-canvas .activity.activity-blocking h5,.workflow-canvas .activity.activity-blocking h5 i{color:#ffffff}.workflow-canvas .activity.activity-faulted{border:1px solid #d23c3c;background-color:#d23c3c;color:#ffffff}.workflow-canvas .activity.activity-faulted h5,.workflow-canvas .activity.activity-faulted h5 i{color:#ffffff}.jtk-connector{z-index:4}.jtk-endpoint,.endpointTargetLabel,.endpointSourceLabel{z-index:21;cursor:pointer}.endpointTargetLabel,.endpointSourceLabel{font-size:8px}.jtk-overlay{background-color:transparent}.connection-label{z-index:31;border:1px solid #cccccc;padding:0 0.5em;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;background-color:white}';var Designer=exports("wf_designer",function(){function t(t){var e=this;registerInstance(this,t);this.editActivityEvent=createEvent(this,"edit-activity",7);this.addActivityEvent=createEvent(this,"add-activity",7);this.workflowChanged=createEvent(this,"workflowChanged",7);this.activityDefinitions=[];this.workflow={activities:[],connections:[]};this.lastClickedLocation=null;this.elem=function(){return e.el};this.renderContextMenu=function(){if(e.readonly)return null;return[h("wf-context-menu",{target:e.elem()},h("wf-context-menu-item",{text:"Add Activity",onClick:e.onAddActivityClick})),h("wf-context-menu",{ref:function(t){return e.activityContextMenu=t}},h("wf-context-menu-item",{text:"Edit",onClick:e.onEditActivityClick}),h("wf-context-menu-item",{text:"Delete",onClick:e.onDeleteActivityClick}))]};this.deleteActivity=function(t){return __awaiter(e,void 0,void 0,(function(){var e,n;return __generator(this,(function(i){e=this.workflow.activities.filter((function(e){return e.id!==t.id}));n=this.workflow.connections.filter((function(e){return e.sourceActivityId!=t.id&&e.destinationActivityId!=t.id}));this.workflow=Object.assign(Object.assign({},this.workflow),{activities:e,connections:n});return[2]}))}))};this.setupJsPlumb=function(){e.jsPlumb.reset();e.setupJsPlumbEventHandlers();e.jsPlumb.batch((function(){e.getActivityElements().forEach(e.setupActivityElement);e.setupConnections()}));e.jsPlumb.repaintEverything()};this.setupPopovers=function(){$('[data-toggle="popover"]').popover({})};this.setupActivityElement=function(t){if(!e.readonly){e.setupDragDrop(t)}e.setupTargets(t);e.setupOutcomes(t);e.jsPlumb.revalidate(t)};this.setupDragDrop=function(t){var n=null;var i=false;e.jsPlumb.draggable(t,{containment:"true",start:function(t){n={left:t.e.screenX,top:t.e.screenY}},stop:function(r){return __awaiter(e,void 0,void 0,(function(){var e;return __generator(this,(function(o){switch(o.label){case 0:i=n.left!==r.e.screenX||n.top!==r.e.screenY;if(!i)return[2];e=Object.assign({},this.findActivityByElement(t));e.left=r.pos[0];e.top=r.pos[1];return[4,this.updateActivityInternal(e)];case 1:o.sent();return[2]}}))}))}})};this.setupConnections=function(){for(var t=0,n=e.workflow.connections;t<n.length;t++){var i=n[t];var r=JsPlumbUtils.createEndpointUuid(i.sourceActivityId,i.outcome);var o=e.jsPlumb.getEndpoint(r);var s="wf-activity-"+i.destinationActivityId;e.jsPlumb.connect({source:o,target:s})}};this.findActivityByElement=function(t){var n=Designer.getActivityId(t);return e.findActivityById(n)};this.findActivityById=function(t){return e.workflow.activities.find((function(e){return e.id===t}))};this.updateActivityInternal=function(t){return __awaiter(e,void 0,void 0,(function(){var e,n;return __generator(this,(function(i){e=__spreadArrays(this.workflow.activities);n=e.findIndex((function(e){return e.id==t.id}));e[n]=Object.assign({},t);this.workflow=Object.assign(Object.assign({},this.workflow),{activities:e});return[2]}))}))};this.setupJsPlumbEventHandlers=function(){e.jsPlumb.bind("connection",e.connectionCreated);e.jsPlumb.bind("connectionDetached",e.connectionDetached)};this.connectionCreated=function(t){return __awaiter(e,void 0,void 0,(function(){var e,n,i,r,o,s,a,l;return __generator(this,(function(u){e=t.connection;n=t.sourceEndpoint;i=n.getParameter("outcome");r=e.getOverlay("label");r.setLabel(i);o=this.findActivityByElement(t.source);s=this.findActivityByElement(t.target);a=this.workflow.connections.find((function(t){return t.sourceActivityId===o.id&&t.destinationActivityId==s.id}));if(!a){l=__spreadArrays(this.workflow.connections,[{sourceActivityId:o.id,destinationActivityId:s.id,outcome:i}]);this.workflow=Object.assign(Object.assign({},this.workflow),{connections:l})}return[2]}))}))};this.connectionDetached=function(t){return __awaiter(e,void 0,void 0,(function(){var e,n,i,r,o;return __generator(this,(function(s){e=t.sourceEndpoint;n=e.getParameter("outcome");i=this.findActivityByElement(t.source);r=this.findActivityByElement(t.target);o=this.workflow.connections.filter((function(t){return!(t.sourceActivityId===i.id&&t.destinationActivityId===r.id&&t.outcome===n)}));this.workflow=Object.assign(Object.assign({},this.workflow),{connections:o});return[2]}))}))};this.onAddActivityClick=function(t){var n=e.elem();e.lastClickedLocation={left:t.pageX-n.offsetLeft,top:t.pageY-n.offsetTop};e.addActivityEvent.emit()};this.onDeleteActivityClick=function(){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.deleteActivity(this.selectedActivity)];case 1:t.sent();return[2]}}))}))};this.onEditActivityClick=function(){e.onEditActivity(e.selectedActivity)}}t.prototype.onWorkflowChanged=function(t){this.workflowChanged.emit(deepClone(t))};t.prototype.newWorkflow=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.workflow={activities:[],connections:[]};return[2]}))}))};t.prototype.getWorkflow=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,deepClone(this.workflow)]}))}))};t.prototype.addActivity=function(t){return __awaiter(this,void 0,void 0,(function(){var e,n,i,r;return __generator(this,(function(o){e=!!this.lastClickedLocation?this.lastClickedLocation.left:150;n=!!this.lastClickedLocation?this.lastClickedLocation.top:150;i={id:v4_1(),top:n,left:e,type:t.type,state:{}};this.lastClickedLocation=null;r=__spreadArrays(this.workflow.activities,[i]);this.workflow=Object.assign(Object.assign({},this.workflow),{activities:r});return[2]}))}))};t.prototype.updateActivity=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.updateActivityInternal(t)];case 1:e.sent();return[2]}}))}))};t.prototype.componentWillLoad=function(){this.jsPlumb=JsPlumbUtils.createInstance(".workflow-canvas",this.readonly)};t.prototype.componentDidRender=function(){this.setupJsPlumb();this.setupPopovers()};t.prototype.render=function(){var t=this;var e=this.createActivityModels();return h("host",{class:"workflow-canvas",ref:function(e){return t.canvas=e},style:{height:this.canvasHeight}},e.map((function(e){var n=e.activity;var i={left:n.left+"px",top:n.top+"px"};var r={activity:true,"activity-blocking":!!n.blocking,"activity-executed":!!n.executed,"activity-faulted":n.faulted};if(!t.readonly){return h("div",{id:"wf-activity-"+n.id,"data-activity-id":n.id,class:r,style:i,onDblClick:function(){return t.onEditActivity(n)},onContextMenu:function(e){return t.onActivityContextMenu(e,n)}},h("wf-activity-renderer",{activity:n,activityDefinition:e.definition,displayMode:ActivityDisplayMode.Design}))}else{r["noselect"]=true;var o={};if(!!n.message){o["data-toggle"]="popover";o["data-trigger"]="hover";o["title"]=n.message.title;o["data-content"]=n.message.content}return h("div",Object.assign({id:"wf-activity-"+n.id,"data-activity-id":n.id,class:r,style:i},o),h("wf-activity-renderer",{activity:n,activityDefinition:e.definition,displayMode:ActivityDisplayMode.Design}))}})),this.renderContextMenu())};t.prototype.createActivityModels=function(){var t=this.workflow||{activities:[],connections:[]};var e=this.activityDefinitions||[];return t.activities.map((function(t){var n=e.find((function(e){return e.type==t.type}));return{activity:t,definition:n}}))};t.prototype.setupTargets=function(t){this.jsPlumb.makeTarget(t,{dropOptions:{hoverClass:"hover"},anchor:"Continuous",endpoint:["Blank",{radius:4}]})};t.prototype.setupOutcomes=function(t){var e=this.findActivityByElement(t);var n=this.activityDefinitions.find((function(t){return t.type==e.type}));var i=ActivityManager$1.getOutcomes(e,n);var r=e.executed;for(var o=0,s=i;o<s.length;o++){var a=s[o];var l=JsPlumbUtils.getSourceEndpointOptions(e.id,a,r);var u={connectorOverlays:[["Label",{label:a,cssClass:"connection-label"}]]};this.jsPlumb.addEndpoint(t,u,l)}};t.prototype.getActivityElements=function(){return this.elem().querySelectorAll(".activity")};t.getActivityId=function(t){return t.attributes["data-activity-id"].value};t.prototype.onEditActivity=function(t){var e=deepClone(t);this.editActivityEvent.emit(e)};t.prototype.onActivityContextMenu=function(t,e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:this.selectedActivity=e;return[4,this.activityContextMenu.handleContextMenuEvent(t)];case 1:n.sent();return[2]}}))}))};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{workflow:["onWorkflowChanged"]}},enumerable:false,configurable:true});return t}());Designer.style=designerCss;var dragscroll=createCommonjsModule((function(t,e){!function(t,n){n(e)}(commonjsGlobal,(function(t){var e,n,i=window,r=document,o="mousemove",s="mouseup",a="mousedown",l="EventListener",u="add"+l,c="remove"+l,h=[],f=function(t,l){for(t=0;t<h.length;)l=h[t++],l=l.container||l,l[c](a,l.md,0),i[c](s,l.mu,0),i[c](o,l.mm,0);for(h=[].slice.call(r.getElementsByClassName("dragscroll")),t=0;t<h.length;)!function(t,l,c,h,f,d){(d=t.container||t)[u](a,d.md=function(e){t.hasAttribute("nochilddrag")&&r.elementFromPoint(e.pageX,e.pageY)!=d||(h=1,l=e.clientX,c=e.clientY,e.preventDefault())},0),i[u](s,d.mu=function(){h=0},0),i[u](o,d.mm=function(i){h&&((f=t.scroller||t).scrollLeft-=e=-l+(l=i.clientX),f.scrollTop-=n=-c+(c=i.clientY),t==r.body&&((f=r.documentElement).scrollLeft-=e,f.scrollTop-=n))},0)}(h[t++])};"complete"==r.readyState?f():i[u]("load",f,0),t.reset=f}))}));var BooleanFieldDriver=function(){function t(){this.displayEditor=function(t,e){var n=e.name;var i=e.label;var r=t.state[n]==="true";return'<wf-boolean-field name="'+n+'" label="'+i+'" hint="'+e.hint+'" checked="'+r+'"></wf-boolean-field>'};this.updateEditor=function(t,e,n){t.state[e.name]=n.get(e.name)}}return t}();var ExpressionFieldDriver=function(){function t(){this.displayEditor=function(t,e){var n=e.name;var i=e.label;var r=t.state[n]||{expression:"",syntax:"Literal"};var o=(e.options||{}).multiline||false;var s=r.expression.replace(/"/g,"&quot;");return'<wf-expression-field name="'+n+'" label="'+i+'" hint="'+e.hint+'" value="'+s+'" syntax="'+r.syntax+'" multiline="'+o+'"></wf-expression-field>'};this.updateEditor=function(t,e,n){var i=e.name+".expression";var r=e.name+".syntax";var o=n.get(i).toString().trim();var s=n.get(r).toString();t.state[e.name]={expression:o,syntax:s}}}return t}();var ListFieldDriver=function(){function t(){this.displayEditor=function(t,e){var n=e.name;var i=e.label;var r=t.state[n]||[];var o=r.join(", ");return'<wf-list-field name="'+n+'" label="'+i+'" hint="'+e.hint+'" items="'+o+'"></wf-list-field>'};this.updateEditor=function(t,e,n){var i=n.get(e.name).toString();t.state[e.name]=i.split(",").map((function(t){return t.trim()}))}}return t}();var TextFieldDriver=function(){function t(){this.displayEditor=function(t,e){var n=e.name;var i=e.label;var r=t.state[n]||"";return'<wf-text-field name="'+n+'" label="'+i+'" hint="'+e.hint+'" value="'+r+'"></wf-text-field>'};this.updateEditor=function(t,e,n){t.state[e.name]=n.get(e.name).toString().trim()}}return t}();var SelectFieldDriver=function(){function t(){this.displayEditor=function(t,e){var n=e.name;var i=e.label;var r=t.state[n]||"";var o=e.options.items||[];var s=encodeURI(JSON.stringify(o));return'<wf-select-field name="'+n+'" label="'+i+'" hint="'+e.hint+'" data-items="'+s+'" value="'+r+'"></wf-select-field>'};this.updateEditor=function(t,e,n){var i=n.get(e.name).toString();t.state[e.name]=i.trim()}}return t}();var WorkflowPluginStore=function(){function t(){var t=this;this.plugins=[];this.add=function(e){t.plugins=__spreadArrays(t.plugins,[e])};this.list=function(){return __spreadArrays(t.plugins)}}return t}();var pluginStore=new WorkflowPluginStore;var win=window;var elsa=win.elsa||{};elsa.pluginStore=pluginStore;win.elsa=elsa;var OutcomeNames;(function(t){t["Done"]="Done";t["True"]="True";t["False"]="False"})(OutcomeNames||(OutcomeNames={}));var ConsoleActivities=function(){function t(){var e=this;this.getName=function(){return"ConsoleActivities"};this.getActivityDefinitions=function(){return[e.readLine(),e.writeLine()]};this.readLine=function(){return{type:"ReadLine",displayName:"Read Line",description:"Read text from standard in.",runtimeDescription:"a => !!a.state.variableName ? `Read text from standard in and store into <strong>${ a.state.variableName }</strong>.` : 'Read text from standard in.'",outcomes:[OutcomeNames.Done],category:t.Category,icon:"fas fa-terminal",properties:[{name:"variableName",type:"text",label:"Variable Name",hint:"The name of the variable to store the value into."}]}};this.writeLine=function(){return{type:"WriteLine",displayName:"Write Line",description:"Write text to standard out.",category:t.Category,icon:"fas fa-terminal",runtimeDescription:"x => !!x.state.textExpression ? `Write <strong>${ x.state.textExpression.expression }</strong> to standard out.` : x.definition.description",outcomes:[OutcomeNames.Done],properties:[{name:"textExpression",type:"expression",label:"Text",hint:"The text to write."}]}}}return t}();ConsoleActivities.Category="Console";pluginStore.add(new ConsoleActivities);var ControlFlowActivities=function(){function t(){var e=this;this.getName=function(){return"ControlFlowActivities"};this.getActivityDefinitions=function(){return[e.fork(),e.ifElse(),e.join(),e.switch()]};this.fork=function(){return{type:"Fork",displayName:"Fork",description:"Fork workflow execution into multiple branches.",category:t.Category,icon:"fas fa-code-branch fa-rotate-180",outcomes:"x => x.state.branches",properties:[{name:"branches",type:"list",label:"Branches",hint:"Enter one or more names representing branches, separated with a comma. Example: Branch 1, Branch 2"}]}};this.ifElse=function(){return{type:"IfElse",displayName:"If/Else",description:"Evaluate a Boolean expression and continue execution depending on the result.",category:t.Category,runtimeDescription:"x => !!x.state.expression ? `Evaluate <strong>${ x.state.expression.expression }</strong> and continue execution depending on the result.` : x.definition.description",outcomes:[OutcomeNames.True,OutcomeNames.False],properties:[{name:"expression",type:"expression",label:"Expression",hint:"The expression to evaluate. The evaluated value will be used to switch on."}]}};this.join=function(){return{type:"Join",displayName:"Join",description:"Merge workflow execution back into a single branch.",category:t.Category,icon:"fas fa-code-branch",runtimeDescription:"x => !!x.state.joinMode ? `Merge workflow execution back into a single branch using mode <strong>${ x.state.joinMode }</strong>` : x.definition.description",outcomes:[OutcomeNames.Done],properties:[{name:"joinMode",type:"text",label:"Join Mode",hint:"Either 'WaitAll' or 'WaitAny'"}]}};this.switch=function(){return{type:"Switch",displayName:"Switch",description:"Switch execution based on a given expression.",category:t.Category,icon:"far fa-list-alt",runtimeDescription:"x => !!x.state.expression ? `Switch execution based on <strong>${ x.state.expression.expression }</strong>.` : x.definition.description",outcomes:"x => x.state.cases.map(c => c.toString())",properties:[{name:"expression",type:"expression",label:"Expression",hint:"The expression to evaluate. The evaluated value will be used to switch on."},{name:"cases",type:"list",label:"Cases",hint:"A comma-separated list of possible outcomes of the expression."}]}}}return t}();ControlFlowActivities.Category="Control Flow";pluginStore.add(new ControlFlowActivities);var EmailActivities=function(){function t(){var e=this;this.getName=function(){return"EmailActivities"};this.getActivityDefinitions=function(){return[e.sendEmail()]};this.sendEmail=function(){return{type:"SendEmail",displayName:"Send Email",description:"Send an email message.",category:t.Category,icon:"far fa-envelope",outcomes:[OutcomeNames.Done],properties:[{name:"from",type:"expression",label:"From",hint:"The sender's email address"},{name:"to",type:"expression",label:"To",hint:"The recipient's email address"},{name:"subject",type:"expression",label:"Subject",hint:"The subject of the email message."},{name:"body",type:"expression",label:"Body",hint:"The body of the email message.",options:{multiline:true}}]}}}return t}();EmailActivities.Category="Email";pluginStore.add(new EmailActivities);var HttpActivities=function(){function t(){var e=this;this.getName=function(){return"HttpActivities"};this.getActivityDefinitions=function(){return[e.sendHttpRequest(),e.sendHttpResponse(),e.handleHttpRequest()]};this.sendHttpRequest=function(){return{type:"HttpRequestAction",displayName:"Send HTTP Request",description:"Send an HTTP request.",category:t.Category,icon:"fas fa-cloud",properties:[{name:"url",type:"text",label:"URL",hint:"The URL to send the HTTP request to."},{name:"method",type:"select",label:"Method",hint:"The HTTP method to use when making the request.",options:{items:["GET","POST","PUT","DELETE","OPTIONS","HEAD"]}},{name:"content",type:"expression",label:"Content",hint:"The HTTP content to send along with the request."},{name:"statusCodes",type:"list",label:"Status Codes",hint:"A list of possible HTTP status codes to handle, comma-separated. Example: 200, 400, 404"}],outcomes:"x => !!x.state.statusCodes ? x.state.statusCodes : []"}};this.handleHttpRequest=function(){return{type:"HttpRequestEvent",displayName:"Handle HTTP Request",description:"Handle an incoming HTTP request.",category:t.Category,icon:"fas fa-cloud",properties:[{name:"path",type:"text",label:"Path",hint:"The relative path that triggers this activity."},{name:"method",type:"select",label:"Method",hint:"The HTTP method that triggers this activity.",options:{items:["GET","POST","PUT","DELETE","OPTIONS","HEAD"]}},{name:"readContent",type:"boolean",label:"Read Content",hint:"Check if the HTTP request content body should be read and stored as part of the HTTP request model. The stored format depends on the content-type header."}],runtimeDescription:"x => !!x.state.path ? `Handle <strong>${ x.state.method } ${ x.state.path }</strong>.` : x.definition.description",outcomes:[OutcomeNames.Done]}};this.sendHttpResponse=function(){return{type:"HttpResponseAction",displayName:"Send HTTP Response",description:"Send an HTTP response.",category:t.Category,icon:"fas fa-cloud",properties:[{name:"statusCode",type:"select",label:"Status Code",hint:"The HTTP status code to write.",options:{items:[{label:"2xx",options:[200,201,202,203,204]},{label:"3xx",options:[301,302,304,307,308]},{label:"4xx",options:[400,401,402,403,404,405,409,410,412,413,415,417,418,420,428,429]}]}},{name:"content",type:"expression",label:"Content",hint:"The HTTP content to write.",options:{multiline:true}},{name:"contentType",type:"select",label:"Content Type",hint:"The HTTP content type header to write.",options:{items:["text/plain","text/html","application/json","application/xml"]}},{name:"responseHeaders",type:"expression",label:"Response Headers",hint:"The headers to send along with the response. One 'header: value' pair per line.",options:{multiline:true}}],runtimeDescription:"x => !!x.state.statusCode ? `Send an HTTP <strong>${ x.state.statusCode }</strong><br/><br/> ${ x.state.contentType }</strong><br/>${ !!x.state.content ? x.state.content.expression ? x.state.content.expression.substr(0,100) + '...' : '' : '' }` : x.definition.description",outcomes:[OutcomeNames.Done]}}}return t}();HttpActivities.Category="HTTP";pluginStore.add(new HttpActivities);var MassTransitActivities=function(){function t(){var e=this;this.getName=function(){return"MassTransitActivities"};this.getActivityDefinitions=function(){return[e.receiveMassTransitMessage(),e.sendMassTransitMessage()]};this.receiveMassTransitMessage=function(){return{type:"ReceiveMassTransitMessage",displayName:"Receive MassTransit Message",description:"Receive a message via MassTransit.",category:t.Category,icon:"fas fa-envelope-open-text",properties:[{name:"messageType",type:"text",label:"Message Type",hint:"The assembly-qualified type name of the message to receive."}],outcomes:[OutcomeNames.Done]}};this.sendMassTransitMessage=function(){return{type:"SendMassTransitMessage",displayName:"Send MassTransit Message",description:"Send a message via MassTransit.",category:t.Category,icon:"fas fa-envelope",properties:[{name:"messageType",type:"text",label:"Message Type",hint:"The assembly-qualified type name of the message to send."},{name:"message",type:"expression",label:"Message",hint:"An expression that evaluates to the message to send."}],outcomes:[OutcomeNames.Done]}}}return t}();MassTransitActivities.Category="MassTransit";pluginStore.add(new MassTransitActivities);var PrimitiveActivities=function(){function t(){var e=this;this.getName=function(){return"PrimitiveActivities"};this.getActivityDefinitions=function(){return[e.log(),e.setVariable()]};this.log=function(){return{type:"Log",displayName:"Log",description:"Log a message.",category:t.Category,icon:"fas fa-feather-alt",properties:[{name:"message",type:"text",label:"Message",hint:"The text to log."},{name:"logLevel",type:"text",label:"Log Level",hint:"The log level to use."}],runtimeDescription:"x => !!x.state.message ? `Log <strong>${x.state.logLevel}: ${x.state.message}</strong>` : x.definition.description",outcomes:[OutcomeNames.Done]}};this.setVariable=function(){return{type:"SetVariable",displayName:"Set Variable",description:"Set a variable on the workflow.",category:t.Category,properties:[{name:"variableName",type:"text",label:"Variable Name",hint:"The name of the variable to store the value into."},{name:"expression",type:"expression",label:"Variable Expression",hint:"An expression that evaluates to the value to store in the variable."}],runtimeDescription:"x => !!x.state.variableName ? `${x.state.expression.syntax}: <strong>${x.state.variableName}</strong> = <strong>${x.state.expression.expression}</strong>` : x.definition.description",outcomes:[OutcomeNames.Done]}}}return t}();PrimitiveActivities.Category="Primitives";pluginStore.add(new PrimitiveActivities);var TimerActivities=function(){function t(){var e=this;this.getName=function(){return"TimerActivities"};this.getActivityDefinitions=function(){return[e.timerEvent()]};this.timerEvent=function(){return{type:"TimerEvent",displayName:"Timer Event",description:"Triggers after a specified amount of time.",category:t.Category,icon:"fas fa-hourglass-start",properties:[{name:"expression",type:"expression",label:"Timeout Expression",hint:"The amount of time to wait before this timer event is triggered. Format: 'd.HH:mm:ss'."},{name:"name",type:"text",label:"Name",hint:"Optionally provide a name for this activity. You can reference named activities from expressions."},{name:"title",type:"text",label:"Title",hint:"Optionally provide a custom title for this activity."},{name:"description",type:"text",label:"Description",hint:"Optionally provide a custom description for this activity."}],runtimeDescription:"x => !!x.state.expression ? `Triggers after <strong>${ x.state.expression.expression }</strong>` : x.definition.description",outcomes:[OutcomeNames.Done]}}}return t}();TimerActivities.Category="Timers";pluginStore.add(new TimerActivities);var designerHostCss=".workflow-designer-wrapper{height:80vh;overflow-y:auto}";var DesignerHost=exports("wf_designer_host",function(){function t(t){var e=this;registerInstance(this,t);this.workflowChanged=createEvent(this,"workflowChanged",7);this.activityDefinitions=[];this.loadActivityDefinitions=function(){var t=e.pluginsData||"";var n=t.split(/[ ,]+/).map((function(t){return t.trim()}));return pluginStore.list().filter((function(t){return n.indexOf(t.getName())>-1})).filter((function(t){return!!t.getActivityDefinitions})).map((function(t){return t.getActivityDefinitions()})).reduce((function(t,e){return t.concat(e)}),[])};this.onWorkflowChanged=function(t){e.workflowChanged.emit(t.detail)};this.initActivityDefinitions=function(){e.activityDefinitions=e.loadActivityDefinitions();if(!!e.activityDefinitionsData){var t=JSON.parse(e.activityDefinitionsData);e.activityDefinitions=__spreadArrays(e.activityDefinitions,t)}};this.initFieldDrivers=function(){DisplayManager$1.addDriver("text",new TextFieldDriver);DisplayManager$1.addDriver("expression",new ExpressionFieldDriver);DisplayManager$1.addDriver("list",new ListFieldDriver);DisplayManager$1.addDriver("boolean",new BooleanFieldDriver);DisplayManager$1.addDriver("select",new SelectFieldDriver)};this.initWorkflow=function(){if(!!e.workflowData){var t=JSON.parse(e.workflowData);if(!t.activities)t.activities=[];if(!t.connections)t.connections=[];e.designer.workflow=t}}}t.prototype.newWorkflow=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.designer.newWorkflow()];case 1:t.sent();return[2]}}))}))};t.prototype.getWorkflow=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.designer.getWorkflow()];case 1:return[2,t.sent()]}}))}))};t.prototype.showActivityPicker=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.activityPicker.show()];case 1:t.sent();return[2]}}))}))};t.prototype.export=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.importExport.export(this.designer,t)];case 1:e.sent();return[2]}}))}))};t.prototype.import=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.importExport.import()];case 1:t.sent();return[2]}}))}))};t.prototype.onActivityPicked=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.designer.addActivity(t.detail)];case 1:e.sent();return[2]}}))}))};t.prototype.onEditActivity=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.activityEditor.activity=t.detail;this.activityEditor.show=true;return[2]}))}))};t.prototype.onAddActivity=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.showActivityPicker()];case 1:t.sent();return[2]}}))}))};t.prototype.onUpdateActivity=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.designer.updateActivity(t.detail)];case 1:e.sent();return[2]}}))}))};t.prototype.onExportWorkflow=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.importExport)return[2];return[4,this.importExport.export(this.designer,t.detail)];case 1:e.sent();return[2]}}))}))};t.prototype.onImportWorkflow=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.designer.workflow=deepClone(t.detail);return[2]}))}))};t.prototype.componentWillLoad=function(){this.initActivityDefinitions();this.initFieldDrivers()};t.prototype.componentDidLoad=function(){this.initWorkflow()};t.prototype.render=function(){var t=this;var e=this.activityDefinitions;return h("host",null,h("wf-activity-picker",{activityDefinitions:e,ref:function(e){return t.activityPicker=e}}),h("wf-activity-editor",{activityDefinitions:e,ref:function(e){return t.activityEditor=e}}),h("wf-import-export",{ref:function(e){return t.importExport=e}}),h("div",{class:"workflow-designer-wrapper dragscroll"},h("wf-designer",{activityDefinitions:e,ref:function(e){return t.designer=e},canvasHeight:this.canvasHeight,workflow:this.workflow,readonly:this.readonly,onWorkflowChanged:this.onWorkflowChanged})))};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});return t}());DesignerHost.style=designerHostCss;var ExportButton=exports("wf_export_button",function(){function t(t){var e=this;registerInstance(this,t);this.exportClickedEvent=createEvent(this,"export",7);this.workflowFormats={json:{format:"json",fileExtension:".json",mimeType:"application/json",displayName:"JSON"},yaml:{format:"yaml",fileExtension:".yaml",mimeType:"application/x-yaml",displayName:"YAML"},xml:{format:"xml",fileExtension:".xml",mimeType:"application/xml",displayName:"XML"},object:{format:"object",fileExtension:".bin",mimeType:"application/binary",displayName:"Binary"}};this.getWorkflowHost=function(){return!!e.designerHostId?document.querySelector("#"+e.designerHostId):null};this.handleExportClick=function(t,n){return __awaiter(e,void 0,void 0,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:t.preventDefault();this.exportClickedEvent.emit(n);e=this.getWorkflowHost();if(!!!e)return[3,2];return[4,e.export(n)];case 1:i.sent();i.label=2;case 2:return[2]}}))}))}}t.prototype.render=function(){var t=this;var e=this.workflowFormats;return h("div",{class:"dropdown"},h("button",{class:"btn btn-secondary dropdown-toggle",type:"button",id:"exportButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"Export"),h("div",{class:"dropdown-menu","aria-labelledby":"exportButton"},Object.keys(e).map((function(n){var i=e[n];return h("a",{class:"dropdown-item",href:"#",onClick:function(e){return t.handleExportClick(e,i)}},i.displayName)}))))};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});return t}());var remedial=createCommonjsModule((function(t){(function(){var e=Function("return this")(),n="Boolean Number String Function Array Date RegExp Object".split(" "),i,r,o={};for(i in n){if(n.hasOwnProperty(i)){r=n[i];o["[object "+r+"]"]=r.toLowerCase()}}function s(t){return null===t||undefined===t?String(t):o[Object.prototype.toString.call(t)]||"object"}function a(t){var e,n;if(s(t)==="object"){for(e in t){n=t[e];if(n!==undefined&&s(n)!=="function"){return false}}}return true}if(!String.prototype.entityify){String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}if(!String.prototype.quote){String.prototype.quote=function(){var t,e,n=this.length,i='"';for(e=0;e<n;e+=1){t=this.charAt(e);if(t>=" "){if(t==="\\"||t==='"'){i+="\\"}i+=t}else{switch(t){case"\b":i+="\\b";break;case"\f":i+="\\f";break;case"\n":i+="\\n";break;case"\r":i+="\\r";break;case"\t":i+="\\t";break;default:t=t.charCodeAt();i+="\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)}}}return i+'"'}}if(!String.prototype.supplant){String.prototype.supplant=function(t){return this.replace(/{([^{}]*)}/g,(function(e,n){var i=t[n];return typeof i==="string"||typeof i==="number"?i:e}))}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s*(\S*(?:\s+\S+)*)\s*$/,"$1")}}t.exports={typeOf:s,isEmpty:a};e.typeOf=e.typeOf||s;e.isEmpty=e.isEmpty||a})()}));var json2yaml=createCommonjsModule((function(t){(function(){var e=remedial.typeOf;function n(t){var n,i="";n={undefined:function(){return"null"},null:function(){return"null"},number:function(t){return t},boolean:function(t){return t?"true":"false"},string:function(t){return JSON.stringify(t)},array:function(t){var r="";if(0===t.length){r+="[]";return r}i=i.replace(/$/,"  ");t.forEach((function(t){var o=n[e(t)];if(!o){throw new Error("what the crap: "+e(t))}r+="\n"+i+"- "+o(t)}));i=i.replace(/  /,"");return r},object:function(t){var r="";if(0===Object.keys(t).length){r+="{}";return r}i=i.replace(/$/,"  ");Object.keys(t).forEach((function(o){var s=t[o],a=n[e(s)];if("undefined"===typeof s){return}if(!a){throw new Error("what the crap: "+e(s))}r+="\n"+i+o+": "+a(s)}));i=i.replace(/  /,"");return r},function:function(){return"[object Function]"}};return"---"+n[e(t)](t)+"\n"}t.exports.stringify=n})()}));var importExportCss=".import-button{display:none}";var ImportExport=exports("wf_import_export",function(){function t(t){var e=this;registerInstance(this,t);this.importEvent=createEvent(this,"import-workflow",7);this.importWorkflow=function(){var t=e.fileInput.files[0];var n=new FileReader;n.onload=function(){return __awaiter(e,void 0,void 0,(function(){var t,e,i;return __generator(this,(function(r){switch(r.label){case 0:t=n.result;e="json";i={data:t,format:e};return[4,this.import(i)];case 1:r.sent();return[2]}}))}))};n.readAsText(t)};this.serialize=function(t,e){switch(e){case"json":return JSON.stringify(t);case"yaml":return json2yaml.stringify(t);case"xml":return JSON.stringify(t);default:return t}}}t.prototype.export=function(t,e){return __awaiter(this,void 0,void 0,(function(){var n,i,r,o,s;return __generator(this,(function(a){n=this.blobUrl;if(!!n){window.URL.revokeObjectURL(n)}i=t.workflow;r=this.serialize(i,e.format);o=new Blob([r],{type:e.mimeType});this.blobUrl=n=window.URL.createObjectURL(o);s=document.createElement("a");s.setAttribute("href",n);s.setAttribute("download","workflow."+e.fileExtension);document.body.appendChild(s);s.click();document.body.removeChild(s);return[2]}))}))};t.prototype.import=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(n){if(!t){this.fileInput.click()}else{e=JSON.parse(t.data);this.importEvent.emit(e)}return[2]}))}))};t.prototype.render=function(){var t=this;return h("host",null,h("input",{type:"file",class:"import-button",onChange:this.importWorkflow,ref:function(e){return t.fileInput=e}}))};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});return t}());ImportExport.style=importExportCss}}}));